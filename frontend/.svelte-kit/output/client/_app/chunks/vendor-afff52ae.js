function Gi(){}const xk=n=>n;function pd(n,e){for(const t in e)n[t]=e[t];return n}function sv(n){return n()}function Fm(){return Object.create(null)}function wa(n){n.forEach(sv)}function Mk(n){return typeof n=="function"}function Lk(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let ac;function mz(n,e){return ac||(ac=document.createElement("a")),ac.href=e,n===ac.href}function Fk(n){return Object.keys(n).length===0}function Uk(n,...e){if(n==null)return Gi;const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function _z(n,e,t){n.$$.on_destroy.push(Uk(e,t))}function yz(n,e,t,i){if(n){const r=ov(n,e,t,i);return n[0](r)}}function ov(n,e,t,i){return n[1]&&i?pd(t.ctx.slice(),n[1](i(e))):t.ctx}function wz(n,e,t,i){if(n[2]&&i){const r=n[2](i(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const s=[],o=Math.max(e.dirty.length,r.length);for(let a=0;a<o;a+=1)s[a]=e.dirty[a]|r[a];return s}return e.dirty|r}return e.dirty}function vz(n,e,t,i,r,s){if(r){const o=ov(e,t,i,s);n.p(o,r)}}function Iz(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Ez(n,e,t){return n.set(t),e}const av=typeof window!="undefined";let $k=av?()=>window.performance.now():()=>Date.now(),cv=av?n=>requestAnimationFrame(n):Gi;const Jr=new Set;function lv(n){Jr.forEach(e=>{e.c(n)||(Jr.delete(e),e.f())}),Jr.size!==0&&cv(lv)}function Vk(n){let e;return Jr.size===0&&cv(lv),{promise:new Promise(t=>{Jr.add(e={c:n,f:t})}),abort(){Jr.delete(e)}}}let Kl=!1;function Bk(){Kl=!0}function qk(){Kl=!1}function jk(n,e,t,i){for(;n<e;){const r=n+(e-n>>1);t(r)<=i?n=r+1:e=r}return n}function Kk(n){if(n.hydrate_init)return;n.hydrate_init=!0;let e=n.childNodes;if(n.nodeName==="HEAD"){const c=[];for(let l=0;l<e.length;l++){const u=e[l];u.claim_order!==void 0&&c.push(u)}e=c}const t=new Int32Array(e.length+1),i=new Int32Array(e.length);t[0]=-1;let r=0;for(let c=0;c<e.length;c++){const l=e[c].claim_order,u=(r>0&&e[t[r]].claim_order<=l?r+1:jk(1,r,d=>e[t[d]].claim_order,l))-1;i[c]=t[u]+1;const h=u+1;t[h]=c,r=Math.max(h,r)}const s=[],o=[];let a=e.length-1;for(let c=t[r]+1;c!=0;c=i[c-1]){for(s.push(e[c-1]);a>=c;a--)o.push(e[a]);a--}for(;a>=0;a--)o.push(e[a]);s.reverse(),o.sort((c,l)=>c.claim_order-l.claim_order);for(let c=0,l=0;c<o.length;c++){for(;l<s.length&&o[c].claim_order>=s[l].claim_order;)l++;const u=l<s.length?s[l]:null;n.insertBefore(o[c],u)}}function Wk(n,e){if(Kl){for(Kk(n),(n.actual_end_child===void 0||n.actual_end_child!==null&&n.actual_end_child.parentElement!==n)&&(n.actual_end_child=n.firstChild);n.actual_end_child!==null&&n.actual_end_child.claim_order===void 0;)n.actual_end_child=n.actual_end_child.nextSibling;e!==n.actual_end_child?(e.claim_order!==void 0||e.parentNode!==n)&&n.insertBefore(e,n.actual_end_child):n.actual_end_child=e.nextSibling}else(e.parentNode!==n||e.nextSibling!==null)&&n.appendChild(e)}function Tz(n,e,t){Kl&&!t?Wk(n,e):(e.parentNode!==n||e.nextSibling!=t)&&n.insertBefore(e,t||null)}function Gk(n){n.parentNode.removeChild(n)}function Hk(n){return document.createElement(n)}function Rf(n){return document.createTextNode(n)}function bz(){return Rf(" ")}function Sz(){return Rf("")}function Cz(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function kz(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function zk(n){return Array.from(n.childNodes)}function Qk(n){n.claim_info===void 0&&(n.claim_info={last_index:0,total_claimed:0})}function uv(n,e,t,i,r=!1){Qk(n);const s=(()=>{for(let o=n.claim_info.last_index;o<n.length;o++){const a=n[o];if(e(a)){const c=t(a);return c===void 0?n.splice(o,1):n[o]=c,r||(n.claim_info.last_index=o),a}}for(let o=n.claim_info.last_index-1;o>=0;o--){const a=n[o];if(e(a)){const c=t(a);return c===void 0?n.splice(o,1):n[o]=c,r?c===void 0&&n.claim_info.last_index--:n.claim_info.last_index=o,a}}return i()})();return s.claim_order=n.claim_info.total_claimed,n.claim_info.total_claimed+=1,s}function Yk(n,e,t,i){return uv(n,r=>r.nodeName===e,r=>{const s=[];for(let o=0;o<r.attributes.length;o++){const a=r.attributes[o];t[a.name]||s.push(a.name)}s.forEach(o=>r.removeAttribute(o))},()=>i(e))}function Az(n,e,t){return Yk(n,e,t,Hk)}function Xk(n,e){return uv(n,t=>t.nodeType===3,t=>{const i=""+e;if(t.data.startsWith(i)){if(t.data.length!==i.length)return t.splitText(i.length)}else t.data=i},()=>Rf(e),!0)}function Rz(n){return Xk(n," ")}function Nz(n,e){e=""+e,n.wholeText!==e&&(n.data=e)}function Pz(n,e){n.value=e==null?"":e}function Oz(n,e,t,i){t===null?n.style.removeProperty(e):n.style.setProperty(e,t,i?"important":"")}function Dz(n,e){for(let t=0;t<n.options.length;t+=1){const i=n.options[t];if(i.__value===e){i.selected=!0;return}}n.selectedIndex=-1}function xz(n){const e=n.querySelector(":checked")||n.options[0];return e&&e.__value}let Oo;function wo(n){Oo=n}function Nf(){if(!Oo)throw new Error("Function called outside component initialization");return Oo}function Mz(n){Nf().$$.on_mount.push(n)}function Lz(n){Nf().$$.after_update.push(n)}function Fz(n,e){Nf().$$.context.set(n,e)}const go=[],Um=[],Rc=[],$m=[],hv=Promise.resolve();let gd=!1;function dv(){gd||(gd=!0,hv.then(fv))}function Uz(){return dv(),hv}function md(n){Rc.push(n)}const yh=new Set;let cc=0;function fv(){const n=Oo;do{for(;cc<go.length;){const e=go[cc];cc++,wo(e),Jk(e.$$)}for(wo(null),go.length=0,cc=0;Um.length;)Um.pop()();for(let e=0;e<Rc.length;e+=1){const t=Rc[e];yh.has(t)||(yh.add(t),t())}Rc.length=0}while(go.length);for(;$m.length;)$m.pop()();gd=!1,yh.clear(),wo(n)}function Jk(n){if(n.fragment!==null){n.update(),wa(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(md)}}const Nc=new Set;let Ui;function $z(){Ui={r:0,c:[],p:Ui}}function Vz(){Ui.r||wa(Ui.c),Ui=Ui.p}function Zk(n,e){n&&n.i&&(Nc.delete(n),n.i(e))}function Bz(n,e,t,i){if(n&&n.o){if(Nc.has(n))return;Nc.add(n),Ui.c.push(()=>{Nc.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}}function qz(n,e){const t={},i={},r={$$scope:1};let s=n.length;for(;s--;){const o=n[s],a=e[s];if(a){for(const c in o)c in a||(i[c]=1);for(const c in a)r[c]||(t[c]=a[c],r[c]=1);n[s]=a}else for(const c in o)r[c]=1}for(const o in i)o in t||(t[o]=void 0);return t}function jz(n){return typeof n=="object"&&n!==null?n:{}}function Kz(n){n&&n.c()}function Wz(n,e){n&&n.l(e)}function e0(n,e,t,i){const{fragment:r,on_mount:s,on_destroy:o,after_update:a}=n.$$;r&&r.m(e,t),i||md(()=>{const c=s.map(sv).filter(Mk);o?o.push(...c):wa(c),n.$$.on_mount=[]}),a.forEach(md)}function t0(n,e){const t=n.$$;t.fragment!==null&&(wa(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function n0(n,e){n.$$.dirty[0]===-1&&(go.push(n),dv(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Gz(n,e,t,i,r,s,o,a=[-1]){const c=Oo;wo(n);const l=n.$$={fragment:null,ctx:null,props:s,update:Gi,not_equal:r,bound:Fm(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Fm(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};o&&o(l.root);let u=!1;if(l.ctx=t?t(n,e.props||{},(h,d,...f)=>{const p=f.length?f[0]:d;return l.ctx&&r(l.ctx[h],l.ctx[h]=p)&&(!l.skip_bound&&l.bound[h]&&l.bound[h](p),u&&n0(n,h)),d}):[],l.update(),u=!0,wa(l.before_update),l.fragment=i?i(l.ctx):!1,e.target){if(e.hydrate){Bk();const h=zk(e.target);l.fragment&&l.fragment.l(h),h.forEach(Gk)}else l.fragment&&l.fragment.c();e.intro&&Zk(n.$$.fragment),e0(n,e.target,e.anchor,e.customElement),qk(),fv()}wo(c)}class Hz{$destroy(){t0(this,1),this.$destroy=Gi}$on(e,t){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Fk(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $r=[];function i0(n,e=Gi){let t;const i=new Set;function r(a){if(Lk(n,a)&&(n=a,t)){const c=!$r.length;for(const l of i)l[1](),$r.push(l,n);if(c){for(let l=0;l<$r.length;l+=2)$r[l][0]($r[l+1]);$r.length=0}}}function s(a){r(a(n))}function o(a,c=Gi){const l=[a,c];return i.add(l),i.size===1&&(t=e(r)||Gi),a(n),()=>{i.delete(l),i.size===0&&(t(),t=null)}}return{set:r,update:s,subscribe:o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pv={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T=function(n,e){if(!n)throw Ms(e)},Ms=function(n){return new Error("Firebase Database ("+pv.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},r0=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],o=n[t++],a=n[t++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Wl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,l=c?n[r+2]:0,u=s>>2,h=(s&3)<<4|a>>4;let d=(a&15)<<2|l>>6,f=l&63;c||(f=64,o||(d=64)),i.push(t[u],t[h],t[d],t[f])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(gv(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):r0(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const l=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||l==null||h==null)throw Error();const d=s<<2|a>>4;if(i.push(d),l!==64){const f=a<<4&240|l>>2;if(i.push(f),h!==64){const p=l<<6&192|h;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Gl=function(n){const e=gv(n);return Wl.encodeByteArray(e,!0)},Vm=function(n){return Gl(n).replace(/\./g,"")},_d=function(n){try{return Wl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s0(n){return Do(void 0,n)}function Do(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!o0(t)||(n[t]=Do(n[t],e[t]));return n}function o0(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Vm(JSON.stringify(t)),Vm(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function te(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hl(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(te())}function Of(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function a0(){return typeof self=="object"&&self.self===self}function va(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Ia(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function c0(){return te().indexOf("Electron/")>=0}function Df(){const n=te();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function l0(){return te().indexOf("MSAppHost/")>=0}function mv(){return pv.NODE_ADMIN===!0}function u0(){return!Of()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function bt(){return typeof indexedDB=="object"}function Ea(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function zl(){return!(typeof navigator=="undefined"||!navigator.cookieEnabled)}function h0(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d0="FirebaseError";class de extends Error{constructor(e,t,i){super(t);this.code=e,this.customData=i,this.name=d0,Object.setPrototypeOf(this,de.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_t.prototype.create)}}class _t{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?f0(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new de(r,a,i)}}function f0(n,e){return n.replace(p0,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const p0=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(n){return JSON.parse(n)}function ve(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xf=function(n){let e={},t={},i={},r="";try{const s=n.split(".");e=xo(_d(s[0])||""),t=xo(_d(s[1])||""),r=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:r}},g0=function(n){const e=xf(n).claims;return typeof e=="object"&&e.hasOwnProperty("iat")?e.iat:null},m0=function(n){const e=xf(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},_0=function(n){const e=xf(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Zi(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function jc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Kc(n,e,t){const i={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=e.call(t,n[r],r,n));return i}function Wc(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],o=e[r];if(Bm(s)&&Bm(o)){if(!Wc(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function Bm(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function zr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function mo(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const d=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(d<<1|d>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,u;for(let h=0;h<80;h++){h<40?h<20?(l=a^s&(o^a),u=1518500249):(l=s^o^a,u=1859775393):h<60?(l=s&o|a&(s|o),u=2400959708):(l=s^o^a,u=3395469782);const d=(r<<5|r>>>27)+l+c+u+i[h]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=d}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const i=t-this.blockSize;let r=0;const s=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<t;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}}function _v(n,e){const t=new w0(n,e);return t.subscribe.bind(t)}class w0{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");v0(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=wh),r.error===void 0&&(r.error=wh),r.complete===void 0&&(r.complete=wh);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console!="undefined"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function v0(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wh(){}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R=function(n,e,t,i){let r;if(i<e?r="at least "+e:i>t&&(r=t===0?"none":"no more than "+t),r){const s=n+" failed: Was called with "+i+(i===1?" argument.":" arguments.")+" Expects "+r+".";throw new Error(s)}};function Tt(n,e){return`${n} failed: ${e} argument `}function Se(n,e,t,i){if(!(i&&!t)&&typeof t!="function")throw new Error(Tt(n,e)+"must be a valid function.")}function qm(n,e,t,i){if(!(i&&!t)&&(typeof t!="object"||t===null))throw new Error(Tt(n,e)+"must be a valid context object.")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I0=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){const s=r-55296;i++,T(i<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Ql=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E0=1e3,T0=2,b0=4*60*60*1e3,S0=.5;function Gc(n,e=E0,t=T0){const i=e*Math.pow(t,n),r=Math.round(S0*i*(Math.random()-.5)*2);return Math.min(b0,i+r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w(n){return n&&n._delegate?n._delegate:n}class q{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Di="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new we;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(k0(e))try{this.getOrInitializeService({instanceIdentifier:Di})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=Di){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Di){return this.instances.has(e)}getOptions(e=Di){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;const r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(!!i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:C0(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Di){return this.component?this.component.multipleInstances?e:Di:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function C0(n){return n===Di?void 0:n}function k0(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new yv(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mf=[];var x;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(x||(x={}));const vv={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},A0=x.INFO,R0={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},N0=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=R0[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Cn{constructor(e){this.name=e,this._logLevel=A0,this._logHandler=N0,this._userLogHandler=null,Mf.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?vv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}function P0(n){Mf.forEach(e=>{e.setLogLevel(n)})}function O0(n,e){for(const t of Mf){let i=null;e&&e.level&&(i=vv[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(r,s,...o)=>{const a=o.map(c=>{if(c==null)return null;if(typeof c=="string")return c;if(typeof c=="number"||typeof c=="boolean")return c.toString();if(c instanceof Error)return c.message;try{return JSON.stringify(c)}catch{return null}}).filter(c=>c).join(" ");s>=(i!=null?i:r.logLevel)&&n({level:x[s].toLowerCase(),message:a,args:o,type:r.name})}}}function D0(n){return Array.prototype.slice.call(n)}function Iv(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Yl(n,e,t){var i,r=new Promise(function(s,o){i=n[e].apply(n,t),Iv(i).then(s,o)});return r.request=i,r}function x0(n,e,t){var i=Yl(n,e,t);return i.then(function(r){if(!!r)return new Mo(r,i.request)})}function Ls(n,e,t){t.forEach(function(i){Object.defineProperty(n.prototype,i,{get:function(){return this[e][i]},set:function(r){this[e][i]=r}})})}function Lf(n,e,t,i){i.forEach(function(r){r in t.prototype&&(n.prototype[r]=function(){return Yl(this[e],r,arguments)})})}function Xl(n,e,t,i){i.forEach(function(r){r in t.prototype&&(n.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function Ev(n,e,t,i){i.forEach(function(r){r in t.prototype&&(n.prototype[r]=function(){return x0(this[e],r,arguments)})})}function br(n){this._index=n}Ls(br,"_index",["name","keyPath","multiEntry","unique"]);Lf(br,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]);Ev(br,"_index",IDBIndex,["openCursor","openKeyCursor"]);function Mo(n,e){this._cursor=n,this._request=e}Ls(Mo,"_cursor",["direction","key","primaryKey","value"]);Lf(Mo,"_cursor",IDBCursor,["update","delete"]);["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(Mo.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),Iv(e._request).then(function(i){if(!!i)return new Mo(i,e._request)})})})});function kn(n){this._store=n}kn.prototype.createIndex=function(){return new br(this._store.createIndex.apply(this._store,arguments))};kn.prototype.index=function(){return new br(this._store.index.apply(this._store,arguments))};Ls(kn,"_store",["name","keyPath","indexNames","autoIncrement"]);Lf(kn,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]);Ev(kn,"_store",IDBObjectStore,["openCursor","openKeyCursor"]);Xl(kn,"_store",IDBObjectStore,["deleteIndex"]);function Ta(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}Ta.prototype.objectStore=function(){return new kn(this._tx.objectStore.apply(this._tx,arguments))};Ls(Ta,"_tx",["objectStoreNames","mode"]);Xl(Ta,"_tx",IDBTransaction,["abort"]);function Jl(n,e,t){this._db=n,this.oldVersion=e,this.transaction=new Ta(t)}Jl.prototype.createObjectStore=function(){return new kn(this._db.createObjectStore.apply(this._db,arguments))};Ls(Jl,"_db",["name","version","objectStoreNames"]);Xl(Jl,"_db",IDBDatabase,["deleteObjectStore","close"]);function Zl(n){this._db=n}Zl.prototype.transaction=function(){return new Ta(this._db.transaction.apply(this._db,arguments))};Ls(Zl,"_db",["name","version","objectStoreNames"]);Xl(Zl,"_db",IDBDatabase,["close"]);["openCursor","openKeyCursor"].forEach(function(n){[kn,br].forEach(function(e){n in e.prototype&&(e.prototype[n.replace("open","iterate")]=function(){var t=D0(arguments),i=t[t.length-1],r=this._store||this._index,s=r[n].apply(r,t.slice(0,-1));s.onsuccess=function(){i(s.result)}})})});[br,kn].forEach(function(n){n.prototype.getAll||(n.prototype.getAll=function(e,t){var i=this,r=[];return new Promise(function(s){i.iterateCursor(e,function(o){if(!o){s(r);return}if(r.push(o.value),t!==void 0&&r.length==t){s(r);return}o.continue()})})})});function Fs(n,e,t){var i=Yl(indexedDB,"open",[n,e]),r=i.request;return r&&(r.onupgradeneeded=function(s){t&&t(new Jl(r.result,s.oldVersion,r.transaction))}),i.then(function(s){return new Zl(s)})}function Zr(n){return Yl(indexedDB,"deleteDatabase",[n])}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(L0(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function L0(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const yd="@firebase/app",jm="0.7.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ff=new Cn("@firebase/app"),F0="@firebase/app-compat",U0="@firebase/analytics-compat",$0="@firebase/analytics",V0="@firebase/app-check-compat",B0="@firebase/app-check",q0="@firebase/auth",j0="@firebase/auth-compat",K0="@firebase/database",W0="@firebase/database-compat",G0="@firebase/functions",H0="@firebase/functions-compat",z0="@firebase/installations",Q0="@firebase/installations-compat",Y0="@firebase/messaging",X0="@firebase/messaging-compat",J0="@firebase/performance",Z0="@firebase/performance-compat",eA="@firebase/remote-config",tA="@firebase/remote-config-compat",nA="@firebase/storage",iA="@firebase/storage-compat",rA="@firebase/firestore",sA="@firebase/firestore-compat",oA="firebase",aA="9.6.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const er="[DEFAULT]",cA={[yd]:"fire-core",[F0]:"fire-core-compat",[$0]:"fire-analytics",[U0]:"fire-analytics-compat",[B0]:"fire-app-check",[V0]:"fire-app-check-compat",[q0]:"fire-auth",[j0]:"fire-auth-compat",[K0]:"fire-rtdb",[W0]:"fire-rtdb-compat",[G0]:"fire-fn",[H0]:"fire-fn-compat",[z0]:"fire-iid",[Q0]:"fire-iid-compat",[Y0]:"fire-fcm",[X0]:"fire-fcm-compat",[J0]:"fire-perf",[Z0]:"fire-perf-compat",[eA]:"fire-rc",[tA]:"fire-rc-compat",[nA]:"fire-gcs",[iA]:"fire-gcs-compat",[rA]:"fire-fst",[sA]:"fire-fst-compat","fire-js":"fire-js",[oA]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pi=new Map,Lo=new Map;function Hc(n,e){try{n.container.addComponent(e)}catch(t){Ff.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Tv(n,e){n.container.addOrOverwriteComponent(e)}function le(n){const e=n.name;if(Lo.has(e))return Ff.debug(`There were multiple attempts to register component ${e}.`),!1;Lo.set(e,n);for(const t of pi.values())Hc(t,n);return!0}function An(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function lA(n,e,t=er){An(n,e).clearInstance(t)}function uA(){Lo.clear()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hA={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."},jn=new _t("app","Firebase",hA);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new q("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw jn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rn=aA;function bv(n,e={}){typeof e!="object"&&(e={name:e});const t=Object.assign({name:er,automaticDataCollectionEnabled:!1},e),i=t.name;if(typeof i!="string"||!i)throw jn.create("bad-app-name",{appName:String(i)});const r=pi.get(i);if(r){if(Wc(n,r.options)&&Wc(t,r.config))return r;throw jn.create("duplicate-app",{appName:i})}const s=new wv(i);for(const a of Lo.values())s.addComponent(a);const o=new dA(n,t,s);return pi.set(i,o),o}function eu(n=er){const e=pi.get(n);if(!e)throw jn.create("no-app",{appName:n});return e}function fA(){return Array.from(pi.values())}async function Sv(n){const e=n.name;pi.has(e)&&(pi.delete(e),await Promise.all(n.container.getProviders().map(t=>t.delete())),n.isDeleted=!0)}function Q(n,e,t){var i;let r=(i=cA[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ff.warn(a.join(" "));return}le(new q(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}function Cv(n,e){if(n!==null&&typeof n!="function")throw jn.create("invalid-log-argument");O0(n,e)}function kv(n){P0(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pA="firebase-heartbeat-database",gA=1,tr="firebase-heartbeat-store";let vh=null;function Uf(){return vh||(vh=Fs(pA,gA,n=>{switch(n.oldVersion){case 0:n.createObjectStore(tr)}}).catch(n=>{throw jn.create("storage-open",{originalErrorMessage:n.message})})),vh}async function mA(n){try{return(await Uf()).transaction(tr).objectStore(tr).get($f(n))}catch(e){throw jn.create("storage-get",{originalErrorMessage:e.message})}}async function Ih(n,e){try{const i=(await Uf()).transaction(tr,"readwrite");return await i.objectStore(tr).put(e,$f(n)),i.complete}catch(t){throw jn.create("storage-set",{originalErrorMessage:t.message})}}async function _A(n){try{const t=(await Uf()).transaction(tr,"readwrite");return await t.objectStore(tr).delete($f(n)),t.complete}catch(e){throw jn.create("storage-delete",{originalErrorMessage:e.message})}}function $f(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yA=1024,wA=30*24*60*60*1e3;class vA{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new TA(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=IA();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!this._heartbeatsCache.some(r=>r.date===i))return this._heartbeatsCache.push({date:i,userAgent:t}),this._heartbeatsCache=this._heartbeatsCache.filter(r=>{const s=new Date(r.date).valueOf();return Date.now()-s<=wA}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null)return"";const{heartbeatsToSend:e,unsentEntries:t}=EA(this._heartbeatsCache),i=Gl(JSON.stringify({version:2,heartbeats:e}));return t.length>0?(this._heartbeatsCache=t,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache=null,this._storage.deleteAll()),i}}function IA(){return new Date().toISOString().substring(0,10)}function EA(n,e=yA){const t=[];let i=n.slice();for(const r of n){const s=t.find(o=>o.userAgent===r.userAgent);if(s){if(s.dates.push(r.date),Km(t)>e){s.dates.pop();break}}else if(t.push({userAgent:r.userAgent,dates:[r.date]}),Km(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class TA{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return bt()?Ea().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await mA(this.app);return(t==null?void 0:t.heartbeats)||[]}else return[]}async overwrite(e){if(await this._canUseIndexedDBPromise)return Ih(this.app,{heartbeats:e})}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Ih(this.app,{heartbeats:[...i,...e]})}else return}async delete(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Ih(this.app,{heartbeats:i.filter(r=>!e.includes(r))})}else return}async deleteAll(){if(await this._canUseIndexedDBPromise)return _A(this.app)}}function Km(n){return Gl(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bA(n){le(new q("platform-logger",e=>new M0(e),"PRIVATE")),le(new q("heartbeat",e=>new vA(e),"PRIVATE")),Q(yd,jm,n),Q(yd,jm,"esm2017"),Q("fire-js","")}bA("");var SA=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",SDK_VERSION:Rn,_DEFAULT_ENTRY_NAME:er,_addComponent:Hc,_addOrOverwriteComponent:Tv,_apps:pi,_clearComponents:uA,_components:Lo,_getProvider:An,_registerComponent:le,_removeServiceInstance:lA,deleteApp:Sv,getApp:eu,getApps:fA,initializeApp:bv,onLog:Cv,registerVersion:Q,setLogLevel:kv,FirebaseError:de}),CA="firebase",kA="9.6.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Q(CA,kA,"app");/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Vf(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}const io={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Vr={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AA(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}function Av(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const RA=AA,NA=Av,Rv=new _t("auth","Firebase",Av());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm=new Cn("@firebase/auth");function Pc(n,...e){Wm.logLevel<=x.ERROR&&Wm.error(`Auth (${Rn}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Me(n,...e){throw Bf(n,...e)}function ze(n,...e){return Bf(n,...e)}function Nv(n,e,t){const i=Object.assign(Object.assign({},NA()),{[e]:t});return new _t("auth","Firebase",i).create(e,{appName:n.name})}function Us(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Me(n,"argument-error"),Nv(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Bf(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Rv.create(n,...e)}function E(n,e,...t){if(!n)throw Bf(e,...t)}function dn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Pc(e),new Error(e)}function nn(n,e){n||dn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm=new Map;function Nt(n){nn(n instanceof Function,"Expected a class definition");let e=Gm.get(n);return e?(nn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Gm.set(n,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PA(n,e){const t=An(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(Wc(s,e!=null?e:{}))return r;Me(r,"already-initialized")}return t.initialize({options:e})}function OA(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Nt);(e==null?void 0:e.errorMap)&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fo(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function qf(){return Hm()==="http:"||Hm()==="https:"}function Hm(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DA(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qf()||va()||"connection"in navigator)?navigator.onLine:!0}function xA(){if(typeof navigator=="undefined")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e,t){this.shortDelay=e,this.longDelay=t,nn(t>e,"Short delay should be less than long delay!"),this.isMobile=Hl()||Ia()}get(){return DA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jf(n,e){nn(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pv{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;dn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;dn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;dn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=new ba(3e4,6e4);function Ee(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ve(n,e,t,i,r={}){return Ov(n,r,async()=>{let s={},o={};i&&(e==="GET"?o=i:s={body:JSON.stringify(i)});const a=Tr(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),Pv.fetch()(Dv(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))})}async function Ov(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},MA),e);try{const r=new FA(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw Oc(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Oc(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Oc(n,"email-already-in-use",o);const u=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Nv(n,u,l);Me(n,u)}}catch(r){if(r instanceof de)throw r;Me(n,"network-request-failed")}}async function zn(n,e,t,i,r={}){const s=await Ve(n,e,t,i,r);return"mfaPendingCredential"in s&&Me(n,"multi-factor-auth-required",{_serverResponse:s}),s}function Dv(n,e,t,i){const r=`${e}${t}?${i}`;return n.config.emulator?jf(n.config,r):`${n.config.apiScheme}://${r}`}class FA{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(ze(this.auth,"network-request-failed")),LA.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Oc(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=ze(n,e,i);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UA(n,e){return Ve(n,"POST","/v1/accounts:delete",e)}async function $A(n,e){return Ve(n,"POST","/v1/accounts:update",e)}async function VA(n,e){return Ve(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(n){if(!!n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function BA(n,e=!1){const t=w(n),i=await t.getIdToken(e),r=tu(i);E(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:vo(Eh(r.auth_time)),issuedAtTime:vo(Eh(r.iat)),expirationTime:vo(Eh(r.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Eh(n){return Number(n)*1e3}function tu(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Pc("JWT malformed, contained fewer than 3 sections"),null;try{const r=_d(t);return r?JSON.parse(r):(Pc("Failed to decode base64 JWT payload"),null)}catch(r){return Pc("Caught error parsing JWT payload as JSON",r),null}}function qA(n){const e=tu(n);return E(e,"internal-error"),E(typeof e.exp!="undefined","internal-error"),E(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kn(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof de&&jA(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function jA({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=vo(this.lastLoginAt),this.creationTime=vo(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uo(n){var e;const t=n.auth,i=await n.getIdToken(),r=await Kn(n,VA(t,{idToken:i}));E(r==null?void 0:r.users.length,t,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=((e=s.providerUserInfo)===null||e===void 0?void 0:e.length)?HA(s.providerUserInfo):[],a=GA(n.providerData,o),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(a==null?void 0:a.length),u=c?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new xv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function WA(n){const e=w(n);await Uo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function GA(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function HA(n){return n.map(e=>{var{providerId:t}=e,i=Vf(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zA(n,e){const t=await Ov(n,{},async()=>{const i=Tr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=Dv(n,r,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Pv.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){E(e.idToken,"internal-error"),E(typeof e.idToken!="undefined","internal-error"),E(typeof e.refreshToken!="undefined","internal-error");const t="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):qA(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return E(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await zA(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new $o;return i&&(E(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(E(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(E(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $o,this.toJSON())}_performRefresh(){return dn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(n,e){E(typeof n=="string"||typeof n=="undefined","internal-error",{appName:e})}class Hi{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=Vf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new KA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new xv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Kn(this,this.stsTokenManager.getToken(this.auth,e));return E(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return BA(this,e)}reload(){return WA(this)}_assign(e){this!==e&&(E(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Hi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){E(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await Uo(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Kn(this,UA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,l,u;const h=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(r=t.email)!==null&&r!==void 0?r:void 0,f=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,_=(a=t.tenantId)!==null&&a!==void 0?a:void 0,v=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,P=(l=t.createdAt)!==null&&l!==void 0?l:void 0,V=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:W,emailVerified:z,isAnonymous:Lt,providerData:Ft,stsTokenManager:Nn}=t;E(W&&Nn,e,"internal-error");const Pi=$o.fromJSON(this.name,Nn);E(typeof W=="string",e,"internal-error"),Zn(h,e.name),Zn(d,e.name),E(typeof z=="boolean",e,"internal-error"),E(typeof Lt=="boolean",e,"internal-error"),Zn(f,e.name),Zn(p,e.name),Zn(_,e.name),Zn(v,e.name),Zn(P,e.name),Zn(V,e.name);const Oi=new Hi({uid:W,auth:e,email:d,emailVerified:z,displayName:h,isAnonymous:Lt,photoURL:p,phoneNumber:f,tenantId:_,stsTokenManager:Pi,createdAt:P,lastLoginAt:V});return Ft&&Array.isArray(Ft)&&(Oi.providerData=Ft.map(Dk=>Object.assign({},Dk))),v&&(Oi._redirectEventId=v),Oi}static async _fromIdTokenResponse(e,t,i=!1){const r=new $o;r.updateFromServerResponse(t);const s=new Hi({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await Uo(s),s}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mv{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Mv.type="NONE";const hs=Mv;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(n,e,t){return`firebase:${n}:${e}:${t}`}class es{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=zi(this.userKey,r.apiKey,s),this.fullPersistenceKey=zi("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Hi._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new es(Nt(hs),e,i);const r=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=r[0]||Nt(hs);const o=zi(i,e.config.apiKey,e.name);let a=null;for(const l of t)try{const u=await l._get(o);if(u){const h=Hi._fromJSON(e,u);l!==s&&(a=h),s=l;break}}catch{}const c=r.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new es(s,e,i):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async l=>{if(l!==s)try{await l._remove(o)}catch{}})),new es(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Uv(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Lv(e))return"Firefox";if(e.includes("silk/"))return"Silk";if($v(e))return"Blackberry";if(Vv(e))return"Webos";if(Kf(e))return"Safari";if((e.includes("chrome/")||Fv(e))&&!e.includes("edge/"))return"Chrome";if(Sa(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Lv(n=te()){return/firefox\//i.test(n)}function Kf(n=te()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Fv(n=te()){return/crios\//i.test(n)}function Uv(n=te()){return/iemobile/i.test(n)}function Sa(n=te()){return/android/i.test(n)}function $v(n=te()){return/blackberry/i.test(n)}function Vv(n=te()){return/webos/i.test(n)}function $s(n=te()){return/iphone|ipad|ipod/i.test(n)}function QA(n=te()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function YA(n=te()){var e;return $s(n)&&!!((e=window.navigator)===null||e===void 0?void 0:e.standalone)}function XA(){return Df()&&document.documentMode===10}function Bv(n=te()){return $s(n)||Sa(n)||Vv(n)||$v(n)||/windows phone/i.test(n)||Uv(n)}function JA(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qv(n,e=[]){let t;switch(n){case"Browser":t=zm(te());break;case"Worker":t=`${zm(te())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Rn}/${i}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZA{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qm(this),this.idTokenSubscription=new Qm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Rv,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Nt(t)),this._initializationPromise=this.queue(async()=>{var i,r;if(!this._deleted&&(this.persistenceManager=await es.create(this,e),!this._deleted)){if((i=this._popupRedirectResolver)===null||i===void 0?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t;let i=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,s=i==null?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);(!r||r===s)&&(o==null?void 0:o.user)&&(i=o.user)}return i?i._redirectEventId?(E(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)):this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Uo(e)}catch(t){if(t.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=xA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?w(e):null;return t&&E(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&E(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Nt(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _t("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Nt(e)||this._popupRedirectResolver;E(t,this,"argument-error"),this.redirectPersistenceManager=await es.create(this,[Nt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return E(o,this,"internal-error"),o.then(()=>s(this.currentUser)),typeof t=="function"?e.addObserver(t,i,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return E(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={["X-Client-Version"]:this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function Le(n){return w(n)}class Qm{constructor(e){this.auth=e,this.observer=null,this.addObserver=_v(t=>this.observer=t)}get next(){return E(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function eR(n,e,t){const i=Le(n);E(i._canInitEmulator,i,"emulator-config-failed"),E(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!(t==null?void 0:t.disableWarnings),s=jv(e),{host:o,port:a}=tR(e),c=a===null?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||nR()}function jv(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function tR(n){const e=jv(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:Ym(i.substr(s.length+1))}}else{const[s,o]=i.split(":");return{host:s,port:Ym(o)}}}function Ym(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function nR(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console!="undefined"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window!="undefined"&&typeof document!="undefined"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return dn("not implemented")}_getIdTokenResponse(e){return dn("not implemented")}_linkToIdToken(e,t){return dn("not implemented")}_getReauthenticationResolver(e){return dn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kv(n,e){return Ve(n,"POST","/v1/accounts:resetPassword",Ee(n,e))}async function Wv(n,e){return Ve(n,"POST","/v1/accounts:update",e)}async function iR(n,e){return Ve(n,"POST","/v1/accounts:update",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rR(n,e){return zn(n,"POST","/v1/accounts:signInWithPassword",Ee(n,e))}async function nu(n,e){return Ve(n,"POST","/v1/accounts:sendOobCode",Ee(n,e))}async function sR(n,e){return nu(n,e)}async function oR(n,e){return nu(n,e)}async function aR(n,e){return nu(n,e)}async function cR(n,e){return nu(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lR(n,e){return zn(n,"POST","/v1/accounts:signInWithEmailLink",Ee(n,e))}async function uR(n,e){return zn(n,"POST","/v1/accounts:signInWithEmailLink",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo extends Vs{constructor(e,t,i,r=null){super("password",i);this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Vo(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new Vo(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if((t==null?void 0:t.email)&&(t==null?void 0:t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return rR(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return lR(e,{email:this._email,oobCode:this._password});default:Me(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Wv(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return uR(e,{idToken:t,email:this._email,oobCode:this._password});default:Me(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Un(n,e){return zn(n,"POST","/v1/accounts:signInWithIdp",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hR="http://localhost";class vn extends Vs{constructor(){super(...arguments);this.pendingToken=null}static _fromParams(e){const t=new vn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Me("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r}=t,s=Vf(t,["providerId","signInMethod"]);if(!i||!r)return null;const o=new vn(i,r);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Un(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Un(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Un(e,t)}buildRequest(){const e={requestUri:hR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Tr(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dR(n,e){return Ve(n,"POST","/v1/accounts:sendVerificationCode",Ee(n,e))}async function fR(n,e){return zn(n,"POST","/v1/accounts:signInWithPhoneNumber",Ee(n,e))}async function pR(n,e){const t=await zn(n,"POST","/v1/accounts:signInWithPhoneNumber",Ee(n,e));if(t.temporaryProof)throw Oc(n,"account-exists-with-different-credential",t);return t}const gR={USER_NOT_FOUND:"user-not-found"};async function mR(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return zn(n,"POST","/v1/accounts:signInWithPhoneNumber",Ee(n,t),gR)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi extends Vs{constructor(e){super("phone","phone");this.params=e}static _fromVerification(e,t){return new Qi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Qi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return fR(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return pR(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return mR(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s}=e;return!i&&!t&&!r&&!s?null:new Qi({verificationId:t,verificationCode:i,phoneNumber:r,temporaryProof:s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function yR(n){const e=zr(mo(n)).link,t=e?zr(mo(e)).deep_link_id:null,i=zr(mo(n)).deep_link_id;return(i?zr(mo(i)).link:null)||i||t||e||n}class iu{constructor(e){var t,i,r,s,o,a;const c=zr(mo(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(i=c.oobCode)!==null&&i!==void 0?i:null,h=_R((r=c.mode)!==null&&r!==void 0?r:null);E(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=yR(e);try{return new iu(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(){this.providerId=Si.PROVIDER_ID}static credential(e,t){return Vo._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=iu.parseLink(t);return E(i,"argument-error"),Vo._fromEmailAndCode(e,i.code,i.tenantId)}}Si.PROVIDER_ID="password";Si.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Si.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs extends Qn{constructor(){super(...arguments);this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ts extends Bs{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return E("providerId"in t&&"signInMethod"in t,"argument-error"),vn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return E(e.idToken||e.accessToken,"argument-error"),vn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ts.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ts.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i,oauthTokenSecret:r,pendingToken:s,nonce:o,providerId:a}=e;if(!i&&!r&&!t&&!s||!a)return null;try{return new ts(a)._credential({idToken:t,accessToken:i,nonce:o,pendingToken:s})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an extends Bs{constructor(){super("facebook.com")}static credential(e){return vn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.FACEBOOK_SIGN_IN_METHOD="facebook.com";an.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn extends Bs{constructor(){super("google.com");this.addScope("profile")}static credential(e,t){return vn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return cn.credential(t,i)}catch{return null}}}cn.GOOGLE_SIGN_IN_METHOD="google.com";cn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln extends Bs{constructor(){super("github.com")}static credential(e){return vn._fromParams({providerId:ln.PROVIDER_ID,signInMethod:ln.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ln.credentialFromTaggedObject(e)}static credentialFromError(e){return ln.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ln.credential(e.oauthAccessToken)}catch{return null}}}ln.GITHUB_SIGN_IN_METHOD="github.com";ln.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wR="http://localhost";class ds extends Vs{constructor(e,t){super(e,e);this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Un(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Un(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Un(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,pendingToken:s}=t;return!i||!r||!s||i!==r?null:new ds(i,s)}static _create(e,t){return new ds(e,t)}buildRequest(){return{requestUri:wR,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vR="saml.";class zc extends Qn{constructor(e){E(e.startsWith(vR),"argument-error");super(e)}static credentialFromResult(e){return zc.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return zc.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=ds.fromJSON(e);return E(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:i}=e;if(!t||!i)return null;try{return ds._create(i,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un extends Bs{constructor(){super("twitter.com")}static credential(e,t){return vn._fromParams({providerId:un.PROVIDER_ID,signInMethod:un.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return un.credentialFromTaggedObject(e)}static credentialFromError(e){return un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return un.credential(t,i)}catch{return null}}}un.TWITTER_SIGN_IN_METHOD="twitter.com";un.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gv(n,e){return zn(n,"POST","/v1/accounts:signUp",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await Hi._fromIdTokenResponse(e,i,r),o=Xm(i);return new Gt({user:s,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=Xm(i);return new Gt({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function Xm(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IR(n){var e;const t=Le(n);if(await t._initializationPromise,(e=t.currentUser)===null||e===void 0?void 0:e.isAnonymous)return new Gt({user:t.currentUser,providerId:null,operationType:"signIn"});const i=await Gv(t,{returnSecureToken:!0}),r=await Gt._fromIdTokenResponse(t,"signIn",i,!0);return await t._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc extends de{constructor(e,t,i,r){var s;super(t.code,t.message);this.operationType=i,this.user=r,Object.setPrototypeOf(this,Qc.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new Qc(e,t,i,r)}}function Hv(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Qc._fromErrorAndOperation(n,s,e,i):s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ER(n,e){const t=w(n);await ru(!0,t,e);const{providerUserInfo:i}=await $A(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),r=zv(i||[]);return t.providerData=t.providerData.filter(s=>r.has(s.providerId)),r.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Wf(n,e,t=!1){const i=await Kn(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Gt._forOperation(n,"link",i)}async function ru(n,e,t){await Uo(e);const i=zv(e.providerData),r=n===!1?"provider-already-linked":"no-such-provider";E(i.has(t)===n,e.auth,r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qv(n,e,t=!1){const{auth:i}=n,r="reauthenticate";try{const s=await Kn(n,Hv(i,r,e,n),t);E(s.idToken,i,"internal-error");const o=tu(s.idToken);E(o,i,"internal-error");const{sub:a}=o;return E(n.uid===a,i,"user-mismatch"),Gt._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Me(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yv(n,e,t=!1){const i="signIn",r=await Hv(n,i,e),s=await Gt._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}async function su(n,e){return Yv(Le(n),e)}async function Xv(n,e){const t=w(n);return await ru(!1,t,e.providerId),Wf(t,e)}async function Jv(n,e){return Qv(w(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TR(n,e){return zn(n,"POST","/v1/accounts:signInWithCustomToken",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bR(n,e){const t=Le(n),i=await TR(t,{token:e,returnSecureToken:!0}),r=await Gt._fromIdTokenResponse(t,"signIn",i);return await t._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Gf._fromServerResponse(e,t):Me(e,"internal-error")}}class Gf extends ou{constructor(e){super("phone",e);this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Gf(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function au(n,e,t){var i;E(((i=t.url)===null||i===void 0?void 0:i.length)>0,n,"invalid-continue-uri"),E(typeof t.dynamicLinkDomain=="undefined"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(E(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(E(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SR(n,e,t){const i=w(n),r={requestType:"PASSWORD_RESET",email:e};t&&au(i,r,t),await oR(i,r)}async function CR(n,e,t){await Kv(w(n),{oobCode:e,newPassword:t})}async function kR(n,e){await iR(w(n),{oobCode:e})}async function Zv(n,e){const t=w(n),i=await Kv(t,{oobCode:e}),r=i.requestType;switch(E(r,t,"internal-error"),r){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":E(i.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":E(i.mfaInfo,t,"internal-error");default:E(i.email,t,"internal-error")}let s=null;return i.mfaInfo&&(s=ou._fromServerResponse(Le(t),i.mfaInfo)),{data:{email:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.newEmail:i.email)||null,previousEmail:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.email:i.newEmail)||null,multiFactorInfo:s},operation:r}}async function AR(n,e){const{data:t}=await Zv(w(n),e);return t.email}async function RR(n,e,t){const i=Le(n),r=await Gv(i,{returnSecureToken:!0,email:e,password:t}),s=await Gt._fromIdTokenResponse(i,"signIn",r);return await i._updateCurrentUser(s.user),s}function NR(n,e,t){return su(w(n),Si.credential(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PR(n,e,t){const i=w(n),r={requestType:"EMAIL_SIGNIN",email:e};E(t.handleCodeInApp,i,"argument-error"),t&&au(i,r,t),await aR(i,r)}function OR(n,e){const t=iu.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function DR(n,e,t){const i=w(n),r=Si.credentialWithLink(e,t||Fo());return E(r._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),su(i,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xR(n,e){return Ve(n,"POST","/v1/accounts:createAuthUri",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MR(n,e){const t=qf()?Fo():"http://localhost",i={identifier:e,continueUri:t},{signinMethods:r}=await xR(w(n),i);return r||[]}async function LR(n,e){const t=w(n),i=await n.getIdToken(),r={requestType:"VERIFY_EMAIL",idToken:i};e&&au(t.auth,r,e);const{email:s}=await sR(t.auth,r);s!==n.email&&await n.reload()}async function FR(n,e,t){const i=w(n),r=await n.getIdToken(),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:r,newEmail:e};t&&au(i.auth,s,t);const{email:o}=await cR(i.auth,s);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UR(n,e){return Ve(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $R(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=w(n),s={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Kn(i,UR(i.auth,s));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function VR(n,e){return eI(w(n),e,null)}function BR(n,e){return eI(w(n),null,e)}async function eI(n,e,t){const{auth:i}=n,s={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);const o=await Kn(n,Wv(i,s));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qR(n){var e,t;if(!n)return null;const{providerId:i}=n,r=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!i&&(n==null?void 0:n.idToken)){const o=(t=(e=tu(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ns(s,a)}}if(!i)return null;switch(i){case"facebook.com":return new jR(s,r);case"github.com":return new KR(s,r);case"google.com":return new WR(s,r);case"twitter.com":return new GR(s,r,n.screenName||null);case"custom":case"anonymous":return new ns(s,null);default:return new ns(s,i,r)}}class ns{constructor(e,t,i={}){this.isNewUser=e,this.providerId=t,this.profile=i}}class tI extends ns{constructor(e,t,i,r){super(e,t,i);this.username=r}}class jR extends ns{constructor(e,t){super(e,"facebook.com",t)}}class KR extends tI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class WR extends ns{constructor(e,t){super(e,"google.com",t)}}class GR extends tI{constructor(e,t,i){super(e,"twitter.com",t,i)}}function HR(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:qR(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zz(n,e){return w(n).setPersistence(e)}class $i{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new $i("enroll",e)}static _fromMfaPendingCredential(e){return new $i("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,i;if(e==null?void 0:e.multiFactorSession){if((t=e.multiFactorSession)===null||t===void 0?void 0:t.pendingCredential)return $i._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((i=e.multiFactorSession)===null||i===void 0?void 0:i.idToken)return $i._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,t,i){this.session=e,this.hints=t,this.signInResolver=i}static _fromError(e,t){const i=Le(e),r=t.customData._serverResponse,s=(r.mfaInfo||[]).map(a=>ou._fromServerResponse(i,a));E(r.mfaPendingCredential,i,"internal-error");const o=$i._fromMfaPendingCredential(r.mfaPendingCredential);return new Hf(o,s,async a=>{const c=await a._process(i,o);delete r.mfaInfo,delete r.mfaPendingCredential;const l=Object.assign(Object.assign({},r),{idToken:c.idToken,refreshToken:c.refreshToken});switch(t.operationType){case"signIn":const u=await Gt._fromIdTokenResponse(i,t.operationType,l);return await i._updateCurrentUser(u.user),u;case"reauthenticate":return E(t.user,i,"internal-error"),Gt._forOperation(t.user,t.operationType,l);default:Me(i,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function zR(n,e){var t;const i=w(n),r=e;return E(e.customData.operationType,i,"argument-error"),E((t=r.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,i,"argument-error"),Hf._fromError(i,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QR(n,e){return Ve(n,"POST","/v2/accounts/mfaEnrollment:start",Ee(n,e))}function YR(n,e){return Ve(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ee(n,e))}function XR(n,e){return Ve(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ee(n,e))}class zf{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(i=>ou._fromServerResponse(e.auth,i)))})}static _fromUser(e){return new zf(e)}async getSession(){return $i._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const i=e,r=await this.getSession(),s=await Kn(this.user,i._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(s),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,i=await this.user.getIdToken(),r=await Kn(this.user,XR(this.user.auth,{idToken:i,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:s})=>s!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(s){if(s.code!=="auth/user-token-expired")throw s}}}const Th=new WeakMap;function JR(n){const e=w(n);return Th.has(e)||Th.set(e,zf._fromUser(e)),Th.get(e)}const Yc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Yc,"1"),this.storage.removeItem(Yc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZR(){const n=te();return Kf(n)||$s(n)}const eN=1e3,tN=10;class iI extends nI{constructor(){super(()=>window.localStorage,"LOCAL");this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=ZR()&&JA(),this.fallbackToPolling=Bv(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(i);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const r=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},s=this.storage.getItem(i);XA()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,tN):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},eN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}iI.type="LOCAL";const cu=iI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI extends nI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rI.type="SESSION";const gi=rI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nN(n){return Promise.all(n.map(async e=>{try{const t=await e;return{fulfilled:!0,value:t}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new lu(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,o=this.handlersMap[r];if(!(o==null?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const a=Array.from(o).map(async l=>l(t.origin,s)),c=await nN(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ca(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const l=Ca("",20);r.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:r,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(d.data.response);break;default:clearTimeout(u),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(){return window}function rN(n){ye().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qf(){return typeof ye().WorkerGlobalScope!="undefined"&&typeof ye().importScripts=="function"}async function sN(){if(!(navigator==null?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function oN(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function aN(){return Qf()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sI="firebaseLocalStorageDb",cN=1,Xc="firebaseLocalStorage",oI="fbase_key";class ka{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function uu(n,e){return n.transaction([Xc],e?"readwrite":"readonly").objectStore(Xc)}function lN(){const n=indexedDB.deleteDatabase(sI);return new ka(n).toPromise()}function wd(){const n=indexedDB.open(sI,cN);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Xc,{keyPath:oI})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Xc)?e(i):(i.close(),await lN(),e(await wd()))})})}async function Jm(n,e,t){const i=uu(n,!0).put({[oI]:e,value:t});return new ka(i).toPromise()}async function uN(n,e){const t=uu(n,!1).get(e),i=await new ka(t).toPromise();return i===void 0?null:i.value}function Zm(n,e){const t=uu(n,!0).delete(e);return new ka(t).toPromise()}const hN=800,dN=3;class aI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await wd(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>dN)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lu._getInstance(aN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await sN(),!this.activeServiceWorker)return;this.sender=new iN(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);!i||((e=i[0])===null||e===void 0?void 0:e.fulfilled)&&((t=i[0])===null||t===void 0?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||oN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await wd();return await Jm(e,Yc,"1"),await Zm(e,Yc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Jm(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>uN(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Zm(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=uu(r,!1).getAll();return new ka(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),hN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}aI.type="LOCAL";const fs=aI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fN(n,e){return Ve(n,"POST","/v2/accounts/mfaSignIn:start",Ee(n,e))}function pN(n,e){return Ve(n,"POST","/v2/accounts/mfaSignIn:finalize",Ee(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gN(n){return(await Ve(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mN(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function cI(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=ze("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",mN().appendChild(i)})}function lI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N=500,yN=6e4,lc=1e12;class wN{constructor(e){this.auth=e,this.counter=lc,this._widgets=new Map}render(e,t){const i=this.counter;return this._widgets.set(i,new vN(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;const i=e||lc;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;const i=e||lc;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const i=e||lc;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""}}class vN{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r=typeof e=="string"?document.getElementById(e):e;E(r,"argument-error",{appName:t}),this.container=r,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=IN(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},yN)},_N))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function IN(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bh=lI("rcb"),EN=new ba(3e4,6e4),TN="https://www.google.com/recaptcha/api.js?";class bN{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!ye().grecaptcha}load(e,t=""){return E(SN(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(ye().grecaptcha):new Promise((i,r)=>{const s=ye().setTimeout(()=>{r(ze(e,"network-request-failed"))},EN.get());ye()[bh]=()=>{ye().clearTimeout(s),delete ye()[bh];const a=ye().grecaptcha;if(!a){r(ze(e,"internal-error"));return}const c=a.render;a.render=(l,u)=>{const h=c(l,u);return this.counter++,h},this.hostLanguage=t,i(a)};const o=`${TN}?${Tr({onload:bh,render:"explicit",hl:t})}`;cI(o).catch(()=>{clearTimeout(s),r(ze(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!ye().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function SN(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class CN{async load(e){return new wN(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uI="recaptcha",kN={theme:"light",type:"image"};class AN{constructor(e,t=Object.assign({},kN),i){this.parameters=t,this.type=uI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Le(i),this.isInvisible=this.parameters.size==="invisible",E(typeof document!="undefined",this.auth,"operation-not-supported-in-this-environment");const r=typeof e=="string"?document.getElementById(e):e;E(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new CN:new bN,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(r=>{const s=o=>{!o||(this.tokenChangeListeners.delete(s),r(o))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){E(!this.parameters.sitekey,this.auth,"argument-error"),E(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),E(typeof document!="undefined",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){const i=ye()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){E(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){E(qf()&&!Qf(),this.auth,"internal-error"),await RN(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await gN(this.auth);E(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return E(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function RN(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Qi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function NN(n,e,t){const i=Le(n),r=await hu(i,e,w(t));return new Yf(r,s=>su(i,s))}async function PN(n,e,t){const i=w(n);await ru(!1,i,"phone");const r=await hu(i.auth,e,w(t));return new Yf(r,s=>Xv(i,s))}async function ON(n,e,t){const i=w(n),r=await hu(i.auth,e,w(t));return new Yf(r,s=>Jv(i,s))}async function hu(n,e,t){var i;const r=await t.verify();try{E(typeof r=="string",n,"argument-error"),E(t.type===uI,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const o=s.session;if("phoneNumber"in s)return E(o.type==="enroll",n,"internal-error"),(await QR(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo;{E(o.type==="signin",n,"internal-error");const a=((i=s.multiFactorHint)===null||i===void 0?void 0:i.uid)||s.multiFactorUid;return E(a,n,"missing-multi-factor-info"),(await fN(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await dR(n,{phoneNumber:s.phoneNumber,recaptchaToken:r});return o}}finally{t._reset()}}async function DN(n,e){await Wf(w(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.providerId=en.PROVIDER_ID,this.auth=Le(e)}verifyPhoneNumber(e,t){return hu(this.auth,e,w(t))}static credential(e,t){return Qi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return en.credentialFromTaggedObject(t)}static credentialFromError(e){return en.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:i}=e;return t&&i?Qi._fromTokenResponse(t,i):null}}en.PROVIDER_ID="phone";en.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(n,e){return e?Nt(e):(E(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf extends Vs{constructor(e){super("custom","custom");this.params=e}_getIdTokenResponse(e){return Un(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Un(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Un(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function xN(n){return Yv(n.auth,new Xf(n),n.bypassAuthState)}function MN(n){const{auth:e,user:t}=n;return E(t,e,"internal-error"),Qv(t,new Xf(n),n.bypassAuthState)}async function LN(n){const{auth:e,user:t}=n;return E(t,e,"internal-error"),Wf(t,new Xf(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xN;case"linkViaPopup":case"linkViaRedirect":return LN;case"reauthViaPopup":case"reauthViaRedirect":return MN;default:Me(this.auth,"internal-error")}}resolve(e){nn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){nn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=new ba(2e3,1e4);async function UN(n,e,t){const i=Le(n);Us(n,e,Qn);const r=Sr(i,t);return new xn(i,"signInViaPopup",e,r).executeNotNull()}async function $N(n,e,t){const i=w(n);Us(i.auth,e,Qn);const r=Sr(i.auth,t);return new xn(i.auth,"reauthViaPopup",e,r,i).executeNotNull()}async function VN(n,e,t){const i=w(n);Us(i.auth,e,Qn);const r=Sr(i.auth,t);return new xn(i.auth,"linkViaPopup",e,r,i).executeNotNull()}class xn extends hI{constructor(e,t,i,r,s){super(e,t,r,s);this.provider=i,this.authWindow=null,this.pollId=null,xn.currentPopupAction&&xn.currentPopupAction.cancel(),xn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return E(e,this.auth,"internal-error"),e}async onExecution(){nn(this.filter.length===1,"Popup operations only handle one event");const e=Ca();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ze(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0?void 0:i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ze(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,FN.get())};e()}}xn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BN="pendingRedirect",Dc=new Map;class qN extends hI{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i);this.eventId=null}async execute(){let e=Dc.get(this.auth._key());if(!e){try{const i=await jN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Dc.set(this.auth._key(),e)}return this.bypassAuthState||Dc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function jN(n,e){const t=fI(e),i=dI(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}async function Jf(n,e){return dI(n)._set(fI(e),"true")}function KN(){Dc.clear()}function dI(n){return Nt(n._redirectPersistence)}function fI(n){return zi(BN,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(n,e,t){return GN(n,e,t)}async function GN(n,e,t){const i=Le(n);Us(n,e,Qn);const r=Sr(i,t);return await Jf(r,i),r._openRedirect(i,e,"signInViaRedirect")}function HN(n,e,t){return zN(n,e,t)}async function zN(n,e,t){const i=w(n);Us(i.auth,e,Qn);const r=Sr(i.auth,t);await Jf(r,i.auth);const s=await pI(i);return r._openRedirect(i.auth,e,"reauthViaRedirect",s)}function QN(n,e,t){return YN(n,e,t)}async function YN(n,e,t){const i=w(n);Us(i.auth,e,Qn);const r=Sr(i.auth,t);await ru(!1,i,e.providerId),await Jf(r,i.auth);const s=await pI(i);return r._openRedirect(i.auth,e,"linkViaRedirect",s)}async function XN(n,e){return await Le(n)._initializationPromise,du(n,e,!1)}async function du(n,e,t=!1){const i=Le(n),r=Sr(i,e),o=await new qN(i,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}async function pI(n){const e=Ca(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JN=10*60*1e3;class gI{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ZN(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!mI(e)){const r=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=JN&&this.cachedEventUids.clear(),this.cachedEventUids.has(e_(e))}saveEventToCache(e){this.cachedEventUids.add(e_(e)),this.lastProcessedEventTime=Date.now()}}function e_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function mI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function ZN(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _I(n,e={}){return Ve(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tP=/^https?/;async function nP(n){if(n.config.emulator)return;const{authorizedDomains:e}=await _I(n);for(const t of e)try{if(iP(t))return}catch{}Me(n,"unauthorized-domain")}function iP(n){const e=Fo(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!tP.test(t))return!1;if(eP.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rP=new ba(3e4,6e4);function t_(){const n=ye().___jsl;if(n==null?void 0:n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function sP(n){return new Promise((e,t)=>{var i,r,s;function o(){t_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{t_(),t(ze(n,"network-request-failed"))},timeout:rP.get()})}if((r=(i=ye().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0?void 0:r.Iframe)e(gapi.iframes.getContext());else if((s=ye().gapi)===null||s===void 0?void 0:s.load)o();else{const a=lI("iframefcb");return ye()[a]=()=>{gapi.load?o():t(ze(n,"network-request-failed"))},cI(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw xc=null,e})}let xc=null;function oP(n){return xc=xc||sP(n),xc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aP=new ba(5e3,15e3),cP="__/auth/iframe",lP="emulator/auth/iframe",uP={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dP(n){const e=n.config;E(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?jf(e,lP):`https://${n.config.authDomain}/${cP}`,i={apiKey:e.apiKey,appName:n.name,v:Rn},r=hP.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${Tr(i).slice(1)}`}async function fP(n){const e=await oP(n),t=ye().gapi;return E(t,n,"internal-error"),e.open({where:document.body,url:dP(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:uP,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const o=ze(n,"network-request-failed"),a=ye().setTimeout(()=>{s(o)},aP.get());function c(){ye().clearTimeout(a),r(i)}i.ping(c).then(c,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},gP=500,mP=600,_P="_blank",yP="http://localhost";class n_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function wP(n,e,t,i=gP,r=mP){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},pP),{width:i.toString(),height:r.toString(),top:s,left:o}),l=te().toLowerCase();t&&(a=Fv(l)?_P:t),Lv(l)&&(e=e||yP,c.scrollbars="yes");const u=Object.entries(c).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(YA(l)&&a!=="_self")return vP(e||"",a),new n_(null);const h=window.open(e||"",a,u);E(h,n,"popup-blocked");try{h.focus()}catch{}return new n_(h)}function vP(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP="__/auth/handler",EP="emulator/auth/handler";function vd(n,e,t,i,r,s){E(n.config.authDomain,n,"auth-domain-config-required"),E(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Rn,eventId:r};if(e instanceof Qn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",jc(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,l]of Object.entries(s||{}))o[c]=l}if(e instanceof Bs){const c=e.getScopes().filter(l=>l!=="");c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];return`${TP(n)}?${Tr(a).slice(1)}`}function TP({config:n}){return n.emulator?jf(n,EP):`https://${n.authDomain}/${IP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sh="webStorageSupport";class bP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gi,this._completeRedirectFn=du}async _openPopup(e,t,i,r){var s;nn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=vd(e,t,i,Fo(),r);return wP(e,o,Ca())}async _openRedirect(e,t,i,r){return await this._originValidation(e),rN(vd(e,t,i,Fo(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(nn(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await fP(e),i=new gI(e);return t.register("authEvent",r=>(E(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sh,{type:Sh},r=>{var s;const o=(s=r==null?void 0:r[0])===null||s===void 0?void 0:s[Sh];o!==void 0&&t(!!o),Me(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nP(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Bv()||Kf()||$s()}}const yI=bP;class SP{constructor(e){this.factorId=e}_process(e,t,i){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,i);case"signin":return this._finalizeSignIn(e,t.credential);default:return dn("unexpected MultiFactorSessionType")}}}class Zf extends SP{constructor(e){super("phone");this.credential=e}static _fromCredential(e){return new Zf(e)}_finalizeEnroll(e,t,i){return YR(e,{idToken:t,displayName:i,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return pN(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class wI{constructor(){}static assertion(e){return Zf._fromCredential(e)}}wI.FACTOR_ID="phone";var i_="@firebase/auth",r_="0.19.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{var r;e(((r=i)===null||r===void 0?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){E(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kP(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function AP(n){le(new q("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),{apiKey:r,authDomain:s}=i.options;return(o=>{E(r&&!r.includes(":"),"invalid-api-key",{appName:o.name}),E(!(s==null?void 0:s.includes(":")),"argument-error",{appName:o.name});const a={apiKey:r,authDomain:s,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qv(n)},c=new ZA(o,a);return OA(c,t),c})(i)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),le(new q("auth-internal",e=>{const t=Le(e.getProvider("auth").getImmediate());return(i=>new CP(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Q(i_,r_,kP(n)),Q(i_,r_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qz(n=eu()){const e=An(n,"auth");return e.isInitialized()?e.getImmediate():PA(n,{popupRedirectResolver:yI,persistence:[fs,cu,gi]})}AP("Browser");var RP=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},C,ep=ep||{},D=RP||self;function Jc(){}function Id(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Aa(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function NP(n){return Object.prototype.hasOwnProperty.call(n,Ch)&&n[Ch]||(n[Ch]=++PP)}var Ch="closure_uid_"+(1e9*Math.random()>>>0),PP=0;function OP(n,e,t){return n.call.apply(n.bind,arguments)}function DP(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function Qe(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Qe=OP:Qe=DP,Qe.apply(null,arguments)}function uc(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Je(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(i,r,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(i,o)}}function Ci(){this.s=this.s,this.o=this.o}var xP=0,MP={};Ci.prototype.s=!1;Ci.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),xP!=0)){var n=NP(this);delete MP[n]}};Ci.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vI=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},II=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const i=n.length,r=typeof n=="string"?n.split(""):n;for(let s=0;s<i;s++)s in r&&e.call(t,r[s],s,n)};function LP(n){e:{var e=kO;const t=n.length,i=typeof n=="string"?n.split(""):n;for(let r=0;r<t;r++)if(r in i&&e.call(void 0,i[r],r,n)){e=r;break e}e=-1}return 0>e?null:typeof n=="string"?n.charAt(e):n[e]}function s_(n){return Array.prototype.concat.apply([],arguments)}function tp(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function Zc(n){return/^[\s\xa0]*$/.test(n)}var o_=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function lt(n,e){return n.indexOf(e)!=-1}function kh(n,e){return n<e?-1:n>e?1:0}var ut;e:{var a_=D.navigator;if(a_){var c_=a_.userAgent;if(c_){ut=c_;break e}}ut=""}function np(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function EI(n){const e={};for(const t in n)e[t]=n[t];return e}var l_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function TI(n,e){let t,i;for(let r=1;r<arguments.length;r++){i=arguments[r];for(t in i)n[t]=i[t];for(let s=0;s<l_.length;s++)t=l_[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function ip(n){return ip[" "](n),n}ip[" "]=Jc;function FP(n){var e=VP;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}var UP=lt(ut,"Opera"),ps=lt(ut,"Trident")||lt(ut,"MSIE"),bI=lt(ut,"Edge"),Ed=bI||ps,SI=lt(ut,"Gecko")&&!(lt(ut.toLowerCase(),"webkit")&&!lt(ut,"Edge"))&&!(lt(ut,"Trident")||lt(ut,"MSIE"))&&!lt(ut,"Edge"),$P=lt(ut.toLowerCase(),"webkit")&&!lt(ut,"Edge");function CI(){var n=D.document;return n?n.documentMode:void 0}var el;e:{var Ah="",Rh=function(){var n=ut;if(SI)return/rv:([^\);]+)(\)|;)/.exec(n);if(bI)return/Edge\/([\d\.]+)/.exec(n);if(ps)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if($P)return/WebKit\/(\S+)/.exec(n);if(UP)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(Rh&&(Ah=Rh?Rh[1]:""),ps){var Nh=CI();if(Nh!=null&&Nh>parseFloat(Ah)){el=String(Nh);break e}}el=Ah}var VP={};function BP(){return FP(function(){let n=0;const e=o_(String(el)).split("."),t=o_("9").split("."),i=Math.max(e.length,t.length);for(let o=0;n==0&&o<i;o++){var r=e[o]||"",s=t[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r[0].length==0&&s[0].length==0)break;n=kh(r[1].length==0?0:parseInt(r[1],10),s[1].length==0?0:parseInt(s[1],10))||kh(r[2].length==0,s[2].length==0)||kh(r[2],s[2]),r=r[3],s=s[3]}while(n==0)}return 0<=n})}var Td;if(D.document&&ps){var u_=CI();Td=u_||parseInt(el,10)||void 0}else Td=void 0;var qP=Td,jP=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{D.addEventListener("test",Jc,e),D.removeEventListener("test",Jc,e)}catch{}return n}();function it(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}it.prototype.h=function(){this.defaultPrevented=!0};function Bo(n,e){if(it.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(SI){e:{try{ip(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:KP[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Bo.Z.h.call(this)}}Je(Bo,it);var KP={2:"touch",3:"pen",4:"mouse"};Bo.prototype.h=function(){Bo.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ra="closure_listenable_"+(1e6*Math.random()|0),WP=0;function GP(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ia=r,this.key=++WP,this.ca=this.fa=!1}function fu(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function pu(n){this.src=n,this.g={},this.h=0}pu.prototype.add=function(n,e,t,i,r){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Sd(n,e,i,r);return-1<o?(e=n[o],t||(e.fa=!1)):(e=new GP(e,this.src,s,!!i,r),e.fa=t,n.push(e)),e};function bd(n,e){var t=e.type;if(t in n.g){var i=n.g[t],r=vI(i,e),s;(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(fu(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Sd(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.ca&&s.listener==e&&s.capture==!!t&&s.ia==i)return r}return-1}var rp="closure_lm_"+(1e6*Math.random()|0),Ph={};function kI(n,e,t,i,r){if(i&&i.once)return RI(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)kI(n,e[s],t,i,r);return null}return t=ap(t),n&&n[Ra]?n.N(e,t,Aa(i)?!!i.capture:!!i,r):AI(n,e,t,!1,i,r)}function AI(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var o=Aa(r)?!!r.capture:!!r,a=op(n);if(a||(n[rp]=a=new pu(n)),t=a.add(e,t,i,o,s),t.proxy)return t;if(i=HP(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)jP||(r=o),r===void 0&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(PI(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function HP(){function n(t){return e.call(n.src,n.listener,t)}var e=zP;return n}function RI(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)RI(n,e[s],t,i,r);return null}return t=ap(t),n&&n[Ra]?n.O(e,t,Aa(i)?!!i.capture:!!i,r):AI(n,e,t,!0,i,r)}function NI(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)NI(n,e[s],t,i,r);else i=Aa(i)?!!i.capture:!!i,t=ap(t),n&&n[Ra]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Sd(s,t,i,r),-1<t&&(fu(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=op(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Sd(e,t,i,r)),(t=-1<n?e[n]:null)&&sp(t))}function sp(n){if(typeof n!="number"&&n&&!n.ca){var e=n.src;if(e&&e[Ra])bd(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(PI(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=op(e))?(bd(t,n),t.h==0&&(t.src=null,e[rp]=null)):fu(n)}}}function PI(n){return n in Ph?Ph[n]:Ph[n]="on"+n}function zP(n,e){if(n.ca)n=!0;else{e=new Bo(e,this);var t=n.listener,i=n.ia||n.src;n.fa&&sp(n),n=t.call(i,e)}return n}function op(n){return n=n[rp],n instanceof pu?n:null}var Oh="__closure_events_fn_"+(1e9*Math.random()>>>0);function ap(n){return typeof n=="function"?n:(n[Oh]||(n[Oh]=function(e){return n.handleEvent(e)}),n[Oh])}function Fe(){Ci.call(this),this.i=new pu(this),this.P=this,this.I=null}Je(Fe,Ci);Fe.prototype[Ra]=!0;Fe.prototype.removeEventListener=function(n,e,t,i){NI(this,n,e,t,i)};function Ye(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,typeof e=="string")e=new it(e,n);else if(e instanceof it)e.target=e.target||n;else{var r=e;e=new it(i,n),TI(e,r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];r=hc(o,i,!0,e)&&r}if(o=e.g=n,r=hc(o,i,!0,e)&&r,r=hc(o,i,!1,e)&&r,t)for(s=0;s<t.length;s++)o=e.g=t[s],r=hc(o,i,!1,e)&&r}Fe.prototype.M=function(){if(Fe.Z.M.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)fu(t[i]);delete n.g[e],n.h--}}this.I=null};Fe.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};Fe.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function hc(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ca&&o.capture==t){var a=o.listener,c=o.ia||o.src;o.fa&&bd(n.i,o),r=a.call(c,i)!==!1&&r}}return r&&!i.defaultPrevented}var cp=D.JSON.stringify;function QP(){var n=DI;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class YP{constructor(){this.h=this.g=null}add(e,t){const i=OI.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}}var OI=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new XP,n=>n.reset());class XP{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function JP(n){D.setTimeout(()=>{throw n},0)}function lp(n,e){Cd||ZP(),kd||(Cd(),kd=!0),DI.add(n,e)}var Cd;function ZP(){var n=D.Promise.resolve(void 0);Cd=function(){n.then(eO)}}var kd=!1,DI=new YP;function eO(){for(var n;n=QP();){try{n.h.call(n.g)}catch(t){JP(t)}var e=OI;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}kd=!1}function gu(n,e){Fe.call(this),this.h=n||1,this.g=e||D,this.j=Qe(this.kb,this),this.l=Date.now()}Je(gu,Fe);C=gu.prototype;C.da=!1;C.S=null;C.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ye(this,"tick"),this.da&&(up(this),this.start()))}};C.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function up(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}C.M=function(){gu.Z.M.call(this),up(this),delete this.g};function hp(n,e,t){if(typeof n=="function")t&&(n=Qe(n,t));else if(n&&typeof n.handleEvent=="function")n=Qe(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:D.setTimeout(n,e||0)}function xI(n){n.g=hp(()=>{n.g=null,n.i&&(n.i=!1,xI(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class tO extends Ci{constructor(e,t){super();this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:xI(this)}M(){super.M(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qo(n){Ci.call(this),this.h=n,this.g={}}Je(qo,Ci);var h_=[];function MI(n,e,t,i){Array.isArray(t)||(t&&(h_[0]=t.toString()),t=h_);for(var r=0;r<t.length;r++){var s=kI(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function LI(n){np(n.g,function(e,t){this.g.hasOwnProperty(t)&&sp(e)},n),n.g={}}qo.prototype.M=function(){qo.Z.M.call(this),LI(this)};qo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function mu(){this.g=!0}mu.prototype.Aa=function(){this.g=!1};function nO(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+`
`+t+`
`+o})}function iO(n,e,t,i,r,s,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+`
`+t+`
`+s+" "+o})}function Qr(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+sO(n,t)+(i?" "+i:"")})}function rO(n,e){n.info(function(){return"TIMEOUT: "+e})}mu.prototype.info=function(){};function sO(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return cp(t)}catch{return e}}var Cr={},d_=null;function _u(){return d_=d_||new Fe}Cr.Ma="serverreachability";function FI(n){it.call(this,Cr.Ma,n)}Je(FI,it);function jo(n){const e=_u();Ye(e,new FI(e,n))}Cr.STAT_EVENT="statevent";function UI(n,e){it.call(this,Cr.STAT_EVENT,n),this.stat=e}Je(UI,it);function ht(n){const e=_u();Ye(e,new UI(e,n))}Cr.Na="timingevent";function $I(n,e){it.call(this,Cr.Na,n),this.size=e}Je($I,it);function Na(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){n()},e)}var yu={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},VI={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function dp(){}dp.prototype.h=null;function f_(n){return n.h||(n.h=n.i())}function BI(){}var Pa={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function fp(){it.call(this,"d")}Je(fp,it);function pp(){it.call(this,"c")}Je(pp,it);var Ad;function wu(){}Je(wu,dp);wu.prototype.g=function(){return new XMLHttpRequest};wu.prototype.i=function(){return{}};Ad=new wu;function Oa(n,e,t,i){this.l=n,this.j=e,this.m=t,this.X=i||1,this.V=new qo(this),this.P=oO,n=Ed?125:void 0,this.W=new gu(n),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new qI}function qI(){this.i=null,this.g="",this.h=!1}var oO=45e3,Rd={},tl={};C=Oa.prototype;C.setTimeout=function(n){this.P=n};function Nd(n,e,t){n.K=1,n.v=Iu(Wn(e)),n.s=t,n.U=!0,jI(n,null)}function jI(n,e){n.F=Date.now(),Da(n),n.A=Wn(n.v);var t=n.A,i=n.X;Array.isArray(i)||(i=[String(i)]),YI(t.h,"t",i),n.C=0,t=n.l.H,n.h=new qI,n.g=mE(n.l,t?e:null,!n.s),0<n.O&&(n.L=new tO(Qe(n.Ia,n,n.g),n.O)),MI(n.V,n.g,"readystatechange",n.gb),e=n.H?EI(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),jo(1),nO(n.j,n.u,n.A,n.m,n.X,n.s)}C.gb=function(n){n=n.target;const e=this.L;e&&Mn(n)==3?e.l():this.Ia(n)};C.Ia=function(n){try{if(n==this.g)e:{const u=Mn(this.g);var e=this.g.Da();const h=this.g.ba();if(!(3>u)&&(u!=3||Ed||this.g&&(this.h.h||this.g.ga()||__(this.g)))){this.I||u!=4||e==7||(e==8||0>=h?jo(3):jo(2)),vu(this);var t=this.g.ba();this.N=t;t:if(KI(this)){var i=__(this.g);n="";var r=i.length,s=Mn(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){Vi(this),Io(this);var o="";break t}this.h.i=new D.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=t==200,iO(this.j,this.u,this.A,this.m,this.X,u,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Zc(a)){var l=a;break t}}l=null}if(t=l)Qr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Pd(this,t);else{this.i=!1,this.o=3,ht(12),Vi(this),Io(this);break e}}this.U?(WI(this,u,o),Ed&&this.i&&u==3&&(MI(this.V,this.W,"tick",this.fb),this.W.start())):(Qr(this.j,this.m,o,null),Pd(this,o)),u==4&&Vi(this),this.i&&!this.I&&(u==4?dE(this.l,this):(this.i=!1,Da(this)))}else t==400&&0<o.indexOf("Unknown SID")?(this.o=3,ht(12)):(this.o=0,ht(13)),Vi(this),Io(this)}}}catch{}finally{}};function KI(n){return n.g?n.u=="GET"&&n.K!=2&&n.l.Ba:!1}function WI(n,e,t){let i=!0,r;for(;!n.I&&n.C<t.length;)if(r=aO(n,t),r==tl){e==4&&(n.o=4,ht(14),i=!1),Qr(n.j,n.m,null,"[Incomplete Response]");break}else if(r==Rd){n.o=4,ht(15),Qr(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else Qr(n.j,n.m,r,null),Pd(n,r);KI(n)&&r!=tl&&r!=Rd&&(n.h.g="",n.C=0),e!=4||t.length!=0||n.h.h||(n.o=1,ht(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.aa&&(n.aa=!0,e=n.l,e.g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Tp(e),e.L=!0,ht(11))):(Qr(n.j,n.m,t,"[Invalid Chunked Response]"),Vi(n),Io(n))}C.fb=function(){if(this.g){var n=Mn(this.g),e=this.g.ga();this.C<e.length&&(vu(this),WI(this,n,e),this.i&&n!=4&&Da(this))}};function aO(n,e){var t=n.C,i=e.indexOf(`
`,t);return i==-1?tl:(t=Number(e.substring(t,i)),isNaN(t)?Rd:(i+=1,i+t>e.length?tl:(e=e.substr(i,t),n.C=i+t,e)))}C.cancel=function(){this.I=!0,Vi(this)};function Da(n){n.Y=Date.now()+n.P,GI(n,n.P)}function GI(n,e){if(n.B!=null)throw Error("WatchDog timer not null");n.B=Na(Qe(n.eb,n),e)}function vu(n){n.B&&(D.clearTimeout(n.B),n.B=null)}C.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(rO(this.j,this.A),this.K!=2&&(jo(3),ht(17)),Vi(this),this.o=2,Io(this)):GI(this,this.Y-n)};function Io(n){n.l.G==0||n.I||dE(n.l,n)}function Vi(n){vu(n);var e=n.L;e&&typeof e.na=="function"&&e.na(),n.L=null,up(n.W),LI(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Pd(n,e){try{var t=n.l;if(t.G!=0&&(t.g==n||Od(t.i,n))){if(t.I=n.N,!n.J&&Od(t.i,n)&&t.G==3){try{var i=t.Ca.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var r=i;if(r[0]==0)e:if(!t.u){if(t.g)if(t.g.F+3e3<n.F)sl(t),bu(t);else break e;Ep(t),ht(18)}else t.ta=r[1],0<t.ta-t.U&&37500>r[2]&&t.N&&t.A==0&&!t.v&&(t.v=Na(Qe(t.ab,t),6e3));if(1>=ZI(t.i)&&t.ka){try{t.ka()}catch{}t.ka=void 0}}else Bi(t,11)}else if((n.J||t.g==n)&&sl(t),!Zc(e))for(r=t.Ca.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(t.U=l[0],l=l[1],t.G==2)if(l[0]=="c"){t.J=l[1],t.la=l[2];const u=l[3];u!=null&&(t.ma=u,t.h.info("VER="+t.ma));const h=l[4];h!=null&&(t.za=h,t.h.info("SVER="+t.za));const d=l[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,t.K=i,t.h.info("backChannelRequestTimeoutMs_="+i)),i=t;const f=n.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var s=i.i;!s.g&&(lt(p,"spdy")||lt(p,"quic")||lt(p,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(_p(s,s.h),s.h=null))}if(i.D){const _=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;_&&(i.sa=_,ne(i.F,i.D,_))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms")),i=t;var o=n;if(i.oa=gE(i,i.H?i.la:null,i.W),o.J){eE(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(vu(a),Da(a)),i.g=o}else uE(i);0<t.l.length&&Su(t)}else l[0]!="stop"&&l[0]!="close"||Bi(t,7);else t.G==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?Bi(t,7):Ip(t):l[0]!="noop"&&t.j&&t.j.wa(l),t.A=0)}}jo(4)}catch{}}function cO(n){if(n.R&&typeof n.R=="function")return n.R();if(typeof n=="string")return n.split("");if(Id(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function gp(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Id(n)||typeof n=="string")II(n,e,void 0);else{if(n.T&&typeof n.T=="function")var t=n.T();else if(n.R&&typeof n.R=="function")t=void 0;else if(Id(n)||typeof n=="string"){t=[];for(var i=n.length,r=0;r<i;r++)t.push(r)}else for(r in t=[],i=0,n)t[i++]=r;i=cO(n),r=i.length;for(var s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}}function qs(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var i=0;i<t;i+=2)this.set(arguments[i],arguments[i+1])}else if(n)if(n instanceof qs)for(t=n.T(),i=0;i<t.length;i++)this.set(t[i],n.get(t[i]));else for(i in n)this.set(i,n[i])}C=qs.prototype;C.R=function(){mp(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n};C.T=function(){return mp(this),this.g.concat()};function mp(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var i=n.g[e];nr(n.h,i)&&(n.g[t++]=i),e++}n.g.length=t}if(n.i!=n.g.length){var r={};for(t=e=0;e<n.g.length;)i=n.g[e],nr(r,i)||(n.g[t++]=i,r[i]=1),e++;n.g.length=t}}C.get=function(n,e){return nr(this.h,n)?this.h[n]:e};C.set=function(n,e){nr(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e};C.forEach=function(n,e){for(var t=this.T(),i=0;i<t.length;i++){var r=t[i],s=this.get(r);n.call(e,s,r,this)}};function nr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var HI=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function lO(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function ir(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof ir){this.g=e!==void 0?e:n.g,nl(this,n.j),this.s=n.s,il(this,n.i),rl(this,n.m),this.l=n.l,e=n.h;var t=new Ko;t.i=e.i,e.g&&(t.g=new qs(e.g),t.h=e.h),p_(this,t),this.o=n.o}else n&&(t=String(n).match(HI))?(this.g=!!e,nl(this,t[1]||"",!0),this.s=Eo(t[2]||""),il(this,t[3]||"",!0),rl(this,t[4]),this.l=Eo(t[5]||"",!0),p_(this,t[6]||"",!0),this.o=Eo(t[7]||"")):(this.g=!!e,this.h=new Ko(null,this.g))}ir.prototype.toString=function(){var n=[],e=this.j;e&&n.push(_o(e,g_,!0),":");var t=this.i;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(_o(e,g_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.i&&t.charAt(0)!="/"&&n.push("/"),n.push(_o(t,t.charAt(0)=="/"?pO:fO,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",_o(t,mO)),n.join("")};function Wn(n){return new ir(n)}function nl(n,e,t){n.j=t?Eo(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function il(n,e,t){n.i=t?Eo(e,!0):e}function rl(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function p_(n,e,t){e instanceof Ko?(n.h=e,_O(n.h,n.g)):(t||(e=_o(e,gO)),n.h=new Ko(e,n.g))}function ne(n,e,t){n.h.set(e,t)}function Iu(n){return ne(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function uO(n){return n instanceof ir?Wn(n):new ir(n,void 0)}function hO(n,e,t,i){var r=new ir(null,void 0);return n&&nl(r,n),e&&il(r,e),t&&rl(r,t),i&&(r.l=i),r}function Eo(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function _o(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,dO),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function dO(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var g_=/[#\/\?@]/g,fO=/[#\?:]/g,pO=/[#\?]/g,gO=/[#\?@]/g,mO=/#/g;function Ko(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function ki(n){n.g||(n.g=new qs,n.h=0,n.i&&lO(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}C=Ko.prototype;C.add=function(n,e){ki(this),this.i=null,n=js(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function zI(n,e){ki(n),e=js(n,e),nr(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,n=n.g,nr(n.h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&mp(n)))}function QI(n,e){return ki(n),e=js(n,e),nr(n.g.h,e)}C.forEach=function(n,e){ki(this),this.g.forEach(function(t,i){II(t,function(r){n.call(e,r,i,this)},this)},this)};C.T=function(){ki(this);for(var n=this.g.R(),e=this.g.T(),t=[],i=0;i<e.length;i++)for(var r=n[i],s=0;s<r.length;s++)t.push(e[i]);return t};C.R=function(n){ki(this);var e=[];if(typeof n=="string")QI(this,n)&&(e=s_(e,this.g.get(js(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=s_(e,n[t])}return e};C.set=function(n,e){return ki(this),this.i=null,n=js(this,n),QI(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};C.get=function(n,e){return n?(n=this.R(n),0<n.length?String(n[0]):e):e};function YI(n,e,t){zI(n,e),0<t.length&&(n.i=null,n.g.set(js(n,e),tp(t)),n.h+=t.length)}C.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var i=e[t],r=encodeURIComponent(String(i));i=this.R(i);for(var s=0;s<i.length;s++){var o=r;i[s]!==""&&(o+="="+encodeURIComponent(String(i[s]))),n.push(o)}}return this.i=n.join("&")};function js(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function _O(n,e){e&&!n.j&&(ki(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(zI(this,i),YI(this,r,t))},n)),n.j=e}var yO=class{constructor(n,e){this.h=n,this.g=e}};function XI(n){this.l=n||wO,D.PerformanceNavigationTiming?(n=D.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(D.g&&D.g.Ea&&D.g.Ea()&&D.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wO=10;function JI(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function ZI(n){return n.h?1:n.g?n.g.size:0}function Od(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function _p(n,e){n.g?n.g.add(e):n.h=e}function eE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}XI.prototype.cancel=function(){if(this.i=tE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function tE(n){if(n.h!=null)return n.i.concat(n.h.D);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return tp(n.i)}function yp(){}yp.prototype.stringify=function(n){return D.JSON.stringify(n,void 0)};yp.prototype.parse=function(n){return D.JSON.parse(n,void 0)};function vO(){this.g=new yp}function IO(n,e,t){const i=t||"";try{gp(n,function(r,s){let o=r;Aa(r)&&(o=cp(r)),e.push(i+s+"="+encodeURIComponent(o))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function EO(n,e){const t=new mu;if(D.Image){const i=new Image;i.onload=uc(dc,t,i,"TestLoadImage: loaded",!0,e),i.onerror=uc(dc,t,i,"TestLoadImage: error",!1,e),i.onabort=uc(dc,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=uc(dc,t,i,"TestLoadImage: timeout",!1,e),D.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function dc(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch{}}function xa(n){this.l=n.$b||null,this.j=n.ib||!1}Je(xa,dp);xa.prototype.g=function(){return new Eu(this.l,this.j)};xa.prototype.i=function(n){return function(){return n}}({});function Eu(n,e){Fe.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=wp,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Je(Eu,Fe);var wp=0;C=Eu.prototype;C.open=function(n,e){if(this.readyState!=wp)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Wo(this)};C.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||D).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};C.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ma(this)),this.readyState=wp};C.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Wo(this)),this.g&&(this.readyState=3,Wo(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof D.ReadableStream!="undefined"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nE(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))};function nE(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}C.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ma(this):Wo(this),this.readyState==3&&nE(this)}};C.Ua=function(n){this.g&&(this.response=this.responseText=n,Ma(this))};C.Ta=function(n){this.g&&(this.response=n,Ma(this))};C.ha=function(){this.g&&Ma(this)};function Ma(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Wo(n)}C.setRequestHeader=function(n,e){this.v.append(n,e)};C.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};C.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Wo(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Eu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var TO=D.JSON.parse;function _e(n){Fe.call(this),this.headers=new qs,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=iE,this.K=this.L=!1}Je(_e,Fe);var iE="",bO=/^https?$/i,SO=["POST","PUT"];C=_e.prototype;C.ea=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ad.g(),this.C=this.u?f_(this.u):f_(Ad),this.g.onreadystatechange=Qe(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){m_(this,s);return}n=t||"";const r=new qs(this.headers);i&&gp(i,function(s,o){r.set(o,s)}),i=LP(r.T()),t=D.FormData&&n instanceof D.FormData,!(0<=vI(SO,e))||i||t||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(s,o){this.g.setRequestHeader(o,s)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{oE(this),0<this.B&&((this.K=CO(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Qe(this.pa,this)):this.A=hp(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){m_(this,s)}};function CO(n){return ps&&BP()&&typeof n.timeout=="number"&&n.ontimeout!==void 0}function kO(n){return n.toLowerCase()=="content-type"}C.pa=function(){typeof ep!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ye(this,"timeout"),this.abort(8))};function m_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,rE(n),Tu(n)}function rE(n){n.D||(n.D=!0,Ye(n,"complete"),Ye(n,"error"))}C.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ye(this,"complete"),Ye(this,"abort"),Tu(this))};C.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Tu(this,!0)),_e.Z.M.call(this)};C.Fa=function(){this.s||(this.F||this.v||this.l?sE(this):this.cb())};C.cb=function(){sE(this)};function sE(n){if(n.h&&typeof ep!="undefined"&&(!n.C[1]||Mn(n)!=4||n.ba()!=2)){if(n.v&&Mn(n)==4)hp(n.Fa,0,n);else if(Ye(n,"readystatechange"),Mn(n)==4){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=a===0){var r=String(n.H).match(HI)[1]||null;if(!r&&D.self&&D.self.location){var s=D.self.location.protocol;r=s.substr(0,s.length-1)}i=!bO.test(r?r.toLowerCase():"")}t=i}if(t)Ye(n,"complete"),Ye(n,"success");else{n.m=6;try{var o=2<Mn(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.ba()+"]",rE(n)}}finally{Tu(n)}}}}function Tu(n,e){if(n.g){oE(n);const t=n.g,i=n.C[0]?Jc:null;n.g=null,n.C=null,e||Ye(n,"ready");try{t.onreadystatechange=i}catch{}}}function oE(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(D.clearTimeout(n.A),n.A=null)}function Mn(n){return n.g?n.g.readyState:0}C.ba=function(){try{return 2<Mn(this)?this.g.status:-1}catch{return-1}};C.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};C.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),TO(e)}};function __(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case iE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}C.Da=function(){return this.m};C.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function AO(n){let e="";return np(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function vp(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=AO(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):ne(n,e,t))}function ro(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function aE(n){this.za=0,this.l=[],this.h=new mu,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ro("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ro("baseRetryDelayMs",5e3,n),this.$a=ro("retryDelaySeedMs",1e4,n),this.Ya=ro("forwardChannelMaxRetries",2,n),this.ra=ro("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new XI(n&&n.concurrentRequestLimit),this.Ca=new vO,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||n.Xb!==!1}C=aE.prototype;C.ma=8;C.G=1;function Ip(n){if(cE(n),n.G==3){var e=n.V++,t=Wn(n.F);ne(t,"SID",n.J),ne(t,"RID",e),ne(t,"TYPE","terminate"),La(n,t),e=new Oa(n,n.h,e,void 0),e.K=2,e.v=Iu(Wn(t)),t=!1,D.navigator&&D.navigator.sendBeacon&&(t=D.navigator.sendBeacon(e.v.toString(),"")),!t&&D.Image&&(new Image().src=e.v,t=!0),t||(e.g=mE(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Da(e)}pE(n)}C.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch{}};function bu(n){n.g&&(Tp(n),n.g.cancel(),n.g=null)}function cE(n){bu(n),n.u&&(D.clearTimeout(n.u),n.u=null),sl(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&D.clearTimeout(n.m),n.m=null)}function Dh(n,e){n.l.push(new yO(n.Za++,e)),n.G==3&&Su(n)}function Su(n){JI(n.i)||n.m||(n.m=!0,lp(n.Ha,n),n.C=0)}function RO(n,e){return ZI(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.l=e.D.concat(n.l),!0):n.G==1||n.G==2||n.C>=(n.Xa?0:n.Ya)?!1:(n.m=Na(Qe(n.Ha,n,e),fE(n,n.C)),n.C++,!0)}C.Ha=function(n){if(this.m)if(this.m=null,this.G==1){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const r=new Oa(this,this.h,n,void 0);let s=this.s;if(this.P&&(s?(s=EI(s),TI(s,this.P)):s=this.P),this.o===null&&(r.H=s),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){t:{var i=this.l[t];if("__data__"in i.g&&(i=i.g.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=lE(this,r,e),t=Wn(this.F),ne(t,"RID",n),ne(t,"CVER",22),this.D&&ne(t,"X-HTTP-Session-Id",this.D),La(this,t),this.o&&s&&vp(t,this.o,s),_p(this.i,r),this.Ra&&ne(t,"TYPE","init"),this.ja?(ne(t,"$req",e),ne(t,"SID","null"),r.$=!0,Nd(r,t,null)):Nd(r,t,e),this.G=2}}else this.G==3&&(n?y_(this,n):this.l.length==0||JI(this.i)||y_(this))};function y_(n,e){var t;e?t=e.m:t=n.V++;const i=Wn(n.F);ne(i,"SID",n.J),ne(i,"RID",t),ne(i,"AID",n.U),La(n,i),n.o&&n.s&&vp(i,n.o,n.s),t=new Oa(n,n.h,t,n.C+1),n.o===null&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=lE(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),_p(n.i,t),Nd(t,i,e)}function La(n,e){n.j&&gp({},function(t,i){ne(e,i,t)})}function lE(n,e,t){t=Math.min(n.l.length,t);var i=n.j?Qe(n.j.Oa,n.j,n):null;e:{var r=n.l;let s=-1;for(;;){const o=["count="+t];s==-1?0<t?(s=r[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let l=r[c].h;const u=r[c].g;if(l-=s,0>l)s=Math.max(0,r[c].h-100),a=!1;else try{IO(u,o,"req"+l+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,i}function uE(n){n.g||n.u||(n.Y=1,lp(n.Ga,n),n.A=0)}function Ep(n){return n.g||n.u||3<=n.A?!1:(n.Y++,n.u=Na(Qe(n.Ga,n),fE(n,n.A)),n.A++,!0)}C.Ga=function(){if(this.u=null,hE(this),this.$&&!(this.L||this.g==null||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Na(Qe(this.bb,this),n)}};C.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ht(10),bu(this),hE(this))};function Tp(n){n.B!=null&&(D.clearTimeout(n.B),n.B=null)}function hE(n){n.g=new Oa(n,n.h,"rpc",n.Y),n.o===null&&(n.g.H=n.s),n.g.O=0;var e=Wn(n.oa);ne(e,"RID","rpc"),ne(e,"SID",n.J),ne(e,"CI",n.N?"0":"1"),ne(e,"AID",n.U),La(n,e),ne(e,"TYPE","xmlhttp"),n.o&&n.s&&vp(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Iu(Wn(e)),t.s=null,t.U=!0,jI(t,n)}C.ab=function(){this.v!=null&&(this.v=null,bu(this),Ep(this),ht(19))};function sl(n){n.v!=null&&(D.clearTimeout(n.v),n.v=null)}function dE(n,e){var t=null;if(n.g==e){sl(n),Tp(n),n.g=null;var i=2}else if(Od(n.i,e))t=e.D,eE(n.i,e),i=1;else return;if(n.I=e.N,n.G!=0){if(e.i)if(i==1){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;i=_u(),Ye(i,new $I(i,t,e,r)),Su(n)}else uE(n);else if(r=e.o,r==3||r==0&&0<n.I||!(i==1&&RO(n,e)||i==2&&Ep(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),r){case 1:Bi(n,5);break;case 4:Bi(n,10);break;case 3:Bi(n,6);break;default:Bi(n,2)}}}function fE(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Bi(n,e){if(n.h.info("Error code "+e),e==2){var t=null;n.j&&(t=null);var i=Qe(n.jb,n);t||(t=new ir("//www.google.com/images/cleardot.gif"),D.location&&D.location.protocol=="http"||nl(t,"https"),Iu(t)),EO(t.toString(),i)}else ht(2);n.G=0,n.j&&n.j.va(e),pE(n),cE(n)}C.jb=function(n){n?(this.h.info("Successfully pinged google.com"),ht(2)):(this.h.info("Failed to ping google.com"),ht(1))};function pE(n){n.G=0,n.I=-1,n.j&&((tE(n.i).length!=0||n.l.length!=0)&&(n.i.i.length=0,tp(n.l),n.l.length=0),n.j.ua())}function gE(n,e,t){let i=uO(t);if(i.i!="")e&&il(i,e+"."+i.i),rl(i,i.m);else{const r=D.location;i=hO(r.protocol,e?e+"."+r.hostname:r.hostname,+r.port,t)}return n.aa&&np(n.aa,function(r,s){ne(i,s,r)}),e=n.D,t=n.sa,e&&t&&ne(i,e,t),ne(i,"VER",n.ma),La(n,i),i}function mE(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&n.Ba&&!n.qa?new _e(new xa({ib:!0})):new _e(n.qa),e.L=n.H,e}function _E(){}C=_E.prototype;C.xa=function(){};C.wa=function(){};C.va=function(){};C.ua=function(){};C.Oa=function(){};function ol(){if(ps&&!(10<=Number(qP)))throw Error("Environmental error: no available transport.")}ol.prototype.g=function(n,e){return new Mt(n,e)};function Mt(n,e){Fe.call(this),this.g=new aE(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Zc(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Zc(e)&&(this.g.D=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Ks(this)}Je(Mt,Fe);Mt.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),lp(Qe(n.hb,n,e))),ht(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=gE(n,null,n.W),Su(n)};Mt.prototype.close=function(){Ip(this.g)};Mt.prototype.u=function(n){if(typeof n=="string"){var e={};e.__data__=n,Dh(this.g,e)}else this.v?(e={},e.__data__=cp(n),Dh(this.g,e)):Dh(this.g,n)};Mt.prototype.M=function(){this.g.j=null,delete this.j,Ip(this.g),delete this.g,Mt.Z.M.call(this)};function yE(n){fp.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Je(yE,fp);function wE(){pp.call(this),this.status=1}Je(wE,pp);function Ks(n){this.g=n}Je(Ks,_E);Ks.prototype.xa=function(){Ye(this.g,"a")};Ks.prototype.wa=function(n){Ye(this.g,new yE(n))};Ks.prototype.va=function(n){Ye(this.g,new wE(n))};Ks.prototype.ua=function(){Ye(this.g,"b")};ol.prototype.createWebChannel=ol.prototype.g;Mt.prototype.send=Mt.prototype.u;Mt.prototype.open=Mt.prototype.m;Mt.prototype.close=Mt.prototype.close;yu.NO_ERROR=0;yu.TIMEOUT=8;yu.HTTP_ERROR=6;VI.COMPLETE="complete";BI.EventType=Pa;Pa.OPEN="a";Pa.CLOSE="b";Pa.ERROR="c";Pa.MESSAGE="d";Fe.prototype.listen=Fe.prototype.N;_e.prototype.listenOnce=_e.prototype.O;_e.prototype.getLastError=_e.prototype.La;_e.prototype.getLastErrorCode=_e.prototype.Da;_e.prototype.getStatus=_e.prototype.ba;_e.prototype.getResponseJson=_e.prototype.Qa;_e.prototype.getResponseText=_e.prototype.ga;_e.prototype.send=_e.prototype.ea;var NO=function(){return new ol},PO=function(){return _u()},xh=yu,OO=VI,DO=Cr,w_={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},xO=xa,fc=BI,MO=_e;const v_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}We.UNAUTHENTICATED=new We(null),We.GOOGLE_CREDENTIALS=new We("google-credentials-uid"),We.FIRST_PARTY=new We("first-party-uid"),We.MOCK_USER=new We("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ws="9.6.7";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mi=new Cn("@firebase/firestore");function Dd(){return mi.logLevel}function LO(n){mi.setLogLevel(n)}function I(n,...e){if(mi.logLevel<=x.DEBUG){const t=e.map(bp);mi.debug(`Firestore (${Ws}): ${n}`,...t)}}function ge(n,...e){if(mi.logLevel<=x.ERROR){const t=e.map(bp);mi.error(`Firestore (${Ws}): ${n}`,...t)}}function Go(n,...e){if(mi.logLevel<=x.WARN){const t=e.map(bp);mi.warn(`Firestore (${Ws}): ${n}`,...t)}}function bp(n){if(typeof n=="string")return n;try{return e=n,JSON.stringify(e)}catch{return n}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k(n="Unexpected state"){const e=`FIRESTORE (${Ws}) INTERNAL ASSERTION FAILED: `+n;throw ge(e),new Error(e)}function O(n,e){n||k()}function FO(n,e){n||k()}function b(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends de{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class UO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(We.UNAUTHENTICATED))}shutdown(){}}class $O{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class VO{constructor(e){this.t=e,this.currentUser=We.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.i;const r=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let s=new Pe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Pe,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const c=s;e.enqueueRetryable(async()=>{await c.promise,await r(this.currentUser)})},a=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Pe)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(O(typeof i.accessToken=="string"),new vE(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return O(e===null||typeof e=="string"),new We(e)}}class BO{constructor(e,t,i){this.type="FirstParty",this.user=We.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),i&&this.headers.set("X-Goog-Iam-Authorization-Token",i)}}class qO{constructor(e,t,i){this.h=e,this.l=t,this.m=i}getToken(){return Promise.resolve(new BO(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(We.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class jO{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class KO{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const i=s=>{s.error!=null&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.p;return this.p=s.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.g.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.g.getImmediate({optional:!0});s?r(s):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(O(typeof t.token=="string"),this.p=t.token,new jO(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.I(i),this.T=i=>t.writeSequenceNumber(i))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WO(n){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pt.A=-1;class IE{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const r=WO(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}}function U(n,e){return n<e?-1:n>e?1:0}function gs(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function EE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Oe.fromMillis(Date.now())}static fromDate(e){return Oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new Oe(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?U(this.nanoseconds,e.nanoseconds):U(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N{constructor(e){this.timestamp=e}static fromTimestamp(e){return new N(e)}static min(){return new N(new Oe(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function kr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function TE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,t,i){t===void 0?t=0:t>e.length&&k(),i===void 0?i=e.length-t:i>e.length-t&&k(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Ho.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ho?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=e.get(r),o=t.get(r);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class j extends Ho{construct(e,t,i){return new j(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new j(t)}static emptyPath(){return new j([])}}const GO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Re extends Ho{construct(e,t,i){return new Re(e,t,i)}static isValidIdentifier(e){return GO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Re.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Re(["__name__"])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Re(t)}static emptyPath(){return new Re([])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e){this.fields=e,e.sort(Re.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gs(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HO(){return typeof atob!="undefined"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ie(t)}static fromUint8Array(e){const t=function(i){let r="";for(let s=0;s<i.length;++s)r+=String.fromCharCode(i[s]);return r}(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return U(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const zO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _i(n){if(O(!!n),typeof n=="string"){let e=0;const t=zO.exec(n);if(O(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ce(n.seconds),nanos:ce(n.nanos)}}function ce(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rr(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function bE(n){const e=n.mapValue.fields.__previous_value__;return Sp(e)?bE(e):e}function zo(n){const e=_i(n.mapValue.fields.__local_write_time__.timestampValue);return new Oe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QO{constructor(e,t,i,r,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class sr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new sr("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof sr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(n){return n==null}function Qo(n){return n===0&&1/n==-1/0}function SE(n){return typeof n=="number"&&Number.isInteger(n)&&!Qo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S{constructor(e){this.path=e}static fromPath(e){return new S(j.fromString(e))}static fromName(e){return new S(j.fromString(e).popFirst(5))}static empty(){return new S(j.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&j.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return j.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new S(new j(e.slice()))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YO={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function or(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Sp(n)?4:10:k()}function rn(n,e){if(n===e)return!0;const t=or(n);if(t!==or(e))return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zo(n).isEqual(zo(e));case 3:return function(i,r){if(typeof i.timestampValue=="string"&&typeof r.timestampValue=="string"&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const s=_i(i.timestampValue),o=_i(r.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,r){return rr(i.bytesValue).isEqual(rr(r.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,r){return ce(i.geoPointValue.latitude)===ce(r.geoPointValue.latitude)&&ce(i.geoPointValue.longitude)===ce(r.geoPointValue.longitude)}(n,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return ce(i.integerValue)===ce(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const s=ce(i.doubleValue),o=ce(r.doubleValue);return s===o?Qo(s)===Qo(o):isNaN(s)&&isNaN(o)}return!1}(n,e);case 9:return gs(n.arrayValue.values||[],e.arrayValue.values||[],rn);case 10:return function(i,r){const s=i.mapValue.fields||{},o=r.mapValue.fields||{};if(I_(s)!==I_(o))return!1;for(const a in s)if(s.hasOwnProperty(a)&&(o[a]===void 0||!rn(s[a],o[a])))return!1;return!0}(n,e);default:return k()}}function Yo(n,e){return(n.values||[]).find(t=>rn(t,e))!==void 0}function _s(n,e){if(n===e)return 0;const t=or(n),i=or(e);if(t!==i)return U(t,i);switch(t){case 0:return 0;case 1:return U(n.booleanValue,e.booleanValue);case 2:return function(r,s){const o=ce(r.integerValue||r.doubleValue),a=ce(s.integerValue||s.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return E_(n.timestampValue,e.timestampValue);case 4:return E_(zo(n),zo(e));case 5:return U(n.stringValue,e.stringValue);case 6:return function(r,s){const o=rr(r),a=rr(s);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(r,s){const o=r.split("/"),a=s.split("/");for(let c=0;c<o.length&&c<a.length;c++){const l=U(o[c],a[c]);if(l!==0)return l}return U(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,s){const o=U(ce(r.latitude),ce(s.latitude));return o!==0?o:U(ce(r.longitude),ce(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,s){const o=r.values||[],a=s.values||[];for(let c=0;c<o.length&&c<a.length;++c){const l=_s(o[c],a[c]);if(l)return l}return U(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,s){const o=r.fields||{},a=Object.keys(o),c=s.fields||{},l=Object.keys(c);a.sort(),l.sort();for(let u=0;u<a.length&&u<l.length;++u){const h=U(a[u],l[u]);if(h!==0)return h;const d=_s(o[a[u]],c[l[u]]);if(d!==0)return d}return U(a.length,l.length)}(n.mapValue,e.mapValue);default:throw k()}}function E_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return U(n,e);const t=_i(n),i=_i(e),r=U(t.seconds,i.seconds);return r!==0?r:U(t.nanos,i.nanos)}function is(n){return xd(n)}function xd(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=_i(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?rr(n.bytesValue).toBase64():"referenceValue"in n?(t=n.referenceValue,S.fromName(t).toString()):"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let r="[",s=!0;for(const o of i.values||[])s?s=!1:r+=",",r+=xd(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${xd(i.fields[a])}`;return s+"}"}(n.mapValue):k();var e,t}function al(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Md(n){return!!n&&"integerValue"in n}function Cu(n){return!!n&&"arrayValue"in n}function T_(n){return!!n&&"nullValue"in n}function b_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Mc(n){return!!n&&"mapValue"in n}function To(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return kr(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=To(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=To(n.arrayValue.values[t]);return e}return Object.assign({},n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.value=e}static empty(){return new tt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Mc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=To(t)}setAll(e){let t=Re.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,r),i={},r=[],t=a.popLast()}o?i[a.lastSegment()]=To(o):r.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());Mc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Mc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){kr(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new tt(To(this.value))}}function CE(n){const e=[];return kr(n.fields,(t,i)=>{const r=new Re([t]);if(Mc(i)){const s=CE(i.mapValue).fields;if(s.length===0)e.push(r);else for(const o of s)e.push(r.child(o))}else e.push(r)}),new ms(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e,t,i,r,s,o){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new se(e,0,N.min(),N.min(),tt.empty(),0)}static newFoundDocument(e,t,i){return new se(e,1,t,N.min(),i,0)}static newNoDocument(e,t){return new se(e,2,t,N.min(),tt.empty(),0)}static newUnknownDocument(e,t){return new se(e,3,t,N.min(),tt.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=tt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=tt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof se&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new se(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class kE{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}kE.UNKNOWN_ID=-1;class XO{constructor(e,t){this.fieldPath=e,this.kind=t}}class cl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new cl(0,ku.min())}}class ku{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new ku(N.min(),S.empty(),-1)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JO{constructor(e,t=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.P=null}}function S_(n,e=null,t=[],i=[],r=null,s=null,o=null){return new JO(n,e,t,i,r,s,o)}function Fa(n){const e=b(n);if(e.P===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>{return(r=i).field.canonicalString()+r.op.toString()+is(r.value);var r}).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(r){return r.field.canonicalString()+r.dir}(i)).join(","),Ar(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>is(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>is(i)).join(",")),e.P=t}return e.P}function ZO(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(i=t).field.canonicalString()} ${i.op} ${is(i.value)}`;var i}).join(", ")}]`),Ar(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>function(i){return`${i.field.canonicalString()} (${i.dir})`}(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>is(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>is(t)).join(",")),`Target(${e})`}function Au(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<n.orderBy.length;r++)if(!aD(n.orderBy[r],e.orderBy[r]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let r=0;r<n.filters.length;r++)if(t=n.filters[r],i=e.filters[r],t.op!==i.op||!t.field.isEqual(i.field)||!rn(t.value,i.value))return!1;var t,i;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!k_(n.startAt,e.startAt)&&k_(n.endAt,e.endAt)}function ll(n){return S.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class dt extends class{}{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.v(e,t,i):new eD(e,t,i):t==="array-contains"?new iD(e,i):t==="in"?new rD(e,i):t==="not-in"?new sD(e,i):t==="array-contains-any"?new oD(e,i):new dt(e,t,i)}static v(e,t,i){return t==="in"?new tD(e,i):new nD(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.V(_s(t,this.value)):t!==null&&or(this.value)===or(t)&&this.V(_s(t,this.value))}V(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return k()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class eD extends dt{constructor(e,t,i){super(e,t,i),this.key=S.fromName(i.referenceValue)}matches(e){const t=S.comparator(e.key,this.key);return this.V(t)}}class tD extends dt{constructor(e,t){super(e,"in",t),this.keys=AE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nD extends dt{constructor(e,t){super(e,"not-in",t),this.keys=AE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function AE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>S.fromName(i.referenceValue))}class iD extends dt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Cu(t)&&Yo(t.arrayValue,this.value)}}class rD extends dt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Yo(this.value.arrayValue,t)}}class sD extends dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Yo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Yo(this.value.arrayValue,t)}}class oD extends dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Cu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Yo(this.value.arrayValue,i))}}class ys{constructor(e,t){this.position=e,this.inclusive=t}}class rs{constructor(e,t="asc"){this.field=e,this.dir=t}}function aD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function C_(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],o=n.position[r];if(s.field.isKeyField()?i=S.comparator(S.fromName(o.referenceValue),t.key):i=_s(o,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function k_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!rn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e,t=null,i=[],r=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.D=null,this.C=null,this.startAt,this.endAt}}function RE(n,e,t,i,r,s,o,a){return new Yn(n,e,t,i,r,s,o,a)}function Gs(n){return new Yn(n)}function Lc(n){return!Ar(n.limit)&&n.limitType==="F"}function ul(n){return!Ar(n.limit)&&n.limitType==="L"}function Cp(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function kp(n){for(const e of n.filters)if(e.S())return e.field;return null}function Ap(n){return n.collectionGroup!==null}function ws(n){const e=b(n);if(e.D===null){e.D=[];const t=kp(e),i=Cp(e);if(t!==null&&i===null)t.isKeyField()||e.D.push(new rs(t)),e.D.push(new rs(Re.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.D.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new rs(Re.keyField(),s))}}}return e.D}function Ht(n){const e=b(n);if(!e.C)if(e.limitType==="F")e.C=S_(e.path,e.collectionGroup,ws(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of ws(e)){const o=s.dir==="desc"?"asc":"desc";t.push(new rs(s.field,o))}const i=e.endAt?new ys(e.endAt.position,!e.endAt.inclusive):null,r=e.startAt?new ys(e.startAt.position,!e.startAt.inclusive):null;e.C=S_(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e.C}function NE(n,e,t){return new Yn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ua(n,e){return Au(Ht(n),Ht(e))&&n.limitType===e.limitType}function PE(n){return`${Fa(Ht(n))}|lt:${n.limitType}`}function Ld(n){return`Query(target=${ZO(Ht(n))}; limitType=${n.limitType})`}function Rp(n,e){return e.isFoundDocument()&&function(t,i){const r=i.key.path;return t.collectionGroup!==null?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):S.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,i){for(const r of t.explicitOrderBy)if(!r.field.isKeyField()&&i.data.field(r.field)===null)return!1;return!0}(n,e)&&function(t,i){for(const r of t.filters)if(!r.matches(i))return!1;return!0}(n,e)&&function(t,i){return!(t.startAt&&!function(r,s,o){const a=C_(r,s,o);return r.inclusive?a<=0:a<0}(t.startAt,ws(t),i)||t.endAt&&!function(r,s,o){const a=C_(r,s,o);return r.inclusive?a>=0:a>0}(t.endAt,ws(t),i))}(n,e)}function OE(n){return(e,t)=>{let i=!1;for(const r of ws(n)){const s=cD(r,e,t);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function cD(n,e,t){const i=n.field.isKeyField()?S.comparator(e.key,t.key):function(r,s,o){const a=s.data.field(r),c=o.data.field(r);return a!==null&&c!==null?_s(a,c):k()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return k()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DE(n,e){if(n.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qo(e)?"-0":e}}function xE(n){return{integerValue:""+n}}function ME(n,e){return SE(e)?xE(e):DE(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(){this._=void 0}}function lD(n,e,t){return n instanceof vs?function(i,r){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(s.fields.__previous_value__=r),{mapValue:s}}(t,e):n instanceof ar?FE(n,e):n instanceof cr?UE(n,e):function(i,r){const s=LE(i,r),o=A_(s)+A_(i.k);return Md(s)&&Md(i.k)?xE(o):DE(i.O,o)}(n,e)}function uD(n,e,t){return n instanceof ar?FE(n,e):n instanceof cr?UE(n,e):t}function LE(n,e){return n instanceof Is?Md(t=e)||function(i){return!!i&&"doubleValue"in i}(t)?e:{integerValue:0}:null;var t}class vs extends Ru{}class ar extends Ru{constructor(e){super(),this.elements=e}}function FE(n,e){const t=$E(e);for(const i of n.elements)t.some(r=>rn(r,i))||t.push(i);return{arrayValue:{values:t}}}class cr extends Ru{constructor(e){super(),this.elements=e}}function UE(n,e){let t=$E(e);for(const i of n.elements)t=t.filter(r=>!rn(r,i));return{arrayValue:{values:t}}}class Is extends Ru{constructor(e,t){super(),this.O=e,this.k=t}}function A_(n){return ce(n.integerValue||n.doubleValue)}function $E(n){return Cu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e,t){this.field=e,this.transform=t}}function hD(n,e){return n.field.isEqual(e.field)&&function(t,i){return t instanceof ar&&i instanceof ar||t instanceof cr&&i instanceof cr?gs(t.elements,i.elements,rn):t instanceof Is&&i instanceof Is?rn(t.k,i.k):t instanceof vs&&i instanceof vs}(n.transform,e.transform)}class dD{constructor(e,t){this.version=e,this.transformResults=t}}class me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new me}static exists(e){return new me(void 0,e)}static updateTime(e){return new me(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Fc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Nu{}function fD(n,e,t){n instanceof Va?function(i,r,s){const o=i.value.clone(),a=P_(i.fieldTransforms,r,s.transformResults);o.setAll(a),r.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Rr?function(i,r,s){if(!Fc(i.precondition,r))return void r.convertToUnknownDocument(s.version);const o=P_(i.fieldTransforms,r,s.transformResults),a=r.data;a.setAll(VE(i)),a.setAll(o),r.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(n,e,t):function(i,r,s){r.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,t)}function Fd(n,e,t){n instanceof Va?function(i,r,s){if(!Fc(i.precondition,r))return;const o=i.value.clone(),a=O_(i.fieldTransforms,s,r);o.setAll(a),r.convertToFoundDocument(N_(r),o).setHasLocalMutations()}(n,e,t):n instanceof Rr?function(i,r,s){if(!Fc(i.precondition,r))return;const o=O_(i.fieldTransforms,s,r),a=r.data;a.setAll(VE(i)),a.setAll(o),r.convertToFoundDocument(N_(r),a).setHasLocalMutations()}(n,e,t):function(i,r){Fc(i.precondition,r)&&r.convertToNoDocument(N.min())}(n,e)}function pD(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=LE(i.transform,r||null);s!=null&&(t==null&&(t=tt.empty()),t.set(i.field,s))}return t||null}function R_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(t,i){return t===void 0&&i===void 0||!(!t||!i)&&gs(t,i,(r,s)=>hD(r,s))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}function N_(n){return n.isFoundDocument()?n.version:N.min()}class Va extends Nu{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}}class Rr extends Nu{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}}function VE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function P_(n,e,t){const i=new Map;O(n.length===t.length);for(let r=0;r<t.length;r++){const s=n[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,uD(o,a,t[r]))}return i}function O_(n,e,t){const i=new Map;for(const r of n){const s=r.transform,o=t.data.field(r.field);i.set(r.field,lD(s,o,e))}return i}class Ba extends Nu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Np extends Nu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pe,$;function BE(n){switch(n){default:return k();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function qE(n){if(n===void 0)return ge("GRPC error has no .code"),g.UNKNOWN;switch(n){case pe.OK:return g.OK;case pe.CANCELLED:return g.CANCELLED;case pe.UNKNOWN:return g.UNKNOWN;case pe.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case pe.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case pe.INTERNAL:return g.INTERNAL;case pe.UNAVAILABLE:return g.UNAVAILABLE;case pe.UNAUTHENTICATED:return g.UNAUTHENTICATED;case pe.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case pe.NOT_FOUND:return g.NOT_FOUND;case pe.ALREADY_EXISTS:return g.ALREADY_EXISTS;case pe.PERMISSION_DENIED:return g.PERMISSION_DENIED;case pe.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case pe.ABORTED:return g.ABORTED;case pe.OUT_OF_RANGE:return g.OUT_OF_RANGE;case pe.UNIMPLEMENTED:return g.UNIMPLEMENTED;case pe.DATA_LOSS:return g.DATA_LOSS;default:return k()}}($=pe||(pe={}))[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fe{constructor(e,t){this.comparator=e,this.root=t||Ge.EMPTY}insert(e,t){return new fe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ge.BLACK,null,null))}remove(e){return new fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ge.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pc(this.root,e,this.comparator,!1)}getReverseIterator(){return new pc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pc(this.root,e,this.comparator,!0)}}class pc{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ge{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i!=null?i:Ge.RED,this.left=r!=null?r:Ge.EMPTY,this.right=s!=null?s:Ge.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Ge(e!=null?e:this.key,t!=null?t:this.value,i!=null?i:this.color,r!=null?r:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ge.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Ge.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ge.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ge.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw k();const e=this.left.check();if(e!==this.right.check())throw k();return e+(this.isRed()?0:1)}}Ge.EMPTY=null,Ge.RED=!0,Ge.BLACK=!1;Ge.EMPTY=new class{constructor(){this.size=0}get key(){throw k()}get value(){throw k()}get color(){throw k()}get left(){throw k()}get right(){throw k()}copy(n,e,t,i,r){return this}insert(n,e,t){return new Ge(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new D_(this.data.getIterator())}getIteratorFrom(e){return new D_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof re)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new re(this.comparator);return t.data=e,t}}class D_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Br(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mD=new fe(S.comparator);function Kt(){return mD}const _D=new fe(S.comparator);function Ud(){return _D}const yD=new fe(S.comparator),wD=new re(S.comparator);function G(...n){let e=wD;for(const t of n)e=e.add(t);return e}const vD=new re(U);function Pu(){return vD}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const i=new Map;return i.set(e,ja.createSynthesizedTargetChangeForCurrentChange(e,t)),new qa(N.min(),i,Pu(),Kt(),G())}}class ja{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new ja(Ie.EMPTY_BYTE_STRING,t,G(),G(),G())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,t,i,r){this.M=e,this.removedTargetIds=t,this.key=i,this.$=r}}class jE{constructor(e,t){this.targetId=e,this.F=t}}class KE{constructor(e,t,i=Ie.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class x_{constructor(){this.B=0,this.L=L_(),this.U=Ie.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return this.B!==0}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=G(),t=G(),i=G();return this.L.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:k()}}),new ja(this.U,this.q,e,t,i)}J(){this.K=!1,this.L=L_()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class ID{constructor(e){this.nt=e,this.st=new Map,this.it=Kt(),this.rt=M_(),this.ot=new re(U)}ct(e){for(const t of e.M)e.$&&e.$.isFoundDocument()?this.ut(t,e.$):this.at(t,e.key,e.$);for(const t of e.removedTargetIds)this.at(t,e.key,e.$)}ht(e){this.forEachTarget(e,t=>{const i=this.lt(t);switch(e.state){case 0:this.ft(t)&&i.W(e.resumeToken);break;case 1:i.tt(),i.G||i.J(),i.W(e.resumeToken);break;case 2:i.tt(),i.G||this.removeTarget(t);break;case 3:this.ft(t)&&(i.et(),i.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),i.W(e.resumeToken));break;default:k()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach((i,r)=>{this.ft(r)&&t(r)})}_t(e){const t=e.targetId,i=e.F.count,r=this.wt(t);if(r){const s=r.target;if(ll(s))if(i===0){const o=new S(s.path);this.at(t,o,se.newNoDocument(o,N.min()))}else O(i===1);else this.gt(t)!==i&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach((s,o)=>{const a=this.wt(o);if(a){if(s.current&&ll(a.target)){const c=new S(a.target.path);this.it.get(c)!==null||this.It(o,c)||this.at(o,c,se.newNoDocument(c,e))}s.j&&(t.set(o,s.H()),s.J())}});let i=G();this.rt.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.wt(c);return!l||l.purpose===2||(a=!1,!1)}),a&&(i=i.add(s))}),this.it.forEach((s,o)=>o.setReadTime(e));const r=new qa(e,t,this.ot,this.it,i);return this.it=Kt(),this.rt=M_(),this.ot=new re(U),r}ut(e,t){if(!this.ft(e))return;const i=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,i),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Et(t.key).add(e))}at(e,t,i){if(!this.ft(e))return;const r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Et(t).delete(e)),i&&(this.it=this.it.insert(t,i))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new x_,this.st.set(e,t)),t}Et(e){let t=this.rt.get(e);return t||(t=new re(U),this.rt=this.rt.insert(e,t)),t}ft(e){const t=this.wt(e)!==null;return t||I("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Tt(e)}dt(e){this.st.set(e,new x_),this.nt.getRemoteKeysForTarget(e).forEach(t=>{this.at(e,t,null)})}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function M_(){return new fe(S.comparator)}function L_(){return new fe(S.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ED=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),TD=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class bD{constructor(e,t){this.databaseId=e,this.N=t}}function Xo(n,e){return n.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function WE(n,e){return n.N?e.toBase64():e.toUint8Array()}function SD(n,e){return Xo(n,e.toTimestamp())}function De(n){return O(!!n),N.fromTimestamp(function(e){const t=_i(e);return new Oe(t.seconds,t.nanos)}(n))}function Pp(n,e){return function(t){return new j(["projects",t.projectId,"databases",t.database])}(n).child("documents").child(e).canonicalString()}function GE(n){const e=j.fromString(n);return O(eT(e)),e}function Jo(n,e){return Pp(n.databaseId,e.path)}function gn(n,e){const t=GE(e);if(t.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new S(zE(t))}function $d(n,e){return Pp(n.databaseId,e)}function HE(n){const e=GE(n);return e.length===4?j.emptyPath():zE(e)}function Zo(n){return new j(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function zE(n){return O(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function F_(n,e,t){return{name:Jo(n,e),fields:t.value.mapValue.fields}}function QE(n,e,t){const i=gn(n,e.name),r=De(e.updateTime),s=new tt({mapValue:{fields:e.fields}}),o=se.newFoundDocument(i,r,s);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function CD(n,e){return"found"in e?function(t,i){O(!!i.found),i.found.name,i.found.updateTime;const r=gn(t,i.found.name),s=De(i.found.updateTime),o=new tt({mapValue:{fields:i.found.fields}});return se.newFoundDocument(r,s,o)}(n,e):"missing"in e?function(t,i){O(!!i.missing),O(!!i.readTime);const r=gn(t,i.missing),s=De(i.readTime);return se.newNoDocument(r,s)}(n,e):k()}function kD(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:k()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,l){return c.N?(O(l===void 0||typeof l=="string"),Ie.fromBase64String(l||"")):(O(l===void 0||l instanceof Uint8Array),Ie.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=c.code===void 0?g.UNKNOWN:qE(c.code);return new y(l,c.message||"")}(o);t=new KE(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=gn(n,i.document.name),s=De(i.document.updateTime),o=new tt({mapValue:{fields:i.document.fields}}),a=se.newFoundDocument(r,s,o),c=i.targetIds||[],l=i.removedTargetIds||[];t=new Uc(c,l,a.key,a)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=gn(n,i.document),s=i.readTime?De(i.readTime):N.min(),o=se.newNoDocument(r,s),a=i.removedTargetIds||[];t=new Uc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=gn(n,i.document),s=i.removedTargetIds||[];t=new Uc([],s,r,null)}else{if(!("filter"in e))return k();{e.filter;const i=e.filter;i.targetId;const r=i.count||0,s=new gD(r),o=i.targetId;t=new jE(o,s)}}return t}function ea(n,e){let t;if(e instanceof Va)t={update:F_(n,e.key,e.value)};else if(e instanceof Ba)t={delete:Jo(n,e.key)};else if(e instanceof Rr)t={update:F_(n,e.key,e.data),updateMask:xD(e.fieldMask)};else{if(!(e instanceof Np))return k();t={verify:Jo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,s){const o=s.transform;if(o instanceof vs)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof ar)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof cr)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Is)return{fieldPath:s.field.canonicalString(),increment:o.k};throw k()}(0,i))),e.precondition.isNone||(t.currentDocument=function(i,r){return r.updateTime!==void 0?{updateTime:SD(i,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:k()}(n,e.precondition)),t}function Vd(n,e){const t=e.currentDocument?function(r){return r.updateTime!==void 0?me.updateTime(De(r.updateTime)):r.exists!==void 0?me.exists(r.exists):me.none()}(e.currentDocument):me.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,o){let a=null;if("setToServerValue"in o)O(o.setToServerValue==="REQUEST_TIME"),a=new vs;else if("appendMissingElements"in o){const l=o.appendMissingElements.values||[];a=new ar(l)}else if("removeAllFromArray"in o){const l=o.removeAllFromArray.values||[];a=new cr(l)}else"increment"in o?a=new Is(s,o.increment):k();const c=Re.fromServerFormat(o.fieldPath);return new $a(c,a)}(n,r)):[];if(e.update){e.update.name;const r=gn(n,e.update.name),s=new tt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(a){const c=a.fieldPaths||[];return new ms(c.map(l=>Re.fromServerFormat(l)))}(e.updateMask);return new Rr(r,s,o,t,i)}return new Va(r,s,t,i)}if(e.delete){const r=gn(n,e.delete);return new Ba(r,t)}if(e.verify){const r=gn(n,e.verify);return new Np(r,t)}return k()}function AD(n,e){return n&&n.length>0?(O(e!==void 0),n.map(t=>function(i,r){let s=i.updateTime?De(i.updateTime):De(r);return s.isEqual(N.min())&&(s=De(r)),new dD(s,i.transformResults||[])}(t,e))):[]}function YE(n,e){return{documents:[$d(n,e.path)]}}function XE(n,e){const t={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(t.parent=$d(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=$d(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(c){if(c.length===0)return;const l=c.map(u=>function(h){if(h.op==="=="){if(b_(h.value))return{unaryFilter:{field:qr(h.field),op:"IS_NAN"}};if(T_(h.value))return{unaryFilter:{field:qr(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(b_(h.value))return{unaryFilter:{field:qr(h.field),op:"IS_NOT_NAN"}};if(T_(h.value))return{unaryFilter:{field:qr(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qr(h.field),op:PD(h.op),value:h.value}}}(u));return l.length===1?l[0]:{compositeFilter:{op:"AND",filters:l}}}(e.filters);r&&(t.structuredQuery.where=r);const s=function(c){if(c.length!==0)return c.map(l=>function(u){return{field:qr(u.field),direction:ND(u.dir)}}(l))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=function(c,l){return c.N||Ar(l)?l:{value:l}}(n,e.limit);var a;return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function JE(n){let e=HE(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){O(i===1);const u=t.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=ZE(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(u=>function(h){return new rs(Yr(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(u)));let a=null;t.limit&&(a=function(u){let h;return h=typeof u=="object"?u.value:u,Ar(h)?null:h}(t.limit));let c=null;t.startAt&&(c=function(u){const h=!!u.before,d=u.values||[];return new ys(d,h)}(t.startAt));let l=null;return t.endAt&&(l=function(u){const h=!u.before,d=u.values||[];return new ys(d,h)}(t.endAt)),RE(e,r,o,s,a,"F",c,l)}function RD(n,e){const t=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return k()}}(0,e.purpose);return t==null?null:{"goog-listen-tags":t}}function ZE(n){return n?n.unaryFilter!==void 0?[DD(n)]:n.fieldFilter!==void 0?[OD(n)]:n.compositeFilter!==void 0?n.compositeFilter.filters.map(e=>ZE(e)).reduce((e,t)=>e.concat(t)):k():[]}function ND(n){return ED[n]}function PD(n){return TD[n]}function qr(n){return{fieldPath:n.canonicalString()}}function Yr(n){return Re.fromServerFormat(n.fieldPath)}function OD(n){return dt.create(Yr(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return k()}}(n.fieldFilter.op),n.fieldFilter.value)}function DD(n){switch(n.unaryFilter.op){case"IS_NAN":const e=Yr(n.unaryFilter.field);return dt.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=Yr(n.unaryFilter.field);return dt.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Yr(n.unaryFilter.field);return dt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Yr(n.unaryFilter.field);return dt.create(r,"!=",{nullValue:"NULL_VALUE"});default:return k()}}function xD(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function eT(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=U_(e)),e=MD(n.get(t),e);return U_(e)}function MD(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function U_(n){return n+""}function fn(n){const e=n.length;if(O(e>=2),e===2)return O(n.charAt(0)===""&&n.charAt(1)===""),j.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const o=n.indexOf("",s);switch((o<0||o>t)&&k(),n.charAt(o+1)){case"":const a=n.substring(s,o);let c;r.length===0?c=a:(r+=a,c=r,r=""),i.push(c);break;case"":r+=n.substring(s,o),r+="\0";break;case"":r+=n.substring(s,o+1);break;default:k()}s=o+2}return new j(i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Ct{constructor(e,t,i){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=i}}Ct.store="owner",Ct.key="owner";class ai{constructor(e,t,i){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=i}}ai.store="mutationQueues",ai.keyPath="userId";class Z{constructor(e,t,i,r,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=i,this.baseMutations=r,this.mutations=s}}Z.store="mutations",Z.keyPath="batchId",Z.userMutationsIndex="userMutationsIndex",Z.userMutationsKeyPath=["userId","batchId"];class et{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Ne(t)]}static key(e,t,i){return[e,Ne(t),i]}}et.store="documentMutations",et.PLACEHOLDER=new et;class FD{constructor(e,t){this.path=e,this.readTime=t}}class UD{constructor(e,t){this.path=e,this.version=t}}class ae{constructor(e,t,i,r,s,o){this.unknownDocument=e,this.noDocument=t,this.document=i,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=o}}ae.store="remoteDocuments",ae.readTimeIndex="readTimeIndex",ae.readTimeIndexPath="readTime",ae.collectionReadTimeIndex="collectionReadTimeIndex",ae.collectionReadTimeIndexPath=["parentPath","readTime"];class pn{constructor(e){this.byteSize=e}}pn.store="remoteDocumentGlobal",pn.key="remoteDocumentGlobalKey";class It{constructor(e,t,i,r,s,o,a){this.targetId=e,this.canonicalId=t,this.readTime=i,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=o,this.query=a}}It.store="targets",It.keyPath="targetId",It.queryTargetsIndexName="queryTargetsIndex",It.queryTargetsKeyPath=["canonicalId","targetId"];class He{constructor(e,t,i){this.targetId=e,this.path=t,this.sequenceNumber=i}}He.store="targetDocuments",He.keyPath=["targetId","path"],He.documentTargetsIndex="documentTargetsIndex",He.documentTargetsKeyPath=["path","targetId"];class kt{constructor(e,t,i,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=i,this.targetCount=r}}kt.key="targetGlobalKey",kt.store="targetGlobal";class Yi{constructor(e,t){this.collectionId=e,this.parent=t}}Yi.store="collectionParents",Yi.keyPath=["collectionId","parent"];class $n{constructor(e,t,i,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=i,this.inForeground=r}}$n.store="clientMetadata",$n.keyPath="clientId";class Es{constructor(e,t,i){this.bundleId=e,this.createTime=t,this.version=i}}Es.store="bundles",Es.keyPath="bundleId";class Ts{constructor(e,t,i){this.name=e,this.readTime=t,this.bundledQuery=i}}Ts.store="namedQueries",Ts.keyPath="name";class Ot{constructor(e,t,i){this.indexId=e,this.collectionGroup=t,this.fields=i}}Ot.store="indexConfiguration",Ot.keyPath="indexId",Ot.collectionGroupIndex="collectionGroupIndex",Ot.collectionGroupIndexPath="collectionGroup";class Ut{constructor(e,t,i,r,s,o){this.indexId=e,this.uid=t,this.sequenceNumber=i,this.readTime=r,this.documentKey=s,this.largestBatchId=o}}Ut.store="indexState",Ut.keyPath=["indexId","uid"],Ut.sequenceNumberIndex="sequenceNumberIndex",Ut.sequenceNumberIndexPath=["uid","sequenceNumber"];class $t{constructor(e,t,i,r,s){this.indexId=e,this.uid=t,this.arrayValue=i,this.directionalValue=r,this.documentKey=s}}$t.store="indexEntries",$t.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],$t.documentKeyIndex="documentKeyIndex",$t.documentKeyIndexPath=["indexId","uid","documentKey"];class ke{constructor(e,t,i,r,s,o){this.userId=e,this.collectionPath=t,this.documentId=i,this.collectionGroup=r,this.largestBatchId=s,this.overlayMutation=o}}ke.store="documentOverlays",ke.keyPath=["userId","collectionPath","documentId"],ke.collectionPathOverlayIndex="collectionPathOverlayIndex",ke.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],ke.collectionGroupOverlayIndex="collectionGroupOverlayIndex",ke.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const tT=[ai.store,Z.store,et.store,ae.store,It.store,Ct.store,kt.store,He.store,$n.store,pn.store,Yi.store,Es.store,Ts.store],nT=[...tT,ke.store],$D=[...nT,Ot.store,Ut.store,$t.store];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&k(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new m((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof m?t:m.resolve(t)}catch(t){return m.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):m.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):m.reject(t)}static resolve(e){return new m((t,i)=>{t(e)})}static reject(e){return new m((t,i)=>{i(e)})}static waitFor(e){return new m((t,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&t()},c=>i(c))}),o=!0,s===r&&t()})}static or(e){let t=m.resolve(!1);for(const i of e)t=t.next(r=>r?m.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.At=new Pe,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{t.error?this.At.reject(new bo(e,t.error)):this.At.resolve()},this.transaction.onerror=i=>{const r=Op(i.target.error);this.At.reject(new bo(e,r))}}static open(e,t,i,r){try{return new Ou(t,e.transaction(r,i))}catch(s){throw new bo(t,s)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(I("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new BD(t)}}class Jt{constructor(e,t,i){this.name=e,this.version=t,this.bt=i,Jt.vt(te())===12.2&&ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return I("SimpleDb","Removing database:",e),Li(window.indexedDB.deleteDatabase(e)).toPromise()}static Vt(){if(!bt())return!1;if(Jt.St())return!0;const e=te(),t=Jt.vt(e),i=0<t&&t<10,r=Jt.Dt(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static St(){var e;return typeof process!="undefined"&&((e=process.env)===null||e===void 0?void 0:e.Ct)==="YES"}static Nt(e,t){return e.store(t)}static vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}async xt(e){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,i)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=s=>{const o=s.target.result;t(o)},r.onblocked=()=>{i(new bo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=s=>{const o=s.target.error;o.name==="VersionError"?i(new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new bo(e,o))},r.onupgradeneeded=s=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.bt.kt(o,r.transaction,s.oldVersion,this.version).next(()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Ot&&(this.db.onversionchange=t=>this.Ot(t)),this.db}Mt(e){this.Ot=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,i,r){const s=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.xt(e);const a=Ou.open(this.db,e,s?"readonly":"readwrite",i),c=r(a).next(l=>(a.Pt(),l)).catch(l=>(a.abort(l),m.reject(l))).toPromise();return c.catch(()=>{}),await a.Rt,c}catch(a){const c=a.name!=="FirebaseError"&&o<3;if(I("SimpleDb","Transaction failed with error:",a.message,"Retrying:",c),this.close(),!c)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}class VD{constructor(e){this.$t=e,this.Ft=!1,this.Bt=null}get isDone(){return this.Ft}get Lt(){return this.Bt}set cursor(e){this.$t=e}done(){this.Ft=!0}Ut(e){this.Bt=e}delete(){return Li(this.$t.delete())}}class bo extends y{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Nr(n){return n.name==="IndexedDbTransactionError"}class BD{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(I("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Li(i)}add(e){return I("SimpleDb","ADD",this.store.name,e,e),Li(this.store.add(e))}get(e){return Li(this.store.get(e)).next(t=>(t===void 0&&(t=null),I("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return I("SimpleDb","DELETE",this.store.name,e),Li(this.store.delete(e))}count(){return I("SimpleDb","COUNT",this.store.name),Li(this.store.count())}qt(e,t){const i=this.options(e,t);if(i.index||typeof this.store.getAll!="function"){const r=this.cursor(i),s=[];return this.Kt(r,(o,a)=>{s.push(a)}).next(()=>s)}{const r=this.store.getAll(i.range);return new m((s,o)=>{r.onerror=a=>{o(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}}Gt(e,t){I("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.jt=!1;const r=this.cursor(i);return this.Kt(r,(s,o,a)=>a.delete())}Qt(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.Kt(r,t)}Wt(e){const t=this.cursor({});return new m((i,r)=>{t.onerror=s=>{const o=Op(s.target.error);r(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}Kt(e,t){const i=[];return new m((r,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const c=new VD(a),l=t(a.primaryKey,a.value,c);if(l instanceof m){const u=l.catch(h=>(c.done(),m.reject(h)));i.push(u)}c.isDone?r():c.Lt===null?a.continue():a.continue(c.Lt)}}).next(()=>m.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.jt?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Li(n){return new m((e,t)=>{n.onsuccess=i=>{const r=i.target.result;e(r)},n.onerror=i=>{const r=Op(i.target.error);t(r)}})}let $_=!1;function Op(n){const e=Jt.vt(te());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return $_||($_=!0,setTimeout(()=>{throw i},0)),i}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_ extends rT{constructor(e,t){super(),this.zt=e,this.currentSequenceNumber=t}}function Be(n,e){const t=b(n);return Jt.Nt(t.zt,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&fD(s,e,i[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Fd(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Fd(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const i=e.get(t.key),r=i;this.applyToLocalView(r),i.isValidDocument()||r.convertToNoDocument(N.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),G())}isEqual(e){return this.batchId===e.batchId&&gs(this.mutations,e.mutations,(t,i)=>R_(t,i))&&gs(this.baseMutations,e.baseMutations,(t,i)=>R_(t,i))}}class xp{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){O(e.mutations.length===i.length);let r=yD;const s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new xp(e,t,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,t,i,r,s=N.min(),o=N.min(),a=Ie.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new ci(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{constructor(e){this.Ht=e}}function oT(n,e){let t;if(e.document)t=QE(n.Ht,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=S.fromSegments(e.noDocument.path),r=ur(e.noDocument.readTime);t=se.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return k();{const i=S.fromSegments(e.unknownDocument.path),r=ur(e.unknownDocument.version);t=se.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(Fp(e.readTime)),t}function B_(n,e){const t=Lp(e.readTime),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){const r=function(o,a){return{name:Jo(o,a.key),fields:a.data.value.mapValue.fields,updateTime:Xo(o,a.version.toTimestamp())}}(n.Ht,e),s=e.hasCommittedMutations;return new ae(null,null,r,s,t,i)}if(e.isNoDocument()){const r=e.key.path.toArray(),s=lr(e.version),o=e.hasCommittedMutations;return new ae(null,new FD(r,s),null,o,t,i)}if(e.isUnknownDocument()){const r=e.key.path.toArray(),s=lr(e.version);return new ae(new UD(r,s),null,null,!0,t,i)}return k()}function Lp(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Fp(n){const e=new Oe(n[0],n[1]);return N.fromTimestamp(e)}function lr(n){const e=n.toTimestamp();return new LD(e.seconds,e.nanoseconds)}function ur(n){const e=new Oe(n.seconds,n.nanoseconds);return N.fromTimestamp(e)}function Gr(n,e){const t=(e.baseMutations||[]).map(s=>Vd(n.Ht,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const i=e.mutations.map(s=>Vd(n.Ht,s)),r=Oe.fromMillis(e.localWriteTimeMs);return new Dp(e.batchId,r,t,i)}function yo(n){const e=ur(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ur(n.lastLimboFreeSnapshotVersion):N.min();let i;var r;return n.query.documents!==void 0?(O((r=n.query).documents.length===1),i=Ht(Gs(HE(r.documents[0])))):i=function(s){return Ht(JE(s))}(n.query),new ci(i,n.targetId,0,n.lastListenSequenceNumber,e,t,Ie.fromBase64String(n.resumeToken))}function aT(n,e){const t=lr(e.snapshotVersion),i=lr(e.lastLimboFreeSnapshotVersion);let r;r=ll(e.target)?YE(n.Ht,e.target):XE(n.Ht,e.target);const s=e.resumeToken.toBase64();return new It(e.targetId,Fa(e.target),t,s,e.sequenceNumber,i,r)}function Up(n){const e=JE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?NE(e,e.limit,"L"):e}function Mh(n,e){return new Mp(e.largestBatchId,Vd(n.Ht,e.overlayMutation))}function q_(n,e){const t=e.path.lastSegment();return[n,Ne(e.path.popLast()),t]}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{getBundleMetadata(e,t){return j_(e).get(t).next(i=>{if(i)return{id:(r=i).bundleId,createTime:ur(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return j_(e).put({bundleId:(i=t).id,createTime:lr(De(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return K_(e).get(t).next(i=>{if(i)return{name:(r=i).name,query:Up(r.bundledQuery),readTime:ur(r.readTime)};var r})}saveNamedQuery(e,t){return K_(e).put(function(i){return{name:i.name,readTime:lr(De(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function j_(n){return Be(n,Es.store)}function K_(n){return Be(n,Ts.store)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t){this.O=e,this.userId=t}static Jt(e,t){const i=t.uid||"";return new $p(e,i)}getOverlay(e,t){return so(e).get(q_(this.userId,t)).next(i=>i?Mh(this.O,i):null)}saveOverlays(e,t,i){const r=[];return i.forEach(s=>{const o=new Mp(t,s);r.push(this.Yt(e,o))}),m.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(o=>r.add(Ne(o.getCollectionPath())));const s=[];return r.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);s.push(so(e).Gt(ke.collectionPathOverlayIndex,a))}),m.waitFor(s)}getOverlaysForCollection(e,t,i){const r=new Map,s=Ne(t),o=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return so(e).qt(ke.collectionPathOverlayIndex,o).next(a=>{for(const c of a){const l=Mh(this.O,c);r.set(l.getKey(),l)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=new Map;let o;const a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return so(e).Qt({index:ke.collectionGroupOverlayIndex,range:a},(c,l,u)=>{const h=Mh(this.O,l);s.size<r||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}Yt(e,t){return so(e).put(function(i,r,s){const[o,a,c]=q_(r,s.mutation.key);return new ke(r,a,c,s.mutation.key.getCollectionGroup(),s.largestBatchId,ea(i.Ht,s.mutation))}(this.O,this.userId,t))}}function so(n){return Be(n,ke.store)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(){}Xt(e,t){this.Zt(e,t),t.te()}Zt(e,t){if("nullValue"in e)this.ee(t,5);else if("booleanValue"in e)this.ee(t,10),t.ne(e.booleanValue?1:0);else if("integerValue"in e)this.ee(t,15),t.ne(ce(e.integerValue));else if("doubleValue"in e){const i=ce(e.doubleValue);isNaN(i)?this.ee(t,13):(this.ee(t,15),Qo(i)?t.ne(0):t.ne(i))}else if("timestampValue"in e){const i=e.timestampValue;this.ee(t,20),typeof i=="string"?t.se(i):(t.se(`${i.seconds||""}`),t.ne(i.nanos||0))}else if("stringValue"in e)this.ie(e.stringValue,t),this.re(t);else if("bytesValue"in e)this.ee(t,30),t.oe(rr(e.bytesValue)),this.re(t);else if("referenceValue"in e)this.ce(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.ee(t,45),t.ne(i.latitude||0),t.ne(i.longitude||0)}else"mapValue"in e?rn(e,YO)?this.ee(t,Number.MAX_SAFE_INTEGER):(this.ue(e.mapValue,t),this.re(t)):"arrayValue"in e?(this.ae(e.arrayValue,t),this.re(t)):k()}ie(e,t){this.ee(t,25),this.he(e,t)}he(e,t){t.se(e)}ue(e,t){const i=e.fields||{};this.ee(t,55);for(const r of Object.keys(i))this.ie(r,t),this.Zt(i[r],t)}ae(e,t){const i=e.values||[];this.ee(t,50);for(const r of i)this.Zt(r,t)}ce(e,t){this.ee(t,37),S.fromName(e).path.forEach(i=>{this.ee(t,60),this.he(i,t)})}ee(e,t){e.ne(t)}re(e){e.ne(2)}}hl.le=new hl;function jD(n){if(n===0)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function W_(n){const e=64-function(t){let i=0;for(let r=0;r<8;++r){const s=jD(255&t[r]);if(i+=s,s!==8)break}return i}(n);return Math.ceil(e/8)}class KD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}fe(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.de(i.value),i=t.next();this._e()}we(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.me(i.value),i=t.next();this.ge()}ye(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.de(i);else if(i<2048)this.de(960|i>>>6),this.de(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.de(480|i>>>12),this.de(128|63&i>>>6),this.de(128|63&i);else{const r=t.codePointAt(0);this.de(240|r>>>18),this.de(128|63&r>>>12),this.de(128|63&r>>>6),this.de(128|63&r)}}this._e()}pe(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.me(i);else if(i<2048)this.me(960|i>>>6),this.me(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.me(480|i>>>12),this.me(128|63&i>>>6),this.me(128|63&i);else{const r=t.codePointAt(0);this.me(240|r>>>18),this.me(128|63&r>>>12),this.me(128|63&r>>>6),this.me(128|63&r)}}this.ge()}Ie(e){const t=this.Ee(e),i=W_(t);this.Te(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Ae(e){const t=this.Ee(e),i=W_(t);this.Te(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Re(){this.Pe(255),this.Pe(255)}be(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Te(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ve(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(r){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,r,!1),new Uint8Array(s.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}de(e){const t=255&e;t===0?(this.Pe(0),this.Pe(255)):t===255?(this.Pe(255),this.Pe(0)):this.Pe(t)}me(e){const t=255&e;t===0?(this.ve(0),this.ve(255)):t===255?(this.ve(255),this.ve(0)):this.ve(e)}_e(){this.Pe(0),this.Pe(1)}ge(){this.ve(0),this.ve(1)}Pe(e){this.Te(1),this.buffer[this.position++]=e}ve(e){this.Te(1),this.buffer[this.position++]=~e}Te(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class WD{constructor(e){this.Se=e}oe(e){this.Se.fe(e)}se(e){this.Se.ye(e)}ne(e){this.Se.Ie(e)}te(){this.Se.Re()}}class GD{constructor(e){this.Se=e}oe(e){this.Se.we(e)}se(e){this.Se.pe(e)}ne(e){this.Se.Ae(e)}te(){this.Se.be()}}class G_{constructor(){this.Se=new KD,this.De=new WD(this.Se),this.Ce=new GD(this.Se)}seed(e){this.Se.seed(e)}Ne(e){return e===0?this.De:this.Ce}Ve(){return this.Se.Ve()}reset(){this.Se.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}}function Fh(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=S.comparator(n.documentKey,e.documentKey),t!==0?t:(t=H_(n.arrayValue,e.arrayValue),t!==0?t:H_(n.directionalValue,e.directionalValue)))}function H_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(){this.xe=new Vp}addToCollectionParentIndex(e,t){return this.xe.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.xe.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t,i){return m.resolve(G())}getFieldIndex(e,t){return m.resolve(null)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}updateCollectionGroup(e,t,i){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}}class Vp{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new re(j.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new re(j.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e){this.user=e,this.ke=new Vp,this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.ke.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.ke.add(t)});const s={collectionId:i,parent:Ne(r)};return z_(e).put(s)}return m.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[EE(t),""],!1,!0);return z_(e).qt(r).next(s=>{for(const o of s){if(o.collectionId!==t)break;i.push(fn(o.parent))}return i})}addFieldIndex(e,t){const i=mc(e),r=function(s){return new Ot(s.indexId,s.collectionGroup,s.fields.map(o=>[o.fieldPath.canonicalString(),o.kind]))}(t);return delete r.indexId,i.add(r).next()}deleteFieldIndex(e,t){const i=mc(e),r=_c(e),s=gc(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t,i){return m.resolve(G())}getFieldIndex(e,t){return m.resolve(null)}Oe(e,t){const i=new G_;for(const r of function(s){return s.fields.filter(o=>o.kind!==2)}(e)){const s=t.data.field(r.fieldPath);if(s==null)return null;const o=i.Ne(r.kind);hl.le.Xt(s,o)}return i.Ve()}Me(e){const t=new G_;return hl.le.Xt(e,t.Ne(0)),t.Ve()}getFieldIndexes(e,t){const i=mc(e),r=_c(e);return(t?i.qt(Ot.collectionGroupIndex,IDBKeyRange.bound(t,t)):i.qt()).next(s=>{const o=[];return m.forEach(s,a=>r.get([a.indexId,this.uid]).next(c=>{o.push(function(l,u){const h=u?new cl(u.sequenceNumber,new ku(ur(u.readTime),new S(fn(u.documentKey)),u.largestBatchId)):cl.empty(),d=l.fields.map(([f,p])=>new XO(Re.fromServerFormat(f),p));return new kE(l.indexId,l.collectionGroup,d,h)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,r)=>i.indexState.sequenceNumber-r.indexState.sequenceNumber),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=mc(e),s=_c(e);return this.$e(e).next(o=>r.qt(Ot.collectionGroupIndex,IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,c=>s.put(function(l,u,h,d){return new Ut(l,u.uid||"",h,lr(d.readTime),Ne(d.documentKey.path),d.largestBatchId)}(c.indexId,this.user,o,i)))))}updateIndexEntries(e,t){const i=new Map;return m.forEach(t,(r,s)=>{const o=i.get(r.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(i.set(r.collectionGroup,a),m.forEach(a,c=>this.Fe(e,r,c).next(l=>{const u=this.Be(s,c);return l.isEqual(u)?m.resolve():this.Le(e,s,l,u)}))))})}Ue(e,t,i){return gc(e).put(new $t(i.indexId,this.uid,i.arrayValue,i.directionalValue,Ne(t.key.path)))}qe(e,t,i){return gc(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,Ne(t.key.path)])}Fe(e,t,i){const r=gc(e);let s=new re(Fh);return r.Qt({index:$t.documentKeyIndex,range:IDBKeyRange.only([i.indexId,this.uid,Ne(t.path)])},(o,a)=>{s=s.add(new Lh(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Be(e,t){let i=new re(Fh);const r=this.Oe(t,e);if(r==null)return i;const s=function(o){return o.fields.find(a=>a.kind===2)}(t);if(s!=null){const o=e.data.field(s.fieldPath);if(Cu(o))for(const a of o.arrayValue.values||[])i=i.add(new Lh(t.indexId,e.key,this.Me(a),r))}else i=i.add(new Lh(t.indexId,e.key,new Uint8Array,r));return i}Le(e,t,i,r){I("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(o,a,c,l,u){const h=o.getIterator(),d=a.getIterator();let f=Br(h),p=Br(d);for(;f||p;){let _=!1,v=!1;if(f&&p){const P=c(f,p);P<0?v=!0:P>0&&(_=!0)}else f!=null?v=!0:_=!0;_?(l(p),p=Br(d)):v?(u(f),f=Br(h)):(f=Br(h),p=Br(d))}}(i,r,Fh,o=>{s.push(this.Ue(e,t,o))},o=>{s.push(this.qe(e,t,o))}),m.waitFor(s)}$e(e){let t=1;return _c(e).Qt({index:Ut.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}}function z_(n){return Be(n,Yi.store)}function gc(n){return Be(n,$t.store)}function mc(n){return Be(n,Ot.store)}function _c(n){return Be(n,Ut.store)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yt{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new yt(e,yt.DEFAULT_COLLECTION_PERCENTILE,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cT(n,e,t){const i=n.store(Z.store),r=n.store(et.store),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=i.Qt({range:o},(u,h,d)=>(a++,d.delete()));s.push(c.next(()=>{O(a===1)}));const l=[];for(const u of t.mutations){const h=et.key(e,u.key.path,t.batchId);s.push(r.delete(h)),l.push(u.key)}return m.waitFor(s).next(()=>l)}function dl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw k();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yt.DEFAULT_COLLECTION_PERCENTILE=10,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yt.DEFAULT=new yt(41943040,yt.DEFAULT_COLLECTION_PERCENTILE,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yt.DISABLED=new yt(-1,0,0);class Bp{constructor(e,t,i,r){this.userId=e,this.O=t,this.indexManager=i,this.referenceDelegate=r,this.Ke={}}static Jt(e,t,i,r){O(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new Bp(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ei(e).Qt({index:Z.userMutationsIndex,range:i},(r,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=Hr(e),o=ei(e);return o.add({}).next(a=>{O(typeof a=="number");const c=new Dp(a,t,i,r),l=function(d,f,p){const _=p.baseMutations.map(P=>ea(d.Ht,P)),v=p.mutations.map(P=>ea(d.Ht,P));return new Z(f,p.batchId,p.localWriteTime.toMillis(),_,v)}(this.O,this.userId,c),u=[];let h=new re((d,f)=>U(d.canonicalString(),f.canonicalString()));for(const d of r){const f=et.key(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(l)),u.push(s.put(f,et.PLACEHOLDER))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Ke[a]=c.keys()}),m.waitFor(u).next(()=>c)})}lookupMutationBatch(e,t){return ei(e).get(t).next(i=>i?(O(i.userId===this.userId),Gr(this.O,i)):null)}Ge(e,t){return this.Ke[t]?m.resolve(this.Ke[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.Ke[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return ei(e).Qt({index:Z.userMutationsIndex,range:r},(o,a,c)=>{a.userId===this.userId&&(O(a.batchId>=i),s=Gr(this.O,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return ei(e).Qt({index:Z.userMutationsIndex,range:t,reverse:!0},(r,s,o)=>{i=s.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ei(e).qt(Z.userMutationsIndex,t).next(i=>i.map(r=>Gr(this.O,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=et.prefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return Hr(e).Qt({range:r},(o,a,c)=>{const[l,u,h]=o,d=fn(u);if(l===this.userId&&t.path.isEqual(d))return ei(e).get(h).next(f=>{if(!f)throw k();O(f.userId===this.userId),s.push(Gr(this.O,f))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new re(U);const r=[];return t.forEach(s=>{const o=et.prefixForPath(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Hr(e).Qt({range:a},(l,u,h)=>{const[d,f,p]=l,_=fn(f);d===this.userId&&s.path.isEqual(_)?i=i.add(p):h.done()});r.push(c)}),m.waitFor(r).next(()=>this.je(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=et.prefixForPath(this.userId,i),o=IDBKeyRange.lowerBound(s);let a=new re(U);return Hr(e).Qt({range:o},(c,l,u)=>{const[h,d,f]=c,p=fn(d);h===this.userId&&i.isPrefixOf(p)?p.length===r&&(a=a.add(f)):u.done()}).next(()=>this.je(e,a))}je(e,t){const i=[],r=[];return t.forEach(s=>{r.push(ei(e).get(s).next(o=>{if(o===null)throw k();O(o.userId===this.userId),i.push(Gr(this.O,o))}))}),m.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return cT(e.zt,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.Qe(t.batchId)}),m.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}Qe(e){delete this.Ke[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();const i=IDBKeyRange.lowerBound(et.prefixForUser(this.userId)),r=[];return Hr(e).Qt({range:i},(s,o,a)=>{if(s[0]===this.userId){const c=fn(s[1]);r.push(c)}else a.done()}).next(()=>{O(r.length===0)})})}containsKey(e,t){return lT(e,this.userId,t)}We(e){return uT(e).get(this.userId).next(t=>t||new ai(this.userId,-1,""))}}function lT(n,e,t){const i=et.prefixForPath(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let o=!1;return Hr(n).Qt({range:s,jt:!0},(a,c,l)=>{const[u,h,d]=a;u===e&&h===r&&(o=!0),l.done()}).next(()=>o)}function ei(n){return Be(n,Z.store)}function Hr(n){return Be(n,et.store)}function uT(n){return Be(n,ai.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e){this.ze=e}next(){return this.ze+=2,this.ze}static He(){return new hr(0)}static Je(){return new hr(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,t){this.referenceDelegate=e,this.O=t}allocateTargetId(e){return this.Ye(e).next(t=>{const i=new hr(t.highestTargetId);return t.highestTargetId=i.next(),this.Xe(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ye(e).next(t=>N.fromTimestamp(new Oe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ye(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Ye(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Xe(e,r)))}addTargetData(e,t){return this.Ze(e,t).next(()=>this.Ye(e).next(i=>(i.targetCount+=1,this.tn(t,i),this.Xe(e,i))))}updateTargetData(e,t){return this.Ze(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>jr(e).delete(t.targetId)).next(()=>this.Ye(e)).next(i=>(O(i.targetCount>0),i.targetCount-=1,this.Xe(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return jr(e).Qt((o,a)=>{const c=yo(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(r++,s.push(this.removeTargetData(e,c)))}).next(()=>m.waitFor(s)).next(()=>r)}forEachTarget(e,t){return jr(e).Qt((i,r)=>{const s=yo(r);t(s)})}Ye(e){return Y_(e).get(kt.key).next(t=>(O(t!==null),t))}Xe(e,t){return Y_(e).put(kt.key,t)}Ze(e,t){return jr(e).put(aT(this.O,t))}tn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Ye(e).next(t=>t.targetCount)}getTargetData(e,t){const i=Fa(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return jr(e).Qt({range:r,index:It.queryTargetsIndexName},(o,a,c)=>{const l=yo(a);Au(t,l.target)&&(s=l,c.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=ii(e);return t.forEach(o=>{const a=Ne(o.path);r.push(s.put(new He(i,a))),r.push(this.referenceDelegate.addReference(e,i,o))}),m.waitFor(r)}removeMatchingKeys(e,t,i){const r=ii(e);return m.forEach(t,s=>{const o=Ne(s.path);return m.waitFor([r.delete([i,o]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=ii(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=ii(e);let s=G();return r.Qt({range:i,jt:!0},(o,a,c)=>{const l=fn(o[1]),u=new S(l);s=s.add(u)}).next(()=>s)}containsKey(e,t){const i=Ne(t.path),r=IDBKeyRange.bound([i],[EE(i)],!1,!0);let s=0;return ii(e).Qt({index:He.documentTargetsIndex,jt:!0,range:r},([o,a],c,l)=>{o!==0&&(s++,l.done())}).next(()=>s>0)}Tt(e,t){return jr(e).get(t).next(i=>i?yo(i):null)}}function jr(n){return Be(n,It.store)}function Y_(n){return Be(n,kt.store)}function ii(n){return Be(n,He.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pr(n){if(n.code!==g.FAILED_PRECONDITION||n.message!==iT)throw n;I("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X_([n,e],[t,i]){const r=U(n,t);return r===0?U(e,i):r}class YD{constructor(e){this.en=e,this.buffer=new re(X_),this.nn=0}sn(){return++this.nn}rn(e){const t=[e,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();X_(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class XD{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.on=!1,this.cn=null}start(e){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.un(e)}stop(){this.cn&&(this.cn.cancel(),this.cn=null)}get started(){return this.cn!==null}un(e){const t=this.on?3e5:6e4;I("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.cn=null,this.on=!0;try{await e.collectGarbage(this.garbageCollector)}catch(i){Nr(i)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i):await Pr(i)}await this.un(e)})}}class JD{constructor(e,t){this.an=e,this.params=t}calculateTargetCount(e,t){return this.an.hn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return m.resolve(Pt.A);const i=new YD(t);return this.an.forEachTarget(e,r=>i.rn(r.sequenceNumber)).next(()=>this.an.ln(e,r=>i.rn(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.an.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.an.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(I("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(Q_)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Q_):this.fn(e,t))}getCacheSize(e){return this.an.getCacheSize(e)}fn(e,t){let i,r,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(i=h,a=Date.now(),this.removeTargets(e,i,t))).next(h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(l=Date.now(),Dd()<=x.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(l-c)+`ms
Total Duration: ${l-u}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:h})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(e,t){this.db=e,this.garbageCollector=function(i,r){return new JD(i,r)}(this,t)}hn(e){const t=this.dn(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}dn(e){let t=0;return this.ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ln(e,t){return this._n(e,(i,r)=>t(r))}addReference(e,t,i){return yc(e,i)}removeReference(e,t,i){return yc(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return yc(e,t)}wn(e,t){return function(i,r){let s=!1;return uT(i).Wt(o=>lT(i,o,r).next(a=>(a&&(s=!0),m.resolve(!a)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this._n(e,(o,a)=>{if(a<=t){const c=this.wn(e,o).next(l=>{if(!l)return s++,i.getEntry(e,o).next(()=>(i.removeEntry(o,N.min()),ii(e).delete([0,Ne(o.path)])))});r.push(c)}}).next(()=>m.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return yc(e,t)}_n(e,t){const i=ii(e);let r,s=Pt.A;return i.Qt({index:He.documentTargetsIndex},([o,a],{path:c,sequenceNumber:l})=>{o===0?(s!==Pt.A&&t(new S(fn(r)),s),s=l,r=c):s=Pt.A}).next(()=>{s!==Pt.A&&t(new S(fn(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function yc(n,e){return ii(n).put(function(t,i){return new He(0,Ne(t.path),i)}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(r!==void 0){for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t])}else this.inner[i]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[t]:i.splice(r,1),!0;return!1}forEach(e){kr(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return TE(this.inner)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT{constructor(){this.changes=new Hs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,se.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?m.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e){this.O=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return ni(e).put(wc(t),i)}removeEntry(e,t){const i=ni(e),r=wc(t);return i.delete(r)}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.mn(e,i)))}getEntry(e,t){return ni(e).get(wc(t)).next(i=>this.gn(t,i))}yn(e,t){return ni(e).get(wc(t)).next(i=>({document:this.gn(t,i),size:dl(i)}))}getEntries(e,t){let i=Kt();return this.pn(e,t,(r,s)=>{const o=this.gn(r,s);i=i.insert(r,o)}).next(()=>i)}In(e,t){let i=Kt(),r=new fe(S.comparator);return this.pn(e,t,(s,o)=>{const a=this.gn(s,o);i=i.insert(s,a),r=r.insert(s,dl(o))}).next(()=>({documents:i,En:r}))}pn(e,t,i){if(t.isEmpty())return m.resolve();const r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let o=s.getNext();return ni(e).Qt({range:r},(a,c,l)=>{const u=S.fromSegments(a);for(;o&&S.comparator(o,u)<0;)i(o,null),o=s.getNext();o&&o.isEqual(u)&&(i(o,c),o=s.hasNext()?s.getNext():null),o?l.Ut(o.path.toArray()):l.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getAll(e,t,i){let r=Kt();const s=t.length+1,o={};if(i.isEqual(N.min())){const a=t.toArray();o.range=IDBKeyRange.lowerBound(a)}else{const a=t.toArray(),c=Lp(i);o.range=IDBKeyRange.lowerBound([a,c],!0),o.index=ae.collectionReadTimeIndex}return ni(e).Qt(o,(a,c,l)=>{if(a.length!==s)return;const u=this.gn(S.fromSegments(a),c);t.isPrefixOf(u.key.path)?r=r.insert(u.key,u):l.done()}).next(()=>r)}newChangeBuffer(e){return new tx(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return J_(e).get(pn.key).next(t=>(O(!!t),t))}mn(e,t){return J_(e).put(pn.key,t)}gn(e,t){if(t){const i=oT(this.O,t);if(!(i.isNoDocument()&&i.version.isEqual(N.min())))return i}return se.newInvalidDocument(e)}}class tx extends hT{constructor(e,t){super(),this.Tn=e,this.trackRemovals=t,this.An=new Hs(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new re((s,o)=>U(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.An.get(s);if(o.isValidDocument()){const c=B_(this.Tn.O,o);r=r.add(s.path.popLast()),i+=dl(c)-a,t.push(this.Tn.addEntry(e,s,c))}else if(i-=a,this.trackRemovals){const c=B_(this.Tn.O,o.convertToNoDocument(N.min()));t.push(this.Tn.addEntry(e,s,c))}else t.push(this.Tn.removeEntry(e,s))}),r.forEach(s=>{t.push(this.Tn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Tn.updateMetadata(e,i)),m.waitFor(t)}getFromCache(e,t){return this.Tn.yn(e,t).next(i=>(this.An.set(t,i.size),i.document))}getAllFromCache(e,t){return this.Tn.In(e,t).next(({documents:i,En:r})=>(r.forEach((s,o)=>{this.An.set(s,o)}),i))}}function J_(n){return Be(n,pn.store)}function ni(n){return Be(n,ae.store)}function wc(n){return n.path.toArray()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx{constructor(e){this.O=e}kt(e,t,i,r){const s=new Ou("createOrUpgrade",t);i<1&&r>=1&&(function(a){a.createObjectStore(Ct.store)}(e),function(a){a.createObjectStore(ai.store,{keyPath:ai.keyPath}),a.createObjectStore(Z.store,{keyPath:Z.keyPath,autoIncrement:!0}).createIndex(Z.userMutationsIndex,Z.userMutationsKeyPath,{unique:!0}),a.createObjectStore(et.store)}(e),Z_(e),function(a){a.createObjectStore(ae.store)}(e));let o=m.resolve();return i<3&&r>=3&&(i!==0&&(function(a){a.deleteObjectStore(He.store),a.deleteObjectStore(It.store),a.deleteObjectStore(kt.store)}(e),Z_(e)),o=o.next(()=>function(a){const c=a.store(kt.store),l=new kt(0,0,N.min().toTimestamp(),0);return c.put(kt.key,l)}(s))),i<4&&r>=4&&(i!==0&&(o=o.next(()=>function(a,c){return c.store(Z.store).qt().next(l=>{a.deleteObjectStore(Z.store),a.createObjectStore(Z.store,{keyPath:Z.keyPath,autoIncrement:!0}).createIndex(Z.userMutationsIndex,Z.userMutationsKeyPath,{unique:!0});const u=c.store(Z.store),h=l.map(d=>u.put(d));return m.waitFor(h)})}(e,s))),o=o.next(()=>{(function(a){a.createObjectStore($n.store,{keyPath:$n.keyPath})})(e)})),i<5&&r>=5&&(o=o.next(()=>this.Rn(s))),i<6&&r>=6&&(o=o.next(()=>(function(a){a.createObjectStore(pn.store)}(e),this.Pn(s)))),i<7&&r>=7&&(o=o.next(()=>this.bn(s))),i<8&&r>=8&&(o=o.next(()=>this.vn(e,s))),i<9&&r>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e),function(a){const c=a.objectStore(ae.store);c.createIndex(ae.readTimeIndex,ae.readTimeIndexPath,{unique:!1}),c.createIndex(ae.collectionReadTimeIndex,ae.collectionReadTimeIndexPath,{unique:!1})}(t)})),i<10&&r>=10&&(o=o.next(()=>this.Vn(s))),i<11&&r>=11&&(o=o.next(()=>{(function(a){a.createObjectStore(Es.store,{keyPath:Es.keyPath})})(e),function(a){a.createObjectStore(Ts.store,{keyPath:Ts.keyPath})}(e)})),i<12&&r>=12&&(o=o.next(()=>{(function(a){const c=a.createObjectStore(ke.store,{keyPath:ke.keyPath});c.createIndex(ke.collectionPathOverlayIndex,ke.collectionPathOverlayIndexPath,{unique:!1}),c.createIndex(ke.collectionGroupOverlayIndex,ke.collectionGroupOverlayIndexPath,{unique:!1})})(e)})),i<13&&r>=13&&(o=o.next(()=>{(function(a){a.createObjectStore(Ot.store,{keyPath:Ot.keyPath,autoIncrement:!0}).createIndex(Ot.collectionGroupIndex,Ot.collectionGroupIndexPath,{unique:!1}),a.createObjectStore(Ut.store,{keyPath:Ut.keyPath}).createIndex(Ut.sequenceNumberIndex,Ut.sequenceNumberIndexPath,{unique:!1}),a.createObjectStore($t.store,{keyPath:$t.keyPath}).createIndex($t.documentKeyIndex,$t.documentKeyIndexPath,{unique:!1})})(e)})),o}Pn(e){let t=0;return e.store(ae.store).Qt((i,r)=>{t+=dl(r)}).next(()=>{const i=new pn(t);return e.store(pn.store).put(pn.key,i)})}Rn(e){const t=e.store(ai.store),i=e.store(Z.store);return t.qt().next(r=>m.forEach(r,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.qt(Z.userMutationsIndex,o).next(a=>m.forEach(a,c=>{O(c.userId===s.userId);const l=Gr(this.O,c);return cT(e,s.userId,l).next(()=>{})}))}))}bn(e){const t=e.store(He.store),i=e.store(ae.store);return e.store(kt.store).get(kt.key).next(r=>{const s=[];return i.Qt((o,a)=>{const c=new j(o),l=function(u){return[0,Ne(u)]}(c);s.push(t.get(l).next(u=>u?m.resolve():(h=>t.put(new He(0,Ne(h),r.highestListenSequenceNumber)))(c)))}).next(()=>m.waitFor(s))})}vn(e,t){e.createObjectStore(Yi.store,{keyPath:Yi.keyPath});const i=t.store(Yi.store),r=new Vp,s=o=>{if(r.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:Ne(c)})}};return t.store(ae.store).Qt({jt:!0},(o,a)=>{const c=new j(o);return s(c.popLast())}).next(()=>t.store(et.store).Qt({jt:!0},([o,a,c],l)=>{const u=fn(a);return s(u.popLast())}))}Vn(e){const t=e.store(It.store);return t.Qt((i,r)=>{const s=yo(r),o=aT(this.O,s);return t.put(o)})}}function Z_(n){n.createObjectStore(He.store,{keyPath:He.keyPath}).createIndex(He.documentTargetsIndex,He.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(It.store,{keyPath:It.keyPath}).createIndex(It.queryTargetsIndexName,It.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(kt.store)}const Uh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class qp{constructor(e,t,i,r,s,o,a,c,l,u,h=12){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Sn=s,this.window=o,this.document=a,this.Dn=l,this.Cn=u,this.schemaVersion=h,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=d=>Promise.resolve(),!qp.Vt())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ZD(this,r),this.Bn=t+"main",this.O=new sT(c),this.Ln=new Jt(this.Bn,this.schemaVersion,new nx(this.O)),this.Un=new QD(this.referenceDelegate,this.O),this.qn=function(d){return new ex(d)}(this.O),this.Kn=new qD,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,u===!1&&ge("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.jn().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,Uh);return this.Qn(),this.Wn(),this.zn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Un.getHighestSequenceNumber(e))}).then(e=>{this.Nn=new Pt(e,this.Dn)}).then(()=>{this.xn=!0}).catch(e=>(this.Ln&&this.Ln.close(),Promise.reject(e)))}Hn(e){return this.Fn=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ln.Mt(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Sn.enqueueAndForget(async()=>{this.started&&await this.jn()}))}jn(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>vc(e).put(new $n(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Jn(e).next(t=>{t||(this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)))})}).next(()=>this.Yn(e)).next(t=>this.isPrimary&&!t?this.Xn(e).next(()=>!1):!!t&&this.Zn(e).next(()=>!0))).catch(e=>{if(Nr(e))return I("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Sn.enqueueRetryable(()=>this.Fn(e)),this.isPrimary=e})}Jn(e){return oo(e).get(Ct.key).next(t=>m.resolve(this.ts(t)))}es(e){return vc(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.ss(this.$n,18e5)){this.$n=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const i=Be(t,$n.store);return i.qt().next(r=>{const s=this.rs(r,18e5),o=r.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Gn)for(const t of e)this.Gn.removeItem(this.os(t.clientId))}}zn(){this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.jn().then(()=>this.ns()).then(()=>this.zn()))}ts(e){return!!e&&e.ownerId===this.clientId}Yn(e){return this.Cn?m.resolve(!0):oo(e).get(Ct.key).next(t=>{if(t!==null&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,Uh);return!1}}return!(!this.networkEnabled||!this.inForeground)||vc(e).qt().next(i=>this.rs(i,5e3).find(r=>{if(this.clientId!==r.clientId){const s=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,a=this.networkEnabled===r.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.xn=!1,this.us(),this.Mn&&(this.Mn.cancel(),this.Mn=null),this.hs(),this.ls(),await this.Ln.runTransaction("shutdown","readwrite",[Ct.store,$n.store],e=>{const t=new V_(e,Pt.A);return this.Xn(t).next(()=>this.es(t))}),this.Ln.close(),this.fs()}rs(e,t){return e.filter(i=>this.ss(i.updateTimeMs,t)&&!this.cs(i.clientId))}ds(){return this.runTransaction("getActiveClients","readonly",e=>vc(e).qt().next(t=>this.rs(t,18e5).map(i=>i.clientId)))}get started(){return this.xn}getMutationQueue(e,t){return Bp.Jt(e,this.O,t,this.referenceDelegate)}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getIndexManager(e){return new zD(e)}getDocumentOverlayCache(e){return $p.Jt(this.O,e)}getBundleCache(){return this.Kn}runTransaction(e,t,i){I("IndexedDbPersistence","Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",s=(o=this.schemaVersion)===13?$D:o===12?nT:o===11?tT:void k();var o;let a;return this.Ln.runTransaction(e,r,s,c=>(a=new V_(c,this.Nn?this.Nn.next():Pt.A),t==="readwrite-primary"?this.Jn(a).next(l=>!!l||this.Yn(a)).next(l=>{if(!l)throw ge(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)),new y(g.FAILED_PRECONDITION,iT);return i(a)}).next(l=>this.Zn(a).next(()=>l)):this._s(a).next(()=>i(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}_s(e){return oo(e).get(Ct.key).next(t=>{if(t!==null&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)&&!this.ts(t)&&!(this.Cn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,Uh)})}Zn(e){const t=new Ct(this.clientId,this.allowTabSynchronization,Date.now());return oo(e).put(Ct.key,t)}static Vt(){return Jt.Vt()}Xn(e){const t=oo(e);return t.get(Ct.key).next(i=>this.ts(i)?(I("IndexedDbPersistence","Releasing primary lease."),t.delete(Ct.key)):m.resolve())}ss(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(ge(`Detected an update time that is in the future: ${e} > ${i}`),!1))}Qn(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.On=()=>{this.Sn.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.jn()))},this.document.addEventListener("visibilitychange",this.On),this.inForeground=this.document.visibilityState==="visible")}hs(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}Wn(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.kn=()=>{this.us(),u0()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Sn.enterRestrictedMode(!0),this.Sn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.kn))}ls(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}cs(e){var t;try{const i=((t=this.Gn)===null||t===void 0?void 0:t.getItem(this.os(e)))!==null;return I("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return ge("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}us(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(e){ge("Failed to set zombie client id.",e)}}fs(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch{}}os(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function oo(n){return Be(n,Ct.store)}function vc(n){return Be(n,$n.store)}function jp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(e,t){this.progress=e,this.ws=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(e,t,i){this.qn=e,this.gs=t,this.indexManager=i}ys(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKey(e,t).next(i=>this.ps(e,t,i))}ps(e,t,i){return this.qn.getEntry(e,t).next(r=>{for(const s of i)s.applyToLocalView(r);return r})}Is(e,t){e.forEach((i,r)=>{for(const s of t)s.applyToLocalView(r)})}Es(e,t){return this.qn.getEntries(e,t).next(i=>this.Ts(e,i).next(()=>i))}Ts(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKeys(e,t).next(i=>this.Is(t,i))}As(e,t,i){return function(r){return S.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}(t)?this.Rs(e,t.path):Ap(t)?this.Ps(e,t,i):this.bs(e,t,i)}Rs(e,t){return this.ys(e,new S(t)).next(i=>{let r=Ud();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}Ps(e,t,i){const r=t.collectionGroup;let s=Ud();return this.indexManager.getCollectionParents(e,r).next(o=>m.forEach(o,a=>{const c=function(l,u){return new Yn(u,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t,a.child(r));return this.bs(e,c,i).next(l=>{l.forEach((u,h)=>{s=s.insert(u,h)})})}).next(()=>s))}bs(e,t,i){let r;return this.qn.getAll(e,t.path,i).next(s=>(r=s,this.gs.getAllMutationBatchesAffectingQuery(e,t))).next(s=>{for(const o of s)for(const a of o.mutations){const c=a.key;let l=r.get(c);l==null&&(l=se.newInvalidDocument(c),r=r.insert(c,l)),Fd(a,l,o.localWriteTime),l.isFoundDocument()||(r=r.remove(c))}}).next(()=>(r.forEach((s,o)=>{Rp(t,o)||(r=r.remove(s))}),r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.vs=i,this.Vs=r}static Ss(e,t){let i=G(),r=G();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Kp(e,t.fromCache,i,r)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{Ds(e){this.Cs=e}As(e,t,i,r){return function(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}(t)||i.isEqual(N.min())?this.Ns(e,t):this.Cs.Es(e,r).next(s=>{const o=this.xs(t,s);return(Lc(t)||ul(t))&&this.ks(t.limitType,o,r,i)?this.Ns(e,t):(Dd()<=x.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ld(t)),this.Cs.As(e,t,i).next(a=>(o.forEach(c=>{a=a.insert(c.key,c)}),a)))})}xs(e,t){let i=new re(OE(e));return t.forEach((r,s)=>{Rp(e,s)&&(i=i.add(s))}),i}ks(e,t,i,r){if(i.size!==t.size)return!0;const s=e==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ns(e,t){return Dd()<=x.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Ld(t)),this.Cs.As(e,t,N.min())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(e,t,i,r){this.persistence=e,this.Os=t,this.O=r,this.Ms=new fe(U),this.$s=new Hs(s=>Fa(s),Au),this.Fs=N.min(),this.Bs=e.getRemoteDocumentCache(),this.Un=e.getTargetCache(),this.Kn=e.getBundleCache(),this.Ls(i)}Ls(e){this.indexManager=this.persistence.getIndexManager(e),this.gs=this.persistence.getMutationQueue(e,this.indexManager),this.Us=new rx(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function fT(n,e,t,i){return new sx(n,e,t,i)}async function pT(n,e){const t=b(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.gs.getAllMutationBatches(i).next(s=>(r=s,t.Ls(e),t.gs.getAllMutationBatches(i))).next(s=>{const o=[],a=[];let c=G();for(const l of r){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of s){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.Us.Es(i,c).next(l=>({qs:l,removedBatchIds:o,addedBatchIds:a}))})})}function ox(n,e){const t=b(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Bs.newChangeBuffer({trackRemovals:!0});return function(o,a,c,l){const u=c.batch,h=u.keys();let d=m.resolve();return h.forEach(f=>{d=d.next(()=>l.getEntry(a,f)).next(p=>{const _=c.docVersions.get(f);O(_!==null),p.version.compareTo(_)<0&&(u.applyToRemoteDocument(p,c),p.isValidDocument()&&(p.setReadTime(c.commitVersion),l.addEntry(p)))})}),d.next(()=>o.gs.removeMutationBatch(a,u))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.gs.performConsistencyCheck(i)).next(()=>t.Us.Es(i,r))})}function gT(n){const e=b(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Un.getLastRemoteSnapshotVersion(t))}function ax(n,e){const t=b(n),i=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Bs.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach((l,u)=>{const h=r.get(u);if(!h)return;a.push(t.Un.removeMatchingKeys(s,l.removedDocuments,u).next(()=>t.Un.addMatchingKeys(s,l.addedDocuments,u)));let d=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.has(u)?d=d.withResumeToken(Ie.EMPTY_BYTE_STRING,N.min()).withLastLimboFreeSnapshotVersion(N.min()):l.resumeToken.approximateByteSize()>0&&(d=d.withResumeToken(l.resumeToken,i)),r=r.insert(u,d),function(f,p,_){return f.resumeToken.approximateByteSize()===0||p.snapshotVersion.toMicroseconds()-f.snapshotVersion.toMicroseconds()>=3e8?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(h,d,l)&&a.push(t.Un.updateTargetData(s,d))});let c=Kt();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(mT(s,o,e.documentUpdates).next(l=>{c=l})),!i.isEqual(N.min())){const l=t.Un.getLastRemoteSnapshotVersion(s).next(u=>t.Un.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.Us.Ts(s,c)).next(()=>c)}).then(s=>(t.Ms=r,s))}function mT(n,e,t){let i=G();return t.forEach(r=>i=i.add(r)),e.getEntries(n,i).next(r=>{let s=Kt();return t.forEach((o,a)=>{const c=r.get(o);a.isNoDocument()&&a.version.isEqual(N.min())?(e.removeEntry(o,a.readTime),s=s.insert(o,a)):!c.isValidDocument()||a.version.compareTo(c.version)>0||a.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(a),s=s.insert(o,a)):I("LocalStore","Ignoring outdated watch update for ",o,". Current version:",c.version," Watch version:",a.version)}),s})}function cx(n,e){const t=b(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.gs.getNextMutationBatchAfterBatchId(i,e)))}function bs(n,e){const t=b(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Un.getTargetData(i,e).next(s=>s?(r=s,m.resolve(r)):t.Un.allocateTargetId(i).next(o=>(r=new ci(e,o,0,i.currentSequenceNumber),t.Un.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.Ms.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(i.targetId,i),t.$s.set(e,i.targetId)),i})}async function Ss(n,e,t){const i=b(n),r=i.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Nr(o))throw o;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.Ms=i.Ms.remove(e),i.$s.delete(r.target)}function fl(n,e,t){const i=b(n);let r=N.min(),s=G();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,c,l){const u=b(a),h=u.$s.get(l);return h!==void 0?m.resolve(u.Ms.get(h)):u.Un.getTargetData(c,l)}(i,o,Ht(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.Un.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>i.Os.As(o,e,t?r:N.min(),t?s:G())).next(a=>({documents:a,Ks:s})))}function _T(n,e){const t=b(n),i=b(t.Un),r=t.Ms.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.Tt(s,e).next(o=>o?o.target:null))}function yT(n){const e=b(n);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(i,r,s){const o=b(i);let a=Kt(),c=Lp(s);const l=ni(r),u=IDBKeyRange.lowerBound(c,!0);return l.Qt({index:ae.readTimeIndex,range:u},(h,d)=>{const f=oT(o.O,d);a=a.insert(f.key,f),c=d.readTime}).next(()=>({ws:a,readTime:Fp(c)}))}(e.Bs,t,e.Fs)).then(({ws:t,readTime:i})=>(e.Fs=i,t))}async function lx(n){const e=b(n);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(i){const r=ni(i);let s=N.min();return r.Qt({index:ae.readTimeIndex,reverse:!0},(o,a,c)=>{a.readTime&&(s=Fp(a.readTime)),c.done()}).next(()=>s)}(t)).then(t=>{e.Fs=t})}async function ux(n,e,t,i){const r=b(n);let s=G(),o=Kt();for(const l of t){const u=e.Gs(l.metadata.name);l.document&&(s=s.add(u));const h=e.js(l);h.setReadTime(e.Qs(l.metadata.readTime)),o=o.insert(u,h)}const a=r.Bs.newChangeBuffer({trackRemovals:!0}),c=await bs(r,function(l){return Ht(Gs(j.fromString(`__bundle__/docs/${l}`)))}(i));return r.persistence.runTransaction("Apply bundle documents","readwrite",l=>mT(l,a,o).next(u=>(a.apply(l),u)).next(u=>r.Un.removeMatchingKeysForTargetId(l,c.targetId).next(()=>r.Un.addMatchingKeys(l,s,c.targetId)).next(()=>r.Us.Ts(l,u)).next(()=>u)))}async function hx(n,e,t=G()){const i=await bs(n,Ht(Up(e.bundledQuery))),r=b(n);return r.persistence.runTransaction("Save named query","readwrite",s=>{const o=De(e.readTime);if(i.snapshotVersion.compareTo(o)>=0)return r.Kn.saveNamedQuery(s,e);const a=i.withResumeToken(Ie.EMPTY_BYTE_STRING,o);return r.Ms=r.Ms.insert(a.targetId,a),r.Un.updateTargetData(s,a).next(()=>r.Un.removeMatchingKeysForTargetId(s,i.targetId)).next(()=>r.Un.addMatchingKeys(s,t,i.targetId)).next(()=>r.Kn.saveNamedQuery(s,e))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(e){this.O=e,this.Ws=new Map,this.zs=new Map}getBundleMetadata(e,t){return m.resolve(this.Ws.get(t))}saveBundleMetadata(e,t){var i;return this.Ws.set(t.id,{id:(i=t).id,version:i.version,createTime:De(i.createTime)}),m.resolve()}getNamedQuery(e,t){return m.resolve(this.zs.get(t))}saveNamedQuery(e,t){return this.zs.set(t.name,function(i){return{name:i.name,query:Up(i.bundledQuery),readTime:De(i.readTime)}}(t)),m.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(){this.overlays=new fe(S.comparator),this.Hs=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}saveOverlays(e,t,i){return i.forEach(r=>{this.Yt(e,t,r)}),m.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.Hs.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Hs.delete(i)),m.resolve()}getOverlaysForCollection(e,t,i){const r=new Map,s=t.length+1,o=new S(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&c.largestBatchId>i&&r.set(c.getKey(),c)}return m.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new fe((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>i){let u=s.get(l.largestBatchId);u===null&&(u=new Map,s=s.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=new Map,c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(u,l)),!(a.size>=r)););return m.resolve(a)}Yt(e,t,i){if(i===null)return;const r=this.overlays.get(i.key);r!==null&&this.Hs.get(r.largestBatchId).delete(i.key),this.overlays=this.overlays.insert(i.key,new Mp(t,i));let s=this.Hs.get(t);s===void 0&&(s=new Set,this.Hs.set(t,s)),s.add(i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(){this.Js=new re(be.Ys),this.Xs=new re(be.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(e,t){const i=new be(e,t);this.Js=this.Js.add(i),this.Xs=this.Xs.add(i)}ti(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.ei(new be(e,t))}ni(e,t){e.forEach(i=>this.removeReference(i,t))}si(e){const t=new S(new j([])),i=new be(t,e),r=new be(t,e+1),s=[];return this.Xs.forEachInRange([i,r],o=>{this.ei(o),s.push(o.key)}),s}ii(){this.Js.forEach(e=>this.ei(e))}ei(e){this.Js=this.Js.delete(e),this.Xs=this.Xs.delete(e)}ri(e){const t=new S(new j([])),i=new be(t,e),r=new be(t,e+1);let s=G();return this.Xs.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new be(e,0),i=this.Js.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class be{constructor(e,t){this.key=e,this.oi=t}static Ys(e,t){return S.comparator(e.key,t.key)||U(e.oi,t.oi)}static Zs(e,t){return U(e.oi,t.oi)||S.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.gs=[],this.ci=1,this.ui=new re(be.Ys)}checkEmpty(e){return m.resolve(this.gs.length===0)}addMutationBatch(e,t,i,r){const s=this.ci;this.ci++,this.gs.length>0&&this.gs[this.gs.length-1];const o=new Dp(s,t,i,r);this.gs.push(o);for(const a of r)this.ui=this.ui.add(new be(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.ai(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=this.hi(i),s=r<0?0:r;return m.resolve(this.gs.length>s?this.gs[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.gs.length===0?-1:this.ci-1)}getAllMutationBatches(e){return m.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new be(t,0),r=new be(t,Number.POSITIVE_INFINITY),s=[];return this.ui.forEachInRange([i,r],o=>{const a=this.ai(o.oi);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new re(U);return t.forEach(r=>{const s=new be(r,0),o=new be(r,Number.POSITIVE_INFINITY);this.ui.forEachInRange([s,o],a=>{i=i.add(a.oi)})}),m.resolve(this.li(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;S.isDocumentKey(s)||(s=s.child(""));const o=new be(new S(s),0);let a=new re(U);return this.ui.forEachWhile(c=>{const l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===r&&(a=a.add(c.oi)),!0)},o),m.resolve(this.li(a))}li(e){const t=[];return e.forEach(i=>{const r=this.ai(i);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){O(this.fi(t.batchId,"removed")===0),this.gs.shift();let i=this.ui;return m.forEach(t.mutations,r=>{const s=new be(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ui=i})}Qe(e){}containsKey(e,t){const i=new be(t,0),r=this.ui.firstAfterOrEqual(i);return m.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.gs.length,m.resolve()}fi(e,t){return this.hi(e)}hi(e){return this.gs.length===0?0:e-this.gs[0].batchId}ai(e){const t=this.hi(e);return t<0||t>=this.gs.length?null:this.gs[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e){this.di=e,this.docs=new fe(S.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,o=this.di(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return m.resolve(i?i.document.mutableCopy():se.newInvalidDocument(t))}getEntries(e,t){let i=Kt();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():se.newInvalidDocument(r))}),m.resolve(i)}getAll(e,t,i){let r=Kt();const s=new S(t.child("")),o=this.docs.getIteratorFrom(s);for(;o.hasNext();){const{key:a,value:{document:c}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||c.readTime.compareTo(i)<=0||(r=r.insert(c.key,c.mutableCopy()))}return m.resolve(r)}_i(e,t){return m.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new mx(this)}getSize(e){return m.resolve(this.size)}}class mx extends hT{constructor(e){super(),this.Tn=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Tn.addEntry(e,r)):this.Tn.removeEntry(i)}),m.waitFor(t)}getFromCache(e,t){return this.Tn.getEntry(e,t)}getAllFromCache(e,t){return this.Tn.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(e){this.persistence=e,this.wi=new Hs(t=>Fa(t),Au),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.mi=0,this.gi=new Wp,this.targetCount=0,this.yi=hr.He()}forEachTarget(e,t){return this.wi.forEach((i,r)=>t(r)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.mi)}allocateTargetId(e){return this.highestTargetId=this.yi.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.mi&&(this.mi=t),m.resolve()}Ze(e){this.wi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.yi=new hr(t),this.highestTargetId=t),e.sequenceNumber>this.mi&&(this.mi=e.sequenceNumber)}addTargetData(e,t){return this.Ze(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.Ze(t),m.resolve()}removeTargetData(e,t){return this.wi.delete(t.target),this.gi.si(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.wi.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.wi.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),m.waitFor(s).next(()=>r)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){const i=this.wi.get(t)||null;return m.resolve(i)}addMatchingKeys(e,t,i){return this.gi.ti(t,i),m.resolve()}removeMatchingKeys(e,t,i){this.gi.ni(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.gi.si(t),m.resolve()}getMatchingKeysForTargetId(e,t){const i=this.gi.ri(t);return m.resolve(i)}containsKey(e,t){return m.resolve(this.gi.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e,t){this.pi={},this.overlays={},this.Nn=new Pt(0),this.xn=!1,this.xn=!0,this.referenceDelegate=e(this),this.Un=new _x(this),this.indexManager=new HD,this.qn=function(i){return new gx(i)}(i=>this.referenceDelegate.Ii(i)),this.O=new sT(t),this.Kn=new dx(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fx,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.pi[e.toKey()];return i||(i=new px(t,this.referenceDelegate),this.pi[e.toKey()]=i),i}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(e,t,i){I("MemoryPersistence","Starting transaction:",e);const r=new wx(this.Nn.next());return this.referenceDelegate.Ei(),i(r).next(s=>this.referenceDelegate.Ti(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ai(e,t){return m.or(Object.values(this.pi).map(i=>()=>i.containsKey(e,t)))}}class wx extends rT{constructor(e){super(),this.currentSequenceNumber=e}}class Gp{constructor(e){this.persistence=e,this.Ri=new Wp,this.Pi=null}static bi(e){return new Gp(e)}get vi(){if(this.Pi)return this.Pi;throw k()}addReference(e,t,i){return this.Ri.addReference(i,t),this.vi.delete(i.toString()),m.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.vi.add(i.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.vi.add(t.toString()),m.resolve()}removeTarget(e,t){this.Ri.si(t.targetId).forEach(r=>this.vi.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.vi.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}Ei(){this.Pi=new Set}Ti(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.vi,i=>{const r=S.fromPath(i);return this.Vi(e,r).next(s=>{s||t.removeEntry(r,N.min())})}).next(()=>(this.Pi=null,t.apply(e)))}updateLimboDocument(e,t){return this.Vi(e,t).next(i=>{i?this.vi.delete(t.toString()):this.vi.add(t.toString())})}Ii(e){return 0}Vi(e,t){return m.or([()=>m.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ey(n,e){return`firestore_clients_${n}_${e}`}function ty(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function $h(n,e){return`firestore_targets_${n}_${e}`}class pl{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Si(e,t,i){const r=JSON.parse(i);let s,o=typeof r=="object"&&["pending","acknowledged","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(s=new y(r.error.code,r.error.message))),o?new pl(e,t,r.state,s):(ge("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class So{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Si(e,t){const i=JSON.parse(t);let r,s=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(r=new y(i.error.code,i.error.message))),s?new So(e,i.state,r):(ge("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Si(e,t){const i=JSON.parse(t);let r=typeof i=="object"&&i.activeTargetIds instanceof Array,s=Pu();for(let o=0;r&&o<i.activeTargetIds.length;++o)r=SE(i.activeTargetIds[o]),s=s.add(i.activeTargetIds[o]);return r?new gl(e,s):(ge("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hp{constructor(e,t){this.clientId=e,this.onlineState=t}static Si(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Hp(t.clientId,t.onlineState):(ge("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Bd{constructor(){this.activeTargetIds=Pu()}Ci(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ni(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Di(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vh{constructor(e,t,i,r,s){this.window=e,this.Sn=t,this.persistenceKey=i,this.xi=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new fe(U),this.started=!1,this.$i=[];const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Fi=ey(this.persistenceKey,this.xi),this.Bi=function(a){return`firestore_sequence_number_${a}`}(this.persistenceKey),this.Mi=this.Mi.insert(this.xi,new Bd),this.Li=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ui=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.qi=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Ki=function(a){return`firestore_online_state_${a}`}(this.persistenceKey),this.Gi=function(a){return`firestore_bundle_loaded_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ki)}static Vt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.ds();for(const i of e){if(i===this.xi)continue;const r=this.getItem(ey(this.persistenceKey,i));if(r){const s=gl.Si(i,r);s&&(this.Mi=this.Mi.insert(s.clientId,s))}}this.ji();const t=this.storage.getItem(this.Ki);if(t){const i=this.Qi(t);i&&this.Wi(i)}for(const i of this.$i)this.Oi(i);this.$i=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Bi,JSON.stringify(e))}getAllActiveQueryTargets(){return this.zi(this.Mi)}isActiveQueryTarget(e){let t=!1;return this.Mi.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Hi(e,"pending")}updateMutationState(e,t,i){this.Hi(e,t,i),this.Ji(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem($h(this.persistenceKey,e));if(i){const r=So.Si(e,i);r&&(t=r.state)}}return this.Yi.Ci(e),this.ji(),t}removeLocalQueryTarget(e){this.Yi.Ni(e),this.ji()}isLocalQueryTarget(e){return this.Yi.activeTargetIds.has(e)}clearQueryState(e){this.removeItem($h(this.persistenceKey,e))}updateQueryState(e,t,i){this.Xi(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Ji(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Zi(e)}notifyBundleLoaded(){this.tr()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return I("SharedClientState","READ",e,t),t}setItem(e,t){I("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){I("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Oi(e){const t=e;if(t.storageArea===this.storage){if(I("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Fi)return void ge("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Sn.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Li.test(t.key)){if(t.newValue==null){const i=this.er(t.key);return this.nr(i,null)}{const i=this.sr(t.key,t.newValue);if(i)return this.nr(i.clientId,i)}}else if(this.Ui.test(t.key)){if(t.newValue!==null){const i=this.ir(t.key,t.newValue);if(i)return this.rr(i)}}else if(this.qi.test(t.key)){if(t.newValue!==null){const i=this.cr(t.key,t.newValue);if(i)return this.ur(i)}}else if(t.key===this.Ki){if(t.newValue!==null){const i=this.Qi(t.newValue);if(i)return this.Wi(i)}}else if(t.key===this.Bi){const i=function(r){let s=Pt.A;if(r!=null)try{const o=JSON.parse(r);O(typeof o=="number"),s=o}catch(o){ge("SharedClientState","Failed to read sequence number from WebStorage",o)}return s}(t.newValue);i!==Pt.A&&this.sequenceNumberHandler(i)}else if(t.key===this.Gi)return this.syncEngine.ar()}}else this.$i.push(t)})}}get Yi(){return this.Mi.get(this.xi)}ji(){this.setItem(this.Fi,this.Yi.Di())}Hi(e,t,i){const r=new pl(this.currentUser,e,t,i),s=ty(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Di())}Ji(e){const t=ty(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Zi(e){const t={clientId:this.xi,onlineState:e};this.storage.setItem(this.Ki,JSON.stringify(t))}Xi(e,t,i){const r=$h(this.persistenceKey,e),s=new So(e,t,i);this.setItem(r,s.Di())}tr(){this.setItem(this.Gi,"value-not-used")}er(e){const t=this.Li.exec(e);return t?t[1]:null}sr(e,t){const i=this.er(e);return gl.Si(i,t)}ir(e,t){const i=this.Ui.exec(e),r=Number(i[1]),s=i[2]!==void 0?i[2]:null;return pl.Si(new We(s),r,t)}cr(e,t){const i=this.qi.exec(e),r=Number(i[1]);return So.Si(r,t)}Qi(e){return Hp.Si(e)}async rr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.hr(e.batchId,e.state,e.error);I("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}ur(e){return this.syncEngine.lr(e.targetId,e.state,e.error)}nr(e,t){const i=t?this.Mi.insert(e,t):this.Mi.remove(e),r=this.zi(this.Mi),s=this.zi(i),o=[],a=[];return s.forEach(c=>{r.has(c)||o.push(c)}),r.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.dr(o,a).then(()=>{this.Mi=i})}Wi(e){this.Mi.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}zi(e){let t=Pu();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class wT{constructor(){this._r=new Bd,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this._r.Ci(e),this.wr[e]||"not-current"}updateQueryState(e,t,i){this.wr[e]=t}removeLocalQueryTarget(e){this._r.Ni(e)}isLocalQueryTarget(e){return this._r.activeTargetIds.has(e)}clearQueryState(e){delete this.wr[e]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(e){return this._r.activeTargetIds.has(e)}start(){return this._r=new Bd,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{mr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(e){this.Er.push(e)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Er)e(0)}Ir(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Er)e(1)}static Vt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ix={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex{constructor(e){this.Ar=e.Ar,this.Rr=e.Rr}Pr(e){this.br=e}vr(e){this.Vr=e}onMessage(e){this.Sr=e}close(){this.Rr()}send(e){this.Ar(e)}Dr(){this.br()}Cr(e){this.Vr(e)}Nr(e){this.Sr(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.kr=t+"://"+e.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(e,t,i,r,s){const o=this.$r(e,t);I("RestConnection","Sending: ",o,i);const a={};return this.Fr(a,r,s),this.Br(e,o,a,i).then(c=>(I("RestConnection","Received: ",c),c),c=>{throw Go("RestConnection",`${e} failed with error: `,c,"url: ",o,"request:",i),c})}Lr(e,t,i,r,s){return this.Mr(e,t,i,r,s)}Fr(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ws,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}$r(e,t){const i=Ix[e];return`${this.kr}/v1/${t}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Br(e,t,i,r){return new Promise((s,o)=>{const a=new MO;a.listenOnce(OO.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case xh.NO_ERROR:const l=a.getResponseJson();I("Connection","XHR received:",JSON.stringify(l)),s(l);break;case xh.TIMEOUT:I("Connection",'RPC "'+e+'" timed out'),o(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case xh.HTTP_ERROR:const u=a.getStatus();if(I("Connection",'RPC "'+e+'" failed with status:',u,"response text:",a.getResponseText()),u>0){const h=a.getResponseJson().error;if(h&&h.status&&h.message){const d=function(f){const p=f.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(p)>=0?p:g.UNKNOWN}(h.status);o(new y(d,h.message))}else o(new y(g.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new y(g.UNAVAILABLE,"Connection failed."));break;default:k()}}finally{I("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(r);a.send(t,"POST",c,i,15)})}Ur(e,t,i){const r=[this.kr,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=NO(),o=PO(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new xO({})),this.Fr(a.initMessageHeaders,t,i),Hl()||Ia()||c0()||Df()||l0()||va()||(a.httpHeadersOverwriteParam="$httpHeaders");const c=r.join("");I("Connection","Creating WebChannel: "+c,a);const l=s.createWebChannel(c,a);let u=!1,h=!1;const d=new Ex({Ar:p=>{h?I("Connection","Not sending because WebChannel is closed:",p):(u||(I("Connection","Opening WebChannel transport."),l.open(),u=!0),I("Connection","WebChannel sending:",p),l.send(p))},Rr:()=>l.close()}),f=(p,_,v)=>{p.listen(_,P=>{try{v(P)}catch(V){setTimeout(()=>{throw V},0)}})};return f(l,fc.EventType.OPEN,()=>{h||I("Connection","WebChannel transport opened.")}),f(l,fc.EventType.CLOSE,()=>{h||(h=!0,I("Connection","WebChannel transport closed"),d.Cr())}),f(l,fc.EventType.ERROR,p=>{h||(h=!0,Go("Connection","WebChannel transport errored:",p),d.Cr(new y(g.UNAVAILABLE,"The operation could not be completed")))}),f(l,fc.EventType.MESSAGE,p=>{var _;if(!h){const v=p.data[0];O(!!v);const P=v,V=P.error||((_=P[0])===null||_===void 0?void 0:_.error);if(V){I("Connection","WebChannel received error:",V);const W=V.status;let z=function(Ft){const Nn=pe[Ft];if(Nn!==void 0)return qE(Nn)}(W),Lt=V.message;z===void 0&&(z=g.INTERNAL,Lt="Unknown error status: "+W+" with message "+V.message),h=!0,d.Cr(new y(z,Lt)),l.close()}else I("Connection","WebChannel received:",v),d.Nr(v)}}),f(o,DO.STAT_EVENT,p=>{p.stat===w_.PROXY?I("Connection","Detected buffering proxy"):p.stat===w_.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.Dr()},0),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vT(){return typeof window!="undefined"?window:null}function $c(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(n){return new bD(n,!0)}class zp{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Sn=e,this.timerId=t,this.qr=i,this.Kr=r,this.Gr=s,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(e){this.cancel();const t=Math.floor(this.jr+this.Jr()),i=Math.max(0,Date.now()-this.Wr),r=Math.max(0,t-i);r>0&&I("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.jr} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,r,()=>(this.Wr=Date.now(),e())),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){this.Qr!==null&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){this.Qr!==null&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(e,t,i,r,s,o,a,c){this.Sn=e,this.Xr=i,this.Zr=r,this.eo=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new zp(e,t)}oo(){return this.state===1||this.state===5||this.co()}co(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&this.so===null&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,()=>this.lo()))}fo(e){this._o(),this.stream.send(e)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(e,t){this._o(),this.wo(),this.ro.cancel(),this.no++,e!==4?this.ro.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(ge(t.toString()),ge("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):t&&t.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.mo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.vr(t)}mo(){}auth(){this.state=1;const e=this.yo(this.no),t=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.no===t&&this.po(i,r)},i=>{e(()=>{const r=new y(g.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Io(r)})})}po(e,t){const i=this.yo(this.no);this.stream=this.Eo(e,t),this.stream.Pr(()=>{i(()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,()=>(this.co()&&(this.state=3),Promise.resolve())),this.listener.Pr()))}),this.stream.vr(r=>{i(()=>this.Io(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}uo(){this.state=5,this.ro.Hr(async()=>{this.state=0,this.start()})}Io(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}yo(e){return t=>{this.Sn.enqueueAndForget(()=>this.no===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class bx extends IT{constructor(e,t,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,o),this.O=s}Eo(e,t){return this.eo.Ur("Listen",e,t)}onMessage(e){this.ro.reset();const t=kD(this.O,e),i=function(r){if(!("targetChange"in r))return N.min();const s=r.targetChange;return s.targetIds&&s.targetIds.length?N.min():s.readTime?De(s.readTime):N.min()}(e);return this.listener.To(t,i)}Ao(e){const t={};t.database=Zo(this.O),t.addTarget=function(r,s){let o;const a=s.target;return o=ll(a)?{documents:YE(r,a)}:{query:XE(r,a)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?o.resumeToken=WE(r,s.resumeToken):s.snapshotVersion.compareTo(N.min())>0&&(o.readTime=Xo(r,s.snapshotVersion.toTimestamp())),o}(this.O,e);const i=RD(this.O,e);i&&(t.labels=i),this.fo(t)}Ro(e){const t={};t.database=Zo(this.O),t.removeTarget=e,this.fo(t)}}class Sx extends IT{constructor(e,t,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,o),this.O=s,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(e,t){return this.eo.Ur("Write",e,t)}onMessage(e){if(O(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Po){this.ro.reset();const t=AD(e.writeResults,e.commitTime),i=De(e.commitTime);return this.listener.Vo(i,t)}return O(!e.writeResults||e.writeResults.length===0),this.Po=!0,this.listener.So()}Do(){const e={};e.database=Zo(this.O),this.fo(e)}vo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>ea(this.O,i))};this.fo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.eo=i,this.O=r,this.Co=!1}No(){if(this.Co)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(e,t,i){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.eo.Mr(e,t,i,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new y(g.UNKNOWN,r.toString())})}Lr(e,t,i){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.eo.Lr(e,t,i,r,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new y(g.UNKNOWN,r.toString())})}terminate(){this.Co=!0}}class kx{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){this.xo===0&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve())))}Bo(e){this.state==="Online"?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.$o("Offline")))}set(e){this.Lo(),this.xo=0,e==="Online"&&(this.Oo=!1),this.$o(e)}$o(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Fo(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(ge(t),this.Oo=!1):I("OnlineStateTracker",t)}Lo(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(e,t,i,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=s,this.jo.mr(o=>{i.enqueueAndForget(async()=>{Ai(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(a){const c=b(a);c.Ko.add(4),await zs(c),c.Qo.set("Unknown"),c.Ko.delete(4),await Wa(c)}(this))})}),this.Qo=new kx(i,r)}}async function Wa(n){if(Ai(n))for(const e of n.Go)await e(!0)}async function zs(n){for(const e of n.Go)await e(!1)}function Du(n,e){const t=b(n);t.qo.has(e.targetId)||(t.qo.set(e.targetId,e),Xp(t)?Yp(t):Ys(t).co()&&Qp(t,e))}function ta(n,e){const t=b(n),i=Ys(t);t.qo.delete(e),i.co()&&ET(t,e),t.qo.size===0&&(i.co()?i.ho():Ai(t)&&t.Qo.set("Unknown"))}function Qp(n,e){n.Wo.Z(e.targetId),Ys(n).Ao(e)}function ET(n,e){n.Wo.Z(e),Ys(n).Ro(e)}function Yp(n){n.Wo=new ID({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>n.qo.get(e)||null}),Ys(n).start(),n.Qo.Mo()}function Xp(n){return Ai(n)&&!Ys(n).oo()&&n.qo.size>0}function Ai(n){return b(n).Ko.size===0}function TT(n){n.Wo=void 0}async function Rx(n){n.qo.forEach((e,t)=>{Qp(n,e)})}async function Nx(n,e){TT(n),Xp(n)?(n.Qo.Bo(e),Yp(n)):n.Qo.set("Unknown")}async function Px(n,e,t){if(n.Qo.set("Online"),e instanceof KE&&e.state===2&&e.cause)try{await async function(i,r){const s=r.cause;for(const o of r.targetIds)i.qo.has(o)&&(await i.remoteSyncer.rejectListen(o,s),i.qo.delete(o),i.Wo.removeTarget(o))}(n,e)}catch(i){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await ml(n,i)}else if(e instanceof Uc?n.Wo.ct(e):e instanceof jE?n.Wo._t(e):n.Wo.ht(e),!t.isEqual(N.min()))try{const i=await gT(n.localStore);t.compareTo(i)>=0&&await function(r,s){const o=r.Wo.yt(s);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const l=r.qo.get(c);l&&r.qo.set(c,l.withResumeToken(a.resumeToken,s))}}),o.targetMismatches.forEach(a=>{const c=r.qo.get(a);if(!c)return;r.qo.set(a,c.withResumeToken(Ie.EMPTY_BYTE_STRING,c.snapshotVersion)),ET(r,a);const l=new ci(c.target,a,1,c.sequenceNumber);Qp(r,l)}),r.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){I("RemoteStore","Failed to raise snapshot:",i),await ml(n,i)}}async function ml(n,e,t){if(!Nr(e))throw e;n.Ko.add(1),await zs(n),n.Qo.set("Offline"),t||(t=()=>gT(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{I("RemoteStore","Retrying IndexedDB access"),await t(),n.Ko.delete(1),await Wa(n)})}function bT(n,e){return e().catch(t=>ml(n,t,e))}async function Qs(n){const e=b(n),t=yi(e);let i=e.Uo.length>0?e.Uo[e.Uo.length-1].batchId:-1;for(;Ox(e);)try{const r=await cx(e.localStore,i);if(r===null){e.Uo.length===0&&t.ho();break}i=r.batchId,Dx(e,r)}catch(r){await ml(e,r)}ST(e)&&CT(e)}function Ox(n){return Ai(n)&&n.Uo.length<10}function Dx(n,e){n.Uo.push(e);const t=yi(n);t.co()&&t.bo&&t.vo(e.mutations)}function ST(n){return Ai(n)&&!yi(n).oo()&&n.Uo.length>0}function CT(n){yi(n).start()}async function xx(n){yi(n).Do()}async function Mx(n){const e=yi(n);for(const t of n.Uo)e.vo(t.mutations)}async function Lx(n,e,t){const i=n.Uo.shift(),r=xp.from(i,e,t);await bT(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await Qs(n)}async function Fx(n,e){e&&yi(n).bo&&await async function(t,i){if(r=i.code,BE(r)&&r!==g.ABORTED){const s=t.Uo.shift();yi(t).ao(),await bT(t,()=>t.remoteSyncer.rejectFailedWrite(s.batchId,i)),await Qs(t)}var r}(n,e),ST(n)&&CT(n)}async function iy(n,e){const t=b(n);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const i=Ai(t);t.Ko.add(3),await zs(t),i&&t.Qo.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ko.delete(3),await Wa(t)}async function qd(n,e){const t=b(n);e?(t.Ko.delete(2),await Wa(t)):e||(t.Ko.add(2),await zs(t),t.Qo.set("Unknown"))}function Ys(n){return n.zo||(n.zo=function(e,t,i){const r=b(e);return r.No(),new bx(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,i)}(n.datastore,n.asyncQueue,{Pr:Rx.bind(null,n),vr:Nx.bind(null,n),To:Px.bind(null,n)}),n.Go.push(async e=>{e?(n.zo.ao(),Xp(n)?Yp(n):n.Qo.set("Unknown")):(await n.zo.stop(),TT(n))})),n.zo}function yi(n){return n.Ho||(n.Ho=function(e,t,i){const r=b(e);return r.No(),new Sx(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,i)}(n.datastore,n.asyncQueue,{Pr:xx.bind(null,n),vr:Fx.bind(null,n),So:Mx.bind(null,n),Vo:Lx.bind(null,n)}),n.Go.push(async e=>{e?(n.Ho.ao(),await Qs(n)):(await n.Ho.stop(),n.Uo.length>0&&(I("RemoteStore",`Stopping write stream with ${n.Uo.length} pending writes`),n.Uo=[]))})),n.Ho}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Pe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,i,r,s){const o=Date.now()+i,a=new Jp(e,t,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xs(n,e){if(ge("AsyncQueue",`${e}: ${n}`),Nr(n))return new y(g.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e){this.comparator=e?(t,i)=>e(t,i)||S.comparator(t.key,i.key):(t,i)=>S.comparator(t.key,i.key),this.keyedMap=Ud(),this.sortedSet=new fe(this.comparator)}static emptySet(e){return new ss(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ss)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new ss;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{constructor(){this.Jo=new fe(S.comparator)}track(e){const t=e.doc.key,i=this.Jo.get(t);i?e.type!==0&&i.type===3?this.Jo=this.Jo.insert(t,e):e.type===3&&i.type!==1?this.Jo=this.Jo.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.Jo=this.Jo.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.Jo=this.Jo.remove(t):e.type===1&&i.type===2?this.Jo=this.Jo.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):k():this.Jo=this.Jo.insert(t,e)}Yo(){const e=[];return this.Jo.inorderTraversal((t,i)=>{e.push(i)}),e}}class Cs{constructor(e,t,i,r,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c}static fromInitialDocuments(e,t,i,r){const s=[];return t.forEach(o=>{s.push({type:0,doc:o})}),new Cs(e,t,ss.emptySet(t),s,i,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ua(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(){this.Xo=void 0,this.listeners=[]}}class $x{constructor(){this.queries=new Hs(e=>PE(e),Ua),this.onlineState="Unknown",this.Zo=new Set}}async function Zp(n,e){const t=b(n),i=e.query;let r=!1,s=t.queries.get(i);if(s||(r=!0,s=new Ux),r)try{s.Xo=await t.onListen(i)}catch(o){const a=Xs(o,`Initialization of query '${Ld(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.listeners.push(e),e.tc(t.onlineState),s.Xo&&e.ec(s.Xo)&&tg(t)}async function eg(n,e){const t=b(n),i=e.query;let r=!1;const s=t.queries.get(i);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),r=s.listeners.length===0)}if(r)return t.queries.delete(i),t.onUnlisten(i)}function Vx(n,e){const t=b(n);let i=!1;for(const r of e){const s=r.query,o=t.queries.get(s);if(o){for(const a of o.listeners)a.ec(r)&&(i=!0);o.Xo=r}}i&&tg(t)}function Bx(n,e,t){const i=b(n),r=i.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);i.queries.delete(e)}function tg(n){n.Zo.forEach(e=>{e.next()})}class ng{constructor(e,t,i){this.query=e,this.nc=t,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=i||{}}ec(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new Cs(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.sc?this.rc(e)&&(this.nc.next(e),t=!0):this.oc(e,this.onlineState)&&(this.cc(e),t=!0),this.ic=e,t}onError(e){this.nc.error(e)}tc(e){this.onlineState=e;let t=!1;return this.ic&&!this.sc&&this.oc(this.ic,e)&&(this.cc(this.ic),t=!0),t}oc(e,t){if(!e.fromCache)return!0;const i=t!=="Offline";return(!this.options.uc||!i)&&(!e.docs.isEmpty()||t==="Offline")}rc(e){if(e.docChanges.length>0)return!0;const t=this.ic&&this.ic.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}cc(e){e=Cs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.sc=!0,this.nc.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qx{constructor(e,t){this.payload=e,this.byteLength=t}ac(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e){this.O=e}Gs(e){return gn(this.O,e)}js(e){return e.metadata.exists?QE(this.O,e.document,!1):se.newNoDocument(this.Gs(e.metadata.name),this.Qs(e.metadata.readTime))}Qs(e){return De(e)}}class jx{constructor(e,t,i){this.hc=e,this.localStore=t,this.O=i,this.queries=[],this.documents=[],this.progress=kT(e)}lc(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}fc(e){const t=new Map,i=new sy(this.O);for(const r of e)if(r.metadata.queries){const s=i.Gs(r.metadata.name);for(const o of r.metadata.queries){const a=(t.get(o)||G()).add(s);t.set(o,a)}}return t}async complete(){const e=await ux(this.localStore,new sy(this.O),this.documents,this.hc.id),t=this.fc(this.documents);for(const i of this.queries)await hx(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",new ix(Object.assign({},this.progress),e)}}function kT(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT{constructor(e){this.key=e}}class RT{constructor(e){this.key=e}}class NT{constructor(e,t){this.query=e,this.dc=t,this._c=null,this.current=!1,this.wc=G(),this.mutatedKeys=G(),this.mc=OE(e),this.gc=new ss(this.mc)}get yc(){return this.dc}Ic(e,t){const i=t?t.Ec:new ry,r=t?t.gc:this.gc;let s=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const c=Lc(this.query)&&r.size===this.query.limit?r.last():null,l=ul(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,h)=>{const d=r.get(u),f=Rp(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),_=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let v=!1;d&&f?d.data.isEqual(f.data)?p!==_&&(i.track({type:3,doc:f}),v=!0):this.Tc(d,f)||(i.track({type:2,doc:f}),v=!0,(c&&this.mc(f,c)>0||l&&this.mc(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),v=!0):d&&!f&&(i.track({type:1,doc:d}),v=!0,(c||l)&&(a=!0)),v&&(f?(o=o.add(f),s=_?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),Lc(this.query)||ul(this.query))for(;o.size>this.query.limit;){const u=Lc(this.query)?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{gc:o,Ec:i,ks:a,mutatedKeys:s}}Tc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const r=this.gc;this.gc=e.gc,this.mutatedKeys=e.mutatedKeys;const s=e.Ec.Yo();s.sort((l,u)=>function(h,d){const f=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return k()}};return f(h)-f(d)}(l.type,u.type)||this.mc(l.doc,u.doc)),this.Ac(i);const o=t?this.Rc():[],a=this.wc.size===0&&this.current?1:0,c=a!==this._c;return this._c=a,s.length!==0||c?{snapshot:new Cs(this.query,e.gc,r,s,e.mutatedKeys,a===0,c,!1),Pc:o}:{Pc:o}}tc(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new ry,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(e){return!this.dc.has(e)&&!!this.gc.has(e)&&!this.gc.get(e).hasLocalMutations}Ac(e){e&&(e.addedDocuments.forEach(t=>this.dc=this.dc.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.dc=this.dc.delete(t)),this.current=e.current)}Rc(){if(!this.current)return[];const e=this.wc;this.wc=G(),this.gc.forEach(i=>{this.bc(i.key)&&(this.wc=this.wc.add(i.key))});const t=[];return e.forEach(i=>{this.wc.has(i)||t.push(new RT(i))}),this.wc.forEach(i=>{e.has(i)||t.push(new AT(i))}),t}vc(e){this.dc=e.Ks,this.wc=G();const t=this.Ic(e.documents);return this.applyChanges(t,!0)}Vc(){return Cs.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,this._c===0)}}class Kx{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class Wx{constructor(e){this.key=e,this.Sc=!1}}class Gx{constructor(e,t,i,r,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Dc={},this.Cc=new Hs(a=>PE(a),Ua),this.Nc=new Map,this.xc=new Set,this.kc=new fe(S.comparator),this.Oc=new Map,this.Mc=new Wp,this.$c={},this.Fc=new Map,this.Bc=hr.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return this.Lc===!0}}async function Hx(n,e){const t=ag(n);let i,r;const s=t.Cc.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.Vc();else{const o=await bs(t.localStore,Ht(e));t.isPrimaryClient&&Du(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,r=await ig(t,e,i,a==="current")}return r}async function ig(n,e,t,i){n.Uc=(u,h,d)=>async function(f,p,_,v){let P=p.view.Ic(_);P.ks&&(P=await fl(f.localStore,p.query,!1).then(({documents:z})=>p.view.Ic(z,P)));const V=v&&v.targetChanges.get(p.targetId),W=p.view.applyChanges(P,f.isPrimaryClient,V);return jd(f,p.targetId,W.Pc),W.snapshot}(n,u,h,d);const r=await fl(n.localStore,e,!0),s=new NT(e,r.Ks),o=s.Ic(r.documents),a=ja.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline"),c=s.applyChanges(o,n.isPrimaryClient,a);jd(n,t,c.Pc);const l=new Kx(e,t,s);return n.Cc.set(e,l),n.Nc.has(t)?n.Nc.get(t).push(e):n.Nc.set(t,[e]),c.snapshot}async function zx(n,e){const t=b(n),i=t.Cc.get(e),r=t.Nc.get(i.targetId);if(r.length>1)return t.Nc.set(i.targetId,r.filter(s=>!Ua(s,e))),void t.Cc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||await Ss(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),ta(t.remoteStore,i.targetId),ks(t,i.targetId)}).catch(Pr)):(ks(t,i.targetId),await Ss(t.localStore,i.targetId,!0))}async function Qx(n,e,t){const i=cg(n);try{const r=await function(s,o){const a=b(s),c=Oe.now(),l=o.reduce((h,d)=>h.add(d.key),G());let u;return a.persistence.runTransaction("Locally write mutations","readwrite",h=>a.Us.Es(h,l).next(d=>{u=d;const f=[];for(const p of o){const _=pD(p,u.get(p.key));_!=null&&f.push(new Rr(p.key,_,CE(_.value.mapValue),me.exists(!0)))}return a.gs.addMutationBatch(h,c,f,o)})).then(h=>(h.applyToLocalDocumentSet(u),{batchId:h.batchId,changes:u}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(s,o,a){let c=s.$c[s.currentUser.toKey()];c||(c=new fe(U)),c=c.insert(o,a),s.$c[s.currentUser.toKey()]=c}(i,r.batchId,t),await Xn(i,r.changes),await Qs(i.remoteStore)}catch(r){const s=Xs(r,"Failed to persist write");t.reject(s)}}async function PT(n,e){const t=b(n);try{const i=await ax(t.localStore,e);e.targetChanges.forEach((r,s)=>{const o=t.Oc.get(s);o&&(O(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.Sc=!0:r.modifiedDocuments.size>0?O(o.Sc):r.removedDocuments.size>0&&(O(o.Sc),o.Sc=!1))}),await Xn(t,i,e)}catch(i){await Pr(i)}}function oy(n,e,t){const i=b(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const r=[];i.Cc.forEach((s,o)=>{const a=o.view.tc(e);a.snapshot&&r.push(a.snapshot)}),function(s,o){const a=b(s);a.onlineState=o;let c=!1;a.queries.forEach((l,u)=>{for(const h of u.listeners)h.tc(o)&&(c=!0)}),c&&tg(a)}(i.eventManager,e),r.length&&i.Dc.To(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Yx(n,e,t){const i=b(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.Oc.get(e),s=r&&r.key;if(s){let o=new fe(S.comparator);o=o.insert(s,se.newNoDocument(s,N.min()));const a=G().add(s),c=new qa(N.min(),new Map,new re(U),o,a);await PT(i,c),i.kc=i.kc.remove(s),i.Oc.delete(e),og(i)}else await Ss(i.localStore,e,!1).then(()=>ks(i,e,t)).catch(Pr)}async function Xx(n,e){const t=b(n),i=e.batch.batchId;try{const r=await ox(t.localStore,e);sg(t,i,null),rg(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Xn(t,r)}catch(r){await Pr(r)}}async function Jx(n,e,t){const i=b(n);try{const r=await function(s,o){const a=b(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return a.gs.lookupMutationBatch(c,o).next(u=>(O(u!==null),l=u.keys(),a.gs.removeMutationBatch(c,u))).next(()=>a.gs.performConsistencyCheck(c)).next(()=>a.Us.Es(c,l))})}(i.localStore,e);sg(i,e,t),rg(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Xn(i,r)}catch(r){await Pr(r)}}async function Zx(n,e){const t=b(n);Ai(t.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=await function(s){const o=b(s);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.gs.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(i===-1)return void e.resolve();const r=t.Fc.get(i)||[];r.push(e),t.Fc.set(i,r)}catch(i){const r=Xs(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}function rg(n,e){(n.Fc.get(e)||[]).forEach(t=>{t.resolve()}),n.Fc.delete(e)}function sg(n,e,t){const i=b(n);let r=i.$c[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.$c[i.currentUser.toKey()]=r}}function ks(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Nc.get(e))n.Cc.delete(i),t&&n.Dc.qc(i,t);n.Nc.delete(e),n.isPrimaryClient&&n.Mc.si(e).forEach(i=>{n.Mc.containsKey(i)||OT(n,i)})}function OT(n,e){n.xc.delete(e.path.canonicalString());const t=n.kc.get(e);t!==null&&(ta(n.remoteStore,t),n.kc=n.kc.remove(e),n.Oc.delete(t),og(n))}function jd(n,e,t){for(const i of t)i instanceof AT?(n.Mc.addReference(i.key,e),eM(n,i)):i instanceof RT?(I("SyncEngine","Document no longer in limbo: "+i.key),n.Mc.removeReference(i.key,e),n.Mc.containsKey(i.key)||OT(n,i.key)):k()}function eM(n,e){const t=e.key,i=t.path.canonicalString();n.kc.get(t)||n.xc.has(i)||(I("SyncEngine","New document in limbo: "+t),n.xc.add(i),og(n))}function og(n){for(;n.xc.size>0&&n.kc.size<n.maxConcurrentLimboResolutions;){const e=n.xc.values().next().value;n.xc.delete(e);const t=new S(j.fromString(e)),i=n.Bc.next();n.Oc.set(i,new Wx(t)),n.kc=n.kc.insert(t,i),Du(n.remoteStore,new ci(Ht(Gs(t.path)),i,2,Pt.A))}}async function Xn(n,e,t){const i=b(n),r=[],s=[],o=[];i.Cc.isEmpty()||(i.Cc.forEach((a,c)=>{o.push(i.Uc(c,e,t).then(l=>{if(l){i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l.fromCache?"not-current":"current"),r.push(l);const u=Kp.Ss(c.targetId,l);s.push(u)}}))}),await Promise.all(o),i.Dc.To(r),await async function(a,c){const l=b(a);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>m.forEach(c,h=>m.forEach(h.vs,d=>l.persistence.referenceDelegate.addReference(u,h.targetId,d)).next(()=>m.forEach(h.Vs,d=>l.persistence.referenceDelegate.removeReference(u,h.targetId,d)))))}catch(u){if(!Nr(u))throw u;I("LocalStore","Failed to update sequence numbers: "+u)}for(const u of c){const h=u.targetId;if(!u.fromCache){const d=l.Ms.get(h),f=d.snapshotVersion,p=d.withLastLimboFreeSnapshotVersion(f);l.Ms=l.Ms.insert(h,p)}}}(i.localStore,s))}async function tM(n,e){const t=b(n);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const i=await pT(t.localStore,e);t.currentUser=e,function(r,s){r.Fc.forEach(o=>{o.forEach(a=>{a.reject(new y(g.CANCELLED,s))})}),r.Fc.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Xn(t,i.qs)}}function nM(n,e){const t=b(n),i=t.Oc.get(e);if(i&&i.Sc)return G().add(i.key);{let r=G();const s=t.Nc.get(e);if(!s)return r;for(const o of s){const a=t.Cc.get(o);r=r.unionWith(a.view.yc)}return r}}async function iM(n,e){const t=b(n),i=await fl(t.localStore,e.query,!0),r=e.view.vc(i);return t.isPrimaryClient&&jd(t,e.targetId,r.Pc),r}async function rM(n){const e=b(n);return yT(e.localStore).then(t=>Xn(e,t))}async function sM(n,e,t,i){const r=b(n),s=await function(o,a){const c=b(o),l=b(c.gs);return c.persistence.runTransaction("Lookup mutation documents","readonly",u=>l.Ge(u,a).next(h=>h?c.Us.Es(u,h):m.resolve(null)))}(r.localStore,e);s!==null?(t==="pending"?await Qs(r.remoteStore):t==="acknowledged"||t==="rejected"?(sg(r,e,i||null),rg(r,e),function(o,a){b(b(o).gs).Qe(a)}(r.localStore,e)):k(),await Xn(r,s)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function oM(n,e){const t=b(n);if(ag(t),cg(t),e===!0&&t.Lc!==!0){const i=t.sharedClientState.getAllActiveQueryTargets(),r=await ay(t,i.toArray());t.Lc=!0,await qd(t.remoteStore,!0);for(const s of r)Du(t.remoteStore,s)}else if(e===!1&&t.Lc!==!1){const i=[];let r=Promise.resolve();t.Nc.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):r=r.then(()=>(ks(t,o),Ss(t.localStore,o,!0))),ta(t.remoteStore,o)}),await r,await ay(t,i),function(s){const o=b(s);o.Oc.forEach((a,c)=>{ta(o.remoteStore,c)}),o.Mc.ii(),o.Oc=new Map,o.kc=new fe(S.comparator)}(t),t.Lc=!1,await qd(t.remoteStore,!1)}}async function ay(n,e,t){const i=b(n),r=[],s=[];for(const o of e){let a;const c=i.Nc.get(o);if(c&&c.length!==0){a=await bs(i.localStore,Ht(c[0]));for(const l of c){const u=i.Cc.get(l),h=await iM(i,u);h.snapshot&&s.push(h.snapshot)}}else{const l=await _T(i.localStore,o);a=await bs(i.localStore,l),await ig(i,DT(l),o,!1)}r.push(a)}return i.Dc.To(s),r}function DT(n){return RE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function aM(n){const e=b(n);return b(b(e.localStore).persistence).ds()}async function cM(n,e,t,i){const r=b(n);if(r.Lc)I("SyncEngine","Ignoring unexpected query state notification.");else if(r.Nc.has(e))switch(t){case"current":case"not-current":{const s=await yT(r.localStore),o=qa.createSynthesizedRemoteEventForCurrentChange(e,t==="current");await Xn(r,s,o);break}case"rejected":await Ss(r.localStore,e,!0),ks(r,e,i);break;default:k()}}async function lM(n,e,t){const i=ag(n);if(i.Lc){for(const r of e){if(i.Nc.has(r)){I("SyncEngine","Adding an already active target "+r);continue}const s=await _T(i.localStore,r),o=await bs(i.localStore,s);await ig(i,DT(s),o.targetId,!1),Du(i.remoteStore,o)}for(const r of t)i.Nc.has(r)&&await Ss(i.localStore,r,!1).then(()=>{ta(i.remoteStore,r),ks(i,r)}).catch(Pr)}}function ag(n){const e=b(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=PT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=nM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yx.bind(null,e),e.Dc.To=Vx.bind(null,e.eventManager),e.Dc.qc=Bx.bind(null,e.eventManager),e}function cg(n){const e=b(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xx.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Jx.bind(null,e),e}function uM(n,e,t){const i=b(n);(async function(r,s,o){try{const a=await s.getMetadata();if(await function(h,d){const f=b(h),p=De(d.createTime);return f.persistence.runTransaction("hasNewerBundle","readonly",_=>f.Kn.getBundleMetadata(_,d.id)).then(_=>!!_&&_.createTime.compareTo(p)>=0)}(r.localStore,a))return await s.close(),void o._completeWith(function(h){return{taskState:"Success",documentsLoaded:h.totalDocuments,bytesLoaded:h.totalBytes,totalDocuments:h.totalDocuments,totalBytes:h.totalBytes}}(a));o._updateProgress(kT(a));const c=new jx(a,r.localStore,s.O);let l=await s.Kc();for(;l;){const h=await c.lc(l);h&&o._updateProgress(h),l=await s.Kc()}const u=await c.complete();await Xn(r,u.ws,void 0),await function(h,d){const f=b(h);return f.persistence.runTransaction("Save bundle","readwrite",p=>f.Kn.saveBundleMetadata(p,d))}(r.localStore,a),o._completeWith(u.progress)}catch(a){Go("SyncEngine",`Loading bundle failed with ${a}`),o._failWith(a)}})(i,e,t).then(()=>{i.sharedClientState.notifyBundleLoaded()})}class xT{constructor(){this.synchronizeTabs=!1}async initialize(e){this.O=Ka(e.databaseInfo.databaseId),this.sharedClientState=this.Gc(e),this.persistence=this.jc(e),await this.persistence.start(),this.gcScheduler=this.Qc(e),this.localStore=this.Wc(e)}Qc(e){return null}Wc(e){return fT(this.persistence,new dT,e.initialUser,this.O)}jc(e){return new yx(Gp.bi,this.O)}Gc(e){return new wT}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class MT extends xT{constructor(e,t,i){super(),this.zc=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await lx(this.localStore),await this.zc.initialize(this,e),await cg(this.zc.syncEngine),await Qs(this.zc.remoteStore),await this.persistence.Hn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Wc(e){return fT(this.persistence,new dT,e.initialUser,this.O)}Qc(e){const t=this.persistence.referenceDelegate.garbageCollector;return new XD(t,e.asyncQueue)}jc(e){const t=jp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?yt.withCacheSize(this.cacheSizeBytes):yt.DEFAULT;return new qp(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,vT(),$c(),this.O,this.sharedClientState,!!this.forceOwnership)}Gc(e){return new wT}}class hM extends MT{constructor(e,t){super(e,t,!1),this.zc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.zc.syncEngine;this.sharedClientState instanceof Vh&&(this.sharedClientState.syncEngine={hr:sM.bind(null,t),lr:cM.bind(null,t),dr:lM.bind(null,t),ds:aM.bind(null,t),ar:rM.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Hn(async i=>{await oM(this.zc.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):i||this.gcScheduler.stop())})}Gc(e){const t=vT();if(!Vh.Vt(t))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=jp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Vh(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class lg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>oy(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=tM.bind(null,this.syncEngine),await qd(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new $x}createDatastore(e){const t=Ka(e.databaseInfo.databaseId),i=(r=e.databaseInfo,new Tx(r));var r;return function(s,o,a,c){return new Cx(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,r=e.asyncQueue,s=a=>oy(this.syncEngine,a,0),o=ny.Vt()?new ny:new vx,new Ax(t,i,r,s,o);var t,i,r,s,o}createSyncEngine(e,t){return function(i,r,s,o,a,c,l){const u=new Gx(i,r,s,o,a,c);return l&&(u.Lc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=b(e);I("RemoteStore","RemoteStore shutting down."),t.Ko.add(5),await zs(t),t.jo.shutdown(),t.Qo.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cy(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Hc(this.observer.next,e)}error(e){this.observer.error?this.Hc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Jc(){this.muted=!0}Hc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(e,t){this.Yc=e,this.O=t,this.metadata=new Pe,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then(i=>{i&&i.ac()?this.metadata.resolve(i.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i==null?void 0:i.payload)}`))},i=>this.metadata.reject(i))}close(){return this.Yc.cancel()}async getMetadata(){return this.metadata.promise}async Kc(){return await this.getMetadata(),this.Zc()}async Zc(){const e=await this.tu();if(e===null)return null;const t=this.Xc.decode(e),i=Number(t);isNaN(i)&&this.eu(`length string (${t}) is not valid number`);const r=await this.nu(i);return new qx(JSON.parse(r),e.length+i)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async tu(){for(;this.su()<0&&!await this.iu(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.eu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async nu(e){for(;this.buffer.length<e;)await this.iu()&&this.eu("Reached the end of bundle when more is expected.");const t=this.Xc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}eu(e){throw this.Yc.cancel(),new Error(`Invalid bundle format: ${e}`)}async iu(){const e=await this.Yc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fM{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,r){const s=b(i),o=Zo(s.O)+"/documents",a={documents:r.map(h=>Jo(s.O,h))},c=await s.Lr("BatchGetDocuments",o,a),l=new Map;c.forEach(h=>{const d=CD(s.O,h);l.set(d.key.toString(),d)});const u=[];return r.forEach(h=>{const d=l.get(h.toString());O(!!d),u.push(d)}),u}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ba(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{const r=S.fromPath(i);this.mutations.push(new Np(r,this.precondition(r)))}),await async function(t,i){const r=b(t),s=Zo(r.O)+"/documents",o={writes:i.map(a=>ea(r.O,a))};await r.Mr("Commit",s,o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw k();t=N.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?me.updateTime(t):me.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(N.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return me.updateTime(t)}return me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(e,t,i,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=i,this.deferred=r,this.ru=5,this.ro=new zp(this.asyncQueue,"transaction_retry")}run(){this.ru-=1,this.ou()}ou(){this.ro.Hr(async()=>{const e=new fM(this.datastore),t=this.cu(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(r=>{this.uu(r)}))}).catch(i=>{this.uu(i)})})}cu(e){try{const t=this.updateFunction(e);return!Ar(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}uu(e){this.ru>0&&this.au(e)?(this.ru-=1,this.asyncQueue.enqueueAndForget(()=>(this.ou(),Promise.resolve()))):this.deferred.reject(e)}au(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||!BE(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gM{constructor(e,t,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=We.UNAUTHENTICATED,this.clientId=IE.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async s=>{I("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(i,s=>(I("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Pe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Xs(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function LT(n,e){n.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async r=>{i.isEqual(r)||(await pT(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}async function FT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await ug(n);I("FirestoreClient","Initializing OnlineComponentProvider");const i=await n.getConfiguration();await e.initialize(t,i),n.setCredentialChangeListener(r=>iy(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>iy(e.remoteStore,s)),n.onlineComponents=e}async function ug(n){return n.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await LT(n,new xT)),n.offlineComponents}async function Mu(n){return n.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await FT(n,new lg)),n.onlineComponents}function UT(n){return ug(n).then(e=>e.persistence)}function hg(n){return ug(n).then(e=>e.localStore)}function $T(n){return Mu(n).then(e=>e.remoteStore)}function dg(n){return Mu(n).then(e=>e.syncEngine)}async function As(n){const e=await Mu(n),t=e.eventManager;return t.onListen=Hx.bind(null,e.syncEngine),t.onUnlisten=zx.bind(null,e.syncEngine),t}function mM(n){return n.asyncQueue.enqueue(async()=>{const e=await UT(n),t=await $T(n);return e.setNetworkEnabled(!0),function(i){const r=b(i);return r.Ko.delete(0),Wa(r)}(t)})}function _M(n){return n.asyncQueue.enqueue(async()=>{const e=await UT(n),t=await $T(n);return e.setNetworkEnabled(!1),async function(i){const r=b(i);r.Ko.add(0),await zs(r),r.Qo.set("Offline")}(t)})}function yM(n,e){const t=new Pe;return n.asyncQueue.enqueueAndForget(async()=>async function(i,r,s){try{const o=await function(a,c){const l=b(a);return l.persistence.runTransaction("read document","readonly",u=>l.Us.ys(u,c))}(i,r);o.isFoundDocument()?s.resolve(o):o.isNoDocument()?s.resolve(null):s.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(o){const a=Xs(o,`Failed to get document '${r} from cache`);s.reject(a)}}(await hg(n),e,t)),t.promise}function VT(n,e,t={}){const i=new Pe;return n.asyncQueue.enqueueAndForget(async()=>function(r,s,o,a,c){const l=new xu({next:h=>{s.enqueueAndForget(()=>eg(r,u));const d=h.docs.has(o);!d&&h.fromCache?c.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new ng(Gs(o.path),l,{includeMetadataChanges:!0,uc:!0});return Zp(r,u)}(await As(n),n.asyncQueue,e,t,i)),i.promise}function wM(n,e){const t=new Pe;return n.asyncQueue.enqueueAndForget(async()=>async function(i,r,s){try{const o=await fl(i,r,!0),a=new NT(r,o.Ks),c=a.Ic(o.documents),l=a.applyChanges(c,!1);s.resolve(l.snapshot)}catch(o){const a=Xs(o,`Failed to execute query '${r} against cache`);s.reject(a)}}(await hg(n),e,t)),t.promise}function BT(n,e,t={}){const i=new Pe;return n.asyncQueue.enqueueAndForget(async()=>function(r,s,o,a,c){const l=new xu({next:h=>{s.enqueueAndForget(()=>eg(r,u)),h.fromCache&&a.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new ng(o,l,{includeMetadataChanges:!0,uc:!0});return Zp(r,u)}(await As(n),n.asyncQueue,e,t,i)),i.promise}function vM(n,e){const t=new xu(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,r){b(i).Zo.add(r),r.next()}(await As(n),t)),()=>{t.Jc(),n.asyncQueue.enqueueAndForget(async()=>function(i,r){b(i).Zo.delete(r)}(await As(n),t))}}function IM(n,e){const t=new Pe;return n.asyncQueue.enqueueAndForget(async()=>{const i=await function(r){return Mu(r).then(s=>s.datastore)}(n);new pM(n.asyncQueue,i,e,t).run()}),t.promise}function EM(n,e,t,i){const r=function(s,o){let a;return a=typeof s=="string"?new TextEncoder().encode(s):s,function(c,l){return new dM(c,l)}(function(c,l){if(c instanceof Uint8Array)return cy(c,l);if(c instanceof ArrayBuffer)return cy(new Uint8Array(c),l);if(c instanceof ReadableStream)return c.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),o)}(t,Ka(e));n.asyncQueue.enqueueAndForget(async()=>{uM(await dg(n),r,i)})}function TM(n,e){return n.asyncQueue.enqueue(async()=>function(t,i){const r=b(t);return r.persistence.runTransaction("Get named query","readonly",s=>r.Kn.getNamedQuery(s,i))}(await hg(n),e))}const ly=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(n,e,t){if(!t)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function qT(n,e,t,i){if(e===!0&&i===!0)throw new y(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function uy(n){if(!S.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function hy(n){if(S.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Lu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":k()}function B(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Lu(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function jT(n,e){if(e<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e){var t;if(e.host===void 0){if(e.ssl!==void 0)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,qT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e,t,i){this._authCredentials=t,this._appCheckCredentials=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new dy({}),this._settingsFrozen=!1,e instanceof sr?this._databaseId=e:(this._app=e,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sr(r.options.projectId)}(e))}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new dy(e),e.credentials!==void 0&&(this._authCredentials=function(t){if(!t)return new UO;switch(t.type){case"gapi":const i=t.client;return O(!(typeof i!="object"||i===null||!i.auth||!i.auth.getAuthHeaderValueForFirstParty)),new qO(i,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ly.get(e);t&&(I("ComponentProvider","Removing Datastore"),ly.delete(e),t.terminate())}(this),Promise.resolve()}}function bM(n,e,t,i={}){var r;const s=(n=B(n,Ga))._getSettings();if(s.host!=="firestore.googleapis.com"&&s.host!==e&&Go("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let o,a;if(typeof i.mockUserToken=="string")o=i.mockUserToken,a=We.MOCK_USER;else{o=Pf(i.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new We(c)}n._authCredentials=new $O(new vE(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ee(this.firestore,e,this._key)}}class rt{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new rt(this.firestore,e,this._query)}}class mn extends rt{constructor(e,t,i){super(e,t,Gs(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ee(this.firestore,null,new S(e))}withConverter(e){return new mn(this.firestore,e,this._path)}}function KT(n,e,...t){if(n=w(n),fg("collection","path",e),n instanceof Ga){const i=j.fromString(e,...t);return hy(i),new mn(n,null,i)}{if(!(n instanceof ee||n instanceof mn))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(j.fromString(e,...t));return hy(i),new mn(n.firestore,null,i)}}function SM(n,e){if(n=B(n,Ga),fg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new rt(n,null,function(t){return new Yn(j.emptyPath(),t)}(e))}function _l(n,e,...t){if(n=w(n),arguments.length===1&&(e=IE.R()),fg("doc","path",e),n instanceof Ga){const i=j.fromString(e,...t);return uy(i),new ee(n,null,new S(i))}{if(!(n instanceof ee||n instanceof mn))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(j.fromString(e,...t));return uy(i),new ee(n.firestore,n instanceof mn?n.converter:null,new S(i))}}function WT(n,e){return n=w(n),e=w(e),(n instanceof ee||n instanceof mn)&&(e instanceof ee||e instanceof mn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function GT(n,e){return n=w(n),e=w(e),n instanceof rt&&e instanceof rt&&n.firestore===e.firestore&&Ua(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new zp(this,"async_queue_retry"),this.yu=()=>{const t=$c();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ro.Yr()};const e=$c();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.fu){this.fu=!0,this.mu=e||!1;const t=$c();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.yu)}}enqueue(e){if(this.pu(),this.fu)return new Promise(()=>{});const t=new Pe;return this.Iu(()=>this.fu&&this.mu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.lu.push(e),this.Eu()))}async Eu(){if(this.lu.length!==0){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(e){if(!Nr(e))throw e;I("AsyncQueue","Operation failed with retryable error: "+e)}this.lu.length>0&&this.ro.Hr(()=>this.Eu())}}Iu(e){const t=this.hu.then(()=>(this.wu=!0,e().catch(i=>{this._u=i,this.wu=!1;const r=function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),o}(i);throw ge("INTERNAL UNHANDLED ERROR: ",r),i}).then(i=>(this.wu=!1,i))));return this.hu=t,t}enqueueAfterDelay(e,t,i){this.pu(),this.gu.indexOf(e)>-1&&(t=0);const r=Jp.createAndSchedule(this,e,t,i,s=>this.Tu(s));return this.du.push(r),r}pu(){this._u&&k()}verifyOperationInProgress(){}async Au(){let e;do e=this.hu,await e;while(e!==this.hu)}Ru(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}Pu(e){return this.Au().then(()=>{this.du.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.du)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Au()})}bu(e){this.gu.push(e)}Tu(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}function Kd(n){return function(e,t){if(typeof e!="object"||e===null)return!1;const i=e;for(const r of t)if(r in i&&typeof i[r]=="function")return!0;return!1}(n,["next","error","complete"])}class kM{constructor(){this._progressObserver={},this._taskCompletionResolver=new Pe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AM=-1;class ue extends Ga{constructor(e,t,i){super(e,t,i),this.type="firestore",this._queue=new CM,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||HT(this),this._firestoreClient.terminate()}}function Yz(n=eu()){return An(n,"firestore").getImmediate()}function qe(n){return n._firestoreClient||HT(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function HT(n){var e;const t=n._freezeSettings(),i=function(r,s,o,a){return new QO(r,s,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,t);n._firestoreClient=new gM(n._authCredentials,n._appCheckCredentials,n._queue,i)}function RM(n,e){QT(n=B(n,ue));const t=qe(n),i=n._freezeSettings(),r=new lg;return zT(t,r,new MT(r,i.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function NM(n){QT(n=B(n,ue));const e=qe(n),t=n._freezeSettings(),i=new lg;return zT(e,i,new hM(i,t.cacheSizeBytes))}function zT(n,e,t){const i=new Pe;return n.asyncQueue.enqueue(async()=>{try{await LT(n,t),await FT(n,e),i.resolve()}catch(r){if(!function(s){return s.name==="FirebaseError"?s.code===g.FAILED_PRECONDITION||s.code===g.UNIMPLEMENTED:typeof DOMException!="undefined"&&s instanceof DOMException?s.code===22||s.code===20||s.code===11:!0}(r))throw r;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r)}}).then(()=>i.promise)}function PM(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Pe;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!Jt.Vt())return Promise.resolve();const i=t+"main";await Jt.delete(i)}(jp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function OM(n){return function(e){const t=new Pe;return e.asyncQueue.enqueueAndForget(async()=>Zx(await dg(e),t)),t.promise}(qe(n=B(n,ue)))}function DM(n){return mM(qe(n=B(n,ue)))}function xM(n){return _M(qe(n=B(n,ue)))}function MM(n,e){const t=qe(n=B(n,ue)),i=new kM;return EM(t,n._databaseId,e,i),i}function LM(n,e){return TM(qe(n=B(n,ue)),e).then(t=>t?new rt(n,null,t.query):null)}function QT(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this._byteString=e}static fromBase64String(e){try{return new In(Ie.fromBase64String(e))}catch(t){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new In(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return U(this._lat,e._lat)||U(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FM=/^__.*__$/;class UM{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Rr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Va(e,this.data,t,this.fieldTransforms)}}class YT{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Rr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function XT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw k()}}class Uu{constructor(e,t,i,r,s,o){this.settings=e,this.databaseId=t,this.O=i,this.ignoreUndefinedProperties=r,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(e){return new Uu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Su({path:i,Cu:!1});return r.Nu(e),r}xu(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Su({path:i,Cu:!1});return r.vu(),r}ku(e){return this.Su({path:void 0,Cu:!0})}Ou(e){return yl(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Nu(this.path.get(e))}Nu(e){if(e.length===0)throw this.Ou("Document fields must not be empty");if(XT(this.Vu)&&FM.test(e))throw this.Ou('Document fields cannot begin and end with "__"')}}class $M{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.O=i||Ka(e)}Fu(e,t,i,r=!1){return new Uu({Vu:e,methodName:t,$u:i,path:Re.emptyPath(),Cu:!1,Mu:r},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function Dr(n){const e=n._freezeSettings(),t=Ka(n._databaseId);return new $M(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $u(n,e,t,i,r,s={}){const o=n.Fu(s.merge||s.mergeFields?2:0,e,t,r);_g("Data must be an object, but it was:",o,i);const a=eb(i,o);let c,l;if(s.merge)c=new ms(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=Wd(e,h,t);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);nb(u,d)||u.push(d)}c=new ms(u),l=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,l=o.fieldTransforms;return new UM(new tt(a),c,l)}class Ha extends Or{_toFieldTransform(e){if(e.Vu!==2)throw e.Vu===1?e.Ou(`${this._methodName}() can only appear at the top level of your update data`):e.Ou(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ha}}function JT(n,e,t){return new Uu({Vu:3,$u:e.settings.$u,methodName:n._methodName,Cu:t},e.databaseId,e.O,e.ignoreUndefinedProperties)}class pg extends Or{_toFieldTransform(e){return new $a(e.path,new vs)}isEqual(e){return e instanceof pg}}class VM extends Or{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=JT(this,e,!0),i=this.Bu.map(s=>xr(s,t)),r=new ar(i);return new $a(e.path,r)}isEqual(e){return this===e}}class BM extends Or{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=JT(this,e,!0),i=this.Bu.map(s=>xr(s,t)),r=new cr(i);return new $a(e.path,r)}isEqual(e){return this===e}}class qM extends Or{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=new Is(e.O,ME(e.O,this.Lu));return new $a(e.path,t)}isEqual(e){return this===e}}function gg(n,e,t,i){const r=n.Fu(1,e,t);_g("Data must be an object, but it was:",r,i);const s=[],o=tt.empty();kr(i,(c,l)=>{const u=yg(e,c,t);l=w(l);const h=r.xu(u);if(l instanceof Ha)s.push(u);else{const d=xr(l,h);d!=null&&(s.push(u),o.set(u,d))}});const a=new ms(s);return new YT(o,a,r.fieldTransforms)}function mg(n,e,t,i,r,s){const o=n.Fu(1,e,t),a=[Wd(e,i,t)],c=[r];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Wd(e,s[d])),c.push(s[d+1]);const l=[],u=tt.empty();for(let d=a.length-1;d>=0;--d)if(!nb(l,a[d])){const f=a[d];let p=c[d];p=w(p);const _=o.xu(f);if(p instanceof Ha)l.push(f);else{const v=xr(p,_);v!=null&&(l.push(f),u.set(f,v))}}const h=new ms(l);return new YT(u,h,o.fieldTransforms)}function ZT(n,e,t,i=!1){return xr(t,n.Fu(i?4:3,e))}function xr(n,e){if(tb(n=w(n)))return _g("Unsupported field value:",e,n),eb(n,e);if(n instanceof Or)return function(t,i){if(!XT(i.Vu))throw i.Ou(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Ou(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Cu&&e.Vu!==4)throw e.Ou("Nested arrays are not supported");return function(t,i){const r=[];let s=0;for(const o of t){let a=xr(o,i.ku(s));a==null&&(a={nullValue:"NULL_VALUE"}),r.push(a),s++}return{arrayValue:{values:r}}}(n,e)}return function(t,i){if((t=w(t))===null)return{nullValue:"NULL_VALUE"};if(typeof t=="number")return ME(i.O,t);if(typeof t=="boolean")return{booleanValue:t};if(typeof t=="string")return{stringValue:t};if(t instanceof Date){const r=Oe.fromDate(t);return{timestampValue:Xo(i.O,r)}}if(t instanceof Oe){const r=new Oe(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Xo(i.O,r)}}if(t instanceof Fu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof In)return{bytesValue:WE(i.O,t._byteString)};if(t instanceof ee){const r=i.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw i.Ou(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Pp(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.Ou(`Unsupported field value: ${Lu(t)}`)}(n,e)}function eb(n,e){const t={};return TE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):kr(n,(i,r)=>{const s=xr(r,e.Du(i));s!=null&&(t[i]=s)}),{mapValue:{fields:t}}}function tb(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Oe||n instanceof Fu||n instanceof In||n instanceof ee||n instanceof Or)}function _g(n,e,t){if(!tb(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const i=Lu(t);throw i==="an object"?e.Ou(n+" a custom object"):e.Ou(n+" "+i)}}function Wd(n,e,t){if((e=w(e))instanceof wi)return e._internalPath;if(typeof e=="string")return yg(n,e);throw yl("Field path arguments must be of type string or ",n,!1,void 0,t)}const jM=new RegExp("[~\\*/\\[\\]]");function yg(n,e,t){if(e.search(jM)>=0)throw yl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new wi(...e.split("."))._internalPath}catch{throw yl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function yl(n,e,t,i,r){const s=i&&!i.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new y(g.INVALID_ARGUMENT,a+n+c)}function nb(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ee(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new KM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Vu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class KM extends na{data(){return super.data()}}function Vu(n,e){return typeof e=="string"?yg(n,e):e instanceof wi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gn extends na{constructor(e,t,i,r,s,o){super(e,t,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Co(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Vu("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Co extends Gn{data(e={}){return super.data(e)}}class vi{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new qi(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Co(this._firestore,this._userDataWriter,i.key,i,new qi(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(o=>({type:"added",doc:new Co(i._firestore,i._userDataWriter,o.doc.key,o.doc,new qi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:s++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>r||o.type!==3).map(o=>{const a=new Co(i._firestore,i._userDataWriter,o.doc.key,o.doc,new qi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return o.type!==0&&(c=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),o.type!==1&&(s=s.add(o.doc),l=s.indexOf(o.doc.key)),{type:WM(o.type),doc:a,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function WM(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return k()}}function ib(n,e){return n instanceof Gn&&e instanceof Gn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof vi&&e instanceof vi&&n._firestore===e._firestore&&GT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(n){if(ul(n)&&n.explicitOrderBy.length===0)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class za{}function ti(n,...e){for(const t of e)n=t._apply(n);return n}class GM extends za{constructor(e,t,i){super(),this.Uu=e,this.qu=t,this.Ku=i,this.type="where"}_apply(e){const t=Dr(e.firestore),i=function(r,s,o,a,c,l,u){let h;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){py(u,l);const f=[];for(const p of u)f.push(fy(a,r,p));h={arrayValue:{values:f}}}else h=fy(a,r,u)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||py(u,l),h=ZT(o,s,u,l==="in"||l==="not-in");const d=dt.create(c,l,h);return function(f,p){if(p.S()){const v=kp(f);if(v!==null&&!v.isEqual(p.field))throw new y(g.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${v.toString()}' and '${p.field.toString()}'`);const P=Cp(f);P!==null&&lb(f,p.field,P)}const _=function(v,P){for(const V of v.filters)if(P.indexOf(V.op)>=0)return V.op;return null}(f,function(v){switch(v){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(p.op));if(_!==null)throw _===p.op?new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${p.op.toString()}' filter.`):new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${p.op.toString()}' filters with '${_.toString()}' filters.`)}(r,d),d}(e._query,"where",t,e.firestore._databaseId,this.Uu,this.qu,this.Ku);return new rt(e.firestore,e.converter,function(r,s){const o=r.filters.concat([s]);return new Yn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),o,r.limit,r.limitType,r.startAt,r.endAt)}(e._query,i))}}function HM(n,e,t){const i=e,r=Vu("where",n);return new GM(r,i,t)}class zM extends za{constructor(e,t){super(),this.Uu=e,this.Gu=t,this.type="orderBy"}_apply(e){const t=function(i,r,s){if(i.startAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new rs(r,s);return function(a,c){if(Cp(a)===null){const l=kp(a);l!==null&&lb(a,l,c.field)}}(i,o),o}(e._query,this.Uu,this.Gu);return new rt(e.firestore,e.converter,function(i,r){const s=i.explicitOrderBy.concat([r]);return new Yn(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function QM(n,e="asc"){const t=e,i=Vu("orderBy",n);return new zM(i,t)}class sb extends za{constructor(e,t,i){super(),this.type=e,this.ju=t,this.Qu=i}_apply(e){return new rt(e.firestore,e.converter,NE(e._query,this.ju,this.Qu))}}function YM(n){return jT("limit",n),new sb("limit",n,"F")}function XM(n){return jT("limitToLast",n),new sb("limitToLast",n,"L")}class ob extends za{constructor(e,t,i){super(),this.type=e,this.Wu=t,this.zu=i}_apply(e){const t=cb(e,this.type,this.Wu,this.zu);return new rt(e.firestore,e.converter,function(i,r){return new Yn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,r,i.endAt)}(e._query,t))}}function JM(...n){return new ob("startAt",n,!0)}function ZM(...n){return new ob("startAfter",n,!1)}class ab extends za{constructor(e,t,i){super(),this.type=e,this.Wu=t,this.zu=i}_apply(e){const t=cb(e,this.type,this.Wu,this.zu);return new rt(e.firestore,e.converter,function(i,r){return new Yn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,r)}(e._query,t))}}function eL(...n){return new ab("endBefore",n,!1)}function tL(...n){return new ab("endAt",n,!0)}function cb(n,e,t,i){if(t[0]=w(t[0]),t[0]instanceof na)return function(r,s,o,a,c){if(!a)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const l=[];for(const u of ws(r))if(u.field.isKeyField())l.push(al(s,a.key));else{const h=a.data.field(u.field);if(Sp(h))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(h===null){const d=u.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}l.push(h)}return new ys(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const r=Dr(n.firestore);return function(s,o,a,c,l,u){const h=s.explicitOrderBy;if(l.length>h.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let f=0;f<l.length;f++){const p=l[f];if(h[f].field.isKeyField()){if(typeof p!="string")throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof p}`);if(!Ap(s)&&p.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${p}' contains a slash.`);const _=s.path.child(j.fromString(p));if(!S.isDocumentKey(_))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);const v=new S(_);d.push(al(o,v))}else{const _=ZT(a,c,p);d.push(_)}}return new ys(d,u)}(n._query,n.firestore._databaseId,r,e,t,i)}}function fy(n,e,t){if(typeof(t=w(t))=="string"){if(t==="")throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ap(e)&&t.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(j.fromString(t));if(!S.isDocumentKey(i))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return al(n,new S(i))}if(t instanceof ee)return al(n,t._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Lu(t)}.`)}function py(n,e){if(!Array.isArray(n)||n.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new y(g.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function lb(n,e,t){if(!t.isEqual(e))throw new y(g.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{convertValue(e,t="none"){switch(or(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw k()}}convertObject(e,t){const i={};return kr(e.fields,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new Fu(ce(e.latitude),ce(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=bE(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(zo(e));default:return null}}convertTimestamp(e){const t=_i(e);return new Oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=j.fromString(e);O(eT(i));const r=new sr(i.get(1),i.get(3)),s=new S(i.popFirst(5));return r.isEqual(t)||ge(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class nL extends wg{constructor(e){super(),this.firestore=e}convertBytes(e){return new In(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ee(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iL{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Dr(e)}set(e,t,i){this._verifyNotCommitted();const r=ri(e,this._firestore),s=Bu(r.converter,t,i),o=$u(this._dataReader,"WriteBatch.set",r._key,s,r.converter!==null,i);return this._mutations.push(o.toMutation(r._key,me.none())),this}update(e,t,i,...r){this._verifyNotCommitted();const s=ri(e,this._firestore);let o;return o=typeof(t=w(t))=="string"||t instanceof wi?mg(this._dataReader,"WriteBatch.update",s._key,t,i,r):gg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ri(e,this._firestore);return this._mutations=this._mutations.concat(new Ba(t._key,me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ri(n,e){if((n=w(n)).firestore!==e)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rL(n){n=B(n,ee);const e=B(n.firestore,ue);return VT(qe(e),n._key).then(t=>vg(e,n,t))}class Mr extends wg{constructor(e){super(),this.firestore=e}convertBytes(e){return new In(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ee(this.firestore,null,t)}}function sL(n){n=B(n,ee);const e=B(n.firestore,ue),t=qe(e),i=new Mr(e);return yM(t,n._key).then(r=>new Gn(e,i,n._key,r,new qi(r!==null&&r.hasLocalMutations,!0),n.converter))}function oL(n){n=B(n,ee);const e=B(n.firestore,ue);return VT(qe(e),n._key,{source:"server"}).then(t=>vg(e,n,t))}function aL(n){n=B(n,rt);const e=B(n.firestore,ue),t=qe(e),i=new Mr(e);return rb(n._query),BT(t,n._query).then(r=>new vi(e,i,n,r))}function cL(n){n=B(n,rt);const e=B(n.firestore,ue),t=qe(e),i=new Mr(e);return wM(t,n._query).then(r=>new vi(e,i,n,r))}function lL(n){n=B(n,rt);const e=B(n.firestore,ue),t=qe(e),i=new Mr(e);return BT(t,n._query,{source:"server"}).then(r=>new vi(e,i,n,r))}function gy(n,e,t){n=B(n,ee);const i=B(n.firestore,ue),r=Bu(n.converter,e,t);return Qa(i,[$u(Dr(i),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,me.none())])}function my(n,e,t,...i){n=B(n,ee);const r=B(n.firestore,ue),s=Dr(r);let o;return o=typeof(e=w(e))=="string"||e instanceof wi?mg(s,"updateDoc",n._key,e,t,i):gg(s,"updateDoc",n._key,e),Qa(r,[o.toMutation(n._key,me.exists(!0))])}function uL(n){return Qa(B(n.firestore,ue),[new Ba(n._key,me.none())])}function hL(n,e){const t=B(n.firestore,ue),i=_l(n),r=Bu(n.converter,e);return Qa(t,[$u(Dr(n.firestore),"addDoc",i._key,r,n.converter!==null,{}).toMutation(i._key,me.exists(!1))]).then(()=>i)}function ub(n,...e){var t,i,r;n=w(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||Kd(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Kd(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}let c,l,u;if(n instanceof ee)l=B(n.firestore,ue),u=Gs(n._key.path),c={next:h=>{e[o]&&e[o](vg(l,n,h))},error:e[o+1],complete:e[o+2]};else{const h=B(n,rt);l=B(h.firestore,ue),u=h._query;const d=new Mr(l);c={next:f=>{e[o]&&e[o](new vi(l,d,h,f))},error:e[o+1],complete:e[o+2]},rb(n._query)}return function(h,d,f,p){const _=new xu(p),v=new ng(d,_,f);return h.asyncQueue.enqueueAndForget(async()=>Zp(await As(h),v)),()=>{_.Jc(),h.asyncQueue.enqueueAndForget(async()=>eg(await As(h),v))}}(qe(l),u,a,c)}function dL(n,e){return vM(qe(n=B(n,ue)),Kd(e)?e:{next:e})}function Qa(n,e){return function(t,i){const r=new Pe;return t.asyncQueue.enqueueAndForget(async()=>Qx(await dg(t),i,r)),r.promise}(qe(n),e)}function vg(n,e,t){const i=t.docs.get(e._key),r=new Mr(n);return new Gn(n,r,e._key,i,new qi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fL extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Dr(e)}get(e){const t=ri(e,this._firestore),i=new nL(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||r.length!==1)return k();const s=r[0];if(s.isFoundDocument())return new na(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new na(this._firestore,i,t._key,null,t.converter);throw k()})}set(e,t,i){const r=ri(e,this._firestore),s=Bu(r.converter,t,i),o=$u(this._dataReader,"Transaction.set",r._key,s,r.converter!==null,i);return this._transaction.set(r._key,o),this}update(e,t,i,...r){const s=ri(e,this._firestore);let o;return o=typeof(t=w(t))=="string"||t instanceof wi?mg(this._dataReader,"Transaction.update",s._key,t,i,r):gg(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){const t=ri(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ri(e,this._firestore),i=new Mr(this._firestore);return super.get(e).then(r=>new Gn(this._firestore,i,t._key,r._document,new qi(!1,!1),t.converter))}}function pL(n,e){return IM(qe(n=B(n,ue)),t=>e(new fL(n,t)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gL(){return new Ha("deleteField")}function mL(){return new pg("serverTimestamp")}function _L(...n){return new VM("arrayUnion",n)}function yL(...n){return new BM("arrayRemove",n)}function wL(n){return new qM("increment",n)}(function(n,e=!0){(function(t){Ws=t})(Rn),le(new q("firestore",(t,{options:i})=>{const r=t.getProvider("app").getImmediate(),s=new ue(r,new VO(t.getProvider("auth-internal")),new KO(t.getProvider("app-check-internal")));return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s},"PUBLIC")),Q(v_,"3.4.5",n),Q(v_,"3.4.5","esm2017")})();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e,t){this._delegate=e,this.firebase=t,Hc(e,new q("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Sv(this._delegate)))}_getService(e,t=er){var i;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return!r.isInitialized()&&((i=r.getComponent())===null||i===void 0?void 0:i.instantiationMode)==="EXPLICIT"&&r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=er){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Hc(this._delegate,e)}_addOrOverwriteComponent(e){Tv(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},_y=new _t("app-compat","Firebase",IL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EL(n){const e={},t={__esModule:!0,initializeApp:s,app:r,registerVersion:Q,setLogLevel:kv,onLog:Cv,apps:null,SDK_VERSION:Rn,INTERNAL:{registerComponent:a,removeApp:i,useAsService:c,modularAPIs:SA}};t.default=t,Object.defineProperty(t,"apps",{get:o});function i(l){delete e[l]}function r(l){if(l=l||er,!xt(e,l))throw _y.create("no-app",{appName:l});return e[l]}r.App=n;function s(l,u={}){const h=bv(l,u);if(xt(e,h.name))return e[h.name];const d=new n(h,t);return e[h.name]=d,d}function o(){return Object.keys(e).map(l=>e[l])}function a(l){const u=l.name,h=u.replace("-compat","");if(le(l)&&l.type==="PUBLIC"){const d=(f=r())=>{if(typeof f[h]!="function")throw _y.create("invalid-app-argument",{appName:u});return f[h]()};l.serviceProps!==void 0&&Do(d,l.serviceProps),t[h]=d,n.prototype[h]=function(...f){return this._getService.bind(this,u).apply(this,l.multipleInstances?f:[])}}return l.type==="PUBLIC"?t[h]:null}function c(l,u){return u==="serverAuth"?null:u}return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hb(){const n=EL(vL);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:hb,extendNamespace:e,createSubscribe:_v,ErrorFactory:_t,deepExtend:Do});function e(t){Do(n,t)}return n}const TL=hb();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy=new Cn("@firebase/app-compat"),bL="@firebase/app-compat",SL="0.1.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CL(n){Q(bL,SL,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(a0()&&self.firebase!==void 0){yy.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&yy.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const je=TL;CL();const db="@firebase/installations",Ig="0.5.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fb=1e4,pb=`w:${Ig}`,gb="FIS_v2",kL="https://firebaseinstallations.googleapis.com/v1",AL=60*60*1e3,RL="installations",NL="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PL={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},dr=new _t(RL,NL,PL);function mb(n){return n instanceof de&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b({projectId:n}){return`${kL}/projects/${n}/installations`}function yb(n){return{token:n.token,requestStatus:2,expiresIn:DL(n.expiresIn),creationTime:Date.now()}}async function wb(n,e){const i=(await e.json()).error;return dr.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function vb({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function OL(n,{refreshToken:e}){const t=vb(n);return t.append("Authorization",xL(e)),t}async function Ib(n){const e=await n();return e.status>=500&&e.status<600?n():e}function DL(n){return Number(n.replace("s","000"))}function xL(n){return`${gb} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ML(n,{fid:e}){const t=_b(n),i=vb(n),r={fid:e,authVersion:gb,appId:n.appId,sdkVersion:pb},s={method:"POST",headers:i,body:JSON.stringify(r)},o=await Ib(()=>fetch(t,s));if(o.ok){const a=await o.json();return{fid:a.fid||e,registrationStatus:2,refreshToken:a.refreshToken,authToken:yb(a.authToken)}}else throw await wb("Create Installation",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LL(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FL=/^[cdef][\w-]{21}$/,Gd="";function UL(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=$L(n);return FL.test(t)?t:Gd}catch{return Gd}}function $L(n){return LL(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb=new Map;function bb(n,e){const t=qu(n);Sb(t,e),VL(t,e)}function Sb(n,e){const t=Tb.get(n);if(!!t)for(const i of t)i(e)}function VL(n,e){const t=BL();t&&t.postMessage({key:n,fid:e}),qL()}let ji=null;function BL(){return!ji&&"BroadcastChannel"in self&&(ji=new BroadcastChannel("[Firebase] FID Change"),ji.onmessage=n=>{Sb(n.data.key,n.data.fid)}),ji}function qL(){Tb.size===0&&ji&&(ji.close(),ji=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jL="firebase-installations-database",KL=1,fr="firebase-installations-store";let Bh=null;function Eg(){return Bh||(Bh=Fs(jL,KL,n=>{switch(n.oldVersion){case 0:n.createObjectStore(fr)}})),Bh}async function wl(n,e){const t=qu(n),r=(await Eg()).transaction(fr,"readwrite"),s=r.objectStore(fr),o=await s.get(t);return await s.put(e,t),await r.complete,(!o||o.fid!==e.fid)&&bb(n,e.fid),e}async function Cb(n){const e=qu(n),i=(await Eg()).transaction(fr,"readwrite");await i.objectStore(fr).delete(e),await i.complete}async function ju(n,e){const t=qu(n),r=(await Eg()).transaction(fr,"readwrite"),s=r.objectStore(fr),o=await s.get(t),a=e(o);return a===void 0?await s.delete(t):await s.put(a,t),await r.complete,a&&(!o||o.fid!==a.fid)&&bb(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tg(n){let e;const t=await ju(n,i=>{const r=WL(i),s=GL(n,r);return e=s.registrationPromise,s.installationEntry});return t.fid===Gd?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function WL(n){const e=n||{fid:UL(),registrationStatus:0};return kb(e)}function GL(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const r=Promise.reject(dr.create("app-offline"));return{installationEntry:e,registrationPromise:r}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=HL(n,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:zL(n)}:{installationEntry:e}}async function HL(n,e){try{const t=await ML(n,e);return wl(n,t)}catch(t){throw mb(t)&&t.customData.serverCode===409?await Cb(n):await wl(n,{fid:e.fid,registrationStatus:0}),t}}async function zL(n){let e=await wy(n);for(;e.registrationStatus===1;)await Eb(100),e=await wy(n);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await Tg(n);return i||t}return e}function wy(n){return ju(n,e=>{if(!e)throw dr.create("installation-not-found");return kb(e)})}function kb(n){return QL(n)?{fid:n.fid,registrationStatus:0}:n}function QL(n){return n.registrationStatus===1&&n.registrationTime+fb<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YL({appConfig:n,platformLoggerProvider:e},t){const i=XL(n,t),r=OL(n,t),s=e.getImmediate({optional:!0});s&&r.append("x-firebase-client",s.getPlatformInfoString());const o={installation:{sdkVersion:pb}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Ib(()=>fetch(i,a));if(c.ok){const l=await c.json();return yb(l)}else throw await wb("Generate Auth Token",c)}function XL(n,{fid:e}){return`${_b(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bg(n,e=!1){let t;const i=await ju(n.appConfig,s=>{if(!Ab(s))throw dr.create("not-registered");const o=s.authToken;if(!e&&e1(o))return s;if(o.requestStatus===1)return t=JL(n,e),s;{if(!navigator.onLine)throw dr.create("app-offline");const a=n1(s);return t=ZL(n,a),a}});return t?await t:i.authToken}async function JL(n,e){let t=await vy(n.appConfig);for(;t.authToken.requestStatus===1;)await Eb(100),t=await vy(n.appConfig);const i=t.authToken;return i.requestStatus===0?bg(n,e):i}function vy(n){return ju(n,e=>{if(!Ab(e))throw dr.create("not-registered");const t=e.authToken;return i1(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function ZL(n,e){try{const t=await YL(n,e),i=Object.assign(Object.assign({},e),{authToken:t});return await wl(n.appConfig,i),t}catch(t){if(mb(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Cb(n.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await wl(n.appConfig,i)}throw t}}function Ab(n){return n!==void 0&&n.registrationStatus===2}function e1(n){return n.requestStatus===2&&!t1(n)}function t1(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+AL}function n1(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function i1(n){return n.requestStatus===1&&n.requestTime+fb<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r1(n){const e=n,{installationEntry:t,registrationPromise:i}=await Tg(e.appConfig);return i?i.catch(console.error):bg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s1(n,e=!1){const t=n;return await o1(t.appConfig),(await bg(t,e)).token}async function o1(n){const{registrationPromise:e}=await Tg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a1(n){if(!n||!n.options)throw qh("App Configuration");if(!n.name)throw qh("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw qh(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function qh(n){return dr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rb="installations",c1="installations-internal",l1=n=>{const e=n.getProvider("app").getImmediate(),t=a1(e),i=An(e,"platform-logger");return{app:e,appConfig:t,platformLoggerProvider:i,_delete:()=>Promise.resolve()}},u1=n=>{const e=n.getProvider("app").getImmediate(),t=An(e,Rb).getImmediate();return{getId:()=>r1(t),getToken:r=>s1(t,r)}};function h1(){le(new q(Rb,l1,"PUBLIC")),le(new q(c1,u1,"PRIVATE"))}h1();Q(db,Ig);Q(db,Ig,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iy="analytics",d1="firebase_id",f1="origin",p1=60*1e3,g1="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Nb="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xe=new Cn("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pb(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function m1(n,e){const t=document.createElement("script");t.src=`${Nb}?l=${n}&id=${e}`,t.async=!0,document.head.appendChild(t)}function _1(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function y1(n,e,t,i,r,s){const o=i[r];try{if(o)await e[o];else{const c=(await Pb(t)).find(l=>l.measurementId===r);c&&await e[c.appId]}}catch(a){Xe.error(a)}n("config",r,s)}async function w1(n,e,t,i,r){try{let s=[];if(r&&r.send_to){let o=r.send_to;Array.isArray(o)||(o=[o]);const a=await Pb(t);for(const c of o){const l=a.find(h=>h.measurementId===c),u=l&&e[l.appId];if(u)s.push(u);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),n("event",i,r||{})}catch(s){Xe.error(s)}}function v1(n,e,t,i){async function r(s,o,a){try{s==="event"?await w1(n,e,t,o,a):s==="config"?await y1(n,e,t,i,o,a):n("set",o)}catch(c){Xe.error(c)}}return r}function I1(n,e,t,i,r){let s=function(...o){window[i].push(arguments)};return window[r]&&typeof window[r]=="function"&&(s=window[r]),window[r]=v1(s,n,e,t),{gtagCore:s,wrappedGtag:window[r]}}function E1(){const n=window.document.getElementsByTagName("script");for(const e of Object.values(n))if(e.src&&e.src.includes(Nb))return e;return null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T1={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},Wt=new _t("analytics","Analytics",T1);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b1=30,S1=1e3;class C1{constructor(e={},t=S1){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Ob=new C1;function k1(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function A1(n){var e;const{appId:t,apiKey:i}=n,r={method:"GET",headers:k1(i)},s=g1.replace("{app-id}",t),o=await fetch(s,r);if(o.status!==200&&o.status!==304){let a="";try{const c=await o.json();((e=c.error)===null||e===void 0?void 0:e.message)&&(a=c.error.message)}catch{}throw Wt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function R1(n,e=Ob,t){const{appId:i,apiKey:r,measurementId:s}=n.options;if(!i)throw Wt.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw Wt.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new O1;return setTimeout(async()=>{a.abort()},t!==void 0?t:p1),Db({appId:i,apiKey:r,measurementId:s},o,a,e)}async function Db(n,{throttleEndTimeMillis:e,backoffCount:t},i,r=Ob){const{appId:s,measurementId:o}=n;try{await N1(i,e)}catch(a){if(o)return Xe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}try{const a=await A1(n);return r.deleteThrottleMetadata(s),a}catch(a){if(!P1(a)){if(r.deleteThrottleMetadata(s),o)return Xe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a.message}]`),{appId:s,measurementId:o};throw a}const c=Number(a.customData.httpStatus)===503?Gc(t,r.intervalMillis,b1):Gc(t,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+c,backoffCount:t+1};return r.setThrottleMetadata(s,l),Xe.debug(`Calling attemptFetch again in ${c} millis`),Db(n,l,i,r)}}function N1(n,e){return new Promise((t,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(t,r);n.addEventListener(()=>{clearTimeout(s),i(Wt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function P1(n){if(!(n instanceof de)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class O1{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D1(){if(bt())try{await Ea()}catch(n){return Xe.warn(Wt.create("indexeddb-unavailable",{errorInfo:n}).message),!1}else return Xe.warn(Wt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function x1(n,e,t,i,r,s,o){var a;const c=R1(n);c.then(f=>{t[f.measurementId]=f.appId,n.options.measurementId&&f.measurementId!==n.options.measurementId&&Xe.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>Xe.error(f)),e.push(c);const l=D1().then(f=>{if(f)return i.getId()}),[u,h]=await Promise.all([c,l]);E1()||m1(s,u.measurementId),r("js",new Date);const d=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return d[f1]="firebase",d.update=!0,h!=null&&(d[d1]=h),r("config",u.measurementId,d),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(e){this.app=e}_delete(){return delete Vn[this.app.options.appId],Promise.resolve()}}let Vn={},Ey=[];const Ty={};let Vc="dataLayer",xb="gtag",by,Ya,Hd=!1;function L1(n){if(Hd)throw Wt.create("already-initialized");n.dataLayerName&&(Vc=n.dataLayerName),n.gtagName&&(xb=n.gtagName)}function F1(){const n=[];if(va()&&n.push("This is a browser extension environment."),zl()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,r)=>`(${r+1}) ${i}`).join(" "),t=Wt.create("invalid-analytics-context",{errorInfo:e});Xe.warn(t.message)}}function U1(n,e,t){F1();const i=n.options.appId;if(!i)throw Wt.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Xe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Wt.create("no-api-key");if(Vn[i]!=null)throw Wt.create("already-exists",{id:i});if(!Hd){_1(Vc);const{wrappedGtag:s,gtagCore:o}=I1(Vn,Ey,Ty,Vc,xb);Ya=s,by=o,Hd=!0}return Vn[i]=x1(n,Ey,Ty,e,by,Vc,t),new M1(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $1(n,e,t,i,r){if(r&&r.global){n("event",t,i);return}else{const s=await e,o=Object.assign(Object.assign({},i),{send_to:s});n("event",t,o)}}async function V1(n,e,t,i){if(i&&i.global)return n("set",{screen_name:t}),Promise.resolve();{const r=await e;n("config",r,{update:!0,screen_name:t})}}async function B1(n,e,t,i){if(i&&i.global)return n("set",{user_id:t}),Promise.resolve();{const r=await e;n("config",r,{update:!0,user_id:t})}}async function q1(n,e,t,i){if(i&&i.global){const r={};for(const s of Object.keys(t))r[`user_properties.${s}`]=t[s];return n("set",r),Promise.resolve()}else{const r=await e;n("config",r,{update:!0,user_properties:t})}}async function j1(n,e){const t=await n;window[`ga-disable-${t}`]=!e}async function K1(){if(va()||!zl()||!bt())return!1;try{return await Ea()}catch{return!1}}function W1(n,e,t){n=w(n),V1(Ya,Vn[n.app.options.appId],e,t).catch(i=>Xe.error(i))}function G1(n,e,t){n=w(n),B1(Ya,Vn[n.app.options.appId],e,t).catch(i=>Xe.error(i))}function H1(n,e,t){n=w(n),q1(Ya,Vn[n.app.options.appId],e,t).catch(i=>Xe.error(i))}function z1(n,e){n=w(n),j1(Vn[n.app.options.appId],e).catch(t=>Xe.error(t))}function Mb(n,e,t,i){n=w(n),$1(Ya,Vn[n.app.options.appId],e,t,i).catch(r=>Xe.error(r))}const Sy="@firebase/analytics",Cy="0.7.5";function Q1(){le(new q(Iy,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return U1(i,r,t)},"PUBLIC")),le(new q("analytics-internal",n,"PRIVATE")),Q(Sy,Cy),Q(Sy,Cy,"esm2017");function n(e){try{const t=e.getProvider(Iy).getImmediate();return{logEvent:(i,r,s)=>Mb(t,i,r,s)}}catch(t){throw Wt.create("interop-component-reg-failed",{reason:t})}}}Q1();const Y1="@firebase/analytics-compat",X1="0.1.6";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,i){Mb(this._delegate,e,t,i)}setCurrentScreen(e,t){W1(this._delegate,e,t)}setUserId(e,t){G1(this._delegate,e,t)}setUserProperties(e,t){H1(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){z1(this._delegate,e)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zd;(function(n){n.ADD_SHIPPING_INFO="add_shipping_info",n.ADD_PAYMENT_INFO="add_payment_info",n.ADD_TO_CART="add_to_cart",n.ADD_TO_WISHLIST="add_to_wishlist",n.BEGIN_CHECKOUT="begin_checkout",n.CHECKOUT_PROGRESS="checkout_progress",n.EXCEPTION="exception",n.GENERATE_LEAD="generate_lead",n.LOGIN="login",n.PAGE_VIEW="page_view",n.PURCHASE="purchase",n.REFUND="refund",n.REMOVE_FROM_CART="remove_from_cart",n.SCREEN_VIEW="screen_view",n.SEARCH="search",n.SELECT_CONTENT="select_content",n.SELECT_ITEM="select_item",n.SELECT_PROMOTION="select_promotion",n.SET_CHECKOUT_OPTION="set_checkout_option",n.SHARE="share",n.SIGN_UP="sign_up",n.TIMING_COMPLETE="timing_complete",n.VIEW_CART="view_cart",n.VIEW_ITEM="view_item",n.VIEW_ITEM_LIST="view_item_list",n.VIEW_PROMOTION="view_promotion",n.VIEW_SEARCH_RESULTS="view_search_results"})(zd||(zd={}));/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1=n=>{const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("analytics").getImmediate();return new Lb(e,t)};function Z1(){const n={Analytics:Lb,settings:L1,isSupported:K1,EventName:zd};je.INTERNAL.registerComponent(new q("analytics-compat",J1,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}Z1();je.registerVersion(Y1,X1);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fb=new Map,eF={activated:!1,tokenObservers:[]},tF={initialized:!1,enabled:!1};function Ue(n){return Fb.get(n)||eF}function sn(n,e){Fb.set(n,e)}function Ku(){return tF}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sg="https://content-firebaseappcheck.googleapis.com/v1beta",nF="exchangeRecaptchaToken",iF="exchangeRecaptchaEnterpriseToken",rF="exchangeDebugToken",ky={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},sF=24*60*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new we,await aF(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new we,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function aF(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cF={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ft=new _t("appCheck","AppCheck",cF);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(n=!1){var e;return n?(e=self.grecaptcha)===null||e===void 0?void 0:e.enterprise:self.grecaptcha}function Ub(n){if(!Ue(n).activated)throw ft.create("use-before-activation",{appName:n.name})}function lF(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function Cg(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),i=Math.floor((e-t*3600*24)/3600),r=Math.floor((e-t*3600*24-i*3600)/60),s=e-t*3600*24-i*3600-r*60;let o="";return t&&(o+=Ic(t)+"d:"),i&&(o+=Ic(i)+"h:"),o+=Ic(r)+"m:"+Ic(s)+"s",o}function Ic(n){return n===0?"00":n>=10?n.toString():"0"+n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kg({url:n,body:e},t){const i={"Content-Type":"application/json"},r=t.getImmediate({optional:!0});r&&(i["X-Firebase-Client"]=r.getPlatformInfoString());const s={method:"POST",body:JSON.stringify(e),headers:i};let o;try{o=await fetch(n,s)}catch(h){throw ft.create("fetch-network-error",{originalErrorMessage:h.message})}if(o.status!==200)throw ft.create("fetch-status-error",{httpStatus:o.status});let a;try{a=await o.json()}catch(h){throw ft.create("fetch-parse-error",{originalErrorMessage:h.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw ft.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const l=Number(c[1])*1e3,u=Date.now();return{token:a.attestationToken,expireTimeMillis:u+l,issuedAtTimeMillis:u}}function uF(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${Sg}/projects/${t}/apps/${i}:${nF}?key=${r}`,body:{recaptcha_token:e}}}function hF(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${Sg}/projects/${t}/apps/${i}:${iF}?key=${r}`,body:{recaptcha_enterprise_token:e}}}function dF(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${Sg}/projects/${t}/apps/${i}:${rF}?key=${r}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fF="firebase-app-check-database",pF=1,ia="firebase-app-check-store",$b="debug-token";let Ec=null;function Vb(){return Ec||(Ec=new Promise((n,e)=>{try{const t=indexedDB.open(fF,pF);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(ft.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{const r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(ia,{keyPath:"compositeKey"})}}}catch(t){e(ft.create("storage-open",{originalErrorMessage:t.message}))}}),Ec)}function gF(n){return qb(jb(n))}function mF(n,e){return Bb(jb(n),e)}function _F(n){return Bb($b,n)}function yF(){return qb($b)}async function Bb(n,e){const i=(await Vb()).transaction(ia,"readwrite"),s=i.objectStore(ia).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var l;a(ft.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})}async function qb(n){const t=(await Vb()).transaction(ia,"readonly"),r=t.objectStore(ia).get(n);return new Promise((s,o)=>{r.onsuccess=a=>{const c=a.target.result;s(c?c.value:void 0)},t.onerror=a=>{var c;o(ft.create("storage-get",{originalErrorMessage:(c=a.target.error)===null||c===void 0?void 0:c.message}))}})}function jb(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ra=new Cn("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wF(n){if(bt()){let e;try{e=await gF(n)}catch(t){ra.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function Ay(n,e){return bt()?mF(n,e).catch(t=>{ra.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function vF(){let n;try{n=await yF()}catch{}if(n)return n;{const e=lF();return _F(e).catch(t=>ra.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(){return Ku().enabled}async function Wb(){const n=Ku();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function IF(){const n=h0(),e=Ku();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new we;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(vF())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EF={error:"UNKNOWN_ERROR"};function TF(n){return Wl.encodeString(JSON.stringify(n),!1)}async function Il(n,e=!1){const t=n.app;Ub(t);const i=Ue(t);let r=i.token,s;if(!r){const c=await i.cachedTokenPromise;c&&El(c)&&(r=c)}if(!e&&r&&El(r))return{token:r.token};let o=!1;if(Kb()){i.exchangeTokenPromise||(i.exchangeTokenPromise=kg(dF(t,await Wb()),n.platformLoggerProvider).then(l=>(i.exchangeTokenPromise=void 0,l)),o=!0);const c=await i.exchangeTokenPromise;return await Ay(t,c),sn(t,Object.assign(Object.assign({},i),{token:c})),{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().then(c=>(i.exchangeTokenPromise=void 0,c)),o=!0),r=await i.exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?ra.warn(c.message):ra.error(c),s=c}let a;return r?(a={token:r.token},sn(t,Object.assign(Object.assign({},i),{token:r})),await Ay(t,r)):a=SF(s),o&&Gb(t,a),a}function Ag(n,e,t,i){const{app:r}=n,s=Ue(r),o={next:t,error:i,type:e};if(sn(r,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&El(s.token)){const a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Ry(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Ry(n))}function Rg(n,e){const t=Ue(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),sn(n,Object.assign(Object.assign({},t),{tokenObservers:i}))}function Ry(n){const{app:e}=n,t=Ue(e);let i=t.tokenRefresher;i||(i=bF(n),sn(e,Object.assign(Object.assign({},t),{tokenRefresher:i}))),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function bF(n){const{app:e}=n;return new oF(async()=>{const t=Ue(e);let i;if(t.token?i=await Il(n,!0):i=await Il(n),i.error)throw i.error},()=>!0,()=>{const t=Ue(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},ky.RETRIAL_MIN_WAIT,ky.RETRIAL_MAX_WAIT)}function Gb(n,e){const t=Ue(n).tokenObservers;for(const i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function El(n){return n.expireTimeMillis-Date.now()>0}function SF(n){return{token:TF(EF),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CF{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){const{tokenObservers:e}=Ue(this.app);for(const t of e)Rg(this.app,t.next);return Promise.resolve()}}function kF(n,e){return new CF(n,e)}function AF(n){return{getToken:e=>Il(n,e),addTokenListener:e=>Ag(n,"INTERNAL",e),removeTokenListener:e=>Rg(n.app,e)}}const RF="@firebase/app-check",NF="0.5.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PF="https://www.google.com/recaptcha/api.js",OF="https://www.google.com/recaptcha/enterprise.js";function DF(n,e){const t=Ue(n),i=new we;sn(n,Object.assign(Object.assign({},t),{reCAPTCHAState:{initialized:i}}));const r=Hb(n),s=vl(!1);return s?Tl(n,e,s,r,i):LF(()=>{const o=vl(!1);if(!o)throw new Error("no recaptcha");Tl(n,e,o,r,i)}),i.promise}function xF(n,e){const t=Ue(n),i=new we;sn(n,Object.assign(Object.assign({},t),{reCAPTCHAState:{initialized:i}}));const r=Hb(n),s=vl(!0);return s?Tl(n,e,s,r,i):FF(()=>{const o=vl(!0);if(!o)throw new Error("no recaptcha");Tl(n,e,o,r,i)}),i.promise}function Tl(n,e,t,i,r){t.ready(()=>{MF(n,e,t,i),r.resolve(t)})}function Hb(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function zb(n){Ub(n);const t=await Ue(n).reCAPTCHAState.initialized.promise;return new Promise((i,r)=>{const s=Ue(n).reCAPTCHAState;t.ready(()=>{i(t.execute(s.widgetId,{action:"fire_app_check"}))})})}function MF(n,e,t,i){const r=t.render(i,{sitekey:e,size:"invisible"}),s=Ue(n);sn(n,Object.assign(Object.assign({},s),{reCAPTCHAState:Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:r})}))}function LF(n){const e=document.createElement("script");e.src=PF,e.onload=n,document.head.appendChild(e)}function FF(n){const e=document.createElement("script");e.src=OF,e.onload=n,document.head.appendChild(e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e;Yb(this._throttleData);const t=await zb(this._app).catch(r=>{throw ft.create("recaptcha-error")});let i;try{i=await kg(uF(this._app,t),this._platformLoggerProvider)}catch(r){throw r.code==="fetch-status-error"?(this._throttleData=Qb(Number((e=r.customData)===null||e===void 0?void 0:e.httpStatus),this._throttleData),ft.create("throttled",{time:Cg(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):r}return this._throttleData=null,i}initialize(e){this._app=e,this._platformLoggerProvider=An(e,"platform-logger"),DF(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof sa?this._siteKey===e._siteKey:!1}}class Wu{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e;Yb(this._throttleData);const t=await zb(this._app).catch(r=>{throw ft.create("recaptcha-error")});let i;try{i=await kg(hF(this._app,t),this._platformLoggerProvider)}catch(r){throw r.code==="fetch-status-error"?(this._throttleData=Qb(Number((e=r.customData)===null||e===void 0?void 0:e.httpStatus),this._throttleData),ft.create("throttled",{time:Cg(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):r}return this._throttleData=null,i}initialize(e){this._app=e,this._platformLoggerProvider=An(e,"platform-logger"),xF(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Wu?this._siteKey===e._siteKey:!1}}class oa{constructor(e){this._customProviderOptions=e}async getToken(){const e=await this._customProviderOptions.getToken(),t=g0(e.token),i=t!==null&&t<Date.now()&&t>0?t*1e3:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:i})}initialize(e){this._app=e}isEqual(e){return e instanceof oa?this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString():!1}}function Qb(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+sF,httpStatus:n};{const t=e?e.backoffCount:0,i=Gc(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+i,httpStatus:n}}}function Yb(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw ft.create("throttled",{time:Cg(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UF(n=eu(),e){n=w(n);const t=An(n,"app-check");if(Ku().initialized||IF(),Kb()&&Wb().then(r=>console.log(`App Check debug token: ${r}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(s.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&s.provider.isEqual(e.provider))return r;throw ft.create("already-initialized",{appName:n.name})}const i=t.initialize({options:e});return $F(n,e.provider,e.isTokenAutoRefreshEnabled),Ue(n).isTokenAutoRefreshEnabled&&Ag(i,"INTERNAL",()=>{}),i}function $F(n,e,t){const i=Ue(n),r=Object.assign(Object.assign({},i),{activated:!0});r.provider=e,r.cachedTokenPromise=wF(n).then(s=>(s&&El(s)&&(sn(n,Object.assign(Object.assign({},Ue(n)),{token:s})),Gb(n,{token:s.token})),s)),r.isTokenAutoRefreshEnabled=t===void 0?n.automaticDataCollectionEnabled:t,sn(n,r),r.provider.initialize(n)}function VF(n,e){const t=n.app,i=Ue(t);i.tokenRefresher&&(e===!0?i.tokenRefresher.start():i.tokenRefresher.stop()),sn(t,Object.assign(Object.assign({},i),{isTokenAutoRefreshEnabled:e}))}async function BF(n,e){const t=await Il(n,e);if(t.error)throw t.error;return{token:t.token}}function qF(n,e,t,i){let r=()=>{},s=()=>{};return e.next!=null?r=e.next.bind(e):r=e,e.error!=null?s=e.error.bind(e):t&&(s=t),Ag(n,"EXTERNAL",r,s),()=>Rg(n.app,r)}const jF="app-check",Ny="app-check-internal";function KF(){le(new q(jF,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("platform-logger");return kF(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Ny).initialize()})),le(new q(Ny,n=>{const e=n.getProvider("app-check").getImmediate();return AF(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Q(RF,NF)}KF();const WF="@firebase/app-check-compat",GF="0.2.3";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HF={["use-before-activation"]:"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."},jh=new _t("appCheck","AppCheck",HF);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zF{constructor(e){this.app=e}activate(e,t){let i;typeof e=="string"?i=new sa(e):e instanceof Wu||e instanceof sa||e instanceof oa?i=e:i=new oa({getToken:e.getToken}),this._delegate=UF(this.app,{provider:i,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw jh.create("use-before-activation",{appName:this.app.name});VF(this._delegate,e)}getToken(e){if(!this._delegate)throw jh.create("use-before-activation",{appName:this.app.name});return BF(this._delegate,e)}onTokenChanged(e,t,i){if(!this._delegate)throw jh.create("use-before-activation",{appName:this.app.name});return qF(this._delegate,e,t)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QF=n=>{const e=n.getProvider("app-compat").getImmediate();return new zF(e)};function YF(){je.INTERNAL.registerComponent(new q("appCheck-compat",QF,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Wu,ReCaptchaV3Provider:sa,CustomProvider:oa}))}YF();je.registerVersion(WF,GF);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pr(){return window}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XF=2e3;async function JF(n,e,t){var i;const{BuildInfo:r}=pr();nn(e.sessionId,"AuthEvent did not contain a session ID");const s=await iU(e.sessionId),o={};return $s()?o.ibi=r.packageName:Sa()?o.apn=r.packageName:Me(n,"operation-not-supported-in-this-environment"),r.displayName&&(o.appDisplayName=r.displayName),o.sessionId=s,vd(n,t,e.type,void 0,(i=e.eventId)!==null&&i!==void 0?i:void 0,o)}async function ZF(n){const{BuildInfo:e}=pr(),t={};$s()?t.iosBundleId=e.packageName:Sa()?t.androidPackageName=e.packageName:Me(n,"operation-not-supported-in-this-environment"),await _I(n,t)}function eU(n){const{cordova:e}=pr();return new Promise(t=>{e.plugins.browsertab.isAvailable(i=>{let r=null;i?e.plugins.browsertab.openUrl(n):r=e.InAppBrowser.open(n,QA()?"_blank":"_system","location=yes"),t(r)})})}async function tU(n,e,t){const{cordova:i}=pr();let r=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var h;s();const d=(h=i.plugins.browsertab)===null||h===void 0?void 0:h.close;typeof d=="function"&&d(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function l(){a||(a=window.setTimeout(()=>{o(ze(n,"redirect-cancelled-by-user"))},XF))}function u(){(document==null?void 0:document.visibilityState)==="visible"&&l()}e.addPassiveListener(c),document.addEventListener("resume",l,!1),Sa()&&document.addEventListener("visibilitychange",u,!1),r=()=>{e.removePassiveListener(c),document.removeEventListener("resume",l,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}})}finally{r()}}function nU(n){var e,t,i,r,s,o,a,c,l,u;const h=pr();E(typeof((e=h==null?void 0:h.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),E(typeof((t=h==null?void 0:h.BuildInfo)===null||t===void 0?void 0:t.packageName)!="undefined",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),E(typeof((s=(r=(i=h==null?void 0:h.cordova)===null||i===void 0?void 0:i.plugins)===null||r===void 0?void 0:r.browsertab)===null||s===void 0?void 0:s.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),E(typeof((c=(a=(o=h==null?void 0:h.cordova)===null||o===void 0?void 0:o.plugins)===null||a===void 0?void 0:a.browsertab)===null||c===void 0?void 0:c.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),E(typeof((u=(l=h==null?void 0:h.cordova)===null||l===void 0?void 0:l.InAppBrowser)===null||u===void 0?void 0:u.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function iU(n){const e=rU(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")}function rU(n){if(nn(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder!="undefined")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++)t[i]=n.charCodeAt(i);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sU=20;class oU extends gI{constructor(){super(...arguments);this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function aU(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:uU(),postBody:null,tenantId:n.tenantId,error:ze(n,"no-auth-event")}}function cU(n,e){return Qd()._set(Yd(n),e)}async function Py(n){const e=await Qd()._get(Yd(n));return e&&await Qd()._remove(Yd(n)),e}function lU(n,e){var t,i;const r=dU(e);if(r.includes("/__/auth/callback")){const s=Bc(r),o=s.firebaseError?hU(decodeURIComponent(s.firebaseError)):null,a=(i=(t=o==null?void 0:o.code)===null||t===void 0?void 0:t.split("auth/"))===null||i===void 0?void 0:i[1],c=a?ze(a):null;return c?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:r,postBody:null}}return null}function uU(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<sU;t++){const i=Math.floor(Math.random()*e.length);n.push(e.charAt(i))}return n.join("")}function Qd(){return Nt(cu)}function Yd(n){return zi("authEvent",n.config.apiKey,n.name)}function hU(n){try{return JSON.parse(n)}catch{return null}}function dU(n){const e=Bc(n),t=e.link?decodeURIComponent(e.link):void 0,i=Bc(t).link,r=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return Bc(r).link||r||i||t||n}function Bc(n){if(!(n==null?void 0:n.includes("?")))return{};const[e,...t]=n.split("?");return zr(t.join("?"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fU=500;class pU{constructor(){this._redirectPersistence=gi,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=du}async _initialize(e){const t=e._key();let i=this.eventManagers.get(t);return i||(i=new oU(e),this.eventManagers.set(t,i),this.attachCallbackListeners(e,i)),i}_openPopup(e){Me(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,i,r){nU(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),KN(),await this._originValidation(e);const o=aU(e,i,r);await cU(e,o);const a=await JF(e,o,t),c=await eU(a);return tU(e,s,c)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ZF(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:i,handleOpenURL:r,BuildInfo:s}=pr(),o=setTimeout(async()=>{await Py(e),t.onEvent(Oy())},fU),a=async u=>{clearTimeout(o);const h=await Py(e);let d=null;h&&(u==null?void 0:u.url)&&(d=lU(h,u.url)),t.onEvent(d||Oy())};typeof i!="undefined"&&typeof i.subscribe=="function"&&i.subscribe(null,a);const c=r,l=`${s.packageName.toLowerCase()}://`;pr().handleOpenURL=async u=>{if(u.toLowerCase().startsWith(l)&&a({url:u}),typeof c=="function")try{c(u)}catch(h){console.error(h)}}}}const gU=pU;function Oy(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ze("no-auth-event")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mU(n,e){Le(n)._logFramework(e)}var _U="@firebase/auth-compat",yU="0.2.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wU=1e3;function bl(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function vU(){return bl()==="http:"||bl()==="https:"}function Xb(n=te()){return!!((bl()==="file:"||bl()==="ionic:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function IU(){return Ia()||Of()}function EU(){return Df()&&(document==null?void 0:document.documentMode)===11}function TU(n=te()){return/Edge\/\d+/.test(n)}function bU(n=te()){return EU()||TU(n)}function Jb(){try{const n=self.localStorage,e=Ca();if(n)return n.setItem(e,"1"),n.removeItem(e),bU()?bt():!0}catch{return Ng()&&bt()}return!1}function Ng(){return typeof global!="undefined"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Kh(){return(vU()||va()||Xb())&&!IU()&&Jb()&&!Ng()}function Zb(){return Xb()&&typeof document!="undefined"}async function SU(){return Zb()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},wU);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function CU(){return typeof window!="undefined"?window:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const At={LOCAL:"local",NONE:"none",SESSION:"session"},ao=E,eS="persistence";function kU(n,e){if(ao(Object.values(At).includes(e),n,"invalid-persistence-type"),Ia()){ao(e!==At.SESSION,n,"unsupported-persistence-type");return}if(Of()){ao(e===At.NONE,n,"unsupported-persistence-type");return}if(Ng()){ao(e===At.NONE||e===At.LOCAL&&bt(),n,"unsupported-persistence-type");return}ao(e===At.NONE||Jb(),n,"unsupported-persistence-type")}async function Xd(n){await n._initializationPromise;const e=tS(),t=zi(eS,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function AU(n,e){const t=tS();if(!t)return[];const i=zi(eS,n,e);switch(t.getItem(i)){case At.NONE:return[hs];case At.LOCAL:return[fs,gi];case At.SESSION:return[gi];default:return[]}}function tS(){var n;try{return((n=CU())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RU=E;class si{constructor(){this.browserResolver=Nt(yI),this.cordovaResolver=Nt(gU),this.underlyingResolver=null,this._redirectPersistence=gi,this._completeRedirectFn=du}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,i,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,i,r)}async _openRedirect(e,t,i,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,i,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Zb()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return RU(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await SU();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nS(n){return n.unwrap()}function NU(n){return n.wrapped()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PU(n){return iS(n)}function OU(n,e){var t;const i=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if(e.code==="auth/multi-factor-auth-required"){const r=e;r.resolver=new DU(n,zR(n,e))}else if(i){const r=iS(e),s=e;r&&(s.credential=r,s.tenantId=i.tenantId||void 0,s.email=i.email||void 0,s.phoneNumber=i.phoneNumber||void 0)}}function iS(n){const{_tokenResponse:e}=n instanceof de?n.customData:n;if(!e)return null;if(!(n instanceof de)&&"temporaryProof"in e&&"phoneNumber"in e)return en.credentialFromResult(n);const t=e.providerId;if(!t||t===io.PASSWORD)return null;let i;switch(t){case io.GOOGLE:i=cn;break;case io.FACEBOOK:i=an;break;case io.GITHUB:i=ln;break;case io.TWITTER:i=un;break;default:const{oauthIdToken:r,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=e;return!s&&!o&&!r&&!a?null:a?t.startsWith("saml.")?ds._create(t,a):vn._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:r,accessToken:s}):new ts(t).credential({idToken:r,accessToken:s,rawNonce:c})}return n instanceof de?i.credentialFromError(n):i.credentialFromResult(n)}function wt(n,e){return e.catch(t=>{throw t instanceof de&&OU(n,t),t}).then(t=>{const i=t.operationType,r=t.user;return{operationType:i,credential:PU(t),additionalUserInfo:HR(t),user:Ln.getOrCreate(r)}})}async function Jd(n,e){const t=await e;return{verificationId:t.verificationId,confirm:i=>wt(n,t.confirm(i))}}class DU{constructor(e,t){this.resolver=t,this.auth=NU(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return wt(nS(this.auth),this.resolver.resolveSignIn(e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this._delegate=e,this.multiFactor=JR(e)}static getOrCreate(e){return Ln.USER_MAP.has(e)||Ln.USER_MAP.set(e,new Ln(e)),Ln.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return wt(this.auth,Xv(this._delegate,e))}async linkWithPhoneNumber(e,t){return Jd(this.auth,PN(this._delegate,e,t))}async linkWithPopup(e){return wt(this.auth,VN(this._delegate,e,si))}async linkWithRedirect(e){return await Xd(Le(this.auth)),QN(this._delegate,e,si)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return wt(this.auth,Jv(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Jd(this.auth,ON(this._delegate,e,t))}reauthenticateWithPopup(e){return wt(this.auth,$N(this._delegate,e,si))}async reauthenticateWithRedirect(e){return await Xd(Le(this.auth)),HN(this._delegate,e,si)}sendEmailVerification(e){return LR(this._delegate,e)}async unlink(e){return await ER(this._delegate,e),this}updateEmail(e){return VR(this._delegate,e)}updatePassword(e){return BR(this._delegate,e)}updatePhoneNumber(e){return DN(this._delegate,e)}updateProfile(e){return $R(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return FR(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Ln.USER_MAP=new WeakMap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co=E;class Zd{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:i}=e.options;co(i,"invalid-api-key",{appName:e.name}),co(i,"invalid-api-key",{appName:e.name});const r=typeof window!="undefined"?si:void 0;this._delegate=t.initialize({options:{persistence:xU(i,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(RA),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ln.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){eR(this._delegate,e,t)}applyActionCode(e){return kR(this._delegate,e)}checkActionCode(e){return Zv(this._delegate,e)}confirmPasswordReset(e,t){return CR(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return wt(this._delegate,RR(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return MR(this._delegate,e)}isSignInWithEmailLink(e){return OR(this._delegate,e)}async getRedirectResult(){co(Kh(),this._delegate,"operation-not-supported-in-this-environment");const e=await XN(this._delegate,si);return e?wt(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){mU(this._delegate,e)}onAuthStateChanged(e,t,i){const{next:r,error:s,complete:o}=Dy(e,t,i);return this._delegate.onAuthStateChanged(r,s,o)}onIdTokenChanged(e,t,i){const{next:r,error:s,complete:o}=Dy(e,t,i);return this._delegate.onIdTokenChanged(r,s,o)}sendSignInLinkToEmail(e,t){return PR(this._delegate,e,t)}sendPasswordResetEmail(e,t){return SR(this._delegate,e,t||void 0)}async setPersistence(e){kU(this._delegate,e);let t;switch(e){case At.SESSION:t=gi;break;case At.LOCAL:t=await Nt(fs)._isAvailable()?fs:cu;break;case At.NONE:t=hs;break;default:return Me("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return wt(this._delegate,IR(this._delegate))}signInWithCredential(e){return wt(this._delegate,su(this._delegate,e))}signInWithCustomToken(e){return wt(this._delegate,bR(this._delegate,e))}signInWithEmailAndPassword(e,t){return wt(this._delegate,NR(this._delegate,e,t))}signInWithEmailLink(e,t){return wt(this._delegate,DR(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Jd(this._delegate,NN(this._delegate,e,t))}async signInWithPopup(e){return co(Kh(),this._delegate,"operation-not-supported-in-this-environment"),wt(this._delegate,UN(this._delegate,e,si))}async signInWithRedirect(e){return co(Kh(),this._delegate,"operation-not-supported-in-this-environment"),await Xd(this._delegate),WN(this._delegate,e,si)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return AR(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}Zd.Persistence=At;function Dy(n,e,t){let i=n;typeof n!="function"&&({next:i,error:e,complete:t}=n);const r=i;return{next:o=>r(o&&Ln.getOrCreate(o)),error:e,complete:t}}function xU(n,e){const t=AU(n,e);if(typeof self!="undefined"&&!t.includes(fs)&&t.push(fs),typeof window!="undefined")for(const i of[cu,gi])t.includes(i)||t.push(i);return t.includes(hs)||t.push(hs),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(){this.providerId="phone",this._delegate=new en(nS(je.auth()))}static credential(e,t){return en.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Pg.PHONE_SIGN_IN_METHOD=en.PHONE_SIGN_IN_METHOD;Pg.PROVIDER_ID=en.PROVIDER_ID;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MU=E;class LU{constructor(e,t,i=je.app()){var r;MU((r=i.options)===null||r===void 0?void 0:r.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new AN(e,t,i.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FU="auth-compat";function UU(n){n.INTERNAL.registerComponent(new q(FU,e=>{const t=e.getProvider("app-compat").getImmediate(),i=e.getProvider("auth");return new Zd(t,i)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Vr.EMAIL_SIGNIN,PASSWORD_RESET:Vr.PASSWORD_RESET,RECOVER_EMAIL:Vr.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Vr.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Vr.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Vr.VERIFY_EMAIL}},EmailAuthProvider:Si,FacebookAuthProvider:an,GithubAuthProvider:ln,GoogleAuthProvider:cn,OAuthProvider:ts,SAMLAuthProvider:zc,PhoneAuthProvider:Pg,PhoneMultiFactorGenerator:wI,RecaptchaVerifier:LU,TwitterAuthProvider:un,Auth:Zd,AuthCredential:Vs,Error:de}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(_U,yU)}UU(je);const xy="@firebase/database",My="0.12.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rS="";function sS(n){rS=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ve(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:xo(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VU{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return xt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oS=function(n){try{if(typeof window!="undefined"&&typeof window[n]!="undefined"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new $U(e)}}catch{}return new VU},Ki=oS("localStorage"),ef=oS("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const os=new Cn("@firebase/database"),aS=function(){let n=1;return function(){return n++}}(),cS=function(n){const e=I0(n),t=new y0;t.update(e);const i=t.digest();return Wl.encodeByteArray(i)},Xa=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=Xa.apply(null,i):typeof i=="object"?e+=ve(i):e+=i,e+=" "}return e};let Xi=null,Ly=!0;const lS=function(n,e){T(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(os.logLevel=x.VERBOSE,Xi=os.log.bind(os),e&&ef.set("logging_enabled",!0)):typeof n=="function"?Xi=n:(Xi=null,ef.remove("logging_enabled"))},Ae=function(...n){if(Ly===!0&&(Ly=!1,Xi===null&&ef.get("logging_enabled")===!0&&lS(!0)),Xi){const e=Xa.apply(null,n);Xi(e)}},Ja=function(n){return function(...e){Ae(n,...e)}},tf=function(...n){const e="FIREBASE INTERNAL ERROR: "+Xa(...n);os.error(e)},En=function(...n){const e=`FIREBASE FATAL ERROR: ${Xa(...n)}`;throw os.error(e),new Error(e)},gt=function(...n){const e="FIREBASE WARNING: "+Xa(...n);os.warn(e)},BU=function(){typeof window!="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&gt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Gu=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},qU=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Hn="[MIN_NAME]",Tn="[MAX_NAME]",Lr=function(n,e){if(n===e)return 0;if(n===Hn||e===Tn)return-1;if(e===Hn||n===Tn)return 1;{const t=Sl(n),i=Sl(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},jU=function(n,e){return n===e?0:n<e?-1:1},lo=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ve(e))},Og=function(n){if(typeof n!="object"||n===null)return ve(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=ve(e[i]),t+=":",t+=Og(n[e[i]]);return t+="}",t},uS=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function $e(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const hS=function(n){T(!Gu(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));const l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(r?1:0),l.reverse();const u=l.join("");let h="";for(c=0;c<64;c+=8){let d=parseInt(u.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},KU=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},WU=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function GU(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const HU=new RegExp("^-?(0*)\\d{1,10}$"),dS=-2147483648,Dg=2147483647,Sl=function(n){if(HU.test(n)){const e=Number(n);if(e>=dS&&e<=Dg)return e}return null},Js=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw gt("Exception was thrown by user callback.",t),e},Math.floor(0))}},zU=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ko=function(n,e){const t=setTimeout(n,e);return typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QU{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){gt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ae("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',gt(e)}}class as{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}as.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xg="5",fS="v",pS="s",gS="r",mS="f",_S=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,yS="ls",XU="p",nf="ac",wS="websocket",vS="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(e,t,i,r,s=!1,o="",a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ki.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ki.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function JU(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ES(n,e,t){T(typeof e=="string","typeof type must == string"),T(typeof t=="object","typeof params must == object");let i;if(e===wS)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===vS)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);JU(n)&&(t.ns=n.namespace);const r=[];return $e(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{constructor(){this.counters_={}}incrementCounter(e,t=1){xt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return s0(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh={},Gh={};function Mg(n){const e=n.toString();return Wh[e]||(Wh[e]=new ZU),Wh[e]}function e$(n,e){const t=n.toString();return Gh[t]||(Gh[t]=e()),Gh[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t${constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&Js(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy="start",n$="close",i$="pLPCommand",r$="pRTLPCB",TS="id",bS="pw",SS="ser",s$="cb",o$="seg",a$="ts",c$="d",l$="dframe",CS=1870,kS=30,u$=CS-kS,h$=25e3,d$=3e4;class Xr{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ja(e),this.stats_=Mg(t),this.urlFn=c=>(this.appCheckToken&&(c[nf]=this.appCheckToken),ES(t,vS,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new t$(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(d$)),qU(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Lg((...s)=>{const[o,a,c,l,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Fy)this.id=a,this.password=c;else if(o===n$)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[Fy]="t",i[SS]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[s$]=this.scriptTagHolder.uniqueCallbackIdentifier),i[fS]=xg,this.transportSessionId&&(i[pS]=this.transportSessionId),this.lastSessionId&&(i[yS]=this.lastSessionId),this.applicationId&&(i[XU]=this.applicationId),this.appCheckToken&&(i[nf]=this.appCheckToken),typeof location!="undefined"&&location.hostname&&_S.test(location.hostname)&&(i[gS]=mS);const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Xr.forceAllow_=!0}static forceDisallow(){Xr.forceDisallow_=!0}static isAvailable(){return Xr.forceAllow_?!0:!Xr.forceDisallow_&&typeof document!="undefined"&&document.createElement!=null&&!KU()&&!WU()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Gl(t),r=uS(i,u$);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[l$]="t",i[TS]=e,i[bS]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ve(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Lg{constructor(e,t,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=aS(),window[i$+this.uniqueCallbackIdentifier]=e,window[r$+this.uniqueCallbackIdentifier]=t,this.myIFrame=Lg.createIFrame_();let s="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"){const a=document.domain;s='<script>document.domain="'+a+'";<\/script>'}const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ae("frame writing exception"),a.stack&&Ae(a.stack),Ae(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ae("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[TS]=this.myID,e[bS]=this.myPW,e[SS]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+kS+i.length<=CS;){const o=this.pendingSegs.shift();i=i+"&"+o$+r+"="+o.seg+"&"+a$+r+"="+o.ts+"&"+c$+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(h$)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Ae("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f$=16384,p$=45e3;let Cl=null;typeof MozWebSocket!="undefined"?Cl=MozWebSocket:typeof WebSocket!="undefined"&&(Cl=WebSocket);class Xt{constructor(e,t,i,r,s,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ja(this.connId),this.stats_=Mg(t),this.connURL=Xt.connectionURL_(t,o,a,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,r){const s={};return s[fS]=xg,typeof location!="undefined"&&location.hostname&&_S.test(location.hostname)&&(s[gS]=mS),t&&(s[pS]=t),i&&(s[yS]=i),r&&(s[nf]=r),ES(e,wS,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ki.set("previous_websocket_failure",!0);try{if(!mv()){const i={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new Cl(this.connURL,[],i)}}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Xt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator!="undefined"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Cl!==null&&!Xt.forceDisallow_}static previouslyFailed(){return Ki.isInMemoryStorage||Ki.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ki.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=xo(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(T(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=ve(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=uS(t,f$);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(p$))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Xt.responsesRequiredToBeHealthy=2;Xt.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Xr,Xt]}initTransports_(e){const t=Xt&&Xt.isAvailable();let i=t&&!Xt.previouslyFailed();if(e.webSocketOnly&&(t||gt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Xt];else{const r=this.transports_=[];for(const s of Fg.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g$=6e4,m$=5e3,_$=10*1024,y$=100*1024,Hh="t",Uy="d",w$="s",$y="r",v$="e",Vy="o",By="a",qy="n",jy="p",I$="h";class E${constructor(e,t,i,r,s,o,a,c,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ja("c:"+this.id+":"),this.transportManager_=new Fg(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ko(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>y$?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>_$?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Hh in e){const t=e[Hh];t===By?this.upgradeIfSecondaryHealthy_():t===$y?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Vy&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=lo("t",e),i=lo("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:jy,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:By,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:qy,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=lo("t",e),i=lo("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=lo(Hh,e);if(Uy in e){const i=e[Uy];if(t===I$)this.onHandshake_(i);else if(t===qy){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===w$?this.onConnectionShutdown_(i):t===$y?this.onReset_(i):t===v$?tf("Server Error: "+i):t===Vy?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tf("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),xg!==i&&gt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ko(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(g$))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ko(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(m$))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:jy,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ki.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RS{constructor(e){this.allowedEvents_=e,this.listeners_={},T(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){T(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl extends RS{constructor(){super(["online"]);this.online_=!0,typeof window!="undefined"&&typeof window.addEventListener!="undefined"&&!Hl()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new kl}getInitialEvent(e){return T(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ky=32,Wy=768;class H{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function K(){return new H("")}function M(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ii(n){return n.pieces_.length-n.pieceNum_}function Y(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new H(n.pieces_,e)}function Ug(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function T$(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function aa(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function NS(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new H(e,0)}function ie(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof H)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new H(t,0)}function L(n){return n.pieceNum_>=n.pieces_.length}function pt(n,e){const t=M(n),i=M(e);if(t===null)return e;if(t===i)return pt(Y(n),Y(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function b$(n,e){const t=aa(n,0),i=aa(e,0);for(let r=0;r<t.length&&r<i.length;r++){const s=Lr(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function $g(n,e){if(Ii(n)!==Ii(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Vt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(Ii(n)>Ii(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class S${constructor(e,t){this.errorPrefix_=t,this.parts_=aa(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ql(this.parts_[i]);PS(this)}}function C$(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ql(e),PS(n)}function k$(n){const e=n.parts_.pop();n.byteLength_-=Ql(e),n.parts_.length>0&&(n.byteLength_-=1)}function PS(n){if(n.byteLength_>Wy)throw new Error(n.errorPrefix_+"has a key path longer than "+Wy+" bytes ("+n.byteLength_+").");if(n.parts_.length>Ky)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ky+") or object contains a cycle "+xi(n))}function xi(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg extends RS{constructor(){super(["visible"]);let e,t;typeof document!="undefined"&&typeof document.addEventListener!="undefined"&&(typeof document.hidden!="undefined"?(t="visibilitychange",e="hidden"):typeof document.mozHidden!="undefined"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden!="undefined"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden!="undefined"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new Vg}getInitialEvent(e){return T(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uo=1e3,A$=60*5*1e3,R$=3*1e3,Gy=30*1e3,N$=1.3,P$=3e4,O$="server_kill",Hy=3;class Bn extends AS{constructor(e,t,i,r,s,o,a,c){super();if(this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Bn.nextPersistentConnectionId_++,this.log_=Ja("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=uo,this.maxReconnectDelay_=A$,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!mv())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Vg.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&kl.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const r=++this.requestNumber_,s={r,a:e,b:t};this.log_(ve(s)),T(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[r]=i)}get(e){this.initConnection_();const t=new we,i={p:e._path.toString(),q:e._queryObject},r={action:"g",request:i,onComplete:o=>{const a=o.d;o.s==="ok"?(this.onDataUpdate_(i.p,a,!1,null),t.resolve(a)):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const o=this.outstandingGets_[s];o===void 0||r!==o||(delete this.outstandingGets_[s],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),this.log_("get "+s+" timed out on connection"),t.reject(new Error("Client is offline.")))},R$),this.connected_&&this.sendGet_(s),t.promise}listen(e,t,i,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),T(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),T(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:i};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+i+" for "+r);const s={p:i},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const c=a.d,l=a.s;Bn.warnOnListenWarnings_(c,t),(this.listens.get(i)&&this.listens.get(i).get(r))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(i,r),e.onComplete&&e.onComplete(l,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&xt(e,"w")){const i=Zi(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();gt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||_0(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Gy)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=m0(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,r=>{const s=r.s,o=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),T(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,e._queryObject,t)}sendUnlisten_(e,t,i,r){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";r&&(s.q=i,s.t=r),this.sendRequest(o,s)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,r){const s={p:t,d:i};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,i,r){this.putInternal("p",e,t,i,r)}merge(e,t,i,r){this.putInternal("m",e,t,i,r)}putInternal(e,t,i,r,s){this.initConnection_();const o={p:t,d:i};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const s=i.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ve(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):tf("Unrecognized action received from server: "+ve(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){T(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=uo,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=uo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>P$&&(this.reconnectDelay_=uo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*N$)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Bn.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(h){T(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:l};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?Ae("getToken() completed but was canceled"):(Ae("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new E$(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,f=>{gt(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(O$)},s))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&gt(h),c())}}}interrupt(e){Ae("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ae("Resuming connection for reason: "+e),delete this.interruptReasons_[e],jc(this.interruptReasons_)&&(this.reconnectDelay_=uo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(s=>Og(s)).join("$"):i="default";const r=this.removeListen_(e,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const i=new H(e).toString();let r;if(this.listens.has(i)){const s=this.listens.get(i);r=s.get(t),s.delete(t),s.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(e,t){Ae("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Hy&&(this.reconnectDelay_=Gy,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ae("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Hy&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+rS.replace(/\./g,"-")]=1,Hl()?e["framework.cordova"]=1:Ia()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=kl.getInstance().currentlyOnline();return jc(this.interruptReasons_)&&e}}Bn.nextPersistentConnectionId_=0;Bn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new F(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new F(Hn,e),r=new F(Hn,t);return this.compare(i,r)!==0}minPost(){return F.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tc;class OS extends Hu{static get __EMPTY_NODE(){return Tc}static set __EMPTY_NODE(e){Tc=e}compare(e,t){return Lr(e.name,t.name)}isDefinedOn(e){throw Ms("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return F.MIN}maxPost(){return new F(Tn,Tc)}makePost(e,t){return T(typeof e=="string","KeyIndex indexValue must always be a string."),new F(e,Tc)}toString(){return".key"}}const _n=new OS;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ce{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=i!=null?i:Ce.RED,this.left=r!=null?r:Et.EMPTY_NODE,this.right=s!=null?s:Et.EMPTY_NODE}copy(e,t,i,r,s){return new Ce(e!=null?e:this.key,t!=null?t:this.value,i!=null?i:this.color,r!=null?r:this.left,s!=null?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,t,i),null):s===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Et.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,r;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return Et.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ce.RED=!0;Ce.BLACK=!1;class D${copy(e,t,i,r,s){return this}insert(e,t,i){return new Ce(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Et{constructor(e,t=Et.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Et(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ce.BLACK,null,null))}remove(e){return new Et(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ce.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bc(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bc(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bc(this.root_,null,this.comparator_,!0,e)}}Et.EMPTY_NODE=new D$;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x$(n,e){return Lr(n.name,e.name)}function Bg(n,e){return Lr(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rf;function M$(n){rf=n}const DS=function(n){return typeof n=="number"?"number:"+hS(n):"string:"+n},xS=function(n){if(n.isLeafNode()){const e=n.val();T(typeof e=="string"||typeof e=="number"||typeof e=="object"&&xt(e,".sv"),"Priority must be a string or number.")}else T(n===rf||n.isEmpty(),"priority of unexpected type.");T(n===rf||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zy;class Te{constructor(e,t=Te.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,T(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),xS(this.priorityNode_)}static set __childrenNodeConstructor(e){zy=e}static get __childrenNodeConstructor(){return zy}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Te(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Te.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return L(e)?this:M(e)===".priority"?this.priorityNode_:Te.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Te.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=M(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(T(i!==".priority"||Ii(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Te.__childrenNodeConstructor.EMPTY_NODE.updateChild(Y(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+DS(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=hS(this.value_):e+=this.value_,this.lazyHash_=cS(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Te.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Te.__childrenNodeConstructor?-1:(T(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,r=Te.VALUE_TYPE_ORDER.indexOf(t),s=Te.VALUE_TYPE_ORDER.indexOf(i);return T(r>=0,"Unknown leaf type: "+t),T(s>=0,"Unknown leaf type: "+i),r===s?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Te.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MS,LS;function L$(n){MS=n}function F$(n){LS=n}class U$ extends Hu{compare(e,t){const i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?Lr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return F.MIN}maxPost(){return new F(Tn,new Te("[PRIORITY-POST]",LS))}makePost(e,t){const i=MS(e);return new F(t,new Te("[PRIORITY-POST]",i))}toString(){return".priority"}}const J=new U$;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $$=Math.log(2);class V${constructor(e){const t=s=>parseInt(Math.log(s)/$$,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Al=function(n,e,t,i){n.sort(e);const r=function(c,l){const u=l-c;let h,d;if(u===0)return null;if(u===1)return h=n[c],d=t?t(h):h,new Ce(d,h.node,Ce.BLACK,null,null);{const f=parseInt(u/2,10)+c,p=r(c,f),_=r(f+1,l);return h=n[f],d=t?t(h):h,new Ce(d,h.node,Ce.BLACK,p,_)}},s=function(c){let l=null,u=null,h=n.length;const d=function(p,_){const v=h-p,P=h;h-=p;const V=r(v+1,P),W=n[v],z=t?t(W):W;f(new Ce(z,W.node,_,null,V))},f=function(p){l?(l.left=p,l=p):(u=p,l=p)};for(let p=0;p<c.count;++p){const _=c.nextBitIsOne(),v=Math.pow(2,c.count-(p+1));_?d(v,Ce.BLACK):(d(v,Ce.BLACK),d(v,Ce.RED))}return u},o=new V$(n.length),a=s(o);return new Et(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zh;const Kr={};class Fn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return T(Kr&&J,"ChildrenNode.ts has not been loaded"),zh=zh||new Fn({".priority":Kr},{".priority":J}),zh}get(e){const t=Zi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Et?t:null}hasIndex(e){return xt(this.indexSet_,e.toString())}addIndex(e,t){T(e!==_n,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const s=t.getIterator(F.Wrap);let o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Al(i,e.getCompare()):a=Kr;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const u=Object.assign({},this.indexes_);return u[c]=a,new Fn(u,l)}addToIndexes(e,t){const i=Kc(this.indexes_,(r,s)=>{const o=Zi(this.indexSet_,s);if(T(o,"Missing index implementation for "+s),r===Kr)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(F.Wrap);let l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Al(a,o.getCompare())}else return Kr;else{const a=t.get(e.name);let c=r;return a&&(c=c.remove(new F(e.name,a))),c.insert(e,e.node)}});return new Fn(i,this.indexSet_)}removeFromIndexes(e,t){const i=Kc(this.indexes_,r=>{if(r===Kr)return r;{const s=t.get(e.name);return s?r.remove(new F(e.name,s)):r}});return new Fn(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ho;class A{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&xS(this.priorityNode_),this.children_.isEmpty()&&T(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ho||(ho=new A(new Et(Bg),null,Fn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ho}updatePriority(e){return this.children_.isEmpty()?this:new A(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?ho:t}}getChild(e){const t=M(e);return t===null?this:this.getImmediateChild(t).getChild(Y(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(T(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new F(e,t);let r,s;t.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(i,this.children_));const o=r.isEmpty()?ho:this.priorityNode_;return new A(r,o,s)}}updateChild(e,t){const i=M(e);if(i===null)return t;{T(M(e)!==".priority"||Ii(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(Y(e),t);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,r=0,s=!0;if(this.forEachChild(J,(o,a)=>{t[o]=a.val(e),i++,s&&A.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1}),!e&&s&&r<2*i){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+DS(this.getPriority().val())+":"),this.forEachChild(J,(t,i)=>{const r=i.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":cS(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const r=this.resolveIndex_(i);if(r){const s=r.getPredecessorKey(new F(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new F(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new F(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,F.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,F.Wrap);let s=r.peek();for(;s!=null&&t.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Za?-1:0}withIndex(e){if(e===_n||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new A(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===_n||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(J),r=t.getIterator(J);let s=i.getNext(),o=r.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=i.getNext(),o=r.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===_n?null:this.indexMap_.get(e.toString())}}A.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class B$ extends A{constructor(){super(new Et(Bg),A.EMPTY_NODE,Fn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return A.EMPTY_NODE}isEmpty(){return!1}}const Za=new B$;Object.defineProperties(F,{MIN:{value:new F(Hn,A.EMPTY_NODE)},MAX:{value:new F(Tn,Za)}});OS.__EMPTY_NODE=A.EMPTY_NODE;Te.__childrenNodeConstructor=A;M$(Za);F$(Za);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q$=!0;function oe(n,e=null){if(n===null)return A.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),T(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Te(t,oe(e))}if(!(n instanceof Array)&&q$){const t=[];let i=!1;if($e(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=oe(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new F(o,c)))}}),t.length===0)return A.EMPTY_NODE;const s=Al(t,x$,o=>o.name,Bg);if(i){const o=Al(t,J.getCompare());return new A(s,oe(e),new Fn({".priority":o},{".priority":J}))}else return new A(s,oe(e),Fn.Default)}else{let t=A.EMPTY_NODE;return $e(n,(i,r)=>{if(xt(n,i)&&i.substring(0,1)!=="."){const s=oe(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(oe(e))}}L$(oe);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg extends Hu{constructor(e){super();this.indexPath_=e,T(!L(e)&&M(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?Lr(e.name,t.name):s}makePost(e,t){const i=oe(e),r=A.EMPTY_NODE.updateChild(this.indexPath_,i);return new F(t,r)}maxPost(){const e=A.EMPTY_NODE.updateChild(this.indexPath_,Za);return new F(Tn,e)}toString(){return aa(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j$ extends Hu{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Lr(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return F.MIN}maxPost(){return F.MAX}makePost(e,t){const i=oe(e);return new F(t,i)}toString(){return".value"}}const jg=new j$;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sf="-",FS="z",US=786,K$=function(){let n=0;const e=[];return function(t){const i=t===n;n=t;let r;const s=new Array(8);for(r=7;r>=0;r--)s[r]=Rs.charAt(t%64),t=Math.floor(t/64);T(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=Rs.charAt(e[r]);return T(o.length===20,"nextPushId: Length should be 20."),o}}(),Qy=function(n){if(n===""+Dg)return sf;const e=Sl(n);if(e!=null)return""+(e+1);const t=new Array(n.length);for(let o=0;o<t.length;o++)t[o]=n.charAt(o);if(t.length<US)return t.push(sf),t.join("");let i=t.length-1;for(;i>=0&&t[i]===FS;)i--;if(i===-1)return Tn;const r=t[i],s=Rs.charAt(Rs.indexOf(r)+1);return t[i]=s,t.slice(0,i+1).join("")},Yy=function(n){if(n===""+dS)return Hn;const e=Sl(n);if(e!=null)return""+(e-1);const t=new Array(n.length);for(let i=0;i<t.length;i++)t[i]=n.charAt(i);return t[t.length-1]===sf?t.length===1?""+Dg:(delete t[t.length-1],t.join("")):(t[t.length-1]=Rs.charAt(Rs.indexOf(t[t.length-1])-1),t.join("")+FS.repeat(US-t.length))};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $S(n){return{type:"value",snapshotNode:n}}function Ns(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ca(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function la(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function W$(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){T(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(ca(t,a)):T(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ns(t,i)):o.trackChildChange(la(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(J,(r,s)=>{t.hasChild(r)||i.trackChildChange(ca(r,s))}),t.isLeafNode()||t.forEachChild(J,(r,s)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(la(r,s,o))}else i.trackChildChange(Ns(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?A.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this.indexedFilter_=new Kg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ua.getStartPost_(e),this.endPost_=ua.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,i,r,s,o){return this.matches(new F(t,i))||(i=A.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=A.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(A.EMPTY_NODE);const s=this;return t.forEachChild(J,(o,a)=>{s.matches(new F(o,a))||(r=r.updateImmediateChild(o,A.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G${constructor(e){this.rangedFilter_=new ua(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new F(t,i))||(i=A.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=A.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=A.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();let c;if(this.reverse_?c=this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:c=this.index_.compare(a,this.rangedFilter_.getEndPost())<=0,c)r=r.updateImmediateChild(a.name,a.node),o++;else break}}else{r=t.withIndex(this.index_),r=r.updatePriority(A.EMPTY_NODE);let s,o,a,c;if(this.reverse_){c=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),o=this.rangedFilter_.getStartPost();const h=this.index_.getCompare();a=(d,f)=>h(f,d)}else c=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),o=this.rangedFilter_.getEndPost(),a=this.index_.getCompare();let l=0,u=!1;for(;c.hasNext();){const h=c.getNext();!u&&a(s,h)<=0&&(u=!0),u&&l<this.limit_&&a(h,o)<=0?l++:r=r.updateImmediateChild(h.name,A.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();const a=e;T(a.numChildren()===this.limit_,"");const c=new F(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){const h=a.getImmediateChild(t);let d=r.getChildAfterChild(this.index_,l,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,c);if(u&&!i.isEmpty()&&f>=0)return s!=null&&s.trackChildChange(la(t,i,h)),a.updateImmediateChild(t,i);{s!=null&&s.trackChildChange(ca(t,h));const _=a.updateImmediateChild(t,A.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(s!=null&&s.trackChildChange(Ns(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}else return i.isEmpty()?e:u&&o(l,c)>=0?(s!=null&&(s.trackChildChange(ca(l.name,l.node)),s.trackChildChange(Ns(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,A.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=J}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return T(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return T(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Hn}hasEnd(){return this.endSet_}getIndexEndValue(){return T(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return T(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Tn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return T(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===J}copy(){const e=new zu;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function H$(n){return n.loadsAllData()?new Kg(n.getIndex()):n.hasLimit()?new G$(n):new ua(n)}function z$(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Q$(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function of(n,e,t){const i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Y$(n,e,t){let i;if(n.index_===_n)typeof e=="string"&&(e=Qy(e)),i=of(n,e,t);else{let r;t==null?r=Tn:r=Qy(t),i=of(n,e,r)}return i.startAfterSet_=!0,i}function af(n,e,t){const i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function X$(n,e,t){let i,r;return n.index_===_n?(typeof e=="string"&&(e=Yy(e)),r=af(n,e,t)):(t==null?i=Hn:i=Yy(t),r=af(n,e,i)),r.endBeforeSet_=!0,r}function Qu(n,e){const t=n.copy();return t.index_=e,t}function Xy(n){const e={};if(n.isDefault())return e;let t;return n.index_===J?t="$priority":n.index_===jg?t="$value":n.index_===_n?t="$key":(T(n.index_ instanceof qg,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ve(t),n.startSet_&&(e.startAt=ve(n.indexStartValue_),n.startNameSet_&&(e.startAt+=","+ve(n.indexStartName_))),n.endSet_&&(e.endAt=ve(n.indexEndValue_),n.endNameSet_&&(e.endAt+=","+ve(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Jy(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_)),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_)),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==J&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl extends AS{constructor(e,t,i,r){super();this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Ja("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(T(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Rl.getListenId_(e,i),a={};this.listens_[o]=a;const c=Xy(e._queryParams);this.restRequest_(s+".json",c,(l,u)=>{let h=u;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(s,h,!1,i),Zi(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",r(d,null)}})}unlisten(e,t){const i=Rl.getListenId_(e,t);delete this.listens_[i]}get(e){const t=Xy(e._queryParams),i=e._path.toString(),r=new we;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Tr(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=xo(a.responseText)}catch{gt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&gt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J${constructor(){this.rootNode_=A.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nl(){return{value:null,children:new Map}}function Zs(n,e,t){if(L(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=M(e);n.children.has(i)||n.children.set(i,Nl());const r=n.children.get(i);e=Y(e),Zs(r,e,t)}}function cf(n,e){if(L(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(J,(i,r)=>{Zs(n,new H(i),r)}),cf(n,e)}}else if(n.children.size>0){const t=M(e);return e=Y(e),n.children.has(t)&&cf(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function lf(n,e,t){n.value!==null?t(e,n.value):Z$(n,(i,r)=>{const s=new H(e.toString()+"/"+i);lf(r,s,t)})}function Z$(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&$e(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zy=10*1e3,tV=30*1e3,nV=5*60*1e3;class iV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new eV(e);const i=Zy+(tV-Zy)*Math.random();ko(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;$e(e,(r,s)=>{s>0&&xt(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),ko(this.reportStats_.bind(this),Math.floor(Math.random()*2*nV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Zt||(Zt={}));function Wg(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Gg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Hg(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Zt.ACK_USER_WRITE,this.source=Wg()}operationForChild(e){if(L(this.path)){if(this.affectedTree.value!=null)return T(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new H(e));return new Pl(K(),t,this.revert)}}else return T(M(this.path)===e,"operationForChild called for unrelated child."),new Pl(Y(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,t){this.source=e,this.path=t,this.type=Zt.LISTEN_COMPLETE}operationForChild(e){return L(this.path)?new ha(this.source,K()):new ha(this.source,Y(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Zt.OVERWRITE}operationForChild(e){return L(this.path)?new gr(this.source,K(),this.snap.getImmediateChild(e)):new gr(this.source,Y(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Zt.MERGE}operationForChild(e){if(L(this.path)){const t=this.children.subtree(new H(e));return t.isEmpty()?null:t.value?new gr(this.source,K(),t.value):new Ps(this.source,K(),t)}else return T(M(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ps(this.source,Y(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(L(e))return this.isFullyInitialized()&&!this.filtered_;const t=M(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function sV(n,e,t,i){const r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(W$(o.childName,o.snapshotNode))}),fo(n,r,"child_removed",e,i,t),fo(n,r,"child_added",e,i,t),fo(n,r,"child_moved",s,i,t),fo(n,r,"child_changed",e,i,t),fo(n,r,"value",e,i,t),r}function fo(n,e,t,i,r,s){const o=i.filter(a=>a.type===t);o.sort((a,c)=>aV(n,a,c)),o.forEach(a=>{const c=oV(n,a,s);r.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function oV(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function aV(n,e,t){if(e.childName==null||t.childName==null)throw Ms("Should only compare child_ events.");const i=new F(e.childName,e.snapshotNode),r=new F(t.childName,t.snapshotNode);return n.index_.compare(i,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yu(n,e){return{eventCache:n,serverCache:e}}function Ao(n,e,t,i){return Yu(new Ei(e,t,i),n.serverCache)}function VS(n,e,t,i){return Yu(n.eventCache,new Ei(e,t,i))}function Ol(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function mr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qh;const cV=()=>(Qh||(Qh=new Et(jU)),Qh);class X{constructor(e,t=cV()){this.value=e,this.children=t}static fromObject(e){let t=new X(null);return $e(e,(i,r)=>{t=t.set(new H(i),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:K(),value:this.value};if(L(e))return null;{const i=M(e),r=this.children.get(i);if(r!==null){const s=r.findRootMostMatchingPathAndValue(Y(e),t);return s!=null?{path:ie(new H(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(L(e))return this;{const t=M(e),i=this.children.get(t);return i!==null?i.subtree(Y(e)):new X(null)}}set(e,t){if(L(e))return new X(t,this.children);{const i=M(e),s=(this.children.get(i)||new X(null)).set(Y(e),t),o=this.children.insert(i,s);return new X(this.value,o)}}remove(e){if(L(e))return this.children.isEmpty()?new X(null):new X(null,this.children);{const t=M(e),i=this.children.get(t);if(i){const r=i.remove(Y(e));let s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new X(null):new X(this.value,s)}else return this}}get(e){if(L(e))return this.value;{const t=M(e),i=this.children.get(t);return i?i.get(Y(e)):null}}setTree(e,t){if(L(e))return t;{const i=M(e),s=(this.children.get(i)||new X(null)).setTree(Y(e),t);let o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new X(this.value,o)}}fold(e){return this.fold_(K(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(ie(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,K(),t)}findOnPath_(e,t,i){const r=this.value?i(t,this.value):!1;if(r)return r;if(L(e))return null;{const s=M(e),o=this.children.get(s);return o?o.findOnPath_(Y(e),ie(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,K(),t)}foreachOnPath_(e,t,i){if(L(e))return this;{this.value&&i(t,this.value);const r=M(e),s=this.children.get(r);return s?s.foreachOnPath_(Y(e),ie(t,r),i):new X(null)}}foreach(e){this.foreach_(K(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(ie(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e){this.writeTree_=e}static empty(){return new tn(new X(null))}}function Ro(n,e,t){if(L(e))return new tn(new X(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const r=i.path;let s=i.value;const o=pt(r,e);return s=s.updateChild(o,t),new tn(n.writeTree_.set(r,s))}else{const r=new X(t),s=n.writeTree_.setTree(e,r);return new tn(s)}}}function uf(n,e,t){let i=n;return $e(t,(r,s)=>{i=Ro(i,ie(e,r),s)}),i}function ew(n,e){if(L(e))return tn.empty();{const t=n.writeTree_.setTree(e,new X(null));return new tn(t)}}function hf(n,e){return Fr(n,e)!=null}function Fr(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(pt(t.path,e)):null}function tw(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(J,(i,r)=>{e.push(new F(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new F(i,r.value))}),e}function li(n,e){if(L(e))return n;{const t=Fr(n,e);return t!=null?new tn(new X(t)):new tn(n.writeTree_.subtree(e))}}function df(n){return n.writeTree_.isEmpty()}function Os(n,e){return BS(K(),n.writeTree_,e)}function BS(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(T(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=BS(ie(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ie(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(n,e){return WS(e,n)}function lV(n,e,t,i,r){T(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=Ro(n.visibleWrites,e,t)),n.lastWriteId=i}function uV(n,e,t,i){T(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=uf(n.visibleWrites,e,t),n.lastWriteId=i}function hV(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function dV(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);T(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&fV(a,i.path)?r=!1:Vt(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return pV(n),!0;if(i.snap)n.visibleWrites=ew(n.visibleWrites,i.path);else{const a=i.children;$e(a,c=>{n.visibleWrites=ew(n.visibleWrites,ie(i.path,c))})}return!0}else return!1}function fV(n,e){if(n.snap)return Vt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Vt(ie(n.path,t),e))return!0;return!1}function pV(n){n.visibleWrites=qS(n.allWrites,gV,K()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function gV(n){return n.visible}function qS(n,e,t){let i=tn.empty();for(let r=0;r<n.length;++r){const s=n[r];if(e(s)){const o=s.path;let a;if(s.snap)Vt(t,o)?(a=pt(t,o),i=Ro(i,a,s.snap)):Vt(o,t)&&(a=pt(o,t),i=Ro(i,K(),s.snap.getChild(a)));else if(s.children){if(Vt(t,o))a=pt(t,o),i=uf(i,a,s.children);else if(Vt(o,t))if(a=pt(o,t),L(a))i=uf(i,K(),s.children);else{const c=Zi(s.children,M(a));if(c){const l=c.getChild(Y(a));i=Ro(i,K(),l)}}}else throw Ms("WriteRecord should have .snap or .children")}}return i}function jS(n,e,t,i,r){if(!i&&!r){const s=Fr(n.visibleWrites,e);if(s!=null)return s;{const o=li(n.visibleWrites,e);if(df(o))return t;if(t==null&&!hf(o,K()))return null;{const a=t||A.EMPTY_NODE;return Os(o,a)}}}else{const s=li(n.visibleWrites,e);if(!r&&df(s))return t;if(!r&&t==null&&!hf(s,K()))return null;{const o=function(l){return(l.visible||r)&&(!i||!~i.indexOf(l.writeId))&&(Vt(l.path,e)||Vt(e,l.path))},a=qS(n.allWrites,o,e),c=t||A.EMPTY_NODE;return Os(a,c)}}}function mV(n,e,t){let i=A.EMPTY_NODE;const r=Fr(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(J,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){const s=li(n.visibleWrites,e);return t.forEachChild(J,(o,a)=>{const c=Os(li(s,new H(o)),a);i=i.updateImmediateChild(o,c)}),tw(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const s=li(n.visibleWrites,e);return tw(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function _V(n,e,t,i,r){T(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=ie(e,t);if(hf(n.visibleWrites,s))return null;{const o=li(n.visibleWrites,s);return df(o)?r.getChild(t):Os(o,r.getChild(t))}}function yV(n,e,t,i){const r=ie(e,t),s=Fr(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){const o=li(n.visibleWrites,r);return Os(o,i.getNode().getImmediateChild(t))}else return null}function wV(n,e){return Fr(n.visibleWrites,e)}function vV(n,e,t,i,r,s,o){let a;const c=li(n.visibleWrites,e),l=Fr(c,K());if(l!=null)a=l;else if(t!=null)a=Os(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let f=d.getNext();for(;f&&u.length<r;)h(f,i)!==0&&u.push(f),f=d.getNext();return u}else return[]}function IV(){return{visibleWrites:tn.empty(),allWrites:[],lastWriteId:-1}}function Dl(n,e,t,i){return jS(n.writeTree,n.treePath,e,t,i)}function zg(n,e){return mV(n.writeTree,n.treePath,e)}function nw(n,e,t,i){return _V(n.writeTree,n.treePath,e,t,i)}function xl(n,e){return wV(n.writeTree,ie(n.treePath,e))}function EV(n,e,t,i,r,s){return vV(n.writeTree,n.treePath,e,t,i,r,s)}function Qg(n,e,t){return yV(n.writeTree,n.treePath,e,t)}function KS(n,e){return WS(ie(n.treePath,e),n.writeTree)}function WS(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;T(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),T(i!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,la(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,ca(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,Ns(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,la(i,e.snapshotNode,r.oldSnap));else throw Ms("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const GS=new bV;class Yg{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Ei(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Qg(this.writes_,e,i)}}getChildAfterChild(e,t,i){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:mr(this.viewCache_),s=EV(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SV(n){return{filter:n}}function CV(n,e){T(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),T(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function kV(n,e,t,i,r){const s=new TV;let o,a;if(t.type===Zt.OVERWRITE){const l=t;l.source.fromUser?o=ff(n,e,l.path,l.snap,i,r,s):(T(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!L(l.path),o=Ml(n,e,l.path,l.snap,i,r,a,s))}else if(t.type===Zt.MERGE){const l=t;l.source.fromUser?o=RV(n,e,l.path,l.children,i,r,s):(T(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=pf(n,e,l.path,l.children,i,r,a,s))}else if(t.type===Zt.ACK_USER_WRITE){const l=t;l.revert?o=OV(n,e,l.path,i,r,s):o=NV(n,e,l.path,l.affectedTree,i,r,s)}else if(t.type===Zt.LISTEN_COMPLETE)o=PV(n,e,t.path,i,s);else throw Ms("Unknown operation type: "+t.type);const c=s.getChanges();return AV(e,o,c),{viewCache:o,changes:c}}function AV(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Ol(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push($S(Ol(e)))}}function HS(n,e,t,i,r,s){const o=e.eventCache;if(xl(i,t)!=null)return e;{let a,c;if(L(t))if(T(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=mr(e),u=l instanceof A?l:A.EMPTY_NODE,h=zg(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{const l=Dl(i,mr(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{const l=M(t);if(l===".priority"){T(Ii(t)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=nw(i,t,u,c);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{const u=Y(t);let h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const d=nw(i,t,o.getNode(),c);d!=null?h=o.getNode().getImmediateChild(l).updateChild(u,d):h=o.getNode().getImmediateChild(l)}else h=Qg(i,l,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),l,h,u,r,s):a=o.getNode()}}return Ao(e,a,o.isFullyInitialized()||L(t),n.filter.filtersNodes())}}function Ml(n,e,t,i,r,s,o,a){const c=e.serverCache;let l;const u=o?n.filter:n.filter.getIndexedFilter();if(L(t))l=u.updateFullNode(c.getNode(),i,null);else if(u.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(t,i);l=u.updateFullNode(c.getNode(),f,null)}else{const f=M(t);if(!c.isCompleteForPath(t)&&Ii(t)>1)return e;const p=Y(t),v=c.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?l=u.updatePriority(c.getNode(),v):l=u.updateChild(c.getNode(),f,v,p,GS,null)}const h=VS(e,l,c.isFullyInitialized()||L(t),u.filtersNodes()),d=new Yg(r,h,s);return HS(n,h,t,r,d,a)}function ff(n,e,t,i,r,s,o){const a=e.eventCache;let c,l;const u=new Yg(r,e,s);if(L(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=Ao(e,l,!0,n.filter.filtersNodes());else{const h=M(t);if(h===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=Ao(e,l,a.isFullyInitialized(),a.isFiltered());else{const d=Y(t),f=a.getNode().getImmediateChild(h);let p;if(L(d))p=i;else{const _=u.getCompleteChild(h);_!=null?Ug(d)===".priority"&&_.getChild(NS(d)).isEmpty()?p=_:p=_.updateChild(d,i):p=A.EMPTY_NODE}if(f.equals(p))c=e;else{const _=n.filter.updateChild(a.getNode(),h,p,d,u,o);c=Ao(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function iw(n,e){return n.eventCache.isCompleteForChild(e)}function RV(n,e,t,i,r,s,o){let a=e;return i.foreach((c,l)=>{const u=ie(t,c);iw(e,M(u))&&(a=ff(n,a,u,l,r,s,o))}),i.foreach((c,l)=>{const u=ie(t,c);iw(e,M(u))||(a=ff(n,a,u,l,r,s,o))}),a}function rw(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function pf(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;L(t)?l=i:l=new X(null).setTree(t,i);const u=e.serverCache.getNode();return l.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),p=rw(n,f,d);c=Ml(n,c,new H(h),p,r,s,o,a)}}),l.children.inorderTraversal((h,d)=>{const f=!e.serverCache.isCompleteForChild(h)&&d.value===void 0;if(!u.hasChild(h)&&!f){const p=e.serverCache.getNode().getImmediateChild(h),_=rw(n,p,d);c=Ml(n,c,new H(h),_,r,s,o,a)}}),c}function NV(n,e,t,i,r,s,o){if(xl(r,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(L(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Ml(n,e,t,c.getNode().getChild(t),r,s,a,o);if(L(t)){let l=new X(null);return c.getNode().forEachChild(_n,(u,h)=>{l=l.set(new H(u),h)}),pf(n,e,t,l,r,s,a,o)}else return e}else{let l=new X(null);return i.foreach((u,h)=>{const d=ie(t,u);c.isCompleteForPath(d)&&(l=l.set(u,c.getNode().getChild(d)))}),pf(n,e,t,l,r,s,a,o)}}function PV(n,e,t,i,r){const s=e.serverCache,o=VS(e,s.getNode(),s.isFullyInitialized()||L(t),s.isFiltered());return HS(n,o,t,i,GS,r)}function OV(n,e,t,i,r,s){let o;if(xl(i,t)!=null)return e;{const a=new Yg(i,e,r),c=e.eventCache.getNode();let l;if(L(t)||M(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Dl(i,mr(e));else{const h=e.serverCache.getNode();T(h instanceof A,"serverChildren would be complete if leaf node"),u=zg(i,h)}u=u,l=n.filter.updateFullNode(c,u,s)}else{const u=M(t);let h=Qg(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?l=n.filter.updateChild(c,u,h,Y(t),a,s):e.eventCache.getNode().hasChild(u)?l=n.filter.updateChild(c,u,A.EMPTY_NODE,Y(t),a,s):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Dl(i,mr(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||xl(i,K())!=null,Ao(e,l,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,r=new Kg(i.getIndex()),s=H$(i);this.processor_=SV(s);const o=t.serverCache,a=t.eventCache,c=r.updateFullNode(A.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(A.EMPTY_NODE,a.getNode(),null),u=new Ei(c,o.isFullyInitialized(),r.filtersNodes()),h=new Ei(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Yu(h,u),this.eventGenerator_=new rV(this.query_)}get query(){return this.query_}}function xV(n){return n.viewCache_.serverCache.getNode()}function MV(n){return Ol(n.viewCache_)}function LV(n,e){const t=mr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!L(e)&&!t.getImmediateChild(M(e)).isEmpty())?t.getChild(e):null}function sw(n){return n.eventRegistrations_.length===0}function FV(n,e){n.eventRegistrations_.push(e)}function ow(n,e,t){const i=[];if(t){T(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){const o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function aw(n,e,t,i){e.type===Zt.MERGE&&e.source.queryId!==null&&(T(mr(n.viewCache_),"We should always have a full cache before handling merges"),T(Ol(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,s=kV(n.processor_,r,e,t,i);return CV(n.processor_,s.viewCache),T(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,zS(n,s.changes,s.viewCache.eventCache.getNode(),null)}function UV(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(J,(s,o)=>{i.push(Ns(s,o))}),t.isFullyInitialized()&&i.push($S(t.getNode())),zS(n,i,t.getNode(),e)}function zS(n,e,t,i){const r=i?[i]:n.eventRegistrations_;return sV(n.eventGenerator_,e,t,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ll;class QS{constructor(){this.views=new Map}}function $V(n){T(!Ll,"__referenceConstructor has already been defined"),Ll=n}function VV(){return T(Ll,"Reference.ts has not been loaded"),Ll}function BV(n){return n.views.size===0}function Xg(n,e,t,i){const r=e.source.queryId;if(r!==null){const s=n.views.get(r);return T(s!=null,"SyncTree gave us an op for an invalid query."),aw(s,e,t,i)}else{let s=[];for(const o of n.views.values())s=s.concat(aw(o,e,t,i));return s}}function YS(n,e,t,i,r){const s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Dl(t,r?i:null),c=!1;a?c=!0:i instanceof A?(a=zg(t,i),c=!1):(a=A.EMPTY_NODE,c=!1);const l=Yu(new Ei(a,c,!1),new Ei(i,r,!1));return new DV(e,l)}return o}function qV(n,e,t,i,r,s){const o=YS(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),FV(o,t),UV(o,t)}function jV(n,e,t,i){const r=e._queryIdentifier,s=[];let o=[];const a=Ti(n);if(r==="default")for(const[c,l]of n.views.entries())o=o.concat(ow(l,t,i)),sw(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const c=n.views.get(r);c&&(o=o.concat(ow(c,t,i)),sw(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!Ti(n)&&s.push(new(VV())(e._repo,e._path)),{removed:s,events:o}}function XS(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ui(n,e){let t=null;for(const i of n.views.values())t=t||LV(i,e);return t}function JS(n,e){if(e._queryParams.loadsAllData())return Ju(n);{const i=e._queryIdentifier;return n.views.get(i)}}function ZS(n,e){return JS(n,e)!=null}function Ti(n){return Ju(n)!=null}function Ju(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fl;function KV(n){T(!Fl,"__referenceConstructor has already been defined"),Fl=n}function WV(){return T(Fl,"Reference.ts has not been loaded"),Fl}let GV=1;class cw{constructor(e){this.listenProvider_=e,this.syncPointTree_=new X(null),this.pendingWriteTree_=IV(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Jg(n,e,t,i,r){return lV(n.pendingWriteTree_,e,t,i,r),r?eo(n,new gr(Wg(),e,t)):[]}function HV(n,e,t,i){uV(n.pendingWriteTree_,e,t,i);const r=X.fromObject(t);return eo(n,new Ps(Wg(),e,r))}function oi(n,e,t=!1){const i=hV(n.pendingWriteTree_,e);if(dV(n.pendingWriteTree_,e)){let s=new X(null);return i.snap!=null?s=s.set(K(),!0):$e(i.children,o=>{s=s.set(new H(o),!0)}),eo(n,new Pl(i.path,s,t))}else return[]}function ec(n,e,t){return eo(n,new gr(Gg(),e,t))}function zV(n,e,t){const i=X.fromObject(t);return eo(n,new Ps(Gg(),e,i))}function QV(n,e){return eo(n,new ha(Gg(),e))}function YV(n,e,t){const i=Zg(n,t);if(i){const r=em(i),s=r.path,o=r.queryId,a=pt(s,e),c=new ha(Hg(o),a);return tm(n,s,c)}else return[]}function gf(n,e,t,i){const r=e._path,s=n.syncPointTree_.get(r);let o=[];if(s&&(e._queryIdentifier==="default"||ZS(s,e))){const a=jV(s,e,t,i);BV(s)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const c=a.removed;o=a.events;const l=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,u=n.syncPointTree_.findOnPath(r,(h,d)=>Ti(d));if(l&&!u){const h=n.syncPointTree_.subtree(r);if(!h.isEmpty()){const d=eB(h);for(let f=0;f<d.length;++f){const p=d[f],_=p.query,v=nC(n,p);n.listenProvider_.startListening(No(_),Ul(n,_),v.hashFn,v.onComplete)}}}!u&&c.length>0&&!i&&(l?n.listenProvider_.stopListening(No(e),null):c.forEach(h=>{const d=n.queryToTagMap.get(eh(h));n.listenProvider_.stopListening(No(h),d)})),tB(n,c)}return o}function XV(n,e,t,i){const r=Zg(n,i);if(r!=null){const s=em(r),o=s.path,a=s.queryId,c=pt(o,e),l=new gr(Hg(a),c,t);return tm(n,o,l)}else return[]}function JV(n,e,t,i){const r=Zg(n,i);if(r){const s=em(r),o=s.path,a=s.queryId,c=pt(o,e),l=X.fromObject(t),u=new Ps(Hg(a),c,l);return tm(n,o,u)}else return[]}function lw(n,e,t){const i=e._path;let r=null,s=!1;n.syncPointTree_.foreachOnPath(i,(h,d)=>{const f=pt(h,i);r=r||ui(d,f),s=s||Ti(d)});let o=n.syncPointTree_.get(i);o?(s=s||Ti(o),r=r||ui(o,K())):(o=new QS,n.syncPointTree_=n.syncPointTree_.set(i,o));let a;r!=null?a=!0:(a=!1,r=A.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((d,f)=>{const p=ui(f,K());p&&(r=r.updateImmediateChild(d,p))}));const c=ZS(o,e);if(!c&&!e._queryParams.loadsAllData()){const h=eh(e);T(!n.queryToTagMap.has(h),"View does not exist, but we have a tag");const d=nB();n.queryToTagMap.set(h,d),n.tagToQueryMap.set(d,h)}const l=Xu(n.pendingWriteTree_,i);let u=qV(o,e,t,l,r,a);if(!c&&!s){const h=JS(o,e);u=u.concat(iB(n,e,h))}return u}function Zu(n,e,t){const r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=pt(o,e),l=ui(a,c);if(l)return l});return jS(r,e,s,t,!0)}function ZV(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(l,u)=>{const h=pt(l,t);i=i||ui(u,h)});let r=n.syncPointTree_.get(t);r?i=i||ui(r,K()):(r=new QS,n.syncPointTree_=n.syncPointTree_.set(t,r));const s=i!=null,o=s?new Ei(i,!0,!1):null,a=Xu(n.pendingWriteTree_,e._path),c=YS(r,e,a,s?o.getNode():A.EMPTY_NODE,s);return MV(c)}function eo(n,e){return eC(e,n.syncPointTree_,null,Xu(n.pendingWriteTree_,K()))}function eC(n,e,t,i){if(L(n.path))return tC(n,e,t,i);{const r=e.get(K());t==null&&r!=null&&(t=ui(r,K()));let s=[];const o=M(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const l=t?t.getImmediateChild(o):null,u=KS(i,o);s=s.concat(eC(a,c,l,u))}return r&&(s=s.concat(Xg(r,n,i,t))),s}}function tC(n,e,t,i){const r=e.get(K());t==null&&r!=null&&(t=ui(r,K()));let s=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,l=KS(i,o),u=n.operationForChild(o);u&&(s=s.concat(tC(u,a,c,l)))}),r&&(s=s.concat(Xg(r,n,i,t))),s}function nC(n,e){const t=e.query,i=Ul(n,t);return{hashFn:()=>(xV(e)||A.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?YV(n,t._path,i):QV(n,t._path);{const s=GU(r,t);return gf(n,t,null,s)}}}}function Ul(n,e){const t=eh(e);return n.queryToTagMap.get(t)}function eh(n){return n._path.toString()+"$"+n._queryIdentifier}function Zg(n,e){return n.tagToQueryMap.get(e)}function em(n){const e=n.indexOf("$");return T(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new H(n.substr(0,e))}}function tm(n,e,t){const i=n.syncPointTree_.get(e);T(i,"Missing sync point for query tag that we're tracking");const r=Xu(n.pendingWriteTree_,e);return Xg(i,t,r,null)}function eB(n){return n.fold((e,t,i)=>{if(t&&Ti(t))return[Ju(t)];{let r=[];return t&&(r=XS(t)),$e(i,(s,o)=>{r=r.concat(o)}),r}})}function No(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(WV())(n._repo,n._path):n}function tB(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const r=eh(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function nB(){return GV++}function iB(n,e,t){const i=e._path,r=Ul(n,e),s=nC(n,t),o=n.listenProvider_.startListening(No(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)T(!Ti(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((l,u,h)=>{if(!L(l)&&u&&Ti(u))return[Ju(u).query];{let d=[];return u&&(d=d.concat(XS(u).map(f=>f.query))),$e(h,(f,p)=>{d=d.concat(p)}),d}});for(let l=0;l<c.length;++l){const u=c[l];n.listenProvider_.stopListening(No(u),Ul(n,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new nm(t)}node(){return this.node_}}class im{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ie(this.path_,e);return new im(this.syncTree_,t)}node(){return Zu(this.syncTree_,this.path_)}}const rB=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},uw=function(n,e,t){if(!n||typeof n!="object")return n;if(T(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return sB(n[".sv"],e,t);if(typeof n[".sv"]=="object")return oB(n[".sv"],e);T(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},sB=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:T(!1,"Unexpected server value: "+n)}},oB=function(n,e,t){n.hasOwnProperty("increment")||T(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&T(!1,"Unexpected increment value: "+i);const r=e.node();if(T(r!==null&&typeof r!="undefined","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return typeof o!="number"?i:o+i},iC=function(n,e,t,i){return sm(e,new im(t,n),i)},rm=function(n,e,t){return sm(n,new nm(e),t)};function sm(n,e,t){const i=n.getPriority().val(),r=uw(i,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const o=n,a=uw(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Te(a,oe(r)):n}else{const o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new Te(r))),o.forEachChild(J,(a,c)=>{const l=sm(c,e.getImmediateChild(a),t);l!==c&&(s=s.updateImmediateChild(a,l))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function th(n,e){let t=e instanceof H?e:new H(e),i=n,r=M(t);for(;r!==null;){const s=Zi(i.node.children,r)||{children:{},childCount:0};i=new om(r,i,s),t=Y(t),r=M(t)}return i}function Ur(n){return n.node.value}function am(n,e){n.node.value=e,mf(n)}function rC(n){return n.node.childCount>0}function aB(n){return Ur(n)===void 0&&!rC(n)}function nh(n,e){$e(n.node.children,(t,i)=>{e(new om(t,n,i))})}function sC(n,e,t,i){t&&!i&&e(n),nh(n,r=>{sC(r,e,!0,i)}),t&&i&&e(n)}function cB(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function tc(n){return new H(n.parent===null?n.name:tc(n.parent)+"/"+n.name)}function mf(n){n.parent!==null&&lB(n.parent,n.name,n)}function lB(n,e,t){const i=aB(t),r=xt(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,mf(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,mf(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uB=/[\[\].#$\/\u0000-\u001F\u007F]/,hB=/[\[\].#$\u0000-\u001F\u007F]/,Yh=10*1024*1024,ih=function(n){return typeof n=="string"&&n.length!==0&&!uB.test(n)},oC=function(n){return typeof n=="string"&&n.length!==0&&!hB.test(n)},dB=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),oC(n)},da=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Gu(n)||n&&typeof n=="object"&&xt(n,".sv")},bn=function(n,e,t,i){i&&e===void 0||nc(Tt(n,"value"),e,t)},nc=function(n,e,t){const i=t instanceof H?new S$(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+xi(i));if(typeof e=="function")throw new Error(n+"contains a function "+xi(i)+" with contents = "+e.toString());if(Gu(e))throw new Error(n+"contains "+e.toString()+" "+xi(i));if(typeof e=="string"&&e.length>Yh/3&&Ql(e)>Yh)throw new Error(n+"contains a string greater than "+Yh+" utf8 bytes "+xi(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if($e(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!ih(o)))throw new Error(n+" contains an invalid key ("+o+") "+xi(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);C$(i,o),nc(n,a,i),k$(i)}),r&&s)throw new Error(n+' contains ".value" child '+xi(i)+" in addition to actual children.")}},fB=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const s=aa(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!ih(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(b$);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&Vt(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},aC=function(n,e,t,i){if(i&&e===void 0)return;const r=Tt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const s=[];$e(e,(o,a)=>{const c=new H(o);if(nc(r,a,ie(t,c)),Ug(c)===".priority"&&!da(a))throw new Error(r+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),fB(r,s)},cm=function(n,e,t){if(!(t&&e===void 0)){if(Gu(e))throw new Error(Tt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!da(e))throw new Error(Tt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ic=function(n,e,t,i){if(!(i&&t===void 0)&&!ih(t))throw new Error(Tt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},fa=function(n,e,t,i){if(!(i&&t===void 0)&&!oC(t))throw new Error(Tt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},pB=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),fa(n,e,t,i)},Bt=function(n,e){if(M(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},cC=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ih(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!dB(t))throw new Error(Tt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rh(n,e){let t=null;for(let i=0;i<e.length;i++){const r=e[i],s=r.getPath();t!==null&&!$g(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function lm(n,e,t){rh(n,t),lC(n,i=>$g(i,e))}function zt(n,e,t){rh(n,t),lC(n,i=>Vt(i,e)||Vt(e,i))}function lC(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const r=n.eventLists_[i];if(r){const s=r.path;e(s)?(mB(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function mB(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();Xi&&Ae("event: "+t.toString()),Js(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC="repo_interrupt",_B=25;class yB{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new gB,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Nl(),this.transactionQueueTree_=new om,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function wB(n,e,t){if(n.stats_=Mg(n.repoInfo_),n.forceRestClient_||zU())n.server_=new Rl(n.repoInfo_,(i,r,s,o)=>{hw(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>dw(n,!0),0);else{if(typeof t!="undefined"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ve(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Bn(n.repoInfo_,e,(i,r,s,o)=>{hw(n,i,r,s,o)},i=>{dw(n,i)},i=>{vB(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=e$(n.repoInfo_,()=>new iV(n.stats_,n.server_)),n.infoData_=new J$,n.infoSyncTree_=new cw({startListening:(i,r,s,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=ec(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),um(n,"connected",!1),n.serverSyncTree_=new cw({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{const l=o(a,c);zt(n.eventQueue_,i._path,l)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function hC(n){const t=n.infoData_.getNode(new H(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function rc(n){return rB({timestamp:hC(n)})}function hw(n,e,t,i,r){n.dataUpdateCount++;const s=new H(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){const c=Kc(t,l=>oe(l));o=JV(n.serverSyncTree_,s,c,r)}else{const c=oe(t);o=XV(n.serverSyncTree_,s,c,r)}else if(i){const c=Kc(t,l=>oe(l));o=zV(n.serverSyncTree_,s,c)}else{const c=oe(t);o=ec(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=Ds(n,s)),zt(n.eventQueue_,a,o)}function dw(n,e){um(n,"connected",e),e===!1&&TB(n)}function vB(n,e){$e(e,(t,i)=>{um(n,t,i)})}function um(n,e,t){const i=new H("/.info/"+e),r=oe(t);n.infoData_.updateSnapshot(i,r);const s=ec(n.infoSyncTree_,i,r);zt(n.eventQueue_,i,s)}function sh(n){return n.nextWriteId_++}function IB(n,e){const t=ZV(n.serverSyncTree_,e);return t!=null?Promise.resolve(t):n.server_.get(e).then(i=>{const r=oe(i).withIndex(e._queryParams.getIndex()),s=ec(n.serverSyncTree_,e._path,r);return lm(n.eventQueue_,e._path,s),Promise.resolve(r)},i=>(to(n,"get for query "+ve(e)+" failed: "+i),Promise.reject(new Error(i))))}function hm(n,e,t,i,r){to(n,"set",{path:e.toString(),value:t,priority:i});const s=rc(n),o=oe(t,i),a=Zu(n.serverSyncTree_,e),c=rm(o,a,s),l=sh(n),u=Jg(n.serverSyncTree_,e,c,l,!0);rh(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const p=d==="ok";p||gt("set at "+e+" failed: "+d);const _=oi(n.serverSyncTree_,l,!p);zt(n.eventQueue_,e,_),bi(n,r,d,f)});const h=fm(n,e);Ds(n,h),zt(n.eventQueue_,h,[])}function EB(n,e,t,i){to(n,"update",{path:e.toString(),value:t});let r=!0;const s=rc(n),o={};if($e(t,(a,c)=>{r=!1,o[a]=iC(ie(e,a),oe(c),n.serverSyncTree_,s)}),r)Ae("update() called with empty data.  Don't do anything."),bi(n,i,"ok",void 0);else{const a=sh(n),c=HV(n.serverSyncTree_,e,o,a);rh(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,u)=>{const h=l==="ok";h||gt("update at "+e+" failed: "+l);const d=oi(n.serverSyncTree_,a,!h),f=d.length>0?Ds(n,e):e;zt(n.eventQueue_,f,d),bi(n,i,l,u)}),$e(t,l=>{const u=fm(n,ie(e,l));Ds(n,u)}),zt(n.eventQueue_,e,[])}}function TB(n){to(n,"onDisconnectEvents");const e=rc(n),t=Nl();lf(n.onDisconnect_,K(),(r,s)=>{const o=iC(r,s,n.serverSyncTree_,e);Zs(t,r,o)});let i=[];lf(t,K(),(r,s)=>{i=i.concat(ec(n.serverSyncTree_,r,s));const o=fm(n,r);Ds(n,o)}),n.onDisconnect_=Nl(),zt(n.eventQueue_,K(),i)}function bB(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&cf(n.onDisconnect_,e),bi(n,t,i,r)})}function fw(n,e,t,i){const r=oe(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&Zs(n.onDisconnect_,e,r),bi(n,i,s,o)})}function SB(n,e,t,i,r){const s=oe(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Zs(n.onDisconnect_,e,s),bi(n,r,o,a)})}function CB(n,e,t,i){if(jc(t)){Ae("onDisconnect().update() called with empty data.  Don't do anything."),bi(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&$e(t,(o,a)=>{const c=oe(a);Zs(n.onDisconnect_,ie(e,o),c)}),bi(n,i,r,s)})}function kB(n,e,t){let i;M(e._path)===".info"?i=lw(n.infoSyncTree_,e,t):i=lw(n.serverSyncTree_,e,t),lm(n.eventQueue_,e._path,i)}function _f(n,e,t){let i;M(e._path)===".info"?i=gf(n.infoSyncTree_,e,t):i=gf(n.serverSyncTree_,e,t),lm(n.eventQueue_,e._path,i)}function dC(n){n.persistentConnection_&&n.persistentConnection_.interrupt(uC)}function AB(n){n.persistentConnection_&&n.persistentConnection_.resume(uC)}function to(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ae(t,...e)}function bi(n,e,t,i){e&&Js(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let s=r;i&&(s+=": "+i);const o=new Error(s);o.code=r,e(o)}})}function RB(n,e,t,i,r,s){to(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:aS(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=dm(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{nc("transaction failed: Data returned ",c,o.path),o.status=0;const l=th(n.transactionQueueTree_,e),u=Ur(l)||[];u.push(o),am(l,u);let h;typeof c=="object"&&c!==null&&xt(c,".priority")?(h=Zi(c,".priority"),T(da(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(Zu(n.serverSyncTree_,e)||A.EMPTY_NODE).getPriority().val();const d=rc(n),f=oe(c,h),p=rm(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=sh(n);const _=Jg(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);zt(n.eventQueue_,e,_),oh(n,n.transactionQueueTree_)}}function dm(n,e,t){return Zu(n.serverSyncTree_,e,t)||A.EMPTY_NODE}function oh(n,e=n.transactionQueueTree_){if(e||ah(n,e),Ur(e)){const t=pC(n,e);T(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&NB(n,tc(e),t)}else rC(e)&&nh(e,t=>{oh(n,t)})}function NB(n,e,t){const i=t.map(l=>l.currentWriteId),r=dm(n,e,i);let s=r;const o=r.hash();for(let l=0;l<t.length;l++){const u=t[l];T(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=pt(e,u.path);s=s.updateChild(h,u.currentOutputSnapshotRaw)}const a=s.val(!0),c=e;n.server_.put(c.toString(),a,l=>{to(n,"transaction put response",{path:c.toString(),status:l});let u=[];if(l==="ok"){const h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(oi(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();ah(n,th(n.transactionQueueTree_,e)),oh(n,n.transactionQueueTree_),zt(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Js(h[d])}else{if(l==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{gt("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=l}Ds(n,e)}},o)}function Ds(n,e){const t=fC(n,e),i=tc(t),r=pC(n,t);return PB(n,r,i),i}function PB(n,e,t){if(e.length===0)return;const i=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],l=pt(t,c.path);let u=!1,h;if(T(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,r=r.concat(oi(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=_B)u=!0,h="maxretry",r=r.concat(oi(n.serverSyncTree_,c.currentWriteId,!0));else{const d=dm(n,c.path,o);c.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){nc("transaction failed: Data returned ",f,c.path);let p=oe(f);typeof f=="object"&&f!=null&&xt(f,".priority")||(p=p.updatePriority(d.getPriority()));const v=c.currentWriteId,P=rc(n),V=rm(p,d,P);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=V,c.currentWriteId=sh(n),o.splice(o.indexOf(v),1),r=r.concat(Jg(n.serverSyncTree_,c.path,V,c.currentWriteId,c.applyLocally)),r=r.concat(oi(n.serverSyncTree_,v,!0))}else u=!0,h="nodata",r=r.concat(oi(n.serverSyncTree_,c.currentWriteId,!0))}zt(n.eventQueue_,t,r),r=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}ah(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Js(i[a]);oh(n,n.transactionQueueTree_)}function fC(n,e){let t,i=n.transactionQueueTree_;for(t=M(e);t!==null&&Ur(i)===void 0;)i=th(i,t),e=Y(e),t=M(e);return i}function pC(n,e){const t=[];return gC(n,e,t),t.sort((i,r)=>i.order-r.order),t}function gC(n,e,t){const i=Ur(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);nh(e,r=>{gC(n,r,t)})}function ah(n,e){const t=Ur(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,am(e,t.length>0?t:void 0)}nh(e,i=>{ah(n,i)})}function fm(n,e){const t=tc(fC(n,e)),i=th(n.transactionQueueTree_,e);return cB(i,r=>{Xh(n,r)}),Xh(n,i),sC(i,r=>{Xh(n,r)}),t}function Xh(n,e){const t=Ur(e);if(t){const i=[];let r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(T(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(T(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(oi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?am(e,void 0):t.length=s+1,zt(n.eventQueue_,tc(e),r);for(let o=0;o<i.length;o++)Js(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OB(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function DB(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):gt(`Invalid query segment '${t}' in query '${n}'`)}return e}const yf=function(n,e){const t=xB(n),i=t.namespace;t.domain==="firebase.com"&&En(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&En("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||BU();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new IS(t.host,t.secure,i,e,r,"",i!==t.subdomain),path:new H(t.pathString)}},xB=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(r=OB(n.substring(u,h)));const d=DB(n.substring(Math.min(n.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),s=i}"ns"in d&&(s=d.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ve(this.snapshot.exportVal())}}class _C{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return T(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MB{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new we;return bB(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Bt("OnDisconnect.remove",this._path);const e=new we;return fw(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Bt("OnDisconnect.set",this._path),bn("OnDisconnect.set",e,this._path,!1);const t=new we;return fw(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Bt("OnDisconnect.setWithPriority",this._path),bn("OnDisconnect.setWithPriority",e,this._path,!1),cm("OnDisconnect.setWithPriority",t,!1);const i=new we;return SB(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Bt("OnDisconnect.update",this._path),aC("OnDisconnect.update",e,this._path,!1);const t=new we;return CB(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return L(this._path)?null:Ug(this._path)}get ref(){return new Qt(this._repo,this._path)}get _queryIdentifier(){const e=Jy(this._queryParams),t=Og(e);return t==="{}"?"default":t}get _queryObject(){return Jy(this._queryParams)}isEqual(e){if(e=w(e),!(e instanceof St))return!1;const t=this._repo===e._repo,i=$g(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+T$(this._path)}}function ch(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ri(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===_n){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Hn)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==Tn)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===J){if(e!=null&&!da(e)||t!=null&&!da(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(T(n.getIndex()instanceof qg||n.getIndex()===jg,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function lh(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Qt extends St{constructor(e,t){super(e,t,new zu,!1)}get parent(){const e=NS(this._path);return e===null?null:new Qt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class _r{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new H(e),i=yr(this.ref,e);return new _r(this._node.getChild(t),i,J)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new _r(r,yr(this.ref,i),J)))}hasChild(e){const t=new H(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function wC(n,e){return n=w(n),n._checkNotDeleted("ref"),e!==void 0?yr(n._root,e):n._root}function pw(n,e){n=w(n),n._checkNotDeleted("refFromURL");const t=yf(e,n._repo.repoInfo_.nodeAdmin);cC("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&En("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),wC(n,t.path.toString())}function yr(n,e){return n=w(n),M(n._path)===null?pB("child","path",e,!1):fa("child","path",e,!1),new Qt(n._repo,ie(n._path,e))}function LB(n,e){n=w(n),Bt("push",n._path),bn("push",e,n._path,!0);const t=hC(n._repo),i=K$(t),r=yr(n,i),s=yr(n,i);let o;return e!=null?o=pm(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function FB(n){return Bt("remove",n._path),pm(n,null)}function pm(n,e){n=w(n),Bt("set",n._path),bn("set",e,n._path,!1);const t=new we;return hm(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function UB(n,e){n=w(n),Bt("setPriority",n._path),cm("setPriority",e,!1);const t=new we;return hm(n._repo,ie(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function $B(n,e,t){if(Bt("setWithPriority",n._path),bn("setWithPriority",e,n._path,!1),cm("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new we;return hm(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function VB(n,e){aC("update",e,n._path,!1);const t=new we;return EB(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function BB(n){return n=w(n),IB(n._repo,n).then(e=>new _r(e,new Qt(n._repo,n._path),n._queryParams.getIndex()))}class uh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new mC("value",this,new _r(e.snapshotNode,new Qt(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new _C(this,e,t):null}matches(e){return e instanceof uh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class hh{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new _C(this,e,t):null}createEvent(e,t){T(e.childName!=null,"Child events should have a childName.");const i=yr(new Qt(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new mC(e.type,this,new _r(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof hh?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function sc(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){const c=t,l=(u,h)=>{_f(n._repo,n,a),c(u,h)};l.userCallback=t.userCallback,l.context=t.context,t=l}const o=new yC(t,s||void 0),a=e==="value"?new uh(o):new hh(e,o);return kB(n._repo,n,a),()=>_f(n._repo,n,a)}function wf(n,e,t,i){return sc(n,"value",e,t,i)}function gw(n,e,t,i){return sc(n,"child_added",e,t,i)}function mw(n,e,t,i){return sc(n,"child_changed",e,t,i)}function _w(n,e,t,i){return sc(n,"child_moved",e,t,i)}function yw(n,e,t,i){return sc(n,"child_removed",e,t,i)}function ww(n,e,t){let i=null;const r=t?new yC(t):null;e==="value"?i=new uh(r):e&&(i=new hh(e,r)),_f(n._repo,n,i)}class on{}class vC extends on{constructor(e,t){super();this._value=e,this._key=t}_apply(e){bn("endAt",this._value,e._path,!0);const t=af(e._queryParams,this._value,this._key);if(lh(t),Ri(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}}function qB(n,e){return ic("endAt","key",e,!0),new vC(n,e)}class jB extends on{constructor(e,t){super();this._value=e,this._key=t}_apply(e){bn("endBefore",this._value,e._path,!1);const t=X$(e._queryParams,this._value,this._key);if(lh(t),Ri(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}}function KB(n,e){return ic("endBefore","key",e,!0),new jB(n,e)}class IC extends on{constructor(e,t){super();this._value=e,this._key=t}_apply(e){bn("startAt",this._value,e._path,!0);const t=of(e._queryParams,this._value,this._key);if(lh(t),Ri(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}}function WB(n=null,e){return ic("startAt","key",e,!0),new IC(n,e)}class GB extends on{constructor(e,t){super();this._value=e,this._key=t}_apply(e){bn("startAfter",this._value,e._path,!1);const t=Y$(e._queryParams,this._value,this._key);if(lh(t),Ri(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new St(e._repo,e._path,t,e._orderByCalled)}}function HB(n,e){return ic("startAfter","key",e,!0),new GB(n,e)}class zB extends on{constructor(e){super();this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new St(e._repo,e._path,z$(e._queryParams,this._limit),e._orderByCalled)}}function QB(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new zB(n)}class YB extends on{constructor(e){super();this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new St(e._repo,e._path,Q$(e._queryParams,this._limit),e._orderByCalled)}}function XB(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new YB(n)}class JB extends on{constructor(e){super();this._path=e}_apply(e){ch(e,"orderByChild");const t=new H(this._path);if(L(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new qg(t),r=Qu(e._queryParams,i);return Ri(r),new St(e._repo,e._path,r,!0)}}function ZB(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return fa("orderByChild","path",n,!1),new JB(n)}class eq extends on{_apply(e){ch(e,"orderByKey");const t=Qu(e._queryParams,_n);return Ri(t),new St(e._repo,e._path,t,!0)}}function tq(){return new eq}class nq extends on{_apply(e){ch(e,"orderByPriority");const t=Qu(e._queryParams,J);return Ri(t),new St(e._repo,e._path,t,!0)}}function iq(){return new nq}class rq extends on{_apply(e){ch(e,"orderByValue");const t=Qu(e._queryParams,jg);return Ri(t),new St(e._repo,e._path,t,!0)}}function sq(){return new rq}class oq extends on{constructor(e,t){super();this._value=e,this._key=t}_apply(e){if(bn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new vC(this._value,this._key)._apply(new IC(this._value,this._key)._apply(e))}}function aq(n,e){return ic("equalTo","key",e,!0),new oq(n,e)}function Yt(n,...e){let t=w(n);for(const i of e)t=i._apply(t);return t}$V(Qt);KV(Qt);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cq="FIREBASE_DATABASE_EMULATOR_HOST",vf={};let lq=!1;function uq(n,e,t,i){n.repoInfo_=new IS(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),i&&(n.authTokenProvider_=i)}function EC(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||En("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ae("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=yf(s,r),a=o.repoInfo,c,l;typeof process!="undefined"&&(l=process.env[cq]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=yf(s,r),a=o.repoInfo):c=!o.repoInfo.secure;const u=r&&c?new as(as.OWNER):new YU(n.name,n.options,e);cC("Invalid Firebase Database URL",o),L(o.path)||En("Database URL must point to the root of a Firebase Database (not including a child path).");const h=dq(a,n,u,new QU(n.name,t));return new fq(h,n)}function hq(n,e){const t=vf[e];(!t||t[n.key]!==n)&&En(`Database ${e}(${n.repoInfo_}) has already been deleted.`),dC(n),delete t[n.key]}function dq(n,e,t,i){let r=vf[e.name];r||(r={},vf[e.name]=r);let s=r[n.toURLString()];return s&&En("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new yB(n,lq,t,i),r[n.toURLString()]=s,s}class fq{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(wB(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Qt(this._repo,K())),this._rootInternal}_delete(){return this._rootInternal!==null&&(hq(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&En("Cannot call "+e+" on a deleted database.")}}function pq(n,e,t,i={}){n=w(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&En("Cannot call useEmulator() after instance has already been initialized.");const r=n._repoInternal;let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&En('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new as(as.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:Pf(i.mockUserToken,n.app.options.projectId);s=new as(o)}uq(r,e,t,s)}function gq(n){n=w(n),n._checkNotDeleted("goOffline"),dC(n._repo)}function mq(n){n=w(n),n._checkNotDeleted("goOnline"),AB(n._repo)}function _q(n,e){lS(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yq(n){sS(Rn),le(new q("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return EC(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Q(xy,My,n),Q(xy,My,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wq={".sv":"timestamp"};function vq(){return wq}function Iq(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eq{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Tq(n,e,t){var i;if(n=w(n),Bt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(i=t==null?void 0:t.applyLocally)!==null&&i!==void 0?i:!0,s=new we,o=(c,l,u)=>{let h=null;c?s.reject(c):(h=new _r(u,new Qt(n._repo,n._path),J),s.resolve(new Eq(l,h)))},a=wf(n,()=>{});return RB(n._repo,n._path,e,o,a,r),s.promise}Bn.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Bn.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};yq();const bq="@firebase/database-compat",Sq="0.1.5";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cq=new Cn("@firebase/database-compat"),TC=function(n){const e="FIREBASE WARNING: "+n;Cq.warn(e)};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kq=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(Tt(n,e)+"must be a boolean.")},Aq=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Tt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rq{constructor(e){this._delegate=e}cancel(e){R("OnDisconnect.cancel",0,1,arguments.length),Se("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){R("OnDisconnect.remove",0,1,arguments.length),Se("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){R("OnDisconnect.set",1,2,arguments.length),Se("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){R("OnDisconnect.setWithPriority",2,3,arguments.length),Se("OnDisconnect.setWithPriority","onComplete",i,!0);const r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if(R("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,TC("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Se("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nq{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return R("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,t){this._database=e,this._delegate=t}val(){return R("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return R("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return R("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return R("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return R("DataSnapshot.child",0,1,arguments.length),e=String(e),fa("DataSnapshot.child","path",e,!1),new hi(this._database,this._delegate.child(e))}hasChild(e){return R("DataSnapshot.hasChild",1,1,arguments.length),fa("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return R("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return R("DataSnapshot.forEach",1,1,arguments.length),Se("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new hi(this._database,t)))}hasChildren(){return R("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return R("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return R("DataSnapshot.ref",0,0,arguments.length),new Rt(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Ke{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;R("Query.on",2,4,arguments.length),Se("Query.on","callback",t,!1);const o=Ke.getCancelAndContextArgs_("Query.on",i,r),a=(l,u)=>{t.call(o.context,new hi(this.database,l),u)};a.userCallback=t,a.context=o.context;const c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return wf(this._delegate,a,c),t;case"child_added":return gw(this._delegate,a,c),t;case"child_removed":return yw(this._delegate,a,c),t;case"child_changed":return mw(this._delegate,a,c),t;case"child_moved":return _w(this._delegate,a,c),t;default:throw new Error(Tt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(R("Query.off",0,3,arguments.length),Aq("Query.off",e,!0),Se("Query.off","callback",t,!0),qm("Query.off","context",i,!0),t){const r=()=>{};r.userCallback=t,r.context=i,ww(this._delegate,e,r)}else ww(this._delegate,e)}get(){return BB(this._delegate).then(e=>new hi(this.database,e))}once(e,t,i,r){R("Query.once",1,4,arguments.length),Se("Query.once","callback",t,!0);const s=Ke.getCancelAndContextArgs_("Query.once",i,r),o=new we,a=(l,u)=>{const h=new hi(this.database,l);t&&t.call(s.context,h,u),o.resolve(h)};a.userCallback=t,a.context=s.context;const c=l=>{s.cancel&&s.cancel.call(s.context,l),o.reject(l)};switch(e){case"value":wf(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":gw(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":yw(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":mw(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":_w(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(Tt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return R("Query.limitToFirst",1,1,arguments.length),new Ke(this.database,Yt(this._delegate,QB(e)))}limitToLast(e){return R("Query.limitToLast",1,1,arguments.length),new Ke(this.database,Yt(this._delegate,XB(e)))}orderByChild(e){return R("Query.orderByChild",1,1,arguments.length),new Ke(this.database,Yt(this._delegate,ZB(e)))}orderByKey(){return R("Query.orderByKey",0,0,arguments.length),new Ke(this.database,Yt(this._delegate,tq()))}orderByPriority(){return R("Query.orderByPriority",0,0,arguments.length),new Ke(this.database,Yt(this._delegate,iq()))}orderByValue(){return R("Query.orderByValue",0,0,arguments.length),new Ke(this.database,Yt(this._delegate,sq()))}startAt(e=null,t){return R("Query.startAt",0,2,arguments.length),new Ke(this.database,Yt(this._delegate,WB(e,t)))}startAfter(e=null,t){return R("Query.startAfter",0,2,arguments.length),new Ke(this.database,Yt(this._delegate,HB(e,t)))}endAt(e=null,t){return R("Query.endAt",0,2,arguments.length),new Ke(this.database,Yt(this._delegate,qB(e,t)))}endBefore(e=null,t){return R("Query.endBefore",0,2,arguments.length),new Ke(this.database,Yt(this._delegate,KB(e,t)))}equalTo(e,t){return R("Query.equalTo",1,2,arguments.length),new Ke(this.database,Yt(this._delegate,aq(e,t)))}toString(){return R("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return R("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(R("Query.isEqual",1,1,arguments.length),!(e instanceof Ke)){const t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,Se(e,"cancel",r.cancel,!0),r.context=i,qm(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error(Tt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new Rt(this.database,new Qt(this._delegate._repo,this._delegate._path))}}class Rt extends Ke{constructor(e,t){super(e,new St(t._repo,t._path,new zu,!1));this.database=e,this._delegate=t}getKey(){return R("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return R("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new Rt(this.database,yr(this._delegate,e))}getParent(){R("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Rt(this.database,e):null}getRoot(){return R("Reference.root",0,0,arguments.length),new Rt(this.database,this._delegate.root)}set(e,t){R("Reference.set",1,2,arguments.length),Se("Reference.set","onComplete",t,!0);const i=pm(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if(R("Reference.update",1,2,arguments.length),Array.isArray(e)){const r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,TC("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Bt("Reference.update",this._delegate._path),Se("Reference.update","onComplete",t,!0);const i=VB(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){R("Reference.setWithPriority",2,3,arguments.length),Se("Reference.setWithPriority","onComplete",i,!0);const r=$B(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){R("Reference.remove",0,1,arguments.length),Se("Reference.remove","onComplete",e,!0);const t=FB(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){R("Reference.transaction",1,3,arguments.length),Se("Reference.transaction","transactionUpdate",e,!1),Se("Reference.transaction","onComplete",t,!0),kq("Reference.transaction","applyLocally",i,!0);const r=Tq(this._delegate,e,{applyLocally:i}).then(s=>new Nq(s.committed,new hi(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){R("Reference.setPriority",1,2,arguments.length),Se("Reference.setPriority","onComplete",t,!0);const i=UB(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){R("Reference.push",0,2,arguments.length),Se("Reference.push","onComplete",t,!0);const i=LB(this._delegate,e),r=i.then(o=>new Rt(this.database,o));t&&r.then(()=>t(null),o=>t(o));const s=new Rt(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return Bt("Reference.onDisconnect",this._delegate._path),new Rq(new MB(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,i={}){pq(this._delegate,e,t,i)}ref(e){if(R("database.ref",0,1,arguments.length),e instanceof Rt){const t=pw(this._delegate,e.toString());return new Rt(this,t)}else{const t=wC(this._delegate,e);return new Rt(this,t)}}refFromURL(e){R("database.refFromURL",1,1,arguments.length);const i=pw(this._delegate,e);return new Rt(this,i)}goOffline(){return R("database.goOffline",0,0,arguments.length),gq(this._delegate)}goOnline(){return R("database.goOnline",0,0,arguments.length),mq(this._delegate)}}pa.ServerValue={TIMESTAMP:vq(),increment:n=>Iq(n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pq({app:n,url:e,version:t,customAuthImpl:i,namespace:r,nodeAdmin:s=!1}){sS(t);const o=new yv("auth-internal",new wv("database-standalone"));return o.setComponent(new q("auth-internal",()=>i,"PRIVATE")),{instance:new pa(EC(n,o,void 0,e,s),n),namespace:r}}var Oq=Object.freeze({__proto__:null,initStandalone:Pq});/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dq=pa.ServerValue;function xq(n){n.INTERNAL.registerComponent(new q("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new pa(r,i)},"PUBLIC").setServiceProps({Reference:Rt,Query:Ke,Database:pa,DataSnapshot:hi,enableLogging:_q,INTERNAL:Oq,ServerValue:Dq}).setMultipleInstances(!0)),n.registerVersion(bq,Sq)}xq(je);const Mq="@firebase/firestore-compat",Lq="0.1.14";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gm(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vw(){if(typeof Uint8Array=="undefined")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Iw(){if(!HO())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}class ga{constructor(e){this._delegate=e}static fromBase64String(e){return Iw(),new ga(In.fromBase64String(e))}static fromUint8Array(e){return vw(),new ga(In.fromUint8Array(e))}toBase64(){return Iw(),this._delegate.toBase64()}toUint8Array(){return vw(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(n){return Fq(n,["next","error","complete"])}function Fq(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uq{enableIndexedDbPersistence(e,t){return RM(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return NM(e._delegate)}clearIndexedDbPersistence(e){return PM(e._delegate)}}class bC{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof sr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Go("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){bM(this._delegate,e,t,i)}enableNetwork(){return DM(this._delegate)}disableNetwork(){return xM(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,qT("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return OM(this._delegate)}onSnapshotsInSync(e){return dL(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new xs(this,KT(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new qt(this,_l(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ot(this,SM(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return pL(this._delegate,t=>e(new SC(this,t)))}batch(){return qe(this._delegate),new CC(new iL(this._delegate,e=>Qa(this._delegate,e)))}loadBundle(e){return MM(this._delegate,e)}namedQuery(e){return LM(this._delegate,e).then(t=>t?new ot(this,t):null)}}class dh extends wg{constructor(e){super();this.firestore=e}convertBytes(e){return new ga(new In(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return qt.forKey(t,this.firestore,null)}}function $q(n){LO(n)}class SC{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new dh(e)}get(e){const t=Wi(e);return this._delegate.get(t).then(i=>new ma(this._firestore,new Gn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const r=Wi(e);return i?(gm("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=Wi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=Wi(e);return this._delegate.delete(t),this}}class CC{constructor(e){this._delegate=e}set(e,t,i){const r=Wi(e);return i?(gm("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=Wi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=Wi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class wr{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new Co(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new _a(this._firestore,i),t!=null?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=wr.INSTANCES;let r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new wr(e,new dh(e),t),r.set(t,s)),s}}wr.INSTANCES=new WeakMap;class qt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new dh(e)}static forPath(e,t,i){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new qt(t,new ee(t._delegate,i,new S(e)))}static forKey(e,t,i){return new qt(t,new ee(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new xs(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new xs(this.firestore,KT(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=w(e),e instanceof ee?WT(this._delegate,e):!1}set(e,t){t=gm("DocumentReference.set",t);try{return t?gy(this._delegate,e,t):gy(this._delegate,e)}catch(i){throw at(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?my(this._delegate,e):my(this._delegate,e,t,...i)}catch(r){throw at(r,"updateDoc()","DocumentReference.update()")}}delete(){return uL(this._delegate)}onSnapshot(...e){const t=kC(e),i=AC(e,r=>new ma(this.firestore,new Gn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return ub(this._delegate,t,i)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=sL(this._delegate):(e==null?void 0:e.source)==="server"?t=oL(this._delegate):t=rL(this._delegate),t.then(i=>new ma(this.firestore,new Gn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new qt(this.firestore,e?this._delegate.withConverter(wr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function at(n,e,t){return n.message=n.message.replace(e,t),n}function kC(n){for(const e of n)if(typeof e=="object"&&!If(e))return e;return{}}function AC(n,e){var t,i;let r;return If(n[0])?r=n[0]:If(n[1])?r=n[1]:typeof n[0]=="function"?r={next:n[0],error:n[1],complete:n[2]}:r={next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:(t=r.error)===null||t===void 0?void 0:t.bind(r),complete:(i=r.complete)===null||i===void 0?void 0:i.bind(r)}}class ma{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new qt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ib(this._delegate,e._delegate)}}class _a extends ma{data(e){const t=this._delegate.data(e);return FO(t!==void 0),t}}class ot{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new dh(e)}where(e,t,i){try{return new ot(this.firestore,ti(this._delegate,HM(e,t,i)))}catch(r){throw at(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ot(this.firestore,ti(this._delegate,QM(e,t)))}catch(i){throw at(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ot(this.firestore,ti(this._delegate,YM(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ot(this.firestore,ti(this._delegate,XM(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ot(this.firestore,ti(this._delegate,JM(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ot(this.firestore,ti(this._delegate,ZM(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ot(this.firestore,ti(this._delegate,eL(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ot(this.firestore,ti(this._delegate,tL(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return GT(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=cL(this._delegate):(e==null?void 0:e.source)==="server"?t=lL(this._delegate):t=aL(this._delegate),t.then(i=>new Ef(this.firestore,new vi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=kC(e),i=AC(e,r=>new Ef(this.firestore,new vi(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return ub(this._delegate,t,i)}withConverter(e){return new ot(this.firestore,e?this._delegate.withConverter(wr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Vq{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new _a(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Ef{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ot(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new _a(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Vq(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new _a(this._firestore,i))})}isEqual(e){return ib(this._delegate,e._delegate)}}class xs extends ot{constructor(e,t){super(e,t);this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new qt(this.firestore,e):null}doc(e){try{return e===void 0?new qt(this.firestore,_l(this._delegate)):new qt(this.firestore,_l(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return hL(this._delegate,e).then(t=>new qt(this.firestore,t))}isEqual(e){return WT(this._delegate,e._delegate)}withConverter(e){return new xs(this.firestore,e?this._delegate.withConverter(wr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Wi(n){return B(n,ee)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(...e){this._delegate=new wi(...e)}static documentId(){return new mm(Re.keyField().canonicalString())}isEqual(e){return e=w(e),e instanceof wi?this._delegate._internalPath.isEqual(e._internalPath):!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e){this._delegate=e}static serverTimestamp(){const e=mL();return e._methodName="FieldValue.serverTimestamp",new Fi(e)}static delete(){const e=gL();return e._methodName="FieldValue.delete",new Fi(e)}static arrayUnion(...e){const t=_L(...e);return t._methodName="FieldValue.arrayUnion",new Fi(t)}static arrayRemove(...e){const t=yL(...e);return t._methodName="FieldValue.arrayRemove",new Fi(t)}static increment(e){const t=wL(e);return t._methodName="FieldValue.increment",new Fi(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bq={Firestore:bC,GeoPoint:Fu,Timestamp:Oe,Blob:ga,Transaction:SC,WriteBatch:CC,DocumentReference:qt,DocumentSnapshot:ma,Query:ot,QueryDocumentSnapshot:_a,QuerySnapshot:Ef,CollectionReference:xs,FieldPath:mm,FieldValue:Fi,setLogLevel:$q,CACHE_SIZE_UNLIMITED:AM};function qq(n,e){n.INTERNAL.registerComponent(new q("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},Bq)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jq(n){qq(n,(e,t)=>new bC(e,t,new Uq)),n.registerVersion(Mq,Lq)}jq(je);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kq="type.googleapis.com/google.protobuf.Int64Value",Wq="type.googleapis.com/google.protobuf.UInt64Value";function RC(n,e){const t={};for(const i in n)n.hasOwnProperty(i)&&(t[i]=e(n[i]));return t}function Tf(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Tf(e));if(typeof n=="function"||typeof n=="object")return RC(n,e=>Tf(e));throw new Error("Data cannot be encoded in JSON: "+n)}function $l(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case Kq:case Wq:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>$l(e)):typeof n=="function"||typeof n=="object"?RC(n,e=>$l(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class cs extends de{constructor(e,t,i){super(`${NC}/${e}`,t||"");this.details=i}}function Gq(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Hq(n,e){let t=Gq(n),i=t,r;try{const s=e&&e.error;if(s){const o=s.status;if(typeof o=="string"){if(!Ew[o])return new cs("internal","internal");t=Ew[o],i=o}const a=s.message;typeof a=="string"&&(i=a),r=s.details,r!==void 0&&(r=$l(r))}}catch{}return t==="ok"?null:new cs(t,i,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zq{constructor(e,t,i){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(r=>this.auth=r,()=>{}),this.messaging||t.get().then(r=>this.messaging=r,()=>{}),this.appCheck||i.get().then(r=>this.appCheck=r,()=>{})}async getAuthToken(){if(!!this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(){if(this.appCheck){const e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){const e=await this.getAuthToken(),t=await this.getMessagingToken(),i=await this.getAppCheckToken();return{authToken:e,messagingToken:t,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tw="us-central1";function Qq(n){let e=null;return{promise:new Promise((t,i)=>{e=setTimeout(()=>{i(new cs("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class Yq{constructor(e,t,i,r,s=Tw,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new zq(t,i,r),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(s);this.customDomain=a.origin,this.region=Tw}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function Xq(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function Jq(n,e,t){return i=>ej(n,e,i,t||{})}async function Zq(n,e,t,i){t["Content-Type"]="application/json";let r;try{r=await i(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let s=null;try{s=await r.json()}catch{}return{status:r.status,json:s}}async function ej(n,e,t,i){const r=n._url(e);t=Tf(t);const s={data:t},o={},a=await n.contextProvider.getContext();a.authToken&&(o.Authorization="Bearer "+a.authToken),a.messagingToken&&(o["Firebase-Instance-ID-Token"]=a.messagingToken),a.appCheckToken!==null&&(o["X-Firebase-AppCheck"]=a.appCheckToken);const c=i.timeout||7e4,l=Qq(c),u=await Promise.race([Zq(r,s,o,n.fetchImpl),l.promise,n.cancelAllRequests]);if(l.cancel(),!u)throw new cs("cancelled","Firebase Functions instance was deleted.");const h=Hq(u.status,u.json);if(h)throw h;if(!u.json)throw new cs("internal","Response is not valid JSON object.");let d=u.json.data;if(typeof d=="undefined"&&(d=u.json.result),typeof d=="undefined")throw new cs("internal","Response is missing data field.");return{data:$l(d)}}const bw="@firebase/functions",Sw="0.7.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tj="auth-internal",nj="app-check-internal",ij="messaging-internal";function rj(n,e){const t=(i,{instanceIdentifier:r})=>{const s=i.getProvider("app").getImmediate(),o=i.getProvider(tj),a=i.getProvider(ij),c=i.getProvider(nj);return new Yq(s,o,a,c,r,n)};le(new q(NC,t,"PUBLIC").setMultipleInstances(!0)),Q(bw,Sw,e),Q(bw,Sw,"esm2017")}function Cw(n,e,t){Xq(w(n),e,t)}function sj(n,e,t){return Jq(w(n),e,t)}rj(fetch.bind(self));const oj="@firebase/functions-compat",aj="0.1.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return sj(this._delegate,e,t)}useFunctionsEmulator(e){const t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(t==null)throw new de("functions","No origin provided to useFunctionsEmulator()");if(t[2]==null)throw new de("functions","Port missing in origin provided to useFunctionsEmulator()");return Cw(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return Cw(this._delegate,e,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cj="us-central1",lj=(n,{instanceIdentifier:e})=>{const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("functions").getImmediate({identifier:e!=null?e:cj});return new PC(t,i)};function uj(){const n={Functions:PC};je.INTERNAL.registerComponent(new q("functions-compat",lj,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */uj();je.registerVersion(oj,aj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj="/firebase-messaging-sw.js",dj="/firebase-cloud-messaging-push-scope",OC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",fj="https://fcmregistrations.googleapis.com/v1",DC="google.c.a.c_id",pj="google.c.a.c_l",gj="google.c.a.ts",mj="google.c.a.e";var kw;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(kw||(kw={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var ya;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(ya||(ya={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _j(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jh="fcm_token_details_db",yj=5,Aw="fcm_token_object_Store";async function wj(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(s=>s.name).includes(Jh))return null;let e=null;return(await Fs(Jh,yj,async i=>{var r;if(i.oldVersion<2||!i.objectStoreNames.contains(Aw))return;const s=i.transaction.objectStore(Aw),o=await s.index("fcmSenderId").get(n);if(await s.clear(),!!o){if(i.oldVersion===2){const a=o;if(!a.auth||!a.p256dh||!a.endpoint)return;e={token:a.fcmToken,createTime:(r=a.createTime)!==null&&r!==void 0?r:Date.now(),subscriptionOptions:{auth:a.auth,p256dh:a.p256dh,endpoint:a.endpoint,swScope:a.swScope,vapidKey:typeof a.vapidKey=="string"?a.vapidKey:Pn(a.vapidKey)}}}else if(i.oldVersion===3){const a=o;e={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:Pn(a.auth),p256dh:Pn(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:Pn(a.vapidKey)}}}else if(i.oldVersion===4){const a=o;e={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:Pn(a.auth),p256dh:Pn(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:Pn(a.vapidKey)}}}}})).close(),await Zr(Jh),await Zr("fcm_vapid_details_db"),await Zr("undefined"),vj(e)?e:null}function vj(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ij="firebase-messaging-database",Ej=1,vr="firebase-messaging-store";let Zh=null;function _m(){return Zh||(Zh=Fs(Ij,Ej,n=>{switch(n.oldVersion){case 0:n.createObjectStore(vr)}})),Zh}async function xC(n){const e=wm(n),i=await(await _m()).transaction(vr).objectStore(vr).get(e);if(i)return i;{const r=await wj(n.appConfig.senderId);if(r)return await ym(n,r),r}}async function ym(n,e){const t=wm(n),r=(await _m()).transaction(vr,"readwrite");return await r.objectStore(vr).put(e,t),await r.complete,e}async function Tj(n){const e=wm(n),i=(await _m()).transaction(vr,"readwrite");await i.objectStore(vr).delete(e),await i.complete}function wm({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bj={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},mt=new _t("messaging","Messaging",bj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sj(n,e){const t=await Im(n),i=LC(e),r={method:"POST",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(vm(n.appConfig),r)).json()}catch(o){throw mt.create("token-subscribe-failed",{errorInfo:o})}if(s.error){const o=s.error.message;throw mt.create("token-subscribe-failed",{errorInfo:o})}if(!s.token)throw mt.create("token-subscribe-no-token");return s.token}async function Cj(n,e){const t=await Im(n),i=LC(e.subscriptionOptions),r={method:"PATCH",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(`${vm(n.appConfig)}/${e.token}`,r)).json()}catch(o){throw mt.create("token-update-failed",{errorInfo:o})}if(s.error){const o=s.error.message;throw mt.create("token-update-failed",{errorInfo:o})}if(!s.token)throw mt.create("token-update-no-token");return s.token}async function MC(n,e){const t=await Im(n),i={method:"DELETE",headers:t};try{const s=await(await fetch(`${vm(n.appConfig)}/${e}`,i)).json();if(s.error){const o=s.error.message;throw mt.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw mt.create("token-unsubscribe-failed",{errorInfo:r})}}function vm({projectId:n}){return`${fj}/projects/${n}/registrations`}async function Im({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function LC({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const r={web:{endpoint:t,auth:e,p256dh:n}};return i!==OC&&(r.web.applicationPubKey=i),r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kj=7*24*60*60*1e3;async function Aj(n){const e=await Nj(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Pn(e.getKey("auth")),p256dh:Pn(e.getKey("p256dh"))},i=await xC(n.firebaseDependencies);if(i){if(Pj(i.subscriptionOptions,t))return Date.now()>=i.createTime+kj?Rj(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await MC(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return Rw(n.firebaseDependencies,t)}else return Rw(n.firebaseDependencies,t)}async function FC(n){const e=await xC(n.firebaseDependencies);e&&(await MC(n.firebaseDependencies,e.token),await Tj(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function Rj(n,e){try{const t=await Cj(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await ym(n.firebaseDependencies,i),t}catch(t){throw await FC(n),t}}async function Rw(n,e){const i={token:await Sj(n,e),createTime:Date.now(),subscriptionOptions:e};return await ym(n,i),i.token}async function Nj(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_j(e)})}function Pj(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,r=e.auth===n.auth,s=e.p256dh===n.p256dh;return t&&i&&r&&s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nw(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return Oj(e,n),Dj(e,n),xj(e,n),e}function Oj(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const r=e.notification.image;r&&(n.notification.image=r)}function Dj(n,e){!e.data||(n.data=e.data)}function xj(n,e){if(!e.fcmOptions)return;n.fcmOptions={};const t=e.fcmOptions.link;t&&(n.fcmOptions.link=t);const i=e.fcmOptions.analytics_label;i&&(n.fcmOptions.analyticsLabel=i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mj(n){return typeof n=="object"&&!!n&&DC in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */UC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");UC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function UC(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lj(n){if(!n||!n.options)throw ed("App Configuration Object");if(!n.name)throw ed("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw ed(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function ed(n){return mt.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=Lj(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $C(n){try{n.swRegistration=await navigator.serviceWorker.register(hj,{scope:dj}),n.swRegistration.update().catch(()=>{})}catch(e){throw mt.create("failed-service-worker-registration",{browserErrorMessage:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uj(n,e){if(!e&&!n.swRegistration&&await $C(n),!(!e&&!!n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw mt.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $j(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=OC)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VC(n,e){if(!navigator)throw mt.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw mt.create("permission-blocked");return await $j(n,e==null?void 0:e.vapidKey),await Uj(n,e==null?void 0:e.serviceWorkerRegistration),Aj(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vj(n,e,t){const i=Bj(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:t[DC],message_name:t[pj],message_time:t[gj],message_device_time:Math.floor(Date.now()/1e3)})}function Bj(n){switch(n){case ya.NOTIFICATION_CLICKED:return"notification_open";case ya.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qj(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===ya.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Nw(t)):n.onMessageHandler.next(Nw(t)));const i=t.data;Mj(i)&&i[mj]==="1"&&await Vj(n,t.messageType,i)}const Pw="@firebase/messaging",Ow="0.9.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jj=n=>{const e=new Fj(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>qj(e,t)),e},Kj=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:i=>VC(e,i)}};function Wj(){le(new q("messaging",jj,"PUBLIC")),le(new q("messaging-internal",Kj,"PRIVATE")),Q(Pw,Ow),Q(Pw,Ow,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gj(n){if(!navigator)throw mt.create("only-available-in-window");return n.swRegistration||await $C(n),FC(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hj(n,e){if(!navigator)throw mt.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}async function zj(n,e){return n=w(n),VC(n,e)}function Qj(n){return n=w(n),Gj(n)}function Yj(n,e){return n=w(n),Hj(n,e)}Wj();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Xj="https://fcmregistrations.googleapis.com/v1",qC="FCM_MSG",Jj="google.c.a.c_id",Zj=3,eK=1;var Vl;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(Vl||(Vl={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Bl;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(Bl||(Bl={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function tK(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const td="fcm_token_details_db",nK=5,Dw="fcm_token_object_Store";async function iK(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(s=>s.name).includes(td))return null;let e=null;return(await Fs(td,nK,async i=>{var r;if(i.oldVersion<2||!i.objectStoreNames.contains(Dw))return;const s=i.transaction.objectStore(Dw),o=await s.index("fcmSenderId").get(n);if(await s.clear(),!!o){if(i.oldVersion===2){const a=o;if(!a.auth||!a.p256dh||!a.endpoint)return;e={token:a.fcmToken,createTime:(r=a.createTime)!==null&&r!==void 0?r:Date.now(),subscriptionOptions:{auth:a.auth,p256dh:a.p256dh,endpoint:a.endpoint,swScope:a.swScope,vapidKey:typeof a.vapidKey=="string"?a.vapidKey:On(a.vapidKey)}}}else if(i.oldVersion===3){const a=o;e={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:On(a.auth),p256dh:On(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:On(a.vapidKey)}}}else if(i.oldVersion===4){const a=o;e={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:On(a.auth),p256dh:On(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:On(a.vapidKey)}}}}})).close(),await Zr(td),await Zr("fcm_vapid_details_db"),await Zr("undefined"),rK(e)?e:null}function rK(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sK="firebase-messaging-database",oK=1,Ir="firebase-messaging-store";let nd=null;function Em(){return nd||(nd=Fs(sK,oK,n=>{switch(n.oldVersion){case 0:n.createObjectStore(Ir)}})),nd}async function Tm(n){const e=Sm(n),i=await(await Em()).transaction(Ir).objectStore(Ir).get(e);if(i)return i;{const r=await iK(n.appConfig.senderId);if(r)return await bm(n,r),r}}async function bm(n,e){const t=Sm(n),r=(await Em()).transaction(Ir,"readwrite");return await r.objectStore(Ir).put(e,t),await r.complete,e}async function aK(n){const e=Sm(n),i=(await Em()).transaction(Ir,"readwrite");await i.objectStore(Ir).delete(e),await i.complete}function Sm({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cK={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},yn=new _t("messaging","Messaging",cK);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lK(n,e){const t=await km(n),i=KC(e),r={method:"POST",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(Cm(n.appConfig),r)).json()}catch(o){throw yn.create("token-subscribe-failed",{errorInfo:o})}if(s.error){const o=s.error.message;throw yn.create("token-subscribe-failed",{errorInfo:o})}if(!s.token)throw yn.create("token-subscribe-no-token");return s.token}async function uK(n,e){const t=await km(n),i=KC(e.subscriptionOptions),r={method:"PATCH",headers:t,body:JSON.stringify(i)};let s;try{s=await(await fetch(`${Cm(n.appConfig)}/${e.token}`,r)).json()}catch(o){throw yn.create("token-update-failed",{errorInfo:o})}if(s.error){const o=s.error.message;throw yn.create("token-update-failed",{errorInfo:o})}if(!s.token)throw yn.create("token-update-no-token");return s.token}async function jC(n,e){const t=await km(n),i={method:"DELETE",headers:t};try{const s=await(await fetch(`${Cm(n.appConfig)}/${e}`,i)).json();if(s.error){const o=s.error.message;throw yn.create("token-unsubscribe-failed",{errorInfo:o})}}catch(r){throw yn.create("token-unsubscribe-failed",{errorInfo:r})}}function Cm({projectId:n}){return`${Xj}/projects/${n}/registrations`}async function km({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function KC({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const r={web:{endpoint:t,auth:e,p256dh:n}};return i!==BC&&(r.web.applicationPubKey=i),r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hK=7*24*60*60*1e3;async function dK(n){const e=await pK(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:On(e.getKey("auth")),p256dh:On(e.getKey("p256dh"))},i=await Tm(n.firebaseDependencies);if(i){if(gK(i.subscriptionOptions,t))return Date.now()>=i.createTime+hK?fK(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await jC(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return xw(n.firebaseDependencies,t)}else return xw(n.firebaseDependencies,t)}async function bf(n){const e=await Tm(n.firebaseDependencies);e&&(await jC(n.firebaseDependencies,e.token),await aK(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function fK(n,e){try{const t=await uK(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await bm(n.firebaseDependencies,i),t}catch(t){throw await bf(n),t}}async function xw(n,e){const i={token:await lK(n,e),createTime:Date.now(),subscriptionOptions:e};return await bm(n,i),i.token}async function pK(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:tK(e)})}function gK(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,r=e.auth===n.auth,s=e.p256dh===n.p256dh;return t&&i&&r&&s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mK(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return _K(e,n),yK(e,n),wK(e,n),e}function _K(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const r=e.notification.image;r&&(n.notification.image=r)}function yK(n,e){!e.data||(n.data=e.data)}function wK(n,e){if(!e.fcmOptions)return;n.fcmOptions={};const t=e.fcmOptions.link;t&&(n.fcmOptions.link=t);const i=e.fcmOptions.analytics_label;i&&(n.fcmOptions.analyticsLabel=i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vK(n){return typeof n=="object"&&!!n&&Jj in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IK(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */WC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");WC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function EK(n,e){const t=TK(e,await n.firebaseDependencies.installations.getId());bK(n,t)}function TK(n,e){var t,i;const r={};return n.from&&(r.project_number=n.from),n.fcmMessageId&&(r.message_id=n.fcmMessageId),r.instance_id=e,n.notification?r.message_type=Vl.DISPLAY_NOTIFICATION.toString():r.message_type=Vl.DATA_MESSAGE.toString(),r.sdk_platform=Zj.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),n.collapse_key&&(r.collapse_key=n.collapse_key),r.event=eK.toString(),((t=n.fcmOptions)===null||t===void 0?void 0:t.analytics_label)&&(r.analytics_label=(i=n.fcmOptions)===null||i===void 0?void 0:i.analytics_label),r}function bK(n,e){const t={};t.event_time_ms=Math.floor(Date.now()).toString(),t.source_extension_json_proto3=JSON.stringify(e),n.logEvents.push(t)}function WC(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SK(n,e){var t,i;const{newSubscription:r}=n;if(!r){await bf(e);return}const s=await Tm(e.firebaseDependencies);await bf(e),e.vapidKey=(i=(t=s==null?void 0:s.subscriptionOptions)===null||t===void 0?void 0:t.vapidKey)!==null&&i!==void 0?i:BC,await dK(e)}async function CK(n,e){const t=RK(n);if(!t)return;e.deliveryMetricsExportedToBigQueryEnabled&&await EK(e,t);const i=await GC();if(PK(i))return OK(i,t);if(t.notification&&await DK(AK(t)),!!e&&e.onBackgroundMessageHandler){const r=mK(t);typeof e.onBackgroundMessageHandler=="function"?await e.onBackgroundMessageHandler(r):e.onBackgroundMessageHandler.next(r)}}async function kK(n){var e,t;const i=(t=(e=n.notification)===null||e===void 0?void 0:e.data)===null||t===void 0?void 0:t[qC];if(i){if(n.action)return}else return;n.stopImmediatePropagation(),n.notification.close();const r=xK(i);if(!r)return;const s=new URL(r,self.location.href),o=new URL(self.location.origin);if(s.host!==o.host)return;let a=await NK(s);if(a?a=await a.focus():(a=await self.clients.openWindow(r),await IK(3e3)),!!a)return i.messageType=Bl.NOTIFICATION_CLICKED,i.isFirebaseMessaging=!0,a.postMessage(i)}function AK(n){const e=Object.assign({},n.notification);return e.data={[qC]:n},e}function RK({data:n}){if(!n)return null;try{return n.json()}catch{return null}}async function NK(n){const e=await GC();for(const t of e){const i=new URL(t.url,self.location.href);if(n.host===i.host)return t}return null}function PK(n){return n.some(e=>e.visibilityState==="visible"&&!e.url.startsWith("chrome-extension://"))}function OK(n,e){e.isFirebaseMessaging=!0,e.messageType=Bl.PUSH_RECEIVED;for(const t of n)t.postMessage(e)}function GC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function DK(n){var e;const{actions:t}=n,{maxActions:i}=Notification;return t&&i&&t.length>i&&console.warn(`This browser only supports ${i} actions. The remaining actions will not be displayed.`),self.registration.showNotification((e=n.title)!==null&&e!==void 0?e:"",n)}function xK(n){var e,t,i;const r=(t=(e=n.fcmOptions)===null||e===void 0?void 0:e.link)!==null&&t!==void 0?t:(i=n.notification)===null||i===void 0?void 0:i.click_action;return r||(vK(n.data)?self.location.origin:null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MK(n){if(!n||!n.options)throw id("App Configuration Object");if(!n.name)throw id("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw id(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function id(n){return yn.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LK{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=MK(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FK=n=>{const e=new LK(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return self.addEventListener("push",t=>{t.waitUntil(CK(t,e))}),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil(SK(t,e))}),self.addEventListener("notificationclick",t=>{t.waitUntil(kK(t))}),e};function UK(){le(new q("messaging-sw",FK,"PUBLIC"))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $K(n,e){if(self.document!==void 0)throw yn.create("only-available-in-sw");return n.onBackgroundMessageHandler=e,()=>{n.onBackgroundMessageHandler=null}}function VK(n,e){return n=w(n),$K(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */UK();const BK="@firebase/messaging-compat",qK="0.1.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jK(){return self&&"ServiceWorkerGlobalScope"in self?WK():KK()}function KK(){return typeof window!="undefined"&&bt()&&zl()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function WK(){return bt()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}class Mw{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return zj(this._delegate,e)}async deleteToken(){return Qj(this._delegate)}onMessage(e){return Yj(this._delegate,e)}onBackgroundMessage(e){return VK(this._delegate,e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GK=n=>self&&"ServiceWorkerGlobalScope"in self?new Mw(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging-sw").getImmediate()):new Mw(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging").getImmediate()),HK={isSupported:jK};function zK(){je.INTERNAL.registerComponent(new q("messaging-compat",GK,"PUBLIC").setServiceProps(HK))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zK();je.registerVersion(BK,qK);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC="firebasestorage.googleapis.com",zC="storageBucket",QK=2*60*1e3,YK=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he extends de{constructor(e,t){super(rd(e),`Firebase Storage: ${t} (${rd(e)})`);this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,he.prototype)}_codeEquals(e){return rd(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function rd(n){return"storage/"+n}function Am(){const n="An unknown error occurred, please check the error payload for server response.";return new he("unknown",n)}function XK(n){return new he("object-not-found","Object '"+n+"' does not exist.")}function JK(n){return new he("quota-exceeded","Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function ZK(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new he("unauthenticated",n)}function eW(){return new he("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function tW(n){return new he("unauthorized","User does not have permission to access '"+n+"'.")}function nW(){return new he("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function QC(){return new he("canceled","User canceled the upload/download.")}function iW(n){return new he("invalid-url","Invalid URL '"+n+"'.")}function rW(n){return new he("invalid-default-bucket","Invalid default bucket '"+n+"'.")}function sW(){return new he("no-default-bucket","No default bucket found. Did you set the '"+zC+"' property when initializing the app?")}function YC(){return new he("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function oW(){return new he("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function aW(){return new he("no-download-url","The given file does not have any download URLs.")}function ls(n){return new he("invalid-argument",n)}function XC(){return new he("app-deleted","The Firebase app was deleted.")}function JC(n){return new he("invalid-root-operation","The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Po(n,e){return new he("invalid-format","String does not match format '"+n+"': "+e)}function po(n){throw new he("internal-error","Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=nt.makeFromUrl(e,t)}catch{return new nt(e,"")}if(i.path==="")return i;throw rW(e)}static makeFromUrl(e,t){let i=null;const r="([A-Za-z0-9.\\-_]+)";function s(z){z.path.charAt(z.path.length-1)==="/"&&(z.path_=z.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+r+o,"i"),c={bucket:1,path:3};function l(z){z.path_=decodeURIComponent(z.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${r}/o${d}`,"i"),p={bucket:1,path:3},_=t===HC?"(?:storage.googleapis.com|storage.cloud.google.com)":t,v="([^?#]*)",P=new RegExp(`^https?://${_}/${r}/${v}`,"i"),W=[{regex:a,indices:c,postModify:s},{regex:f,indices:p,postModify:l},{regex:P,indices:{bucket:1,path:2},postModify:l}];for(let z=0;z<W.length;z++){const Lt=W[z],Ft=Lt.regex.exec(e);if(Ft){const Nn=Ft[Lt.indices.bucket];let Pi=Ft[Lt.indices.path];Pi||(Pi=""),i=new nt(Nn,Pi),Lt.postModify(i);break}}if(i==null)throw iW(e);return i}}class cW{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lW(n,e,t){let i=1,r=null,s=null,o=!1,a=0;function c(){return a===2}let l=!1;function u(...v){l||(l=!0,e.apply(null,v))}function h(v){r=setTimeout(()=>{r=null,n(f,c())},v)}function d(){s&&clearTimeout(s)}function f(v,...P){if(l){d();return}if(v){d(),u.call(null,v,...P);return}if(c()||o){d(),u.call(null,v,...P);return}i<64&&(i*=2);let W;a===1?(a=2,W=0):W=(i+Math.random())*1e3,h(W)}let p=!1;function _(v){p||(p=!0,d(),!l&&(r!==null?(v||(a=2),clearTimeout(r),h(0)):v||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,_(!0)},t),_}function uW(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hW(n){return n!==void 0}function dW(n){return typeof n=="function"}function fW(n){return typeof n=="object"&&!Array.isArray(n)}function fh(n){return typeof n=="string"||n instanceof String}function Lw(n){return Rm()&&n instanceof Blob}function Rm(){return typeof Blob!="undefined"}function Sf(n,e,t,i){if(i<e)throw ls(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw ls(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(n,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${n}`}function ZC(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const r=e(i)+"="+e(n[i]);t=t+r+"&"}return t=t.slice(0,-1),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ji;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Ji||(Ji={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pW{constructor(e,t,i,r,s,o,a,c,l,u,h){this.url_=e,this.method_=t,this.headers_=i,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((d,f)=>{this.resolve_=d,this.reject_=f,this.start_()})}start_(){const e=(i,r)=>{if(r){i(!1,new Sc(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{const c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===Ji.NO_ERROR,c=s.getStatus();if(!a||this.isRetryStatusCode_(c)){const u=s.getErrorCode()===Ji.ABORT;i(!1,new Sc(!1,null,u));return}const l=this.successCodes_.indexOf(c)!==-1;i(!0,new Sc(l,s))})},t=(i,r)=>{const s=this.resolve_,o=this.reject_,a=r.connection;if(r.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());hW(c)?s(c):s()}catch(c){o(c)}else if(a!==null){const c=Am();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(r.canceled){const c=this.appDelete_?XC():QC();o(c)}else{const c=nW();o(c)}};this.canceled_?t(!1,new Sc(!1,null,!0)):this.backoffId_=lW(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&uW(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,r=[408,429].indexOf(e)!==-1,s=this.additionalRetryCodes_.indexOf(e)!==-1;return t||r||s}}class Sc{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function gW(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function mW(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function _W(n,e){e&&(n["X-Firebase-GMPID"]=e)}function yW(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function wW(n,e,t,i,r,s){const o=ZC(n.urlParams),a=n.url+o,c=Object.assign({},n.headers);return _W(c,e),gW(c,t),mW(c,s),yW(c,i),new pW(a,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vW(){return typeof BlobBuilder!="undefined"?BlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:void 0}function IW(...n){const e=vW();if(e!==void 0){const t=new e;for(let i=0;i<n.length;i++)t.append(n[i]);return t.getBlob()}else{if(Rm())return new Blob(n);throw new he("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function EW(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TW(n){return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class sd{constructor(e,t){this.data=e,this.contentType=t||null}}function ek(n,e){switch(n){case jt.RAW:return new sd(tk(e));case jt.BASE64:case jt.BASE64URL:return new sd(nk(n,e));case jt.DATA_URL:return new sd(SW(e),CW(e))}throw Am()}function tk(n){const e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i<=127)e.push(i);else if(i<=2047)e.push(192|i>>6,128|i&63);else if((i&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const s=i,o=n.charCodeAt(++t);i=65536|(s&1023)<<10|o&1023,e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)===56320?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(e)}function bW(n){let e;try{e=decodeURIComponent(n)}catch{throw Po(jt.DATA_URL,"Malformed data URL.")}return tk(e)}function nk(n,e){switch(n){case jt.BASE64:{const r=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(r||s)throw Po(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case jt.BASE64URL:{const r=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(r||s)throw Po(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=TW(e)}catch{throw Po(n,"Invalid character found")}const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}class ik{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Po(jt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=t[1]||null;i!=null&&(this.base64=kW(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-7):i),this.rest=e.substring(e.indexOf(",")+1)}}function SW(n){const e=new ik(n);return e.base64?nk(jt.BASE64,e.rest):bW(e.rest)}function CW(n){return new ik(n).contentType}function kW(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e,t){let i=0,r="";Lw(e)?(this.data_=e,i=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),i=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),i=e.length),this.size_=i,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Lw(this.data_)){const i=this.data_,r=EW(i,e,t);return r===null?null:new Dn(r)}else{const i=new Uint8Array(this.data_.buffer,e,t-e);return new Dn(i,!0)}}static getBlob(...e){if(Rm()){const t=e.map(i=>i instanceof Dn?i.data_:i);return new Dn(IW.apply(null,t))}else{const t=e.map(o=>fh(o)?ek(jt.RAW,o).data:o.data_);let i=0;t.forEach(o=>{i+=o.byteLength});const r=new Uint8Array(i);let s=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)r[s++]=o[a]}),new Dn(r,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nm(n){let e;try{e=JSON.parse(n)}catch{return null}return fW(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AW(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function RW(n,e){const t=e.split("/").filter(i=>i.length>0).join("/");return n.length===0?t:n+"/"+t}function rk(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NW(n,e){return e}class st{constructor(e,t,i,r){this.server=e,this.local=t||e,this.writable=!!i,this.xform=r||NW}}let Cc=null;function PW(n){return!fh(n)||n.length<2?n:rk(n)}function ph(){if(Cc)return Cc;const n=[];n.push(new st("bucket")),n.push(new st("generation")),n.push(new st("metageneration")),n.push(new st("name","fullPath",!0));function e(s,o){return PW(o)}const t=new st("name");t.xform=e,n.push(t);function i(s,o){return o!==void 0?Number(o):o}const r=new st("size");return r.xform=i,n.push(r),n.push(new st("timeCreated")),n.push(new st("updated")),n.push(new st("md5Hash",null,!0)),n.push(new st("cacheControl",null,!0)),n.push(new st("contentDisposition",null,!0)),n.push(new st("contentEncoding",null,!0)),n.push(new st("contentLanguage",null,!0)),n.push(new st("contentType",null,!0)),n.push(new st("metadata","customMetadata",!0)),Cc=n,Cc}function OW(n,e){function t(){const i=n.bucket,r=n.fullPath,s=new nt(i,r);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function DW(n,e,t){const i={};i.type="file";const r=t.length;for(let s=0;s<r;s++){const o=t[s];i[o.local]=o.xform(i,e[o.server])}return OW(i,n),i}function sk(n,e,t){const i=Nm(e);return i===null?null:DW(n,i,t)}function xW(n,e,t,i){const r=Nm(e);if(r===null||!fh(r.downloadTokens))return null;const s=r.downloadTokens;if(s.length===0)return null;const o=encodeURIComponent;return s.split(",").map(l=>{const u=n.bucket,h=n.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=Ni(d,t,i),p=ZC({alt:"media",token:l});return f+p})[0]}function Pm(n,e){const t={},i=e.length;for(let r=0;r<i;r++){const s=e[r];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw="prefixes",Uw="items";function MW(n,e,t){const i={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[Fw])for(const r of t[Fw]){const s=r.replace(/\/$/,""),o=n._makeStorageReference(new nt(e,s));i.prefixes.push(o)}if(t[Uw])for(const r of t[Uw]){const s=n._makeStorageReference(new nt(e,r.name));i.items.push(s)}return i}function LW(n,e,t){const i=Nm(t);return i===null?null:MW(n,e,i)}class Jn{constructor(e,t,i,r){this.url=e,this.method=t,this.handler=i,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(n){if(!n)throw Am()}function gh(n,e){function t(i,r){const s=sk(n,r,e);return wn(s!==null),s}return t}function FW(n,e){function t(i,r){const s=LW(n,e,r);return wn(s!==null),s}return t}function UW(n,e){function t(i,r){const s=sk(n,r,e);return wn(s!==null),xW(s,r,n.host,n._protocol)}return t}function no(n){function e(t,i){let r;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?r=eW():r=ZK():t.getStatus()===402?r=JK(n.bucket):t.getStatus()===403?r=tW(n.path):r=i,r.serverResponse=i.serverResponse,r}return e}function mh(n){const e=no(n);function t(i,r){let s=e(i,r);return i.getStatus()===404&&(s=XK(n.path)),s.serverResponse=r.serverResponse,s}return t}function ok(n,e,t){const i=e.fullServerUrl(),r=Ni(i,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new Jn(r,s,gh(n,t),o);return a.errorHandler=mh(e),a}function $W(n,e,t,i,r){const s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),i&&(s.pageToken=i),r&&(s.maxResults=r);const o=e.bucketOnlyServerUrl(),a=Ni(o,n.host,n._protocol),c="GET",l=n.maxOperationRetryTime,u=new Jn(a,c,FW(n,e.bucket),l);return u.urlParams=s,u.errorHandler=no(e),u}function VW(n,e,t){const i=e.fullServerUrl(),r=Ni(i,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new Jn(r,s,UW(n,t),o);return a.errorHandler=mh(e),a}function BW(n,e,t,i){const r=e.fullServerUrl(),s=Ni(r,n.host,n._protocol),o="PATCH",a=Pm(t,i),c={"Content-Type":"application/json; charset=utf-8"},l=n.maxOperationRetryTime,u=new Jn(s,o,gh(n,i),l);return u.headers=c,u.body=a,u.errorHandler=mh(e),u}function qW(n,e){const t=e.fullServerUrl(),i=Ni(t,n.host,n._protocol),r="DELETE",s=n.maxOperationRetryTime;function o(c,l){}const a=new Jn(i,r,o,s);return a.successCodes=[200,204],a.errorHandler=mh(e),a}function jW(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function ak(n,e,t){const i=Object.assign({},t);return i.fullPath=n.path,i.size=e.size(),i.contentType||(i.contentType=jW(null,e)),i}function KW(n,e,t,i,r){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let W="";for(let z=0;z<2;z++)W=W+Math.random().toString().slice(2);return W}const c=a();o["Content-Type"]="multipart/related; boundary="+c;const l=ak(e,i,r),u=Pm(l,t),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+c+`\r
Content-Type: `+l.contentType+`\r
\r
`,d=`\r
--`+c+"--",f=Dn.getBlob(h,i,d);if(f===null)throw YC();const p={name:l.fullPath},_=Ni(s,n.host,n._protocol),v="POST",P=n.maxUploadRetryTime,V=new Jn(_,v,gh(n,t),P);return V.urlParams=p,V.headers=o,V.body=f.uploadData(),V.errorHandler=no(e),V}class ql{constructor(e,t,i,r){this.current=e,this.total=t,this.finalized=!!i,this.metadata=r||null}}function Om(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{wn(!1)}return wn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function WW(n,e,t,i,r){const s=e.bucketOnlyServerUrl(),o=ak(e,i,r),a={name:o.fullPath},c=Ni(s,n.host,n._protocol),l="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${i.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Pm(o,t),d=n.maxUploadRetryTime;function f(_){Om(_);let v;try{v=_.getResponseHeader("X-Goog-Upload-URL")}catch{wn(!1)}return wn(fh(v)),v}const p=new Jn(c,l,f,d);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=no(e),p}function GW(n,e,t,i){const r={"X-Goog-Upload-Command":"query"};function s(l){const u=Om(l,["active","final"]);let h=null;try{h=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{wn(!1)}h||wn(!1);const d=Number(h);return wn(!isNaN(d)),new ql(d,i.size(),u==="final")}const o="POST",a=n.maxUploadRetryTime,c=new Jn(t,o,s,a);return c.headers=r,c.errorHandler=no(e),c}const $w=256*1024;function HW(n,e,t,i,r,s,o,a){const c=new ql(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=i.size()),i.size()!==c.total)throw oW();const l=c.total-c.current;let u=l;r>0&&(u=Math.min(u,r));const h=c.current,d=h+u,p={"X-Goog-Upload-Command":u===l?"upload, finalize":"upload","X-Goog-Upload-Offset":`${c.current}`},_=i.slice(h,d);if(_===null)throw YC();function v(z,Lt){const Ft=Om(z,["active","final"]),Nn=c.current+u,Pi=i.size();let Oi;return Ft==="final"?Oi=gh(e,s)(z,Lt):Oi=null,new ql(Nn,Pi,Ft==="final",Oi)}const P="POST",V=e.maxUploadRetryTime,W=new Jn(t,P,v,V);return W.headers=p,W.body=_.uploadData(),W.progressCallback=a||null,W.errorHandler=no(n),W}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zW={STATE_CHANGED:"state_changed"},ct={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function od(n){switch(n){case"running":case"pausing":case"canceling":return ct.RUNNING;case"paused":return ct.PAUSED;case"success":return ct.SUCCESS;case"canceled":return ct.CANCELED;case"error":return ct.ERROR;default:return ct.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QW{constructor(e,t,i){if(dW(e)||t!=null||i!=null)this.next=e,this.error=t!=null?t:void 0,this.complete=i!=null?i:void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wr(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class YW{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ji.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ji.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ji.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,r){if(this.sent_)throw po("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),r!==void 0)for(const s in r)r.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,r[s].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw po("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw po("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw po("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw po("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class XW extends YW{initXhr(){this.xhr_.responseType="text"}}function hn(){return new XW}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,t,i=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=i,this._mappings=ph(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=r=>{this._request=void 0,this._chunkMultiplier=1,r._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=r,this._transition("error"))},this._metadataErrorHandler=r=>{this._request=void 0,r._codeEquals("canceled")?this.completeTransitions_():(this._error=r,this._transition("error"))},this._promise=new Promise((r,s)=>{this._resolve=r,this._reject=s,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,i])=>{switch(this._state){case"running":e(t,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const i=WW(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(i,hn,e,t);this._request=r,r.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,i)=>{const r=GW(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(r,hn,t,i);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=$w*this._chunkMultiplier,t=new ql(this._transferred,this._blob.size()),i=this._uploadUrl;this._resolveToken((r,s)=>{let o;try{o=HW(this._ref._location,this._ref.storage,i,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}const a=this._ref.storage._makeRequest(o,hn,r,s);this._request=a,a.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){$w*this._chunkMultiplier<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const i=ok(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(i,hn,e,t);this._request=r,r.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const i=KW(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(i,hn,e,t);this._request=r,r.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":this._state=e,this._request!==void 0&&this._request.cancel();break;case"pausing":this._state=e,this._request!==void 0&&this._request.cancel();break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=QC(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=od(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,i,r){const s=new QW(t||void 0,i||void 0,r||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(od(this._state)){case ct.SUCCESS:Wr(this._resolve.bind(null,this.snapshot))();break;case ct.CANCELED:case ct.ERROR:const t=this._reject;Wr(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(od(this._state)){case ct.RUNNING:case ct.PAUSED:e.next&&Wr(e.next.bind(e,this.snapshot))();break;case ct.SUCCESS:e.complete&&Wr(e.complete.bind(e))();break;case ct.CANCELED:case ct.ERROR:e.error&&Wr(e.error.bind(e,this._error))();break;default:e.error&&Wr(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e,t){this._service=e,t instanceof nt?this._location=t:this._location=nt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Er(e,t)}get root(){const e=new nt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return rk(this._location.path)}get storage(){return this._service}get parent(){const e=AW(this._location.path);if(e===null)return null;const t=new nt(this._location.bucket,e);return new Er(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw JC(e)}}function JW(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new ck(n,new Dn(e),t)}function ZW(n){const e={prefixes:[],items:[]};return lk(n,e).then(()=>e)}async function lk(n,e,t){const r=await uk(n,{pageToken:t});e.prefixes.push(...r.prefixes),e.items.push(...r.items),r.nextPageToken!=null&&await lk(n,e,r.nextPageToken)}function uk(n,e){e!=null&&typeof e.maxResults=="number"&&Sf("options.maxResults",1,1e3,e.maxResults);const t=e||{},i=$W(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(i,hn)}function eG(n){n._throwIfRoot("getMetadata");const e=ok(n.storage,n._location,ph());return n.storage.makeRequestWithTokens(e,hn)}function tG(n,e){n._throwIfRoot("updateMetadata");const t=BW(n.storage,n._location,e,ph());return n.storage.makeRequestWithTokens(t,hn)}function nG(n){n._throwIfRoot("getDownloadURL");const e=VW(n.storage,n._location,ph());return n.storage.makeRequestWithTokens(e,hn).then(t=>{if(t===null)throw aW();return t})}function iG(n){n._throwIfRoot("deleteObject");const e=qW(n.storage,n._location);return n.storage.makeRequestWithTokens(e,hn)}function hk(n,e){const t=RW(n._location.path,e),i=new nt(n._location.bucket,t);return new Er(n.storage,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rG(n){return/^[A-Za-z]+:\/\//.test(n)}function sG(n,e){return new Er(n,e)}function dk(n,e){if(n instanceof Dm){const t=n;if(t._bucket==null)throw sW();const i=new Er(t,t._bucket);return e!=null?dk(i,e):i}else return e!==void 0?hk(n,e):n}function oG(n,e){if(e&&rG(e)){if(n instanceof Dm)return sG(n,e);throw ls("To use ref(service, url), the first argument must be a Storage instance.")}else return dk(n,e)}function Vw(n,e){const t=e==null?void 0:e[zC];return t==null?null:nt.makeFromBucketSpec(t,n)}function aG(n,e,t,i={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:r}=i;r&&(n._overrideAuthToken=typeof r=="string"?r:Pf(r,n.app.options.projectId))}class Dm{constructor(e,t,i,r,s){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=r,this._firebaseVersion=s,this._bucket=null,this._host=HC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=QK,this._maxUploadRetryTime=YK,this._requests=new Set,r!=null?this._bucket=nt.makeFromBucketSpec(r,this._host):this._bucket=Vw(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=nt.makeFromBucketSpec(this._url,e):this._bucket=Vw(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Sf("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Sf("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Er(this,e)}_makeRequest(e,t,i,r){if(this._deleted)return new cW(XC());{const s=wW(e,this._appId,i,r,t,this._firebaseVersion);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){const[i,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,r).getPromise()}}const Bw="@firebase/storage",qw="0.9.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cG="storage";function lG(n,e,t){return n=w(n),JW(n,e,t)}function uG(n){return n=w(n),eG(n)}function hG(n,e){return n=w(n),tG(n,e)}function dG(n,e){return n=w(n),uk(n,e)}function fG(n){return n=w(n),ZW(n)}function pG(n){return n=w(n),nG(n)}function gG(n){return n=w(n),iG(n)}function jw(n,e){return n=w(n),oG(n,e)}function mG(n,e){return hk(n,e)}function _G(n,e,t,i={}){aG(n,e,t,i)}function yG(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new Dm(t,i,r,e,Rn)}function wG(){le(new q(cG,yG,"PUBLIC").setMultipleInstances(!0)),Q(Bw,qw,""),Q(Bw,qw,"esm2017")}wG();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(e,t,i){this._delegate=e,this.task=t,this.ref=i}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new kc(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(i=>{if(e)return e(new kc(i,this,this._ref))},t)}on(e,t,i,r){let s;return t&&(typeof t=="function"?s=o=>t(new kc(o,this,this._ref)):s={next:t.next?o=>t.next(new kc(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,s,i||void 0,r||void 0)}}class Ww{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new qn(e,this._service))}get items(){return this._delegate.items.map(e=>new qn(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=mG(this._delegate,e);return new qn(t,this.storage)}get root(){return new qn(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return e==null?null:new qn(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Kw(lG(this._delegate,e,t),this)}putString(e,t=jt.RAW,i){this._throwIfRoot("putString");const r=ek(t,e),s=Object.assign({},i);return s.contentType==null&&r.contentType!=null&&(s.contentType=r.contentType),new Kw(new ck(this._delegate,new Dn(r.data,!0),s),this)}listAll(){return fG(this._delegate).then(e=>new Ww(e,this.storage))}list(e){return dG(this._delegate,e||void 0).then(t=>new Ww(t,this.storage))}getMetadata(){return uG(this._delegate)}updateMetadata(e){return hG(this._delegate,e)}getDownloadURL(){return pG(this._delegate)}delete(){return this._throwIfRoot("delete"),gG(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw JC(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Gw(e))throw ls("ref() expected a child path but got a URL, use refFromURL instead.");return new qn(jw(this._delegate,e),this)}refFromURL(e){if(!Gw(e))throw ls("refFromURL() expected a full URL but got a child path, use ref() instead.");try{nt.makeFromUrl(e,this._delegate.host)}catch{throw ls("refFromUrl() expected a valid full URL but got an invalid one.")}return new qn(jw(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,i={}){_G(this._delegate,e,t,i)}}function Gw(n){return/^[A-Za-z]+:\/\//.test(n)}const vG="@firebase/storage-compat",IG="0.1.10";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EG="storage-compat";function TG(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("storage").getImmediate({identifier:e});return new fk(t,i)}function bG(n){const e={TaskState:ct,TaskEvent:zW,StringFormat:jt,Storage:fk,Reference:qn};n.INTERNAL.registerComponent(new q(EG,TG,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(vG,IG)}bG(je);const Hw="@firebase/performance",Cf="0.5.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk=Cf,SG="FB-PERF-TRACE-START",CG="FB-PERF-TRACE-STOP",kf="FB-PERF-TRACE-MEASURE",gk="_wt_",mk="_fp",_k="_fcp",yk="_fid",wk="@firebase/performance/config",vk="@firebase/performance/configexpire",kG="performance",Ik="Performance";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AG={["trace started"]:"Trace {$traceName} was started before.",["trace stopped"]:"Trace {$traceName} is not running.",["nonpositive trace startTime"]:"Trace {$traceName} startTime should be positive.",["nonpositive trace duration"]:"Trace {$traceName} duration should be positive.",["no window"]:"Window is not available.",["no app id"]:"App id is not available.",["no project id"]:"Project id is not available.",["no api key"]:"Api key is not available.",["invalid cc log"]:"Attempted to queue invalid cc event",["FB not default"]:"Performance can only start when Firebase app instance is the default one.",["RC response not ok"]:"RC response is not ok",["invalid attribute name"]:"Attribute name {$attributeName} is invalid.",["invalid attribute value"]:"Attribute value {$attributeValue} is invalid.",["invalid custom metric name"]:"Custom metric name {$customMetricName} is invalid",["invalid String merger input"]:"Input for String merger is invalid, contact support team to resolve.",["already initialized"]:"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},Ze=new _t(kG,Ik,AG);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sn=new Cn(Ik);Sn.logLevel=x.INFO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ad,Ek;class xe{constructor(e){if(this.window=e,!e)throw Ze.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,i){!this.performance||!this.performance.measure||this.performance.measure(e,t,i)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!zl()?(Sn.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):bt()?!0:(Sn.info("IndexedDB is not supported by current browswer"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(r=>{for(const s of r.getEntries())t(s)}).observe({entryTypes:[e]})}static getInstance(){return ad===void 0&&(ad=new xe(Ek)),ad}}function RG(n){Ek=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tk;function NG(n){const e=n.getId();return e.then(t=>{Tk=t}),e}function xm(){return Tk}function PG(n){const e=n.getToken();return e.then(t=>{}),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zw(n,e){const t=n.length-e.length;if(t<0||t>1)throw Ze.create("invalid String merger input");const i=[];for(let r=0;r<n.length;r++)i.push(n.charAt(r)),e.length>r&&i.push(e.charAt(r));return i.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cd;class Dt{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=zw("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=zw("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return cd===void 0&&(cd=new Dt),cd}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var us;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.VISIBLE=1]="VISIBLE",n[n.HIDDEN=2]="HIDDEN"})(us||(us={}));const OG=["firebase_","google_","ga_"],DG=new RegExp("^[a-zA-Z]\\w*$"),xG=40,MG=100;function LG(){const n=xe.getInstance().navigator;return"serviceWorker"in n?n.serviceWorker.controller?2:3:1}function bk(){switch(xe.getInstance().document.visibilityState){case"visible":return us.VISIBLE;case"hidden":return us.HIDDEN;default:return us.UNKNOWN}}function FG(){const e=xe.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function UG(n){return n.length===0||n.length>xG?!1:!OG.some(t=>n.startsWith(t))&&!!n.match(DG)}function $G(n){return n.length!==0&&n.length<=MG}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sk(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.appId;if(!t)throw Ze.create("no app id");return t}function VG(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.projectId;if(!t)throw Ze.create("no project id");return t}function BG(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw Ze.create("no api key");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qG="0.0.1",jG={loggingEnabled:!0},KG="FIREBASE_INSTALLATIONS_AUTH";function WG(n,e){const t=GG();return t?(Qw(t),Promise.resolve()):QG(n,e).then(Qw).then(i=>HG(i),()=>{})}function GG(){const n=xe.getInstance().localStorage;if(!n)return;const e=n.getItem(vk);if(!e||!YG(e))return;const t=n.getItem(wk);if(!!t)try{return JSON.parse(t)}catch{return}}function HG(n){const e=xe.getInstance().localStorage;!n||!e||(e.setItem(wk,JSON.stringify(n)),e.setItem(vk,String(Date.now()+Dt.getInstance().configTimeToLive*60*60*1e3)))}const zG="Could not fetch config, will use default configs";function QG(n,e){return PG(n.installations).then(t=>{const i=VG(n.app),r=BG(n.app),s=`https://firebaseremoteconfig.googleapis.com/v1/projects/${i}/namespaces/fireperf:fetch?key=${r}`,o=new Request(s,{method:"POST",headers:{Authorization:`${KG} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:Sk(n.app),app_version:pk,sdk_version:qG})});return fetch(o).then(a=>{if(a.ok)return a.json();throw Ze.create("RC response not ok")})}).catch(()=>{Sn.info(zG)})}function Qw(n){if(!n)return n;const e=Dt.getInstance(),t=n.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=jG.loggingEnabled,t.fpr_log_source&&(e.logSource=Number(t.fpr_log_source)),t.fpr_log_endpoint_url&&(e.logEndPointUrl=t.fpr_log_endpoint_url),t.fpr_log_transport_key&&(e.transportKey=t.fpr_log_transport_key),t.fpr_vc_network_request_sampling_rate!==void 0&&(e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate)),t.fpr_vc_trace_sampling_rate!==void 0&&(e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=Yw(e.tracesSamplingRate),e.logNetworkAfterSampling=Yw(e.networkRequestsSamplingRate),n}function YG(n){return Number(n)>Date.now()}function Yw(n){return Math.random()<=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mm=1,ld;function Ck(n){return Mm=2,ld=ld||JG(n),ld}function XG(){return Mm===3}function JG(n){return ZG().then(()=>NG(n.installations)).then(e=>WG(n,e)).then(()=>Xw(),()=>Xw())}function ZG(){const n=xe.getInstance().document;return new Promise(e=>{if(n&&n.readyState!=="complete"){const t=()=>{n.readyState==="complete"&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}function Xw(){Mm=3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lm=10*1e3,eH=5.5*1e3,kk=3,tH=1e3;let jl=kk,di=[],Jw=!1;function nH(){Jw||(_h(eH),Jw=!0)}function _h(n){setTimeout(()=>{if(jl!==0){if(!di.length)return _h(Lm);iH()}},n)}function iH(){const n=di.splice(0,tH),e=n.map(i=>({source_extension_json_proto3:i.message,event_time_ms:String(i.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Dt.getInstance().logSource,log_event:e};rH(t,n).catch(()=>{di=[...n,...di],jl--,Sn.info(`Tries left: ${jl}.`),_h(Lm)})}function rH(n,e){return sH(n).then(t=>(t.ok||Sn.info("Call to Firebase backend failed."),t.json())).then(t=>{const i=Number(t.nextRequestWaitMillis);let r=Lm;isNaN(i)||(r=Math.max(i,r));const s=t.logResponseDetails;Array.isArray(s)&&s.length>0&&s[0].responseAction==="RETRY_REQUEST_LATER"&&(di=[...e,...di],Sn.info("Retry transport request later.")),jl=kk,_h(r)})}function sH(n){const e=Dt.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(n)})}function oH(n){if(!n.eventTime||!n.message)throw Ze.create("invalid cc log");di=[...di,n]}function aH(n){return(...e)=>{const t=n(...e);oH({message:t,eventTime:Date.now()})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ud;function Ak(n,e){ud||(ud=aH(lH)),ud(n,e)}function Ac(n){const e=Dt.getInstance();!e.instrumentationEnabled&&n.isAuto||!e.dataCollectionEnabled&&!n.isAuto||!xe.getInstance().requiredApisAvailable()||n.isAuto&&bk()!==us.VISIBLE||(XG()?hd(n):Ck(n.performanceController).then(()=>hd(n),()=>hd(n)))}function hd(n){if(!xm())return;const e=Dt.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>Ak(n,1),0)}function cH(n){const e=Dt.getInstance();if(!e.instrumentationEnabled)return;const t=n.url,i=e.logEndPointUrl.split("?")[0],r=e.flTransportEndpointUrl.split("?")[0];t===i||t===r||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>Ak(n,0),0)}function lH(n,e){return e===0?uH(n):hH(n)}function uH(n){const e={url:n.url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},t={application_info:Rk(n.performanceController.app),network_request_metric:e};return JSON.stringify(t)}function hH(n){const e={name:n.name,is_auto:n.isAuto,client_start_time_us:n.startTimeUs,duration_us:n.durationUs};Object.keys(n.counters).length!==0&&(e.counters=n.counters);const t=n.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const i={application_info:Rk(n.performanceController.app),trace_metric:e};return JSON.stringify(i)}function Rk(n){return{google_app_id:Sk(n),app_instance_id:xm(),web_app_info:{sdk_version:pk,page_url:xe.getInstance().getUrl(),service_worker_status:LG(),visibility_state:bk(),effective_connection_type:FG()},application_process_state:0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dH=100,fH="_",pH=[mk,_k,yk];function gH(n,e){return n.length===0||n.length>dH?!1:e&&e.startsWith(gk)&&pH.indexOf(n)>-1||!n.startsWith(fH)}function mH(n){const e=Math.floor(n);return e<n&&Sn.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,t,i=!1,r){this.performanceController=e,this.name=t,this.isAuto=i,this.state=1,this.customAttributes={},this.counters={},this.api=xe.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${SG}-${this.randomId}-${this.name}`,this.traceStopMark=`${CG}-${this.randomId}-${this.name}`,this.traceMeasure=r||`${kf}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw Ze.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw Ze.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Ac(this)}record(e,t,i){if(e<=0)throw Ze.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Ze.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),i&&i.attributes&&(this.customAttributes=Object.assign({},i.attributes)),i&&i.metrics)for(const r of Object.keys(i.metrics))isNaN(Number(i.metrics[r]))||(this.counters[r]=Number(Math.floor(i.metrics[r])));Ac(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(gH(e,this.name))this.counters[e]=mH(t);else throw Ze.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const i=UG(e),r=$G(t);if(i&&r){this.customAttributes[e]=t;return}if(!i)throw Ze.create("invalid attribute name",{attributeName:e});if(!r)throw Ze.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,i,r){const s=xe.getInstance().getUrl();if(!s)return;const o=new fi(e,gk+s,!0),a=Math.floor(xe.getInstance().getTimeOrigin()*1e3);o.setStartTime(a),t&&t[0]&&(o.setDuration(Math.floor(t[0].duration*1e3)),o.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),o.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),o.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const c="first-paint",l="first-contentful-paint";if(i){const u=i.find(d=>d.name===c);u&&u.startTime&&o.putMetric(mk,Math.floor(u.startTime*1e3));const h=i.find(d=>d.name===l);h&&h.startTime&&o.putMetric(_k,Math.floor(h.startTime*1e3)),r&&o.putMetric(yk,Math.floor(r*1e3))}Ac(o)}static createUserTimingTrace(e,t){const i=new fi(e,t,!1,t);Ac(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(n,e){const t=e;if(!t||t.responseStart===void 0)return;const i=xe.getInstance().getTimeOrigin(),r=Math.floor((t.startTime+i)*1e3),s=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,o=Math.floor((t.responseEnd-t.startTime)*1e3),a=t.name&&t.name.split("?")[0],c={performanceController:n,url:a,responsePayloadBytes:t.transferSize,startTimeUs:r,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o};cH(c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _H=5e3;function ev(n){!xm()||(setTimeout(()=>wH(n),0),setTimeout(()=>yH(n),0),setTimeout(()=>vH(n),0))}function yH(n){const e=xe.getInstance(),t=e.getEntriesByType("resource");for(const i of t)Zw(n,i);e.setupObserver("resource",i=>Zw(n,i))}function wH(n){const e=xe.getInstance(),t=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let r=setTimeout(()=>{fi.createOobTrace(n,t,i),r=void 0},_H);e.onFirstInputDelay(s=>{r&&(clearTimeout(r),fi.createOobTrace(n,t,i,s))})}else fi.createOobTrace(n,t,i)}function vH(n){const e=xe.getInstance(),t=e.getEntriesByType("measure");for(const i of t)tv(n,i);e.setupObserver("measure",i=>tv(n,i))}function tv(n,e){const t=e.name;t.substring(0,kf.length)!==kf&&fi.createUserTimingTrace(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IH{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),xe.getInstance().requiredApisAvailable()?Ea().then(t=>{t&&(nH(),Ck(this).then(()=>ev(this),()=>ev(this)),this.initialized=!0)}).catch(t=>{Sn.info(`Environment doesn't support IndexedDB: ${t}`)}):Sn.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){Dt.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return Dt.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){Dt.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return Dt.getInstance().dataCollectionEnabled}}const EH="[DEFAULT]";function TH(n,e){return n=w(n),new fi(n,e)}const bH=(n,{options:e})=>{const t=n.getProvider("app").getImmediate(),i=n.getProvider("installations-internal").getImmediate();if(t.name!==EH)throw Ze.create("FB not default");if(typeof window=="undefined")throw Ze.create("no window");RG(window);const r=new IH(t,i);return r._init(e),r};function SH(){le(new q("performance",bH,"PUBLIC")),Q(Hw,Cf),Q(Hw,Cf,"esm2017")}SH();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CH{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return TH(this._delegate,e)}}const kH="@firebase/performance-compat",AH="0.1.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RH(n){n.INTERNAL.registerComponent(new q("performance-compat",NH,"PUBLIC")),n.registerVersion(kH,AH)}function NH(n){const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("performance").getImmediate();return new CH(e,t)}RH(je);const dd="@firebase/remote-config",nv="0.3.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PH{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OH="remote-config";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DH={["registration-window"]:"Undefined window object. This SDK only supports usage in a browser environment.",["registration-project-id"]:"Undefined project identifier. Check Firebase app initialization.",["registration-api-key"]:"Undefined API key. Check Firebase app initialization.",["registration-app-id"]:"Undefined app identifier. Check Firebase app initialization.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",["fetch-client-network"]:"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-timeout"]:'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',["fetch-throttle"]:'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',["fetch-client-parse"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["indexed-db-unavailable"]:"Indexed DB is not supported by current browser"},vt=new _t("remoteconfig","Remote Config",DH);function xH(n,e){return n instanceof de&&n.code.indexOf(e)!==-1}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MH=!1,LH="",iv=0,FH=["1","true","t","yes","y","on"];class fd{constructor(e,t=LH){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?MH:FH.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return iv;let e=Number(this._value);return isNaN(e)&&(e=iv),e}getSource(){return this._source}}async function Nk(n){const e=w(n),[t,i]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===i?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}function Pk(n){const e=w(n);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}async function Ok(n){const e=w(n),t=new PH;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(i){const r=xH(i,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(r),i}}function UH(n){const e=w(n);return jH(e._storageCache.getActiveConfig(),e.defaultConfig).reduce((t,i)=>(t[i]=oc(n,i),t),{})}function $H(n,e){return oc(w(n),e).asBoolean()}function VH(n,e){return oc(w(n),e).asNumber()}function BH(n,e){return oc(w(n),e).asString()}function oc(n,e){const t=w(n);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const i=t._storageCache.getActiveConfig();return i&&i[e]!==void 0?new fd("remote",i[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new fd("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new fd("static"))}function qH(n,e){const t=w(n);switch(e){case"debug":t._logger.logLevel=x.DEBUG;break;case"silent":t._logger.logLevel=x.SILENT;break;default:t._logger.logLevel=x.ERROR}}function jH(n={},e={}){return Object.keys(Object.assign(Object.assign({},n),e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KH{constructor(e,t,i,r){this.client=e,this.storage=t,this.storageCache=i,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const i=Date.now()-t,r=i<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${i}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}async fetch(e){const[t,i]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(i&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return i;e.eTag=i&&i.eTag;const r=await this.client.fetch(e),s=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return r.status===200&&s.push(this.storage.setLastSuccessfulFetchResponse(r)),await Promise.all(s),r}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WH(n=navigator){return n.languages&&n.languages[0]||n.language}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GH{constructor(e,t,i,r,s,o){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=i,this.projectId=r,this.apiKey=s,this.appId=o}async fetch(e){const[t,i]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),s=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,o={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},a={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:i,app_id:this.appId,language_code:WH()},c={method:"POST",headers:o,body:JSON.stringify(a)},l=fetch(s,c),u=new Promise((v,P)=>{e.signal.addEventListener(()=>{const V=new Error("The operation was aborted.");V.name="AbortError",P(V)})});let h;try{await Promise.race([l,u]),h=await l}catch(v){let P="fetch-client-network";throw v.name==="AbortError"&&(P="fetch-timeout"),vt.create(P,{originalErrorMessage:v.message})}let d=h.status;const f=h.headers.get("ETag")||void 0;let p,_;if(h.status===200){let v;try{v=await h.json()}catch(P){throw vt.create("fetch-client-parse",{originalErrorMessage:P.message})}p=v.entries,_=v.state}if(_==="INSTANCE_STATE_UNSPECIFIED"?d=500:_==="NO_CHANGE"?d=304:(_==="NO_TEMPLATE"||_==="EMPTY_CONFIG")&&(p={}),d!==304&&d!==200)throw vt.create("fetch-status",{httpStatus:d});return{status:d,eTag:f,config:p}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HH(n,e){return new Promise((t,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(t,r);n.addEventListener(()=>{clearTimeout(s),i(vt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function zH(n){if(!(n instanceof de)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class QH{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:i}){await HH(e.signal,t);try{const r=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),r}catch(r){if(!zH(r))throw r;const s={throttleEndTimeMillis:Date.now()+Gc(i),backoffCount:i+1};return await this.storage.setThrottleMetadata(s),this.attemptFetch(e,s)}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YH=60*1e3,XH=12*60*60*1e3;class JH{constructor(e,t,i,r,s){this.app=e,this._client=t,this._storageCache=i,this._storage=r,this._logger=s,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:YH,minimumFetchIntervalMillis:XH},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qc(n,e){const t=n.target.error||void 0;return vt.create(e,{originalErrorMessage:t&&t.message})}const Mi="app_namespace_store",ZH="firebase_remote_config",ez=1;function tz(){return new Promise((n,e)=>{try{const t=indexedDB.open(ZH,ez);t.onerror=i=>{e(qc(i,"storage-open"))},t.onsuccess=i=>{n(i.target.result)},t.onupgradeneeded=i=>{const r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(Mi,{keyPath:"compositeKey"})}}}catch(t){e(vt.create("storage-open",{originalErrorMessage:t}))}})}class nz{constructor(e,t,i,r=tz()){this.appId=e,this.appName=t,this.namespace=i,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((i,r)=>{const o=t.transaction([Mi],"readonly").objectStore(Mi),a=this.createCompositeKey(e);try{const c=o.get(a);c.onerror=l=>{r(qc(l,"storage-get"))},c.onsuccess=l=>{const u=l.target.result;i(u?u.value:void 0)}}catch(c){r(vt.create("storage-get",{originalErrorMessage:c&&c.message}))}})}async set(e,t){const i=await this.openDbPromise;return new Promise((r,s)=>{const a=i.transaction([Mi],"readwrite").objectStore(Mi),c=this.createCompositeKey(e);try{const l=a.put({compositeKey:c,value:t});l.onerror=u=>{s(qc(u,"storage-set"))},l.onsuccess=()=>{r()}}catch(l){s(vt.create("storage-set",{originalErrorMessage:l&&l.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((i,r)=>{const o=t.transaction([Mi],"readwrite").objectStore(Mi),a=this.createCompositeKey(e);try{const c=o.delete(a);c.onerror=l=>{r(qc(l,"storage-delete"))},c.onsuccess=()=>{i()}}catch(c){r(vt.create("storage-delete",{originalErrorMessage:c&&c.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iz{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),i=this.storage.getActiveConfig(),r=await e;r&&(this.lastFetchStatus=r);const s=await t;s&&(this.lastSuccessfulFetchTimestampMillis=s);const o=await i;o&&(this.activeConfig=o)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rz(){le(new q(OH,n,"PUBLIC").setMultipleInstances(!0)),Q(dd,nv),Q(dd,nv,"esm2017");function n(e,{instanceIdentifier:t}){const i=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(typeof window=="undefined")throw vt.create("registration-window");if(!bt())throw vt.create("indexed-db-unavailable");const{projectId:s,apiKey:o,appId:a}=i.options;if(!s)throw vt.create("registration-project-id");if(!o)throw vt.create("registration-api-key");if(!a)throw vt.create("registration-app-id");t=t||"firebase";const c=new nz(a,i.name,t),l=new iz(c),u=new Cn(dd);u.logLevel=x.ERROR;const h=new GH(r,Rn,t,s,o,a),d=new QH(h,c),f=new KH(d,c,l,u),p=new JH(i,f,l,c,u);return Pk(p),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sz(n){return n=w(n),await Ok(n),Nk(n)}async function oz(){if(!bt())return!1;try{return await Ea()}catch{return!1}}rz();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class az{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return Nk(this._delegate)}ensureInitialized(){return Pk(this._delegate)}fetch(){return Ok(this._delegate)}fetchAndActivate(){return sz(this._delegate)}getAll(){return UH(this._delegate)}getBoolean(e){return $H(this._delegate,e)}getNumber(e){return VH(this._delegate,e)}getString(e){return BH(this._delegate,e)}getValue(e){return oc(this._delegate,e)}setLogLevel(e){qH(this._delegate,e)}}const cz="@firebase/remote-config-compat",lz="0.1.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uz(n){n.INTERNAL.registerComponent(new q("remoteConfig-compat",hz,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:oz})),n.registerVersion(cz,lz)}function hz(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("remote-config").getImmediate({identifier:e});return new az(t,i)}uz(je);var dz="firebase",fz="9.6.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */je.registerVersion(dz,fz,"app-compat");var pz="firebase",gz="9.6.8";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */console.warn(`
It looks like you're using the development build of the Firebase JS SDK.
When deploying Firebase apps to production, it is advisable to only import
the individual SDK components you intend to use.

For the module builds, these are available in the following manner
(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):

CommonJS Modules:
const firebase = require('firebase/app');
require('firebase/<PACKAGE>');

ES Modules:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';

Typescript:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';
`);je.registerVersion(pz,gz,"compat");function Xz(n){const e=Math.cos(n*Math.PI*.5);return Math.abs(e)<1e-14?1:1-e}function rv(n){return Object.prototype.toString.call(n)==="[object Date]"}function Af(n,e){if(n===e||n!==n)return()=>n;const t=typeof n;if(t!==typeof e||Array.isArray(n)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(n)){const i=e.map((r,s)=>Af(n[s],r));return r=>i.map(s=>s(r))}if(t==="object"){if(!n||!e)throw new Error("Object cannot be null");if(rv(n)&&rv(e)){n=n.getTime(),e=e.getTime();const s=e-n;return o=>new Date(n+o*s)}const i=Object.keys(e),r={};return i.forEach(s=>{r[s]=Af(n[s],e[s])}),s=>{const o={};return i.forEach(a=>{o[a]=r[a](s)}),o}}if(t==="number"){const i=e-n;return r=>n+r*i}throw new Error(`Cannot interpolate ${t} values`)}function Jz(n,e={}){const t=i0(n);let i,r=n;function s(o,a){if(n==null)return t.set(n=o),Promise.resolve();r=o;let c=i,l=!1,{delay:u=0,duration:h=400,easing:d=xk,interpolate:f=Af}=pd(pd({},e),a);if(h===0)return c&&(c.abort(),c=null),t.set(n=r),Promise.resolve();const p=$k()+u;let _;return i=Vk(v=>{if(v<p)return!0;l||(_=f(n,o),typeof h=="function"&&(h=h(n,o)),l=!0),c&&(c.abort(),c=null);const P=v-p;return P>h?(t.set(n=o),!1):(t.set(n=_(d(P/h))),!0)}),i.promise}return{set:s,update:(o,a)=>s(o(r,n),a),subscribe:t.subscribe}}export{rL as $,jz as A,t0 as B,pd as C,i0 as D,Uz as E,yz as F,vz as G,Iz as H,wz as I,Wk as J,Gi as K,cn as L,UN as M,mz as N,Cz as O,wa as P,_z as Q,Jz as R,Hz as S,Xz as T,Ez as U,bv as V,Qz as W,Yz as X,zz as Y,hs as Z,_l as _,zk as a,my as a0,gy as a1,hL as a2,KT as a3,md as a4,Pz as a5,Dz as a6,xz as a7,kz as b,Az as c,Gk as d,Hk as e,Oz as f,Tz as g,Xk as h,Gz as i,Nz as j,bz as k,Sz as l,Rz as m,$z as n,Bz as o,Vz as p,Zk as q,Fz as r,Lk as s,Rf as t,Lz as u,Mz as v,Kz as w,Wz as x,e0 as y,qz as z};
